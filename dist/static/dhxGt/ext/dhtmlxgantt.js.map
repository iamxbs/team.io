{"version":3,"sources":["../../../../static/dhxGt/ext/dhtmlxgantt.js"],"names":["gantt","version","event","el","handler","addEventListener","attachEvent","eventRemove","removeEventListener","detachEvent","_eventable","obj","_silent_mode","_silentStart","_silentEnd","name","catcher","callObj","toLowerCase","_eventCatcher","addEvent","callEvent","arg0","apply","checkEvent","dhx_catch","z","res","i","length","zr","arguments","ev","push","removeEvent","id","list","split","detachAllEvents","indexOf","copy","object","t","result","Array","Date","Number","String","Boolean","Object","prototype","hasOwnProperty","mixin","target","source","force","f","defined","uid","_seed","valueOf","bind","functor","isVisible","node","display","visibility","window","getComputedStyle","style","currentStyle","hasNonNegativeTabIndex","isNaN","getAttribute","hasHref","canHaveHref","nodeName","loLowerCase","isEnabled","canDisable","hasAttribute","_getFocusableNodes","getFocusableNodes","root","nodes","querySelectorAll","join","nodesArray","slice","call","isValid","splice","_get_position","elem","top","left","getBoundingClientRect","box","body","document","docElem","documentElement","scrollTop","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","y","Math","round","x","width","offsetWidth","height","offsetHeight","parseInt","offsetTop","offsetLeft","offsetParent","_detectScrollSize","div","createElement","cssText","appendChild","clientWidth","removeChild","dhtmlx","attaches","attachGantt","start","end","cmp","attachObject","dataType","dataObj","that","vs","av","grid","init","firstChild","border","gridId","gridObj","method_name","dhtmlXCellObject","config","templates","links","types","duration_unit","work_time","correct_work_time","skip_off_time","cascade_delete","autosize","autosize_min_width","autoscroll","autoscroll_speed","show_links","show_task_cells","static_background","branch_loading","show_loading","show_chart","show_grid","min_duration","xml_date","api_date","start_on_monday","server_utc","show_progress","fit_tasks","select_task","scroll_on_click","preserve_scroll","readonly","date_grid","drag_links","drag_progress","drag_resize","drag_move","drag_mode","round_dnd_dates","link_wrapper_width","root_id","autofit","columns","tree","resize","align","step","scale_unit","scale_offset_minimal","subscales","inherit_scale_class","time_step","duration_step","date_scale","task_date","time_picker","task_attribute","link_attribute","layer_attribute","buttons_left","_migrate_buttons","buttons_right","lightbox","sections","map_to","type","focus","project_sections","milestone_sections","single_date","drag_lightbox","sort","details_on_create","details_on_dblclick","initial_scroll","task_scroll_offset","order_branch","order_branch_free","task_height","min_column_width","min_grid_column_width","grid_resizer_column_attribute","grid_resizer_attribute","keep_grid_width","grid_resize","show_unscheduled","readonly_property","editable_property","calendar_property","resource_calendars","type_renderers","open_tree_initially","optimize_render","prevent_default_scroll","show_errors","wai_aria_attributes","smart_scales","keys","edit_save","edit_cancel","_init_template","initial","template_name","registeredTemplates","_reg_templates","date","date_to_str","_init_templates","labels","locale","gantt_save_btn","icon_save","gantt_cancel_btn","icon_cancel","gantt_delete_btn","icon_delete","d","c","str_to_date","xml_format","progress_text","task","grid_header_class","column","task_text","text","task_class","grid_row_class","task_row_class","task_cell_class","item","scale_cell_class","scale_row_class","grid_indent","grid_folder","$open","grid_file","grid_open","grid_blank","isUnscheduledTask","task_unscheduled_time","grid_date_format","task_time","link_class","link","link_description","from","getTask","to","drag_link","from_start","to_start","link_start","link_end","drag_link_class","add","allowed","isLinkAllowed","tooltip_date_format","tooltip_text","_click","_dbl_click","_context_menu","_on_click","e","trg","srcElement","locate","default_action","_find_ev_handler","selectTask","_on_contextmenu","src","taskId","linkId","preventDefault","returnValue","hash","css","_getClassName","parentNode","_on_dblclick","showLightbox","_on_mousemove","_last_move_event","_DnD","_obj","_settings","inputMethods","getInputMethods","_drag_start_timer","clearDragTimer","input","down","original_target","touch","setTimeout","dragStart","touch_drag","up","traceDragEvents","domElement","inputMethod","mousemove","dragMove","accessor","scroll","dragScroll","limited_mousemove","cancelBubble","updates_per_second","_checkTimeout","mouseup","move","dragEnd","checkPositionChange","pos","diff_x","diff_y","distance","sqrt","pow","abs","sensitivity","initDnDMarker","marker","className","innerHTML","backupEventTarget","domEvent","getEvent","cloneNode","backup_element","touchEventsSupported","createEvent","touches","elementFromPoint","clientX","clientY","pageX","pageY","navigator","pointerEnabled","pointerType","msPointerEnabled","MSPOINTER_TYPE_MOUSE","clearTimeout","started","getPosition","_prevent_touch_scroll","ignore","_touch_feedback","replace","_init_grid","gantt_close","close","gantt_open","open","gantt_row","showDate","start_date","gantt_grid_head_cell","gantt_add","sorting_method","conf","undefined","_sort","direction","_init_dnd","createTask","_init_resize","_render_grid","_calc_grid_width","_is_grid_visible","_render_grid_header","getGridColumns","cols_width","unknown","v","diff","_get_grid_width","delta","index","grid_width","cells","lineHeigth","scale_height","last","col","colWidth","cssClass","label","ariaAttrs","_waiAria","gridScaleCellAttrString","cell","$grid_scale","lineHeight","_render_grid_item","has_child","value","textValue","aria","gridAddButtonAttrString","template","j","$level","_has_children","gridCellAttrString","getGlobalTaskIndex","$transparent","$dataprocessor_class","css_template","end_date","getState","selected_task","row_height","setAttribute","taskRowAttr","_set_item_state","state","_pull","_refresh_on_toggle_element","refreshData","_is_chart_visible","_x","moveTask","sid","tindex","parent","getParent","getTaskIndex","source_pid","sbranch","getChildren","tbranch","sindex","_replace_branch_child","tid","concat","setParent","_branches","calculateTaskLevel","childTree","_getTaskTree","$drop_target","getPrevSibling","dnd","$grid_data","dnd_sensitivity","_locateHTML","hideQuickInfo","_hideQuickInfo","_is_readonly","initial_open_state","outerHTML","lastTaskOfLevel","level","ids","_order","pull","last_item","len","_getGridPos","gridHeight","getTaskCount","_getTargetY","getScrollState","_getTaskByY","dropIndex","smart_rendering","floor","dd","targetY","isTaskExists","allowedLevel","next","isChildOf","over","hasChild","prev","shift","scrollRange","scrollStep","scrollInterval","interval","startPos","autoscrollInterval","clearInterval","eventPos","setInterval","tick","querySelector","$task","posX","posY","need_scroll","scroll_speed","boxSize","startCoord","scrollState","scrollTo","_wbs","_needRecalc","reset","_isRecalcNeeded","_isGroupSort","_groups","is_active","_getWBSCode","_calcWBS","$virtual","$wbs","_setWBSCode","getWBSCode","_isFirst","eachTask","ch","_prevSibling","_parent","old_has_children","$has_child","_need_dynamic_loading","needLoading","_load_url","was_rendered","getUserData","url","param","_cached_scroll_pos","max","load","encodeURIComponent","_load_type","setUserData","visibleColumns","hide","getGridColumn","htmlTags","RegExp","extraSpaces","stripHTMLLite","htmlText","singleQuotes","escapeQuotes","getAttributeString","attr","attributes","getTimelineCellAttr","dateString","_taskCommonAttr","isSelectedTask","setTaskBarAttr","drag_id","linkAttr","linkTypes","toStart","finish_to_start","start_to_start","fromStart","start_to_finish","content","gridSeparatorAttr","lightboxHiddenAttr","lightboxVisibleAttr","lightboxAttr","lightboxButtonAttrString","buttonName","lightboxHeader","headerText","lightboxSelectAttrString","time_option","years","months","days","hours","minutes","lightboxDurationInputAttrString","section","column_duration","gridAttrString","multiselect","gridScaleRowAttrString","attrs","new_task","gridDataAttrString","messageButtonAttrString","buttonLabel","messageInfoAttr","messageModalAttr","quickInfoAttr","quickInfoHeaderAttrString","quickInfoHeader","header","quickInfoButtonAttrString","tooltipAttr","tooltipVisibleAttr","tooltipHiddenAttr","isDisabled","payload","_scale_helpers","getSum","sizes","summ","setSumWidth","sum_width","scale","parts","oldWidth","adjustSize","full_width","splitSize","count","arr","full","shared","share","sortScales","scales","cellSize","unit","a","b","primaryScale","prepareConfigs","min_coll_width","container_width","heights","configs","main_scale","cfg","initScaleConfig","processIgnores","initColSizes","limitVisibleRange","unshift","alineScaleColumns","setPosSettings","trace_x","_ignore_time_config","skip","probe","isWorkTime","ignore_x","display_count","min_col_width","line_height","cont_width","column_count","col_width","ignores","trace_indexes","eachColumn","iterateScales","lower_scale","upper_scale","callback","upper_dates","lower_dates","prevUpper","target_index","upper_start","upper_end","lower_start","lower_end","targetWidth","actualWidth","_min_date","_max_date","curr","tzOffset","getTimezoneOffset","_correct_dst_change","dates","right","lastDate","outDate","_tasks_dnd","drag","_events","before_start","before_finish","after_finish","_handlers","clear_drag_state","set_actions","evs","stage","mode","_move","_resize","progress","_resize_progress","data","$task_data","on_mouse_move","on_mouse_down","on_mouse_up","start_x","start_y","coords_x","_drag_task_coords","dateFromPos","min_date","max_date","calculateEndDate","duration","_init_task_timing","min","new_start","new_end","posFromDate","obj_s_x","obj_e_x","_mouse_position_change","oldPos","newPos","dx","dy","_is_number","n","parseFloat","isFinite","start_drag","_get_mouse_pos","sX","sY","now","timestamp","_start_dnd","_update_on_move","curr_date","getTime","original","_update_parents","refreshTask","button","_get_drag_mode","_is_flex_task","_fix_dnd_scale_time","_tasks","fixStart","fixEnd","roundDate","_fix_working_times","getClosestWorkTime","dir","correctTaskWorkTime","_fireEvent","_dhx_changed","updateTask","modes","classes","classname","params","assert","trigger","roundTaskDates","drag_state","_render_link","getLink","renders","_get_link_renderers","render_item","_get_link_type","finish_to_finish","_render_link_element","dots","_path_builder","get_points","drawer","_drawer","lines","get_lines","color","cssTemplate","highlight_critical_path","isCriticalLink","size","link_arrow_size","render_line","backgroundColor","endpoint","_render_link_arrow","borderColor","point","line_width","dirs","current_pos","path","clear","line_to","get_path","line","_get_line","get_wrapper_sizes","wrapper_size","line_size","link_line_width","get_line_sizes","marginTop","marginLeft","wrapper","innerPos","inner","get_direction","vect","_y_from_ind","current","point_to","pt","get_endpoint","xy","e_y","e_x","shiftX","forward","sign","_get_task_visible_pos","_init_links_dnd","$task_bars","start_marker","end_marker","link_edge_marker","link_landing_hover_area","resetDndState","_locate_css","_link_source_task_start","_link_source_task","_get_safe_type","milestone","_get_visible_milestone_width","_get_milestone_width","_dir_start","getLinePos","_show_link_points","updateMarkedHtml","_get_task_pos","advanceMarker","landing","_is_link_drop_area","prevTarget","_link_target_task","prevLanding","_link_landing","prevToStart","_link_target_task_start","targ","_dir_end","targetChanged","showDirectingLine","getDndState","addLink","removeDirectionLine","html","s_x","s_y","getDirectionLine","link_direction_class","dist","tan","angle","atan","coordinateCircleQuarter","PI","sin","cos","userAgent","ieTransform","shiftLeft","shiftTop","eX","eY","_direction","$task_links","_get_link_state","link_landing_area","link_target_id","link_target_start","link_source_id","link_source_start","_task_renderer","render_one","filter","_task_area_pulls","_task_area_renderers","container","remove_item","dom","append","rendered","clear_container","render_items","items","buffer","createDocumentFragment","vis","replace_item","item_id","newNode","replaceChild","restore","change_id","oldid","newid","unload","_clear_renderers","_is_layer","dom_element","_init_tasks","columnWidth","gantt_task_link","gantt_scale_cell","coll","_day_index_by_date","coll_date","_delete_link_handler","gantt_link_point","$target","$source","_link_layers","links_layer","addLinkLayer","renderer","_create_filter","_filter_link","_get_link_filters","_linkRenderer","getRenderer","_task_layers","bar_layer","addTaskLayer","_render_task_element","_filter_task","_get_task_filters","_taskRenderer","_render_bg_line","$task_bg","_is_std_background","refreshId","oldId","newId","_onTaskIdChange","render","_get_task_renderers","_onLinkIdChange","_isAllowedUnscheduledTask","isTaskVisible","title","question","confirm_link_deleting","_dhtmlx_confirm","deleteLink","getTaskNode","getLinkNode","_get_tasks_data","rows","order","_get_data_range","$index","resetProjectDates","_get_links_data","_links","_render_data","_order_synced","_sync_order","renderers","_update_layout_sizes","_scroll_resize","bar_height","_get_task_height","taskHeight","_y","_scroll_sizes","scroll_size","getVisibleTaskCount","backgroundImage","data_els","childNodes","_scale_range_unit","_get_scales","_init_tasks_range","start_interval","range","getSubtaskDates","_prepare_scale_html","fromPos","toPos","startIndex","endIndex","_findBinary","cssclass","position","ariaAttr","newValue","val","helpers","_get_scale_chunk_html","tplClass","_refreshScales","_scales","$task_scale","oldLeft","oldTop","_render_tasks_scales","_set_sizes","scales_html","outer_width","data_width","_get_resize_options","avail_width","cfgs","scrollSizes","row","odd","getTaskTop","_adjust_scales","old_min","old_max","refresh_links","refreshLink","isLinkExists","_combine_item_class","basic","itemId","project","isCriticalTask","from_id","allowDrag","dragClass","_render_pair","origWidth","getTaskPosition","x2","_get_task_width","_task_default_render","padd","_render_task_progress","_render_task_content","textColor","progressColor","styles","side","_render_leftside_content","_render_rightside_content","outer","painters","defaultRenderer","_render_side_content","_get_link_crossing_css","leftside_text","rightside_text","_get_conditions","leftside","cond","ln","tp","element","maxWidth","done","pr","opacity","steps","hour","ind","part","_get_coll_duration","wholeCells","partCell","day_ind","day","array","low","high","_get_x_pos","task_id","_get_task_coord","x_correction","isMilestone","_default_task_date","mstoneCorrection","_correct_shift","back","env","isIE","_layers","prepareConfig","create","get_container","rel_root","tempCollection","getRenderers","layer","pending","topmost","rel","insertBefore","remove","filter_methods","filter_method","_add_generic_layer","layersManager","filters","removeTaskLayer","removeLinkLayer","_lpull","_order_full","cl","ajax","get","l","on_load","parse","xmlDoc","responseText","serialize","resp","raw","_process_loading","_load_task","_init_task","_build_pull","tasks","loaded","_build_hierarchy","_add_branch","collections","_load_collections","_init_links","showTask","_init_link","_sync_links","collections_loaded","key","collection","serverList","option","option_key","silent","_order_search","_sync_order_item","$ignore","hidden","children","getLinkCount","branch","_get_visible_order","code","master","_eachParent","startTask","json","JSON","dhx_security","security_key","serializeTask","_copyObject","serializeLink","_copyLink","charAt","rawLinks","getLinks","xml","_xmlNodeToJSON","attrs_only","child","nodeType","tagName","nodeValue","_getCollections","loader","opts","xpath","itms","itm","k","_getXML","toptag","getXMLTopNode","xmltop","skey","oldxml","startdate","est","enddate","predecessortasks","message","_calendars","calendarArgumentsHelper","getWorkHoursArguments","setWorkTimeArguments","unsetWorkTimeArguments","isWorkTimeArguments","calendar","getClosestWorkTimeArguments","getDurationConfig","_getStartEndConfig","argumentType","getDurationArguments","hasDurationArguments","calculateEndDateArguments","calendarStrategy","units","_workingUnitsCache","cache","_cache","time","put","_getUnitOrder","_timestamp","settings","UTC","getFullYear","getMonth","getDate","_checkIfWorkingUnit","_isWorkTime","_is_work_day","_getWorkHours","_is_work_hour","getHours","_internDatesPull","_nextDate","_getWorkUnitsBetweenGeneric","stepStart","stepEnd","checkFirst","checkLast","isLastStep","_getHoursPerDay","_getWorkHoursForRange","_getWorkUnitsBetweenHours","firstDayStart","firstDayEnd","day_start","lastDayStart","lastDayEnd","startPart","endPart","hourRange","_getCalendar","worktime","_setCalendar","_tryChangeCalendarSettings","backup","stringify","_isEmptyCalendar","datesArray","isFullWeekSet","checkFullArray","getWorkHours","getDay","setWorkTime","unsetWorkTime","reset_calendar","is_work_unit","calculateDuration","hasDuration","mult","_calculateEndDate","added","_getClosestWorkTime","future_target","prev_target","maximum_loop","both_directins","inc","disabledWorkTimeCalendar","_calculateDuration","fixedUnits","workingUnitsCache","CalendarAPICore","calendarManager","_getDayHoursForMultiple","calendars","currPos","is_work_hour","reduce","acc","mergeCalendars","newCalendar","createCalendar","_convertWorktimeSettings","parentCalendar","defaults","fulltime","apiCore","getCalendar","createDefaultCalendars","getCalendars","getTaskCalendar","field","resource","calendarId","addCalendar","worktimes","deleteCalendar","restoreConfigCalendars","global","_timeCalculator","manager","calManager","getTaskByTime","p","taken","Infinity","unscheduled","_is_parent_sync","_resync_parent","pid","added_already","_sync_parent","_move_branch","old_parent","new_parent","$rendered_parent","old_id","new_id","newbranch","addTask","parent_id","startDate","first","_set_default_task_timing","parentObj","$new","deleteTask","_deleteTask","_getChildLinks","branches","_deleteRelatedLinks","use_dp","_dp","prev_mode","send_changes","updateMode","setUpdateMode","setGanttMode","setUpdated","_deleteLink","sendAllData","_deleteRelatedTasks","t_id","_unset_task","_update_flags","clearAll","_clear_data","userdata","_lightbox_id","_selected_task","changeTaskId","_get_task_links","_get_duration_unit","_get_type_name","type_value","_hasDuration","parseDate","_get_task_timing_mode","task_type","$no_start","$no_end","$rendered_type","task_mode","dirty","taskMode","_assign_project_dates","taskTiming","has_changed","oldStart","oldEnd","child_id","upper","lower","colIndex","desc","criteria","original_criteria","els","temp","getNext","getPrev","_get_parent_id","new_pid","getSiblings","getNextSibling","siblings","_dp_init","dp","setTransactionMode","serverProcessor","_serverProcessor","updated","inserted","deleted","invalid","error","_methods","_ganttMode","_in_progress","_invalid","updatedRows","newState","_sendTaskOrder","clientSideDelete","clientOnly","needDbDelete","_tSend","_waitMode","itemLinks","batchUpdate","updateLink","_tMode","substr","substring","_urlSeparator","_init_dp_live_update_hooks","afterUpdate","reqUrl","filePath","_getRowData","pref","action_param","_change_id","changeLinkId","_row_style","row_id","_delete_task","_get_linked_task","getTarget","role","_get_link_target","_get_link_source","_isTask","_isProject","_configure","_init_skin","_get_skin","skin","getElementsByTagName","href","match","skins","skinset","_second_column_width","_third_column_width","_lightbox_template","resetLightbox","resetSkin","_lightbox_methods","getLightbox","_center_lightbox","showCover","_fill_lightbox","_get_timepicker_step","getLabel","property","_get_typed_lightbox_config","options","updateCollection","list_name","getLightboxType","_lightbox_type","_lightbox","_is_lightbox_timepicker","wide_form","buttons","onmousedown","_ready_to_dnd","onselectstart","cursor","_init_dnd_events","sns","_render_sections","ds","t_ds","getElementById","labelBlock","inputBlock","nextSibling","inputId","resizeLightbox","_init_lightbox_events","block","form_blocks","con","scrollHeight","lightbox_additional_height","scroll_top","scroll_left","view_height","innerHeight","clientHeight","scrollWidth","_cover","_document_height","_scroll_height","lightbox_events","_save_lightbox","$click","hideLightbox","_cancel_lightbox","sec","button_click","previousSibling","func","onkeydown","buttonTarget","keyCode","shiftKey","click","getLightboxValues","_resolve_default_mapping","mapping","time_controls","get_value","hideCover","_custom_lightbox","_set_lightbox_values","s","lightbox_header","default_value","set_value","getLightboxSection","getValue","setValue","get_template_control","control","get_select_control","get_textarea_control","get_time_control","_move_while_dnd","_finish_dnd","_dnd_start_lb","gantt_unselectable","lb","_lb_start","_focus","select","getTimePicker","time_format","_time_format_order","dt","date_part","limit_time_select","last_hour","first_hour","setHours","offset","start_year","end_year","year_range","month_full","tdate","_time_values","setTime","getMinutes","_fill_lightbox_select","map","textarea","_get_input","_dhx_onchange","onchange","map_size","_time_format_size","auto_end_date","_update_lightbox_select","mapped_fields","singleDate","inps","btns","endspan","_calc_date","_get_start_date","_get_duration","_change_duration","onclick","charCode","which","duration_val","_filter","_display","allow_root","root_label","tmpDom","newOptions","onselect","ok","confirm","_silent_redraw_lightbox","oldType","formData","updTask","_extend_to_optional","lightbox_block","optional_time","disable","enable","disabled","update_block","button_text","duration_optional","time_optional","dataProcessor","serverProcessorURL","autoUpdate","_headers","_payload","post_delim","mandatoryFields","messages","invalid_cell","enableUTFencoding","total","headers","_endnm","escape","_utf","setDataColumns","_columns","getSyncState","enableDataNames","enablePartialDataSend","_changed","rowId","findRow","existing","set_invalid","is_invalid","_clearUpdateFlag","markRow","sendData","str","details","toString","checkBeforeUpdate","mytype","_h2","editStop","_beforeSendData","_sendData","serialize_one","stack","_applyPayload","a1","a3","_user","a4","query","method","action","gr_id","valid","_getAllData","out","has_one","setVerificator","verifFunction","clearVerificator","pattern","defineAction","_uActions","afterUpdateCallback","btag","correct","soid","tag","finalizeUpdate","cleanUpdate","atag","anObj","setOnAfterUpdate","enableDebug","setOnBeforeUpdateHandler","setAutoUpdate","user","_need_update","_update_busy","xml_node","afterAutoUpdate","fullSync","self","loadUpdate","getUpdates","_v","_a","vers","upds","status","_insert_callback","_update_callback","_delete_callback","upd","objData","methods","isExist","check","expire","resizeDelay","$container","_reinit","_init_html_area","_init_touch_events","_set_scroll_events","gridAriaAttr","gridDataAriaAttr","childs","$grid","$scroll_ver","$scroll_hor","confirm_deleting","confirm_deleting_title","_calculate_content_height","rows_height","hor_scroll_height","_scroll_hor","_calculate_content_width","chart_width","ver_scroll_width","_scroll_ver","_clean_el_size","_get_box_styles","computed","properties","boxSizing","MozBoxSizing","horPaddings","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","vertPaddings","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","borderBox","innerWidth","outerWidth","outerHeight","_do_autosize","boxSizes","reqHeight","reqWidth","dataHeight","gridWidth","_save_scroll_state","_restore_scroll_state","oldScrollState","date_x","scroll_to","_on_resize","setSizes","visible_date","new_pos","new_date","_wheel_time","_touch_scroll_active","prevTop","barLeft","barTop","ff","isFF","onMouseWheel","wx","deltaX","wheelDeltaX","wy","deltaY","wheelDelta","detail","scrolls","x_inner","y_inner","task_width","task_data_height","scroll_ver","task_data_width","scroll_hor","baseVal","_trim","_get_target_node","attribute","test","trim","strict","getTaskRowNode","drag_from_start","_touch_drag","scale_step","host","updPerSecond","timeout","_on_timeout","unselectTask","getSelectedId","changeLightboxType","_is_render_active","_skip_render","prevOffset","time_unit","offsetChanged","_disableMethod","methodName","dummyMethod","_restoreMethod","_disableMethods","methodsHash","_restoreMethods","_batchUpdatePayload","console","noRedraw","call_dp","dp_mode","resetProjects","isIE6","XMLHttpRequest","isIE7","isIE8","isOpera","isChrome","isKHTML","isIPad","search","isEdge","DOMParser","parseFromString","ActiveXObject","async","loadXML","tagname","xhr","responseXML","xpathExp","docObj","selectNodes","ownerDocument","evaluate","XPathResult","ANY_TYPE","iterateNext","_call","onLoad","getSync","postData","del","post","postSync","getLong","postLong","longParams","isQt","onreadystatechange","readyState","setRequestHeader","toUpperCase","send","_dhx_msg_cfg","usercall","modalbox","modal_key","keyboard","modality","cover","buttonAriaAttrs","button_css","info","area","timers","getFirstDefined","values","_boxStructure","cancel","contentId","message_ok","message_cancel","_createBox","alertPopup","confirmPopup","boxPopup","box_params","alert","focusable","subtype","seed","hideAll","month_short","month_short_hash","month_full_hash","old","hour_start","time_part","week_start","month_start","setDate","year_start","setMonth","setMinutes","minute_start","getSeconds","setSeconds","getMilliseconds","setMilliseconds","_add_days","ndate","setYear","to_fixed","num","format","utc","Function","splt","mask","getISOWeek","nday","first_thursday","year_number","ordinal_date","week_number","getUTCISOWeek","convert_to_utc","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","quarter_start","m","res_month","add_quarter","jQuery","$","fn","dhx_gantt","views","each","day_full","day_short","icon_details","icon_edit","confirm_closing","section_description","section_time","section_type","column_text","column_start_date","column_add","type_task","type_project","type_milestone","weeks","skyblue","meadow","terrace","broadway","_config_buttons_left","_config_buttons_right","touch_feedback","touch_feedback_duration","vibrate","_touch_events","names","dblclicktime","action_mode","scroll_mode","dblclick_timer","action_start","scroll_state","long_tap_timer","current_target","_gantt_touch_event_ready","new_scroll_state","block_action","cloneTaskRendered","deprecated","badCode","goodCode","formatting","log","warn","args","wrapDeprecated","dhtmlxMethods"],"mappings":"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","file":"dhtmlxgantt.js","sourcesContent":["/*\r\n @license\r\n\r\n dhtmlxGantt v.4.2.1 Stardard\r\n This software is covered by GPL license. You also can obtain Commercial or Enterprise license to use it in non-GPL project - please contact sales@dhtmlx.com. Usage without proper license is prohibited.\r\n\r\n (c) Dinamenta, UAB.\r\n */\r\n\r\ngantt = {\r\n  version: \"4.2.1\"\r\n};\r\n\r\n/*jsl:ignore*/\r\n//import from dhtmlxcommon.js\r\ngantt.event = function (el, event, handler) {\r\n  if (el.addEventListener)\r\n    el.addEventListener(event, handler, false);\r\n\r\n  else if (el.attachEvent)\r\n    el.attachEvent(\"on\" + event, handler);\r\n};\r\n\r\n\r\ngantt.eventRemove = function (el, event, handler) {\r\n  if (el.removeEventListener)\r\n    el.removeEventListener(event, handler, false);\r\n\r\n  else if (el.detachEvent)\r\n    el.detachEvent(\"on\" + event, handler);\r\n};\r\n\r\n\r\n/** Overrides event functionality.\r\n *  Includes all default methods from dhtmlx.common but adds _silentStart, _silendEnd\r\n *   @desc:\r\n *   @type: private\r\n */\r\ngantt._eventable = function (obj) {\r\n  obj._silent_mode = false;\r\n  obj._silentStart = function () {\r\n    this._silent_mode = true;\r\n  };\r\n  obj._silentEnd = function () {\r\n    this._silent_mode = false;\r\n  };\r\n  obj.attachEvent = function (name, catcher, callObj) {\r\n    name = 'ev_' + name.toLowerCase();\r\n    if (!this[name])\r\n      this[name] = new this._eventCatcher(callObj || this);\r\n\r\n    return (name + ':' + this[name].addEvent(catcher)); //return ID (event name & event ID)\r\n  };\r\n  obj.callEvent = function (name, arg0) {\r\n    if (this._silent_mode) return true;\r\n    name = 'ev_' + name.toLowerCase();\r\n    if (this[name])\r\n      return this[name].apply(this, arg0);\r\n    return true;\r\n  };\r\n  obj.checkEvent = function (name) {\r\n    return (!!this['ev_' + name.toLowerCase()]);\r\n  };\r\n  obj._eventCatcher = function (obj) {\r\n    var dhx_catch = [];\r\n    var z = function () {\r\n      var res = true;\r\n      for (var i = 0; i < dhx_catch.length; i++) {\r\n        if (dhx_catch[i]) {\r\n          var zr = dhx_catch[i].apply(obj, arguments);\r\n          res = res && zr;\r\n        }\r\n      }\r\n      return res;\r\n    };\r\n    z.addEvent = function (ev) {\r\n      if (typeof (ev) == \"function\")\r\n        return dhx_catch.push(ev) - 1;\r\n      return false;\r\n    };\r\n    z.removeEvent = function (id) {\r\n      dhx_catch[id] = null;\r\n    };\r\n    return z;\r\n  };\r\n  obj.detachEvent = function (id) {\r\n    if (id) {\r\n      var list = id.split(':');           //get EventName and ID\r\n      this[list[0]].removeEvent(list[1]); //remove event\r\n    }\r\n  };\r\n  obj.detachAllEvents = function () {\r\n    for (var name in this) {\r\n      if (name.indexOf(\"ev_\") === 0)\r\n        delete this[name];\r\n    }\r\n  };\r\n  obj = null;\r\n};\r\n\r\n\r\n/*jsl:end*/\r\n\r\n\r\ngantt.copy = function (object) {\r\n  var i, t, result; // iterator, types array, result\r\n\r\n  if (object && typeof object == \"object\") {\r\n    result = {};\r\n    t = [Array, Date, Number, String, Boolean];\r\n    for (i = 0; i < t.length; i++) {\r\n      if (object instanceof t[i])\r\n        result = i ? new t[i](object) : new t[i](); // first one is array\r\n    }\r\n\r\n    for (i in object) {\r\n      if (Object.prototype.hasOwnProperty.apply(object, [i]))\r\n        result[i] = gantt.copy(object[i]);\r\n    }\r\n  }\r\n  return result || object;\r\n};\r\n\r\ngantt.mixin = function (target, source, force) {\r\n  for (var f in source)\r\n    if ((!target[f] || force)) target[f] = source[f];\r\n  return target;\r\n};\r\n\r\n\r\ngantt.defined = function (obj) {\r\n  return typeof(obj) != \"undefined\";\r\n};\r\n\r\ngantt.uid = function () {\r\n  if (!this._seed)\r\n    this._seed = (new Date()).valueOf();\r\n\r\n  this._seed++;\r\n  return this._seed;\r\n};\r\n\r\n\r\n//creates function with specified \"this\" pointer\r\ngantt.bind = function (functor, object) {\r\n  if (functor.bind)\r\n    return functor.bind(object);\r\n  else\r\n    return function () {\r\n      return functor.apply(object, arguments);\r\n    };\r\n};\r\n\r\n(function () {\r\n  function isVisible(node) {\r\n    var display = false,\r\n        visibility = false;\r\n    if (window.getComputedStyle) {\r\n      var style = window.getComputedStyle(node, null);\r\n      display = style[\"display\"];\r\n      visibility = style[\"visibility\"];\r\n    } else if (node.currentStyle) {\r\n      display = node.currentStyle[\"display\"];\r\n      visibility = node.currentStyle[\"visibility\"];\r\n    }\r\n    return (display != \"none\" && visibility != \"hidden\");\r\n  }\r\n\r\n  function hasNonNegativeTabIndex(node) {\r\n    return !isNaN(node.getAttribute(\"tabindex\")) && (node.getAttribute(\"tabindex\") * 1 >= 0);\r\n  }\r\n\r\n  function hasHref(node) {\r\n    var canHaveHref = {\"a\": true, \"area\": true};\r\n    if (canHaveHref[node.nodeName.loLowerCase()]) {\r\n      return !!node.getAttribute(\"href\");\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function isEnabled(node) {\r\n    var canDisable = {\"input\": true, \"select\": true, \"textarea\": true, \"button\": true, \"object\": true};\r\n    if (canDisable[node.nodeName.toLowerCase()]) {\r\n      return !node.hasAttribute(\"disabled\");\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n\r\n  gantt._getFocusableNodes = function getFocusableNodes(root) {\r\n    var nodes = root.querySelectorAll([\r\n      \"a[href]\",\r\n      \"area[href]\",\r\n      \"input\",\r\n      \"select\",\r\n      \"textarea\",\r\n      \"button\",\r\n      \"iframe\",\r\n      \"object\",\r\n      \"embed\",\r\n      \"[tabindex]\",\r\n      \"[contenteditable]\"\r\n    ].join(\", \"));\r\n\r\n    var nodesArray = Array.prototype.slice.call(nodes, 0);\r\n    for (var i = 0; i < nodesArray.length; i++) {\r\n      var node = nodesArray[i];\r\n      var isValid = (hasNonNegativeTabIndex(node) || isEnabled(node) || hasHref(node)) && isVisible(node);\r\n      if (!isValid) {\r\n        nodesArray.splice(i, 1);\r\n        i--;\r\n      }\r\n    }\r\n    return nodesArray;\r\n  };\r\n})();\r\n\r\n//returns position of html element on the page\r\ngantt._get_position = function (elem) {\r\n  var top = 0, left = 0;\r\n  if (elem.getBoundingClientRect) { //HTML5 method\r\n    var box = elem.getBoundingClientRect();\r\n    var body = document.body;\r\n    var docElem = document.documentElement;\r\n    var scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\r\n    var scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\r\n    var clientTop = docElem.clientTop || body.clientTop || 0;\r\n    var clientLeft = docElem.clientLeft || body.clientLeft || 0;\r\n    top = box.top + scrollTop - clientTop;\r\n    left = box.left + scrollLeft - clientLeft;\r\n    return {y: Math.round(top), x: Math.round(left), width: elem.offsetWidth, height: elem.offsetHeight};\r\n  } else { //fallback to naive approach\r\n    while (elem) {\r\n      top = top + parseInt(elem.offsetTop, 10);\r\n      left = left + parseInt(elem.offsetLeft, 10);\r\n      elem = elem.offsetParent;\r\n    }\r\n    return {y: top, x: left, width: elem.offsetWidth, height: elem.offsetHeight};\r\n  }\r\n};\r\n\r\n\r\ngantt._detectScrollSize = function () {\r\n  var div = document.createElement(\"div\");\r\n  div.style.cssText = \"visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;\";\r\n\r\n  document.body.appendChild(div);\r\n  var width = div.offsetWidth - div.clientWidth;\r\n  document.body.removeChild(div);\r\n\r\n  return width;\r\n};\r\n\r\nif (window.dhtmlx) {\r\n\r\n  if (!dhtmlx.attaches)\r\n    dhtmlx.attaches = {};\r\n\r\n  dhtmlx.attaches.attachGantt = function (start, end, gantt) {\r\n    var obj = document.createElement(\"DIV\");\r\n\r\n    gantt = gantt || window.gantt;\r\n\r\n    obj.id = \"gantt_\" + gantt.uid();\r\n    obj.style.width = \"100%\";\r\n    obj.style.height = \"100%\";\r\n    obj.cmp = \"grid\";\r\n\r\n    document.body.appendChild(obj);\r\n    this.attachObject(obj.id);\r\n    this.dataType = \"gantt\";\r\n    this.dataObj = gantt;\r\n\r\n    var that = this.vs[this.av];\r\n    that.grid = gantt;\r\n\r\n    gantt.init(obj.id, start, end);\r\n    obj.firstChild.style.border = \"none\";\r\n\r\n    that.gridId = obj.id;\r\n    that.gridObj = obj;\r\n\r\n    var method_name = \"_viewRestore\";\r\n    return this.vs[this[method_name]()].grid;\r\n  };\r\n\r\n}\r\nif (typeof(window.dhtmlXCellObject) != \"undefined\") {\r\n\r\n  dhtmlXCellObject.prototype.attachGantt = function (start, end, gantt) {\r\n    gantt = gantt || window.gantt;\r\n\r\n    var obj = document.createElement(\"DIV\");\r\n    obj.id = \"gantt_\" + gantt.uid();\r\n    obj.style.width = \"100%\";\r\n    obj.style.height = \"100%\";\r\n    obj.cmp = \"grid\";\r\n\r\n    document.body.appendChild(obj);\r\n    this.attachObject(obj.id);\r\n\r\n    this.dataType = \"gantt\";\r\n    this.dataObj = gantt;\r\n\r\n    gantt.init(obj.id, start, end);\r\n    obj.firstChild.style.border = \"none\";\r\n    var method_name = \"_viewRestore\";\r\n    obj = null;\r\n    this.callEvent(\"_onContentAttach\", []);\r\n\r\n    return this.dataObj;\r\n  };\r\n\r\n}\r\n\r\n\r\ngantt._eventable(gantt);\r\n\r\n/*\r\n %d - the day as a number with a leading zero ( 01 to 31 );\r\n %j - the day as a number without a leading zero ( 1 to 31 );\r\n %D - the day as an abbreviation ( Sun to Sat );\r\n %l - the day as a full name ( Sunday to Saturday );\r\n %W - the ISO-8601 week number of the year. Weeks start on Monday; 1)\r\n %m - the month as a number without a leading zero ( 1 to 12 );\r\n %n - the month as a number with a leading zero ( 01 to 12);\r\n %M - the month as an abbreviation ( Jan to Dec );\r\n %F - the month as a full name ( January to December );\r\n %y - the year as a two-digit number ( 00 to 99 );\r\n %Y - the year as a four-digit number ( 19009999 );\r\n %h - the hour based on the 12-hour clock ( 00 to 11 );\r\n %H - the hour based on the 24-hour clock ( 00 to 23 );\r\n %i - the minute as a number with a leading zero ( 00 to 59 );\r\n %s - the second as a number without a leading zero ( 00 to 59 ); 2)\r\n %a - displays am (for times from midnight until noon) and pm (for times from noon until midnight);\r\n %A - displays AM (for times from midnight until noon) and PM (for times from noon until midnight).\r\n\r\n */\r\n\r\nif (!gantt.config) gantt.config = {};\r\nif (!gantt.config) gantt.config = {};\r\nif (!gantt.templates) gantt.templates = {};\r\n\r\n(function () {\r\n\r\n  gantt.mixin(gantt.config,\r\n      {\r\n        links: {\r\n          \"finish_to_start\": \"0\",\r\n          \"start_to_start\": \"1\",\r\n          \"finish_to_finish\": \"2\",\r\n          \"start_to_finish\": \"3\"\r\n        },\r\n        types: {\r\n          'task': 'task',\r\n          'project': 'project',\r\n          'milestone': 'milestone'\r\n        },\r\n        duration_unit: \"day\",\r\n        work_time: false,\r\n        correct_work_time: false,\r\n        skip_off_time: false,\r\n\r\n        cascade_delete: true,\r\n\r\n        autosize: false,\r\n        autosize_min_width: 0,\r\n        autoscroll: true,\r\n        autoscroll_speed: 30,\r\n\r\n        show_links: true,\r\n        show_task_cells: true,\r\n        // replace backgroung of the task area with a canvas img\r\n        static_background: false,\r\n        branch_loading: false,\r\n        show_loading: false,\r\n        show_chart: true,\r\n        show_grid: true,\r\n        min_duration: 60 * 60 * 1000,\r\n        xml_date: \"%d-%m-%Y %H:%i\",\r\n        api_date: \"%d-%m-%Y %H:%i\",\r\n        start_on_monday: true,\r\n        server_utc: false,\r\n        show_progress: true,\r\n        fit_tasks: false,\r\n        select_task: true,\r\n        scroll_on_click: true,\r\n        preserve_scroll: true,\r\n        readonly: false,\r\n\r\n        /*grid */\r\n        date_grid: \"%Y-%m-%d\",\r\n\r\n        drag_links: true,\r\n        drag_progress: true,\r\n        drag_resize: true,\r\n        drag_move: true,\r\n        drag_mode: {\r\n          \"resize\": \"resize\",\r\n          \"progress\": \"progress\",\r\n          \"move\": \"move\",\r\n          \"ignore\": \"ignore\"\r\n        },\r\n        round_dnd_dates: true,\r\n        link_wrapper_width: 20,\r\n        root_id: 0,\r\n\r\n        autofit: false, // grid column automatic fit grid_width config\r\n        columns: [\r\n          {name: \"text\", tree: true, width: '*', resize: true},\r\n          {name: \"start_date\", align: \"center\", resize: true},\r\n          {name: \"duration\", align: \"center\"},\r\n          {name: \"add\", width: '44'}\r\n        ],\r\n\r\n        /*scale*/\r\n        step: 1,\r\n        scale_unit: \"day\",\r\n        scale_offset_minimal: true,\r\n        subscales: [],\r\n\r\n        inherit_scale_class: false,\r\n\r\n        time_step: 60,\r\n        duration_step: 1,\r\n        date_scale: \"%d %M\",\r\n        task_date: \"%d %F %Y\",\r\n        time_picker: \"%H:%i\",\r\n        task_attribute: \"task_id\",\r\n        link_attribute: \"link_id\",\r\n        layer_attribute: \"data-layer\",\r\n        buttons_left: [\r\n          \"gantt_save_btn\",\r\n          \"gantt_cancel_btn\"\r\n        ],\r\n        _migrate_buttons: {\r\n          \"dhx_save_btn\": \"gantt_save_btn\",\r\n          \"dhx_cancel_btn\": \"gantt_cancel_btn\",\r\n          \"dhx_delete_btn\": \"gantt_delete_btn\"\r\n        },\r\n        buttons_right: [\r\n          \"gantt_delete_btn\"\r\n        ],\r\n        lightbox: {\r\n          sections: [\r\n            {name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n            {name: \"time\", type: \"duration\", map_to: \"auto\"}\r\n          ],\r\n          project_sections: [\r\n            {name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n            {name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n            {name: \"time\", type: \"duration\", readonly: true, map_to: \"auto\"}\r\n          ],\r\n          milestone_sections: [\r\n            {name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n            {name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n            {name: \"time\", type: \"duration\", single_date: true, map_to: \"auto\"}\r\n          ]\r\n        },\r\n        drag_lightbox: true,\r\n        sort: false,\r\n        details_on_create: true,\r\n        details_on_dblclick: true,\r\n        initial_scroll: true,\r\n        task_scroll_offset: 100,\r\n\r\n        order_branch: false,\r\n        order_branch_free: false,\r\n\r\n        task_height: \"full\",//number px of 'full' for row height\r\n        min_column_width: 70,\r\n\r\n        // min width for grid column (when resizing)\r\n        min_grid_column_width: 70,\r\n        // name of the attribute with column index for resize element\r\n        grid_resizer_column_attribute: \"column_index\",\r\n        // name of the attribute with column index for resize element\r\n        grid_resizer_attribute: \"grid_resizer\",\r\n\r\n        // grid width can be increased after the column has been resized\r\n        keep_grid_width: false,\r\n\r\n        // grid width can be adjusted\r\n        grid_resize: false,\r\n\r\n        show_unscheduled: true,\r\n\r\n        //\r\n        readonly_property: \"readonly\",\r\n        editable_property: \"editable\",\r\n        calendar_property: \"calendar_id\",\r\n        resource_calendars: {},\r\n\r\n        type_renderers: {},\r\n\r\n        open_tree_initially: false,\r\n        optimize_render: true,\r\n        prevent_default_scroll: false,\r\n        show_errors: true,\r\n        wai_aria_attributes: true,\r\n        smart_scales: true\r\n      });\r\n  gantt.keys = {\r\n    edit_save: 13,\r\n    edit_cancel: 27\r\n  };\r\n\r\n  gantt._init_template = function (name, initial, template_name) {\r\n    var registeredTemplates = this._reg_templates || {};\r\n    template_name = template_name || name;\r\n    if (this.config[name] && registeredTemplates[template_name] != this.config[name]) {\r\n      if (!(initial && this.templates[template_name])) {\r\n        this.templates[template_name] = this.date.date_to_str(this.config[name]);\r\n        registeredTemplates[template_name] = this.config[name];\r\n      }\r\n    }\r\n    this._reg_templates = registeredTemplates;\r\n  };\r\n  gantt._init_templates = function () {\r\n    var labels = gantt.locale.labels;\r\n    labels.gantt_save_btn = labels.icon_save;\r\n    labels.gantt_cancel_btn = labels.icon_cancel;\r\n    labels.gantt_delete_btn = labels.icon_delete;\r\n\r\n\r\n    //build configuration based templates\r\n    var d = this.date.date_to_str;\r\n    var c = this.config;\r\n    gantt._init_template(\"date_scale\", true);\r\n    gantt._init_template(\"date_grid\", true, \"grid_date_format\");\r\n    gantt._init_template(\"task_date\", true);\r\n\r\n    gantt.mixin(this.templates, {\r\n      xml_date: this.date.str_to_date(c.xml_date, c.server_utc),\r\n      xml_format: d(c.xml_date, c.server_utc),\r\n      api_date: this.date.str_to_date(c.api_date),\r\n      progress_text: function (start, end, task) {\r\n        return \"\";\r\n      },\r\n      grid_header_class: function (column, config) {\r\n        return \"\";\r\n      },\r\n\r\n      task_text: function (start, end, task) {\r\n        return task.text;\r\n      },\r\n      task_class: function (start, end, task) {\r\n        return \"\";\r\n      },\r\n      grid_row_class: function (start, end, task) {\r\n        return \"\";\r\n      },\r\n      task_row_class: function (start, end, task) {\r\n        return \"\";\r\n      },\r\n      task_cell_class: function (item, date) {\r\n        return \"\";\r\n      },\r\n      scale_cell_class: function (date) {\r\n        return \"\";\r\n      },\r\n      scale_row_class: function (date) {\r\n        return \"\";\r\n      },\r\n\r\n      grid_indent: function (item) {\r\n        return \"<div class='gantt_tree_indent'></div>\";\r\n      },\r\n      grid_folder: function (item) {\r\n        return \"<div class='gantt_tree_icon gantt_folder_\" + (item.$open ? \"open\" : \"closed\") + \"'></div>\";\r\n      },\r\n      grid_file: function (item) {\r\n        return \"<div class='gantt_tree_icon gantt_file'></div>\";\r\n      },\r\n      grid_open: function (item) {\r\n        return \"<div class='gantt_tree_icon gantt_\" + (item.$open ? \"close\" : \"open\") + \"'></div>\";\r\n      },\r\n      grid_blank: function (item) {\r\n        return \"<div class='gantt_tree_icon gantt_blank'></div>\";\r\n      },\r\n      date_grid: function (date, item) {\r\n        if (item && gantt.isUnscheduledTask(item) && gantt.config.show_unscheduled) {\r\n          return gantt.templates.task_unscheduled_time(item);\r\n        } else {\r\n          return gantt.templates.grid_date_format(date);\r\n        }\r\n      },\r\n\r\n      task_time: function (start, end, ev) {\r\n        if (gantt.isUnscheduledTask(ev) && gantt.config.show_unscheduled) {\r\n          return gantt.templates.task_unscheduled_time(ev);\r\n        } else {\r\n          return gantt.templates.task_date(start) + \" - \" + gantt.templates.task_date(end);\r\n        }\r\n      },\r\n\r\n      task_unscheduled_time: function (task) {\r\n        return \"\";\r\n      },\r\n\r\n      time_picker: d(c.time_picker),\r\n      link_class: function (link) {\r\n        return \"\";\r\n      },\r\n      link_description: function (link) {\r\n        var from = gantt.getTask(link.source),\r\n            to = gantt.getTask(link.target);\r\n\r\n        return \"<b>\" + from.text + \"</b> &ndash;  <b>\" + to.text + \"</b>\";\r\n      },\r\n\r\n      drag_link: function (from, from_start, to, to_start) {\r\n        from = gantt.getTask(from);\r\n        var labels = gantt.locale.labels;\r\n\r\n        var text = \"<b>\" + from.text + \"</b> \" + (from_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n        if (to) {\r\n          to = gantt.getTask(to);\r\n          text += \"<b> \" + to.text + \"</b> \" + (to_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n        }\r\n        return text;\r\n      },\r\n      drag_link_class: function (from, from_start, to, to_start) {\r\n        var add = \"\";\r\n\r\n        if (from && to) {\r\n          var allowed = gantt.isLinkAllowed(from, to, from_start, to_start);\r\n          add = \" \" + (allowed ? \"gantt_link_allow\" : \"gantt_link_deny\");\r\n        }\r\n\r\n        return \"gantt_link_tooltip\" + add;\r\n      },\r\n\r\n      /* used for aria-labels of bar elements and for tooltip.js */\r\n      tooltip_date_format: gantt.date.date_to_str(\"%Y-%m-%d\"),\r\n      tooltip_text: function (start, end, event) {\r\n        return \"<b>Task:</b> \" + event.text + \"<br/><b>Start date:</b> \" + gantt.templates.tooltip_date_format(start) + \"<br/><b>End date:</b> \" + gantt.templates.tooltip_date_format(end);\r\n      }\r\n    });\r\n\r\n    this.callEvent(\"onTemplatesReady\", []);\r\n  };\r\n\r\n})();\r\ngantt._click = {};\r\ngantt._dbl_click = {};\r\ngantt._context_menu = {};\r\ngantt._on_click = function (e) {\r\n  e = e || window.event;\r\n  var trg = e.target || e.srcElement;\r\n  var id = gantt.locate(e);\r\n\r\n  var res = true;\r\n  if (id !== null) {\r\n    res = !gantt.checkEvent(\"onTaskClick\") || gantt.callEvent(\"onTaskClick\", [id, e]);\r\n  } else {\r\n    gantt.callEvent(\"onEmptyClick\", [e]);\r\n  }\r\n\r\n  if (res) {\r\n    var default_action = gantt._find_ev_handler(e, trg, gantt._click, id);\r\n    if (!default_action)\r\n      return;\r\n\r\n    if (id && gantt.getTask(id) && gantt.config.select_task) {\r\n      gantt.selectTask(id);\r\n    }\r\n  }\r\n\r\n};\r\ngantt._on_contextmenu = function (e) {\r\n  e = e || window.event;\r\n  var src = e.target || e.srcElement,\r\n      taskId = gantt.locate(src),\r\n      linkId = gantt.locate(src, gantt.config.link_attribute);\r\n\r\n  var res = !gantt.checkEvent(\"onContextMenu\") || gantt.callEvent(\"onContextMenu\", [taskId, linkId, e]);\r\n  if (!res) {\r\n    if (e.preventDefault)\r\n      e.preventDefault();\r\n    else\r\n      e.returnValue = false;\r\n  }\r\n  return res;\r\n};\r\ngantt._find_ev_handler = function (e, trg, hash, id) {\r\n  var res = true;\r\n  while (trg) {\r\n    var css = gantt._getClassName(trg);\r\n    if (css) {\r\n      css = css.split(\" \");\r\n      for (var i = 0; i < css.length; i++) {\r\n        if (!css[i]) continue;\r\n        if (hash[css[i]]) {\r\n          var handler = hash[css[i]].call(gantt, e, id, trg);\r\n          res = res && !(typeof handler != \"undefined\" && handler !== true);\r\n        }\r\n      }\r\n    }\r\n    trg = trg.parentNode;\r\n  }\r\n  return res;\r\n};\r\ngantt._on_dblclick = function (e) {\r\n  e = e || window.event;\r\n  var trg = e.target || e.srcElement;\r\n  var id = gantt.locate(e);\r\n  var res = !gantt.checkEvent(\"onTaskDblClick\") || gantt.callEvent(\"onTaskDblClick\", [id, e]);\r\n  if (res) {\r\n    var default_action = gantt._find_ev_handler(e, trg, gantt._dbl_click, id);\r\n    if (!default_action)\r\n      return;\r\n\r\n    if (id !== null && gantt.getTask(id)) {\r\n      if (res && gantt.config.details_on_dblclick) {\r\n        gantt.showLightbox(id);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\ngantt._on_mousemove = function (e) {\r\n  if (gantt.checkEvent(\"onMouseMove\")) {\r\n    var id = gantt.locate(e);\r\n    gantt._last_move_event = e;\r\n    gantt.callEvent(\"onMouseMove\", [id, e]);\r\n  }\r\n};\r\ngantt._DnD = function _DnD(obj, config) {\r\n  this._obj = obj;\r\n  if (config) {\r\n    this._settings = config;\r\n  }\r\n  gantt._eventable(this);\r\n\r\n  var inputMethods = this.getInputMethods();\r\n\r\n  this._drag_start_timer = null;\r\n  gantt.attachEvent(\"onGanttScroll\", gantt.bind(function (left, top) {\r\n    this.clearDragTimer();\r\n  }, this));\r\n\r\n  for (var i = 0; i < inputMethods.length; i++) {\r\n    (gantt.bind(function (input) {\r\n\r\n      gantt.event(obj, input.down, gantt.bind(function (e) {\r\n        config.original_target = {target: e.target || e.srcElement};\r\n        if (gantt.config.touch) {\r\n          this.clearDragTimer();\r\n\r\n          this._drag_start_timer = setTimeout(gantt.bind(function () {\r\n            this.dragStart(obj, e, input);\r\n          }, this), gantt.config.touch_drag);\r\n        }\r\n        else {\r\n          this.dragStart(obj, e, input);\r\n        }\r\n      }, this));\r\n\r\n      gantt.event(document.body, input.up, gantt.bind(function (e) {\r\n        this.clearDragTimer();\r\n      }, this));\r\n\r\n    }, this))(inputMethods[i]);\r\n  }\r\n};\r\n\r\ngantt._DnD.prototype = {\r\n  traceDragEvents: function (domElement, inputMethod) {\r\n    var mousemove = gantt.bind(function (e) {\r\n      return this.dragMove(domElement, e, inputMethod.accessor);\r\n    }, this);\r\n    var scroll = gantt.bind(function (e) {\r\n      return this.dragScroll(domElement, e);\r\n    }, this);\r\n\r\n    var limited_mousemove = gantt.bind(function (e) {\r\n      if (e && e.preventDefault) //Cancel default action on DND\r\n        e.preventDefault();\r\n      (e || event).cancelBubble = true;\r\n      if (gantt.defined(this.config.updates_per_second)) {\r\n        if (!gantt._checkTimeout(this, this.config.updates_per_second))\r\n          return true;\r\n      }\r\n      return mousemove(e);\r\n    }, this);\r\n\r\n    var mouseup = gantt.bind(function (e) {\r\n      gantt.eventRemove(document.body, inputMethod.move, limited_mousemove);\r\n      gantt.eventRemove(document.body, inputMethod.up, mouseup);\r\n      return this.dragEnd(domElement);\r\n    }, this);\r\n\r\n\r\n    gantt.event(document.body, inputMethod.move, limited_mousemove);\r\n    gantt.event(document.body, inputMethod.up, mouseup);\r\n  },\r\n  checkPositionChange: function (pos) {\r\n    var diff_x = pos.x - this.config.pos.x;\r\n    var diff_y = pos.y - this.config.pos.y;\r\n    var distance = Math.sqrt(Math.pow(Math.abs(diff_x), 2) + Math.pow(Math.abs(diff_y), 2));\r\n\r\n    if (distance > this.config.sensitivity) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  },\r\n  initDnDMarker: function () {\r\n    // create dnd placeholder and put it in dom\r\n    var marker = this.config.marker = document.createElement(\"div\");\r\n    marker.className = \"gantt_drag_marker\";\r\n    marker.innerHTML = \"Dragging object\";\r\n    document.body.appendChild(marker);\r\n  },\r\n  backupEventTarget: function (domEvent, getEvent) {\r\n    if (!gantt.config.touch) {\r\n      return;\r\n    }\r\n\r\n    // keep original event target in DOM in order to keep dnd on touchmove event\r\n    var e = getEvent(domEvent);\r\n\r\n    var el = e.target || e.srcElement;\r\n    var copy = el.cloneNode(true);\r\n    //this.config.target.target = copy;\r\n    this.config.original_target = {target: copy};\r\n    this.config.backup_element = el;\r\n    el.parentNode.appendChild(copy);\r\n\r\n    el.style.display = \"none\";\r\n    document.body.appendChild(el);\r\n  },\r\n  getInputMethods: function () {\r\n    // bind actions to browser events\r\n    var inputMethods = [];\r\n\r\n    inputMethods.push({\r\n      \"move\": \"mousemove\",\r\n      \"down\": \"mousedown\",\r\n      \"up\": \"mouseup\",\r\n      \"accessor\": function (e) {\r\n        return e;\r\n      }\r\n    });\r\n\r\n    if (gantt.config.touch) {\r\n\r\n      var touchEventsSupported = true;\r\n      try {\r\n        document.createEvent(\"TouchEvent\");\r\n      } catch (e) {\r\n        touchEventsSupported = false;\r\n      }\r\n\r\n      if (touchEventsSupported) {\r\n        inputMethods.push({\r\n          \"move\": \"touchmove\",\r\n          \"down\": \"touchstart\",\r\n          \"up\": \"touchend\",\r\n          \"accessor\": function (ev) {\r\n            if (ev.touches && ev.touches.length > 1) return null;\r\n            if (ev.touches[0])\r\n              return {\r\n                target: document.elementFromPoint(ev.touches[0].clientX, ev.touches[0].clientY),\r\n                pageX: ev.touches[0].pageX,\r\n                pageY: ev.touches[0].pageY,\r\n                clientX: ev.touches[0].clientX,\r\n                clientY: ev.touches[0].clientY\r\n              };\r\n            else\r\n              return ev;\r\n          }\r\n        });\r\n      } else if (window.navigator.pointerEnabled) {\r\n        inputMethods.push({\r\n          \"move\": \"pointermove\",\r\n          \"down\": \"pointerdown\",\r\n          \"up\": \"pointerup\",\r\n          \"accessor\": function (ev) {\r\n            if (ev.pointerType == \"mouse\") return null;\r\n            return ev;\r\n          }\r\n        });\r\n\r\n      } else if (window.navigator.msPointerEnabled) {\r\n        inputMethods.push({\r\n          \"move\": \"MSPointerMove\",\r\n          \"down\": \"MSPointerDown\",\r\n          \"up\": \"MSPointerUp\",\r\n          \"accessor\": function (ev) {\r\n            if (ev.pointerType == ev.MSPOINTER_TYPE_MOUSE) return null;\r\n            return ev;\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    return inputMethods;\r\n  },\r\n  clearDragTimer: function () {\r\n    if (this._drag_start_timer) {\r\n      clearTimeout(this._drag_start_timer);\r\n      this._drag_start_timer = null;\r\n    }\r\n  },\r\n  dragStart: function (obj, e, inputMethod) {\r\n    this.config = {\r\n      obj: obj,\r\n      marker: null,\r\n      started: false,\r\n      pos: this.getPosition(e),\r\n      sensitivity: 4\r\n    };\r\n    if (this._settings)\r\n      gantt.mixin(this.config, this._settings, true);\r\n\r\n\r\n    this.traceDragEvents(obj, inputMethod);\r\n\r\n    gantt._prevent_touch_scroll = true;\r\n    document.body.className += \" gantt_noselect\";\r\n\r\n    if (gantt.config.touch) {\r\n      this.dragMove(obj, e, inputMethod.accessor);\r\n    }\r\n\r\n  },\r\n  dragMove: function (obj, e, getEvent) {\r\n    var source = getEvent(e);\r\n    if (!source) return;\r\n\r\n    if (!this.config.marker && !this.config.started) {\r\n      var pos = this.getPosition(source);\r\n\r\n      if (gantt.config.touch || this.checkPositionChange(pos)) {\r\n        // real drag starts here,\r\n        // when user moves mouse at first time after onmousedown\r\n        this.config.started = true;\r\n        this.config.ignore = false;\r\n        if (this.callEvent(\"onBeforeDragStart\", [obj, this.config.original_target]) === false) {\r\n          this.config.ignore = true;\r\n          return true;\r\n        }\r\n        this.backupEventTarget(e, getEvent);\r\n        this.initDnDMarker();\r\n        gantt._touch_feedback();\r\n        this.callEvent(\"onAfterDragStart\", [obj, this.config.original_target]);\r\n      } else {\r\n        this.config.ignore = true;\r\n      }\r\n    }\r\n\r\n\r\n    if (!this.config.ignore) {\r\n      source.pos = this.getPosition(source);\r\n      this.config.marker.style.left = source.pos.x + \"px\";\r\n      this.config.marker.style.top = source.pos.y + \"px\";\r\n      this.callEvent(\"onDragMove\", [obj, source]);\r\n      return false;\r\n    }\r\n  },\r\n\r\n  dragEnd: function (obj) {\r\n    var target = this.config.backup_element;\r\n    if (target && target.parentNode) {\r\n      target.parentNode.removeChild(target);\r\n    }\r\n    gantt._prevent_touch_scroll = false;\r\n    if (this.config.marker) {\r\n      this.config.marker.parentNode.removeChild(this.config.marker);\r\n      this.config.marker = null;\r\n\r\n      this.callEvent(\"onDragEnd\", []);\r\n    }\r\n    document.body.className = document.body.className.replace(\" gantt_noselect\", \"\");\r\n  },\r\n\r\n  getPosition: function (e) {\r\n    var x = 0, y = 0;\r\n    e = e || window.event;\r\n    if (e.pageX || e.pageY) {\r\n      x = e.pageX;\r\n      y = e.pageY;\r\n    } else if (e.clientX || e.clientY) {\r\n      x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n      y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n    }\r\n    return {x: x, y: y};\r\n  }\r\n};\r\ngantt._init_grid = function () {\r\n  this._click.gantt_close = this.bind(function (e, id, trg) {\r\n    this.close(id);\r\n    return false;\r\n  }, this);\r\n  this._click.gantt_open = this.bind(function (e, id, trg) {\r\n    this.open(id);\r\n    return false;\r\n  }, this);\r\n\r\n\r\n  this._click.gantt_row = this.bind(function (e, id, trg) {\r\n    if (id !== null) {\r\n      var task = this.getTask(id);\r\n      if (this.config.scroll_on_click)\r\n        this.showDate(task.start_date);\r\n      this.callEvent(\"onTaskRowClick\", [id, trg]);\r\n    }\r\n  }, this);\r\n\r\n  this._click.gantt_grid_head_cell = this.bind(function (e, id, trg) {\r\n    var column = trg.getAttribute(\"column_id\");\r\n\r\n    if (!this.callEvent(\"onGridHeaderClick\", [column, e]))\r\n      return;\r\n\r\n    if (column == \"add\") {\r\n      this._click.gantt_add(e, this.config.root_id);\r\n      return;\r\n    }\r\n\r\n    if (this.config.sort) {\r\n      var sorting_method = column,\r\n          conf;\r\n\r\n      for (var i = 0; i < this.config.columns.length; i++) {\r\n        if (this.config.columns[i].name == column) {\r\n          conf = this.config.columns[i];\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (conf && conf.sort !== undefined && conf.sort !== true) {\r\n        sorting_method = conf.sort;\r\n\r\n        if (!sorting_method) { // column sort property 'false', no sorting\r\n          return;\r\n        }\r\n      }\r\n\r\n      var sort = (this._sort && this._sort.direction && this._sort.name == column) ? this._sort.direction : \"desc\";\r\n      // invert sort direction\r\n      sort = (sort == \"desc\") ? \"asc\" : \"desc\";\r\n      this._sort = {\r\n        name: column,\r\n        direction: sort\r\n      };\r\n      this.sort(sorting_method, sort == \"desc\");\r\n    }\r\n  }, this);\r\n\r\n  if (!this.config.sort && this.config.order_branch) {\r\n    this._init_dnd();\r\n  }\r\n\r\n  this._click.gantt_add = this.bind(function (e, id, trg) {\r\n    if (this.config.readonly) return;\r\n\r\n    var item = {};\r\n    this.createTask(item, id ? id : this.config.root_id);\r\n\r\n    return false;\r\n  }, this);\r\n\r\n  if (this._init_resize) {\r\n    this._init_resize();\r\n  }\r\n\r\n};\r\n\r\ngantt._render_grid = function () {\r\n  this._calc_grid_width();\r\n  if (this._is_grid_visible()) {\r\n    this._render_grid_header();\r\n  }\r\n};\r\n\r\ngantt._calc_grid_width = function () {\r\n  var columns = this.getGridColumns();\r\n  var cols_width = 0;\r\n  var unknown = [];\r\n  var width = [];\r\n\r\n  for (var i = 0; i < columns.length; i++) {\r\n    var v = parseInt(columns[i].width, 10);\r\n    if (window.isNaN(v)) {\r\n      v = 50;\r\n      unknown.push(i);\r\n    }\r\n    width[i] = v;\r\n    cols_width += v;\r\n  }\r\n\r\n  if (this.config.autofit || unknown.length) {\r\n    var diff = this._get_grid_width() - cols_width;\r\n    // TODO: logic may be improved for proportional changing of width\r\n    var step = diff / (unknown.length > 0 ? unknown.length : (width.length > 0 ? width.length : 1));\r\n    if (unknown.length > 0) {\r\n      // there are several columns with undefined width\r\n      var delta = diff / (unknown.length ? unknown.length : 1);\r\n      for (var i = 0; i < unknown.length; i++) {\r\n        var index = unknown[i];\r\n        width[index] += delta;\r\n      }\r\n    } else {\r\n      // delta must be added for all columns\r\n      var delta = diff / (width.length ? width.length : 1);\r\n      for (var i = 0; i < width.length; i++)\r\n        width[i] += delta;\r\n    }\r\n\r\n    for (var i = 0; i < width.length; i++) {\r\n      columns[i].width = width[i];\r\n    }\r\n  } else {\r\n    this.config.grid_width = cols_width;\r\n  }\r\n};\r\n\r\ngantt._render_grid_header = function () {\r\n  var columns = this.getGridColumns();\r\n  var cells = [];\r\n  var width = 0,\r\n      labels = this.locale.labels;\r\n\r\n  var lineHeigth = this.config.scale_height - 2;\r\n\r\n  for (var i = 0; i < columns.length; i++) {\r\n    var last = i == columns.length - 1;\r\n    var col = columns[i];\r\n\r\n    // ensure columns have non-empty names\r\n    if (!col.name) {\r\n      col.name = gantt.uid() + \"\";\r\n    }\r\n\r\n    var colWidth = col.width * 1;\r\n    if (last && this._get_grid_width() > width + colWidth)\r\n      col.width = colWidth = this._get_grid_width() - width;\r\n    width += colWidth;\r\n    var sort = (this._sort && col.name == this._sort.name) ? (\"<div class='gantt_sort gantt_\" + this._sort.direction + \"'></div>\") : \"\";\r\n    var cssClass = [\"gantt_grid_head_cell\",\r\n      (\"gantt_grid_head_\" + col.name),\r\n      (last ? \"gantt_last_cell\" : \"\"),\r\n      this.templates.grid_header_class(col.name, col)].join(\" \");\r\n\r\n    var style = \"width:\" + (colWidth - (last ? 1 : 0)) + \"px;\";\r\n    var label = (col.label || labels[\"column_\" + col.name]);\r\n    label = label || \"\";\r\n\r\n    var ariaAttrs = this._waiAria.gridScaleCellAttrString(col, label);\r\n\r\n    var cell = \"<div class='\" + cssClass + \"' style='\" + style + \"' \" + ariaAttrs + \" column_id='\" + col.name + \"'>\" + label + sort + \"</div>\";\r\n    cells.push(cell);\r\n  }\r\n  this.$grid_scale.style.height = (this.config.scale_height - 1) + \"px\";\r\n  this.$grid_scale.style.lineHeight = lineHeigth + \"px\";\r\n  this.$grid_scale.style.width = (width - 1) + \"px\";\r\n  this.$grid_scale.innerHTML = cells.join(\"\");\r\n};\r\n\r\n\r\ngantt._render_grid_item = function (item) {\r\n  if (!gantt._is_grid_visible())\r\n    return null;\r\n\r\n  var columns = this.getGridColumns();\r\n  var cells = [];\r\n  var width = 0;\r\n  var has_child;\r\n  for (var i = 0; i < columns.length; i++) {\r\n    var last = i == columns.length - 1;\r\n    var col = columns[i];\r\n    var cell;\r\n\r\n    var value;\r\n    var textValue;\r\n    if (col.name == \"add\") {\r\n      var aria = this._waiAria.gridAddButtonAttrString(col);\r\n\r\n      value = \"<div \" + aria + \" class='gantt_add'></div>\";\r\n      textValue = \"\";\r\n    } else {\r\n      if (col.template)\r\n        value = col.template(item);\r\n      else\r\n        value = item[col.name];\r\n\r\n      if (value instanceof Date)\r\n        value = this.templates.date_grid(value, item);\r\n      textValue = value;\r\n      value = \"<div class='gantt_tree_content'>\" + value + \"</div>\";\r\n    }\r\n    var css = \"gantt_cell\" + (last ? \" gantt_last_cell\" : \"\");\r\n\r\n    var tree = \"\";\r\n    if (col.tree) {\r\n      for (var j = 0; j < item.$level; j++)\r\n        tree += this.templates.grid_indent(item);\r\n\r\n      has_child = this._has_children(item.id);\r\n      if (has_child) {\r\n        tree += this.templates.grid_open(item);\r\n        tree += this.templates.grid_folder(item);\r\n      } else {\r\n        tree += this.templates.grid_blank(item);\r\n        tree += this.templates.grid_file(item);\r\n      }\r\n    }\r\n    var style = \"width:\" + (col.width - (last ? 1 : 0)) + \"px;\";\r\n    if (this.defined(col.align))\r\n      style += \"text-align:\" + col.align + \";\";\r\n\r\n    var aria = this._waiAria.gridCellAttrString(col, textValue);\r\n\r\n    cell = \"<div class='\" + css + \"' style='\" + style + \"' \" + aria + \">\" + tree + value + \"</div>\";\r\n    cells.push(cell);\r\n  }\r\n  var css = gantt.getGlobalTaskIndex(item.id) % 2 === 0 ? \"\" : \" odd\";\r\n  css += (item.$transparent) ? \" gantt_transparent\" : \"\";\r\n\r\n  css += (item.$dataprocessor_class ? \" \" + item.$dataprocessor_class : \"\");\r\n\r\n  if (this.templates.grid_row_class) {\r\n    var css_template = this.templates.grid_row_class.call(this, item.start_date, item.end_date, item);\r\n    if (css_template)\r\n      css += \" \" + css_template;\r\n  }\r\n\r\n  if (this.getState().selected_task == item.id) {\r\n    css += \" gantt_selected\";\r\n  }\r\n  var el = document.createElement(\"div\");\r\n  el.className = \"gantt_row\" + css;\r\n  el.style.height = this.config.row_height + \"px\";\r\n  el.style.lineHeight = (gantt.config.row_height) + \"px\";\r\n  el.setAttribute(this.config.task_attribute, item.id);\r\n\r\n  this._waiAria.taskRowAttr(item, el);\r\n\r\n  el.innerHTML = cells.join(\"\");\r\n  return el;\r\n};\r\n\r\n\r\ngantt.open = function (id) {\r\n  gantt._set_item_state(id, true);\r\n  this.callEvent(\"onTaskOpened\", [id]);\r\n};\r\ngantt.close = function (id) {\r\n  gantt._set_item_state(id, false);\r\n  this.callEvent(\"onTaskClosed\", [id]);\r\n};\r\ngantt._set_item_state = function (id, state) {\r\n  if (id && this._pull[id]) {\r\n    this._pull[id].$open = state;\r\n    gantt._refresh_on_toggle_element(id);\r\n  }\r\n};\r\n\r\ngantt._refresh_on_toggle_element = function (id) {\r\n  this.refreshData();\r\n};\r\n\r\ngantt._is_grid_visible = function () {\r\n  return (this.config.grid_width && this.config.show_grid);\r\n};\r\ngantt._get_grid_width = function () {\r\n  if (this._is_grid_visible()) {\r\n    if (this._is_chart_visible()) {\r\n      return this.config.grid_width;\r\n    } else {\r\n      return this._x;\r\n    }\r\n  } else {\r\n    return 0;\r\n  }\r\n};\r\n\r\n\r\ngantt.moveTask = function (sid, tindex, parent) {\r\n  //target id as 4th parameter\r\n  var id = arguments[3];\r\n  if (id) {\r\n    if (id === sid) return;\r\n\r\n    parent = this.getParent(id);\r\n    tindex = this.getTaskIndex(id);\r\n  }\r\n  if (sid == parent) {\r\n    return;\r\n  }\r\n  parent = parent || this.config.root_id;\r\n  var source = this.getTask(sid);\r\n  var source_pid = this.getParent(source.id);\r\n  var sbranch = this.getChildren(this.getParent(source.id));\r\n\r\n  var tbranch = this.getChildren(parent);\r\n  if (tindex == -1)\r\n    tindex = tbranch.length + 1;\r\n  if (source_pid == parent) {\r\n    var sindex = this.getTaskIndex(sid);\r\n    if (sindex == tindex) return;\r\n  }\r\n\r\n\r\n  /*\r\n   prevent moving to another sub-branch:\r\n\r\n   gantt.attachEvent(\"onBeforeTaskMove\", function(id, parent, tindex){\r\n   var task = gantt.getTask(id);\r\n   if(task.parent != parent)\r\n   return false;\r\n   return true;\r\n   });\r\n   */\r\n  if (this.callEvent(\"onBeforeTaskMove\", [sid, parent, tindex]) === false)\r\n    return;\r\n\r\n  this._replace_branch_child(source_pid, sid);\r\n  tbranch = this.getChildren(parent);\r\n\r\n  var tid = tbranch[tindex];\r\n  if (!tid) //adding as last element\r\n    tbranch.push(sid);\r\n  else\r\n    tbranch = tbranch.slice(0, tindex).concat([sid]).concat(tbranch.slice(tindex));\r\n\r\n  this.setParent(source, parent);\r\n  this._branches[parent] = tbranch;\r\n\r\n  var diff = this.calculateTaskLevel(source) - source.$level;\r\n  source.$level += diff;\r\n  var childTree = this._getTaskTree(sid);\r\n  for (var i = 0; i < childTree.length; i++) {\r\n    var item = this._pull[childTree[i]];\r\n    item.$level += diff;\r\n  }\r\n\r\n  if (tindex * 1 > 0) {\r\n    if (id) {\r\n      source.$drop_target = (this.getTaskIndex(sid) > this.getTaskIndex(id) ? \"next:\" : '') + id;\r\n    } else {\r\n      source.$drop_target = \"next:\" + gantt.getPrevSibling(sid);\r\n    }\r\n  } else if (tbranch[tindex * 1 + 1]) {\r\n    source.$drop_target = tbranch[tindex * 1 + 1];\r\n  } else {\r\n    source.$drop_target = parent;\r\n  }\r\n\r\n  if (this.callEvent(\"onAfterTaskMove\", [sid, parent, tindex]) === false)\r\n    return;\r\n\r\n  this.refreshData();\r\n\r\n};\r\n\r\ngantt._init_dnd = function () {\r\n  var dnd = new gantt._DnD(this.$grid_data, {updates_per_second: 60});\r\n  if (this.defined(this.config.dnd_sensitivity))\r\n    dnd.config.sensitivity = this.config.dnd_sensitivity;\r\n\r\n  dnd.attachEvent(\"onBeforeDragStart\", this.bind(function (obj, e) {\r\n    var el = this._locateHTML(e);\r\n    if (!el) return false;\r\n    if (this.hideQuickInfo) this._hideQuickInfo();\r\n\r\n    var id = this.locate(e);\r\n\r\n    var task = gantt.getTask(id);\r\n\r\n    if (gantt._is_readonly(task))\r\n      return false;\r\n\r\n    dnd.config.initial_open_state = task.$open;\r\n    if (!this.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\r\n      return false;\r\n    }\r\n\r\n  }, this));\r\n\r\n  dnd.attachEvent(\"onAfterDragStart\", this.bind(function (obj, e) {\r\n    var el = this._locateHTML(e);\r\n    dnd.config.marker.innerHTML = el.outerHTML;\r\n    dnd.config.id = this.locate(e);\r\n    var task = this.getTask(dnd.config.id);\r\n    dnd.config.index = this.getTaskIndex(dnd.config.id);\r\n    dnd.config.parent = task.parent;\r\n    task.$open = false;\r\n    task.$transparent = true;\r\n    this.refreshData();\r\n  }, this));\r\n\r\n\r\n  dnd.lastTaskOfLevel = function (level) {\r\n    var ids = gantt._order,\r\n        pull = gantt._pull,\r\n        last_item = null;\r\n    for (var i = 0, len = ids.length; i < len; i++) {\r\n      if (pull[ids[i]].$level == level) {\r\n        last_item = pull[ids[i]];\r\n      }\r\n    }\r\n    return last_item ? last_item.id : null;\r\n  };\r\n  dnd._getGridPos = this.bind(function (e) {\r\n    var pos = this._get_position(this.$grid_data);\r\n\r\n    // row offset\r\n    var x = pos.x;\r\n    var y = e.pos.y - 10;\r\n\r\n    // prevent moving row out of grid_data container\r\n    if (y < pos.y) y = pos.y;\r\n    var gridHeight = gantt.getTaskCount() * gantt.config.row_height;\r\n    if (y > pos.y + gridHeight - this.config.row_height) y = pos.y + gridHeight - this.config.row_height;\r\n\r\n    pos.x = x;\r\n    pos.y = y;\r\n    return pos;\r\n  }, this);\r\n  dnd._getTargetY = this.bind(function (e) {\r\n    var pos = this._get_position(this.$grid_data);\r\n\r\n    var y = e.pageY - pos.y + gantt.getScrollState().y;\r\n    if (y < 0)\r\n      y = 0;\r\n    return y;\r\n  }, this);\r\n  dnd._getTaskByY = this.bind(function (y, dropIndex) {\r\n    y = y || 0;\r\n    if (gantt.config.smart_rendering) {\r\n      y += this.$grid_data.scrollTop;\r\n    }\r\n\r\n    var index = Math.floor(y / this.config.row_height);\r\n    index = dropIndex < index ? index - 1 : index;\r\n\r\n    if (index > this._order.length - 1)\r\n      return null;\r\n\r\n    return this._order[index];\r\n  }, this);\r\n  dnd.attachEvent(\"onDragMove\", this.bind(function (obj, e) {\r\n    var dd = dnd.config;\r\n    var pos = dnd._getGridPos(e);\r\n\r\n\r\n    // setting position of row\r\n    dd.marker.style.left = pos.x + 10 + \"px\";\r\n    dd.marker.style.top = pos.y + \"px\";\r\n\r\n    // highlight row when mouseover\r\n    var item = this.getTask(dnd.config.id);\r\n    var targetY = dnd._getTargetY(e);\r\n    var el = dnd._getTaskByY(targetY, gantt.getGlobalTaskIndex(item.id));\r\n\r\n    if (!this.isTaskExists(el)) {\r\n      el = dnd.lastTaskOfLevel(gantt.config.order_branch_free ? item.$level : 0);\r\n      if (el == dnd.config.id) {\r\n        el = null;\r\n      }\r\n    }\r\n\r\n    function allowedLevel(next, item) {\r\n      return (!(gantt.isChildOf(over.id, item.id)) && (next.$level == item.$level || gantt.config.order_branch_free));\r\n    }\r\n\r\n    if (this.isTaskExists(el)) {\r\n      var over = this.getTask(el);\r\n\r\n\r\n      if (gantt.getGlobalTaskIndex(over.id) * this.config.row_height + this.config.row_height / 2 < targetY) {\r\n        //hovering over bottom part of item, check can be drop to bottom\r\n        var index = this.getGlobalTaskIndex(over.id);\r\n        var next = this._pull[this._order[index + 1]]; //adds +1 when hovering over placeholder\r\n        if (next) {\r\n          if (next.id != item.id) {\r\n            over = next; //there is a valid target\r\n          }\r\n          else {\r\n            if (this.config.order_branch_free) {\r\n              if (!(this.isChildOf(item.id, over.id) && this.getChildren(over.id).length == 1))\r\n                return;\r\n              else {\r\n\r\n                this.moveTask(item.id, this.getTaskIndex(over.id) + 1, this.getParent(over.id));\r\n                return;\r\n              }\r\n            }\r\n            else {\r\n              return;\r\n            }\r\n          }\r\n        } else {\r\n          //we at end of the list, check and drop at the end of list\r\n          next = this._pull[this._order[index]];\r\n          if (allowedLevel(next, item) && next.id != item.id) {\r\n            this.moveTask(item.id, -1, this.getParent(next.id));\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      else if (this.config.order_branch_free) {\r\n        if (over.id != item.id && allowedLevel(over, item)) {\r\n          if (!this.hasChild(over.id)) {\r\n            over.$open = true;\r\n            this.moveTask(item.id, -1, over.id);\r\n            return;\r\n          }\r\n          if (this.getGlobalTaskIndex(over.id) || this.config.row_height / 3 < targetY) return;\r\n        }\r\n      }\r\n      //if item is on different level, check the one before it\r\n      var index = this.getGlobalTaskIndex(over.id),\r\n          prev = this._pull[this._order[index - 1]];\r\n\r\n      var shift = 1;\r\n      while ((!prev || prev.id == over.id) && index - shift >= 0) {\r\n        prev = this._pull[this._order[index - shift]];\r\n        shift++;\r\n      }\r\n\r\n      if (item.id == over.id) return;\r\n      //replacing item under cursor\r\n      if (allowedLevel(over, item) && item.id != over.id) {\r\n        this.moveTask(item.id, 0, 0, over.id);\r\n\r\n      } else if (over.$level == item.$level - 1 && !gantt.getChildren(over.id).length) {\r\n        this.moveTask(item.id, 0, over.id);\r\n\r\n      } else if (prev && (allowedLevel(prev, item)) && (item.id != prev.id)) {\r\n        this.moveTask(item.id, -1, this.getParent(prev.id));\r\n\r\n      }\r\n    }\r\n    return true;\r\n  }, this));\r\n\r\n\r\n  dnd.attachEvent(\"onDragEnd\", this.bind(function () {\r\n    var task = this.getTask(dnd.config.id);\r\n    task.$transparent = false;\r\n    task.$open = dnd.config.initial_open_state;\r\n\r\n    if (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, dnd.config.parent, dnd.config.index]) === false) {\r\n      this.moveTask(dnd.config.id, dnd.config.index, dnd.config.parent);\r\n      task.$drop_target = null;\r\n    } else {\r\n      //var newLevel = task.$level,\r\n      //\toldLevel = !this.isTaskExists(dnd.config.parent) ? 0 : (this.getTask(dnd.config.parent).$level + 1);\r\n      //var levelChanged = newLevel != oldLevel;\r\n\r\n      this.callEvent(\"onRowDragEnd\", [dnd.config.id, task.$drop_target]);\r\n    }\r\n\r\n    this.refreshData();\r\n\r\n  }, this));\r\n};\r\n\r\n/* will be overwriten in order to provide hide/show column functionality in some editions */\r\ngantt.getGridColumns = function () {\r\n  return this.config.columns;\r\n};\r\n\r\n\r\ngantt._has_children = function (id) {\r\n  return this.getChildren(id).length > 0;\r\n};\r\n\r\n(function () {\r\n\r\n  var scrollRange = 50,\r\n      scrollStep = 30,\r\n      scrollInterval = 50;\r\n\r\n  var interval = null,\r\n      startPos = null;\r\n\r\n  function autoscrollInterval(event) {\r\n    if (interval)\r\n      clearInterval(interval);\r\n\r\n    var eventPos = {\r\n      x: event.clientX,\r\n      y: event.clientY\r\n    };\r\n    interval = setInterval(function () {\r\n      tick(eventPos);\r\n    }, scrollInterval);\r\n  }\r\n\r\n  function tick(e) {\r\n    if (!gantt.getState().drag_mode && !document.querySelector(\".gantt_drag_marker\")) {\r\n      clearInterval(interval);\r\n      startPos = null;\r\n      return;\r\n    }\r\n\r\n    var box = gantt._get_position(gantt.$task);\r\n\r\n    var posX = e.x - box.x;\r\n    var posY = e.y - box.y;\r\n\r\n    var scrollLeft = need_scroll(posX, box.width, startPos ? startPos.x : 0, scrollRange);\r\n    var scrollTop = need_scroll(posY, box.height, startPos ? startPos.y : 0, scrollRange);\r\n\r\n    if ((scrollTop || scrollLeft) && !startPos) {\r\n      startPos = {\r\n        x: posX,\r\n        y: posY\r\n      };\r\n\r\n      scrollLeft = 0;\r\n      scrollTop = 0;\r\n    }\r\n\r\n    scrollLeft = scrollLeft * (gantt.config.scroll_speed || scrollStep);\r\n    scrollTop = scrollTop * (gantt.config.scroll_speed || scrollStep);\r\n\r\n    if (scrollLeft && scrollTop) {\r\n      if (Math.abs(scrollLeft / 5) > Math.abs(scrollTop)) {\r\n        scrollTop = 0;\r\n      } else if (Math.abs(scrollTop / 5) > Math.abs(scrollLeft)) {\r\n        scrollLeft = 0;\r\n      }\r\n    }\r\n\r\n    if (scrollLeft || scrollTop) {\r\n      startPos.started = true;\r\n      scroll(scrollLeft, scrollTop);\r\n    } else {\r\n      clearInterval(interval);\r\n    }\r\n  }\r\n\r\n  function need_scroll(pos, boxSize, startCoord, scrollRange) {\r\n    if (pos < scrollRange && (!startPos || startPos.started || pos < startCoord)) {\r\n      return -1;\r\n    } else if (boxSize - pos < scrollRange && (!startPos || startPos.started || pos > startCoord)) {\r\n      return 1;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  function scroll(left, top) {\r\n    var scrollState = gantt.getScrollState();\r\n\r\n    var scrollLeft = null,\r\n        scrollTop = null;\r\n    if (left) {\r\n      scrollLeft = scrollState.x + left;\r\n    }\r\n    if (top) {\r\n      scrollTop = scrollState.y + top;\r\n    }\r\n\r\n    gantt.scrollTo(scrollLeft, scrollTop);\r\n  }\r\n\r\n  gantt.attachEvent(\"onGanttReady\", function () {\r\n    gantt.eventRemove(document.body, \"mousemove\", autoscrollInterval);\r\n    gantt.event(document.body, \"mousemove\", autoscrollInterval);\r\n  });\r\n\r\n})();\r\ngantt._wbs = {\r\n  _needRecalc: true,\r\n  reset: function () {\r\n    this._needRecalc = true;\r\n  },\r\n  _isRecalcNeeded: function () {\r\n    return (!this._isGroupSort() && this._needRecalc);\r\n  },\r\n  _isGroupSort: function () {\r\n    return !!(gantt._groups && gantt._groups.is_active());\r\n  },\r\n  _getWBSCode: function (task) {\r\n    if (!task) return \"\";\r\n\r\n    if (this._isRecalcNeeded()) {\r\n      this._calcWBS();\r\n    }\r\n\r\n    if (task.$virtual) return \"\";\r\n    if (this._isGroupSort()) return task.$wbs || \"\";\r\n\r\n    if (!task.$wbs) {\r\n      this.reset();\r\n      this._calcWBS();\r\n    }\r\n    return task.$wbs;\r\n  },\r\n  _setWBSCode: function (task, value) {\r\n    task.$wbs = value;\r\n  },\r\n  getWBSCode: function (task) {\r\n    return this._getWBSCode(task);\r\n  },\r\n  _calcWBS: function () {\r\n    if (!this._isRecalcNeeded()) return;\r\n\r\n    var _isFirst = true;\r\n    gantt.eachTask(function (ch) {\r\n      if (_isFirst) {\r\n        _isFirst = false;\r\n        this._setWBSCode(ch, \"1\");\r\n        return;\r\n      }\r\n      var _prevSibling = gantt.getPrevSibling(ch.id);\r\n      if (_prevSibling !== null) {\r\n        var _wbs = gantt.getTask(_prevSibling).$wbs;\r\n        if (_wbs) {\r\n          _wbs = _wbs.split(\".\");\r\n          _wbs[_wbs.length - 1]++;\r\n          this._setWBSCode(ch, _wbs.join(\".\"));\r\n        }\r\n      } else {\r\n        var _parent = gantt.getParent(ch.id);\r\n        this._setWBSCode(ch, gantt.getTask(_parent).$wbs + \".1\");\r\n      }\r\n    }, gantt.config.root_id, this);\r\n\r\n    this._needRecalc = false;\r\n  }\r\n};\r\n\r\ngantt.getWBSCode = function getWBSCode(task) {\r\n  return gantt._wbs.getWBSCode(task);\r\n};\r\n\r\ngantt.attachEvent(\"onAfterTaskMove\", function () {\r\n  gantt._wbs.reset();\r\n  return true;\r\n});\r\n\r\ngantt.attachEvent(\"onBeforeParse\", function () {\r\n  gantt._wbs.reset();\r\n  return true;\r\n});\r\n\r\ngantt.attachEvent(\"onAfterTaskDelete\", function () {\r\n  gantt._wbs.reset();\r\n  return true;\r\n});\r\n\r\ngantt.attachEvent(\"onAfterTaskAdd\", function () {\r\n  gantt._wbs.reset();\r\n  return true;\r\n});\r\n(function () {\r\n  var old_has_children = gantt._has_children;\r\n  gantt._has_children = function (id) {\r\n\r\n    if (old_has_children.apply(this, arguments))\r\n      return true;\r\n\r\n    if (this.isTaskExists(id)) {\r\n      return this.getTask(id).$has_child;\r\n    }\r\n    return false;\r\n  };\r\n})();\r\n\r\ngantt._need_dynamic_loading = function needLoading(id) {\r\n  if (gantt.config.branch_loading && gantt._load_url) {\r\n    var was_rendered = gantt.getUserData(id, \"was_rendered\");\r\n    // call ajax only if branch has children\r\n    if (!was_rendered && (gantt._has_children(id) && !gantt.hasChild(id))) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n// redefine _refresh_on_toggle_element from grid.js to add some checking\r\ngantt._refresh_on_toggle_element = function (id) {\r\n  //do refresh only if opening branch won't trigger reloading\r\n  if (!gantt._need_dynamic_loading(id) || !gantt.getTask(id).$open)\r\n    this.refreshData();\r\n};\r\n\r\ngantt.attachEvent(\"onTaskOpened\", function (id) {\r\n  if (gantt.config.branch_loading && gantt._load_url) {\r\n    // call ajax only if branch has children\r\n    if (gantt._need_dynamic_loading(id)) {\r\n      var url = gantt._load_url;\r\n      url = url.replace(/(\\?|&)?parent_id=.+&?/, \"\");\r\n      var param = url.indexOf(\"?\") >= 0 ? \"&\" : \"?\";\r\n      var y = 0;\r\n      if (this._cached_scroll_pos && this._cached_scroll_pos.y) {\r\n        y = Math.max(this._cached_scroll_pos.y, 0);\r\n      }\r\n      gantt.load(url + param + \"parent_id=\" + encodeURIComponent(id), this._load_type, function () {\r\n        if (y) {\r\n          gantt.scrollTo(null, y);\r\n        }\r\n      });\r\n\r\n\r\n      gantt.setUserData(id, \"was_rendered\", true);\r\n    }\r\n  }\r\n});\r\n\r\ngantt.getGridColumns = function () {\r\n  var columns = gantt.config.columns,\r\n      visibleColumns = [];\r\n\r\n  for (var i = 0; i < columns.length; i++) {\r\n    if (!columns[i].hide)\r\n      visibleColumns.push(columns[i]);\r\n  }\r\n\r\n  return visibleColumns;\r\n};\r\n\r\ngantt.getGridColumn = function (name) {\r\n  var columns = gantt.config.columns;\r\n\r\n  for (var i = 0; i < columns.length; i++) {\r\n    if (columns[i].name == name)\r\n      return columns[i];\r\n  }\r\n\r\n  return null;\r\n};\r\n(function () {\r\n\r\n  var htmlTags = new RegExp(\"<(?:.|\\n)*?>\", \"gm\");\r\n  var extraSpaces = new RegExp(\" +\", \"gm\");\r\n\r\n  function stripHTMLLite(htmlText) {\r\n    return (htmlText + \"\")\r\n        .replace(htmlTags, \" \").replace(extraSpaces, \" \");\r\n  }\r\n\r\n  var singleQuotes = new RegExp(\"'\", \"gm\");\r\n\r\n  function escapeQuotes(text) {\r\n    return (text + \"\").replace(singleQuotes, \"&#39;\");\r\n  }\r\n\r\n  gantt._waiAria = {\r\n    getAttributeString: function (attr) {\r\n      var attributes = [\" \"];\r\n      for (var i in attr) {\r\n        var text = escapeQuotes(stripHTMLLite(attr[i]));\r\n        attributes.push(i + \"='\" + text + \"'\");\r\n      }\r\n      attributes.push(\" \");\r\n      return attributes.join(\" \");\r\n\r\n    },\r\n\r\n    getTimelineCellAttr: function (dateString) {\r\n      return gantt._waiAria.getAttributeString({\"aria-label\": dateString});\r\n    },\r\n\r\n\r\n    _taskCommonAttr: function (task, div) {\r\n      div.setAttribute(\"aria-label\", stripHTMLLite(gantt.templates.tooltip_text(task.start_date, task.end_date, task)));\r\n\r\n      if (gantt._is_readonly(task)) {\r\n        div.setAttribute(\"aria-readonly\", true);\r\n\r\n\r\n      }\r\n\r\n      if (task.$dataprocessor_class) {\r\n        div.setAttribute(\"aria-busy\", true);\r\n      }\r\n\r\n\r\n      div.setAttribute(\"aria-selected\",\r\n          (gantt.getState().selected_task == task.id || (gantt.isSelectedTask && gantt.isSelectedTask(task.id))) ? \"true\" : \"false\");\r\n    },\r\n\r\n    setTaskBarAttr: function (task, div) {\r\n      this._taskCommonAttr(task, div);\r\n\r\n      if (!gantt._is_readonly(task) && gantt.config.drag_move) {\r\n        if (task.id != gantt.getState().drag_id) {\r\n          div.setAttribute(\"aria-grabbed\", false);\r\n        } else {\r\n          div.setAttribute(\"aria-grabbed\", true);\r\n        }\r\n      }\r\n    },\r\n\r\n    taskRowAttr: function (task, div) {\r\n\r\n      this._taskCommonAttr(task, div);\r\n\r\n      if (!gantt._is_readonly(task) && gantt.config.order_branch) {\r\n        div.setAttribute(\"aria-grabbed\", false);\r\n      }\r\n\r\n      div.setAttribute(\"role\", \"row\");\r\n\r\n      div.setAttribute(\"aria-level\", task.$level);\r\n\r\n      if (gantt._has_children(task.id)) {\r\n        div.setAttribute(\"aria-expanded\", task.$open ? \"true\" : \"false\");\r\n      }\r\n    },\r\n\r\n    linkAttr: function (link, div) {\r\n\r\n      var linkTypes = gantt.config.links;\r\n\r\n      var toStart = link.type == linkTypes.finish_to_start || link.type == linkTypes.start_to_start;\r\n      var fromStart = link.type == linkTypes.start_to_start || link.type == linkTypes.start_to_finish;\r\n\r\n      var content = gantt.locale.labels.link + \" \" + gantt.templates.drag_link(link.source, fromStart, link.target, toStart);\r\n\r\n      div.setAttribute(\"aria-label\", stripHTMLLite(content));\r\n      if (gantt._is_readonly(link)) {\r\n        div.setAttribute(\"aria-readonly\", true);\r\n      }\r\n    },\r\n\r\n    gridSeparatorAttr: function (div) {\r\n      div.setAttribute(\"role\", \"separator\");\r\n    },\r\n\r\n    lightboxHiddenAttr: function (div) {\r\n      div.setAttribute(\"aria-hidden\", \"true\");\r\n    },\r\n\r\n    lightboxVisibleAttr: function (div) {\r\n      div.setAttribute(\"aria-hidden\", \"false\");\r\n    },\r\n\r\n    lightboxAttr: function (div) {\r\n      div.setAttribute(\"role\", \"dialog\");\r\n      div.setAttribute(\"aria-hidden\", \"true\");\r\n      div.firstChild.setAttribute(\"role\", \"heading\");\r\n    },\r\n\r\n    lightboxButtonAttrString: function (buttonName) {\r\n      return this.getAttributeString({\r\n        \"role\": \"button\",\r\n        \"aria-label\": gantt.locale.labels[buttonName],\r\n        \"tabindex\": \"0\"\r\n      });\r\n    },\r\n\r\n    lightboxHeader: function (div, headerText) {\r\n      div.setAttribute(\"aria-label\", headerText);\r\n    },\r\n\r\n    lightboxSelectAttrString: function (time_option) {\r\n      var label = \"\";\r\n\r\n      switch (time_option) {\r\n        case \"%Y\":\r\n          label = gantt.locale.labels.years;\r\n          break;\r\n        case \"%m\":\r\n          label = gantt.locale.labels.months;\r\n          break;\r\n        case \"%d\":\r\n          label = gantt.locale.labels.days;\r\n          break;\r\n        case \"%H:%i\":\r\n          label = gantt.locale.labels.hours + gantt.locale.labels.minutes;\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      return gantt._waiAria.getAttributeString({\"aria-label\": label});\r\n    },\r\n\r\n    lightboxDurationInputAttrString: function (section) {\r\n      return this.getAttributeString({\"aria-label\": gantt.locale.labels.column_duration, \"aria-valuemin\": \"0\"});\r\n    },\r\n\r\n    gridAttrString: function () {\r\n      return [\" role='treegrid'\", gantt.config.multiselect ? \"aria-multiselectable='true'\" : \"aria-multiselectable='false'\", \" \"].join(\" \");\r\n    },\r\n\r\n\r\n    gridScaleRowAttrString: function () {\r\n      return \"role='row'\";\r\n    },\r\n\r\n    gridScaleCellAttrString: function (column, label) {\r\n      var attrs = \"\";\r\n      if (column.name == \"add\") {\r\n        attrs = this.getAttributeString({\"role\": \"button\", \"aria-label\": gantt.locale.labels.new_task});\r\n      } else {\r\n\r\n        var attributes = {\r\n          \"role\": \"columnheader\",\r\n          \"aria-label\": label\r\n        };\r\n\r\n        if (gantt._sort && gantt._sort.name == column.name) {\r\n          if (gantt._sort.direction == \"asc\") {\r\n            attributes[\"aria-sort\"] = \"ascending\";\r\n          } else {\r\n            attributes[\"aria-sort\"] = \"descending\";\r\n          }\r\n        }\r\n\r\n        attrs = this.getAttributeString(attributes);\r\n      }\r\n      return attrs;\r\n    },\r\n\r\n    gridDataAttrString: function () {\r\n      return \"role='rowgroup'\";\r\n    },\r\n\r\n    gridCellAttrString: function (column, textValue) {\r\n      return this.getAttributeString({\"role\": \"gridcell\", \"aria-label\": textValue});\r\n    },\r\n\r\n    gridAddButtonAttrString: function (column) {\r\n      return this.getAttributeString({\"role\": \"button\", \"aria-label\": gantt.locale.labels.new_task});\r\n    },\r\n\r\n    messageButtonAttrString: function (buttonLabel) {\r\n      return \"tabindex='0' role='button' aria-label='\" + buttonLabel + \"'\";\r\n    },\r\n\r\n    messageInfoAttr: function (div) {\r\n      div.setAttribute(\"role\", \"alert\");\r\n      //div.setAttribute(\"tabindex\", \"-1\");\r\n    },\r\n\r\n    messageModalAttr: function (div, uid) {\r\n      div.setAttribute(\"role\", \"dialog\");\r\n      if (uid) {\r\n        div.setAttribute(\"aria-labelledby\", uid);\r\n      }\r\n\r\n      //\tdiv.setAttribute(\"tabindex\", \"-1\");\r\n    },\r\n\r\n    quickInfoAttr: function (div) {\r\n      div.setAttribute(\"role\", \"dialog\");\r\n    },\r\n\r\n    quickInfoHeaderAttrString: function () {\r\n      return \" role='heading' \";\r\n    },\r\n\r\n    quickInfoHeader: function (div, header) {\r\n      div.setAttribute(\"aria-label\", header);\r\n    },\r\n\r\n    quickInfoButtonAttrString: function (label) {\r\n      return gantt._waiAria.getAttributeString({\"role\": \"button\", \"aria-label\": label, \"tabindex\": \"0\"});\r\n    },\r\n\r\n    tooltipAttr: function (div) {\r\n      div.setAttribute(\"role\", \"tooltip\");\r\n    },\r\n\r\n    tooltipVisibleAttr: function (div) {\r\n      div.setAttribute(\"aria-hidden\", \"false\");\r\n    },\r\n\r\n    tooltipHiddenAttr: function (div) {\r\n      div.setAttribute(\"aria-hidden\", \"true\");\r\n    }\r\n  };\r\n\r\n  function isDisabled() {\r\n    return !gantt.config.wai_aria_attributes;\r\n  }\r\n\r\n  for (var i in gantt._waiAria) {\r\n    gantt._waiAria[i] = (function (payload) {\r\n      return function () {\r\n        if (isDisabled()) {\r\n          return \"\";\r\n        }\r\n        return payload.apply(this, arguments);\r\n      };\r\n    })(gantt._waiAria[i]);\r\n  }\r\n\r\n\r\n})();\r\n\r\n\r\ngantt._scale_helpers = {\r\n  getSum: function (sizes, from, to) {\r\n    if (to === undefined)\r\n      to = sizes.length - 1;\r\n    if (from === undefined)\r\n      from = 0;\r\n\r\n    var summ = 0;\r\n    for (var i = from; i <= to; i++)\r\n      summ += sizes[i];\r\n\r\n    return summ;\r\n  },\r\n  setSumWidth: function (sum_width, scale, from, to) {\r\n    var parts = scale.width;\r\n\r\n    if (to === undefined)\r\n      to = parts.length - 1;\r\n    if (from === undefined)\r\n      from = 0;\r\n    var length = to - from + 1;\r\n\r\n    if (from > parts.length - 1 || length <= 0 || to > parts.length - 1)\r\n      return;\r\n\r\n    var oldWidth = this.getSum(parts, from, to);\r\n\r\n    var diff = sum_width - oldWidth;\r\n\r\n    this.adjustSize(diff, parts, from, to);\r\n    this.adjustSize(-diff, parts, to + 1);\r\n\r\n    scale.full_width = this.getSum(parts);\r\n  },\r\n  splitSize: function (width, count) {\r\n    var arr = [];\r\n    for (var i = 0; i < count; i++) arr[i] = 0;\r\n\r\n    this.adjustSize(width, arr);\r\n    return arr;\r\n\r\n  },\r\n  adjustSize: function (width, parts, from, to) {\r\n    if (!from)\r\n      from = 0;\r\n    if (to === undefined)\r\n      to = parts.length - 1;\r\n\r\n    var length = to - from + 1;\r\n\r\n    var full = this.getSum(parts, from, to);\r\n\r\n    var shared = 0;\r\n\r\n    for (var i = from; i <= to; i++) {\r\n      var share = Math.floor(width * (full ? (parts[i] / full) : (1 / length)));\r\n\r\n      full -= parts[i];\r\n      width -= share;\r\n      length--;\r\n\r\n      parts[i] += share;\r\n      shared += share;\r\n    }\r\n    parts[parts.length - 1] += width;\r\n    //parts[parts.length - 1] += width - shared;\r\n  },\r\n  sortScales: function (scales) {\r\n    function cellSize(unit, step) {\r\n      var d = new Date(1970, 0, 1);\r\n      return gantt.date.add(d, step, unit) - d;\r\n    }\r\n\r\n    scales.sort(function (a, b) {\r\n      if (cellSize(a.unit, a.step) < cellSize(b.unit, b.step)) {\r\n        return 1;\r\n      } else if (cellSize(a.unit, a.step) > cellSize(b.unit, b.step)) {\r\n        return -1;\r\n      } else {\r\n        return 0;\r\n      }\r\n    });\r\n\r\n    for (var i = 0; i < scales.length; i++) {\r\n      scales[i].index = i;\r\n    }\r\n  },\r\n  primaryScale: function () {\r\n\r\n    gantt._init_template(\"date_scale\");\r\n\r\n    return {\r\n      unit: gantt.config.scale_unit,\r\n      step: gantt.config.step,\r\n      template: gantt.templates.date_scale,\r\n      date: gantt.config.date_scale,\r\n      css: gantt.templates.scale_cell_class\r\n    };\r\n  },\r\n\r\n  prepareConfigs: function (scales, min_coll_width, container_width, scale_height) {\r\n    var heights = this.splitSize(scale_height, scales.length);\r\n    var full_width = container_width;\r\n\r\n    var configs = [];\r\n    for (var i = scales.length - 1; i >= 0; i--) {\r\n      var main_scale = (i == scales.length - 1);\r\n      var cfg = this.initScaleConfig(scales[i]);\r\n      if (main_scale) {\r\n        this.processIgnores(cfg);\r\n      }\r\n\r\n      this.initColSizes(cfg, min_coll_width, full_width, heights[i]);\r\n      this.limitVisibleRange(cfg);\r\n\r\n      if (main_scale) {\r\n        full_width = cfg.full_width;\r\n      }\r\n\r\n      configs.unshift(cfg);\r\n    }\r\n\r\n\r\n    for (var i = 0; i < configs.length - 1; i++) {\r\n      this.alineScaleColumns(configs[configs.length - 1], configs[i]);\r\n    }\r\n    for (var i = 0; i < configs.length; i++) {\r\n      this.setPosSettings(configs[i]);\r\n    }\r\n    return configs;\r\n\r\n  },\r\n  setPosSettings: function (config) {\r\n    for (var i = 0, len = config.trace_x.length; i < len; i++) {\r\n      config.left.push((config.width[i - 1] || 0) + (config.left[i - 1] || 0));\r\n    }\r\n  },\r\n\r\n  _ignore_time_config: function (date, scale) {\r\n    if (this.config.skip_off_time) {\r\n      var skip = true;\r\n      var probe = date;\r\n\r\n      // check dates in case custom scale unit, e.g. {unit: \"month\", step: 3}\r\n      for (var i = 0; i < scale.step; i++) {\r\n        if (i) {\r\n          probe = gantt.date.add(date, i, scale.unit);\r\n        }\r\n\r\n        skip = skip && !this.isWorkTime(probe, scale.unit);\r\n      }\r\n\r\n      return skip;\r\n    }\r\n    return false;\r\n  },\r\n  //defined in an extension\r\n  processIgnores: function (config) {\r\n    config.ignore_x = {};\r\n    config.display_count = config.count;\r\n  },\r\n  initColSizes: function (config, min_col_width, full_width, line_height) {\r\n    var cont_width = full_width;\r\n\r\n    config.height = line_height;\r\n\r\n    var column_count = config.display_count === undefined ? config.count : config.display_count;\r\n\r\n    if (!column_count)\r\n      column_count = 1;\r\n\r\n    config.col_width = Math.floor(cont_width / column_count);\r\n\r\n    if (min_col_width) {\r\n      if (config.col_width < min_col_width) {\r\n        config.col_width = min_col_width;\r\n        cont_width = config.col_width * column_count;\r\n      }\r\n    }\r\n    config.width = [];\r\n    var ignores = config.ignore_x || {};\r\n    for (var i = 0; i < config.trace_x.length; i++) {\r\n      if (ignores[config.trace_x[i].valueOf()] || (config.display_count == config.count)) {\r\n        config.width[i] = 0;\r\n      } else {\r\n        // width of month columns should be proportional month duration\r\n        var width = 1;\r\n        if (config.unit == \"month\") {\r\n          var days = Math.round((gantt.date.add(config.trace_x[i], config.step, config.unit) - config.trace_x[i]) / (1000 * 60 * 60 * 24));\r\n          width = days;\r\n        }\r\n        config.width[i] = width;\r\n      }\r\n    }\r\n\r\n    this.adjustSize(cont_width - this.getSum(config.width)/* 1 width per column from the code above */, config.width);\r\n    config.full_width = this.getSum(config.width);\r\n  },\r\n  initScaleConfig: function (config) {\r\n    var cfg = gantt.mixin({\r\n      count: 0,\r\n      col_width: 0,\r\n      full_width: 0,\r\n      height: 0,\r\n      width: [],\r\n      left: [],\r\n      trace_x: [],\r\n      trace_indexes: {}\r\n    }, config);\r\n\r\n    this.eachColumn(config.unit, config.step, function (date) {\r\n      cfg.count++;\r\n      cfg.trace_x.push(new Date(date));\r\n      cfg.trace_indexes[date.valueOf()] = cfg.trace_x.length - 1;\r\n    });\r\n\r\n    return cfg;\r\n  },\r\n  iterateScales: function (lower_scale, upper_scale, from, to, callback) {\r\n    var upper_dates = upper_scale.trace_x;\r\n    var lower_dates = lower_scale.trace_x;\r\n\r\n    var prev = from || 0;\r\n    var end = to || (lower_dates.length - 1);\r\n    var prevUpper = 0;\r\n\r\n\r\n    for (var up = 1; up < upper_dates.length; up++) {\r\n      var target_index = (lower_scale.trace_indexes[+upper_dates[up]]);\r\n      if (target_index !== undefined && target_index <= end) {\r\n        if (callback) {\r\n          callback.apply(this, [prevUpper, up, prev, target_index]);\r\n        }\r\n        prev = target_index;\r\n        prevUpper = up;\r\n        continue;\r\n      }\r\n    }\r\n  },\r\n  alineScaleColumns: function (lower_scale, upper_scale, from, to) {\r\n    this.iterateScales(lower_scale, upper_scale, from, to, function (upper_start, upper_end, lower_start, lower_end) {\r\n      var targetWidth = this.getSum(lower_scale.width, lower_start, lower_end - 1);\r\n      var actualWidth = this.getSum(upper_scale.width, upper_start, upper_end - 1);\r\n      if (actualWidth != targetWidth) {\r\n        this.setSumWidth(targetWidth, upper_scale, upper_start, upper_end - 1);\r\n      }\r\n\r\n    });\r\n  },\r\n\r\n  eachColumn: function (unit, step, callback) {\r\n    var start = new Date(gantt._min_date),\r\n        end = new Date(gantt._max_date);\r\n    if (gantt.date[unit + \"_start\"]) {\r\n      start = gantt.date[unit + \"_start\"](start);\r\n    }\r\n\r\n    var curr = new Date(start);\r\n    if (+curr >= +end) {\r\n      end = gantt.date.add(curr, step, unit);\r\n    }\r\n    while (+curr < +end) {\r\n      callback.call(this, new Date(curr));\r\n      var tzOffset = curr.getTimezoneOffset();\r\n      curr = gantt.date.add(curr, step, unit);\r\n      curr = gantt._correct_dst_change(curr, tzOffset, step, unit);\r\n      if (gantt.date[unit + '_start'])\r\n        curr = gantt.date[unit + \"_start\"](curr);\r\n    }\r\n  },\r\n  limitVisibleRange: function (cfg) {\r\n    var dates = cfg.trace_x;\r\n\r\n    var left = 0, right = cfg.width.length - 1;\r\n    var diff = 0;\r\n    if (+dates[0] < +gantt._min_date && left != right) {\r\n      var width = Math.floor(cfg.width[0] * ((dates[1] - gantt._min_date) / (dates[1] - dates[0])));\r\n      diff += cfg.width[0] - width;\r\n      cfg.width[0] = width;\r\n\r\n      dates[0] = new Date(gantt._min_date);\r\n    }\r\n\r\n    var last = dates.length - 1;\r\n    var lastDate = dates[last];\r\n    var outDate = gantt.date.add(lastDate, cfg.step, cfg.unit);\r\n    if (+outDate > +gantt._max_date && last > 0) {\r\n      var width = cfg.width[last] - Math.floor(cfg.width[last] * ((outDate - gantt._max_date) / (outDate - lastDate)));\r\n      diff += cfg.width[last] - width;\r\n      cfg.width[last] = width;\r\n    }\r\n\r\n    if (diff) {\r\n      var full = this.getSum(cfg.width);\r\n      var shared = 0;\r\n      for (var i = 0; i < cfg.width.length; i++) {\r\n        var share = Math.floor(diff * (cfg.width[i] / full));\r\n        cfg.width[i] += share;\r\n        shared += share;\r\n      }\r\n      this.adjustSize(diff - shared, cfg.width);\r\n    }\r\n\r\n  }\r\n};\r\n// --#include core/scales_ignore.js\r\ngantt._tasks_dnd = {\r\n  drag: null,\r\n  _events: {\r\n    before_start: {},\r\n    before_finish: {},\r\n    after_finish: {}\r\n  },\r\n  _handlers: {},\r\n  init: function () {\r\n    this.clear_drag_state();\r\n    var drag = gantt.config.drag_mode;\r\n    this.set_actions();\r\n\r\n    var evs = {\r\n      \"before_start\": \"onBeforeTaskDrag\",\r\n      \"before_finish\": \"onBeforeTaskChanged\",\r\n      \"after_finish\": \"onAfterTaskDrag\"\r\n    };\r\n    //for now, all drag operations will trigger the same events\r\n    for (var stage in this._events) {\r\n      for (var mode in drag) {\r\n        this._events[stage][mode] = evs[stage];\r\n      }\r\n    }\r\n\r\n    this._handlers[drag.move] = this._move;\r\n    this._handlers[drag.resize] = this._resize;\r\n    this._handlers[drag.progress] = this._resize_progress;\r\n\r\n  },\r\n  set_actions: function () {\r\n    var data = gantt.$task_data;\r\n    gantt.event(data, \"mousemove\", gantt.bind(function (e) {\r\n      this.on_mouse_move(e || event);\r\n    }, this));\r\n    gantt.event(data, \"mousedown\", gantt.bind(function (e) {\r\n      this.on_mouse_down(e || event);\r\n    }, this));\r\n    gantt.event(data, \"mouseup\", gantt.bind(function (e) {\r\n      this.on_mouse_up(e || event);\r\n    }, this));\r\n  },\r\n\r\n  clear_drag_state: function () {\r\n    this.drag = {\r\n      id: null,\r\n      mode: null,\r\n      pos: null,\r\n      start_x: null,\r\n      start_y: null,\r\n      obj: null,\r\n      left: null\r\n    };\r\n  },\r\n  _resize: function (ev, shift, drag) {\r\n    var cfg = gantt.config;\r\n    var coords_x = this._drag_task_coords(ev, drag);\r\n    if (drag.left) {\r\n      ev.start_date = gantt.dateFromPos(coords_x.start + shift);\r\n      if (!ev.start_date) {\r\n        ev.start_date = new Date(gantt.getState().min_date);\r\n      }\r\n    } else {\r\n      ev.end_date = gantt.dateFromPos(coords_x.end + shift);\r\n      if (!ev.end_date) {\r\n        ev.end_date = new Date(gantt.getState().max_date);\r\n      }\r\n    }\r\n\r\n    if (ev.end_date - ev.start_date < cfg.min_duration) {\r\n      if (drag.left)\r\n        ev.start_date = gantt.calculateEndDate({start_date: ev.end_date, duration: -1, task: ev});\r\n      else\r\n        ev.end_date = gantt.calculateEndDate({start_date: ev.start_date, duration: 1, task: ev});\r\n    }\r\n    gantt._init_task_timing(ev);\r\n  },\r\n  _resize_progress: function (ev, shift, drag) {\r\n    var coords_x = this._drag_task_coords(ev, drag);\r\n\r\n    var diff = Math.max(0, drag.pos.x - coords_x.start);\r\n    ev.progress = Math.min(1, diff / (coords_x.end - coords_x.start));\r\n  },\r\n  _move: function (ev, shift, drag) {\r\n    var coords_x = this._drag_task_coords(ev, drag);\r\n    var new_start = gantt.dateFromPos(coords_x.start + shift),\r\n        new_end = gantt.dateFromPos(coords_x.end + shift);\r\n    if (!new_start) {\r\n      ev.start_date = new Date(gantt.getState().min_date);\r\n      ev.end_date = gantt.dateFromPos(gantt.posFromDate(ev.start_date) + (coords_x.end - coords_x.start));\r\n    } else if (!new_end) {\r\n      ev.end_date = new Date(gantt.getState().max_date);\r\n      ev.start_date = gantt.dateFromPos(gantt.posFromDate(ev.end_date) - (coords_x.end - coords_x.start));\r\n    } else {\r\n      ev.start_date = new_start;\r\n      ev.end_date = new_end;\r\n    }\r\n  },\r\n  _drag_task_coords: function (t, drag) {\r\n    var start = drag.obj_s_x = drag.obj_s_x || gantt.posFromDate(t.start_date);\r\n    var end = drag.obj_e_x = drag.obj_e_x || gantt.posFromDate(t.end_date);\r\n    return {\r\n      start: start,\r\n      end: end\r\n    };\r\n  },\r\n  _mouse_position_change: function (oldPos, newPos) {\r\n    var dx = oldPos.x - newPos.x,\r\n        dy = oldPos.y - newPos.y;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  },\r\n  _is_number: function (n) {\r\n    return !isNaN(parseFloat(n)) && isFinite(n);\r\n  },\r\n\r\n  on_mouse_move: function (e) {\r\n    if (this.drag.start_drag) {\r\n      var pos = gantt._get_mouse_pos(e);\r\n\r\n      var sX = this.drag.start_drag.start_x,\r\n          sY = this.drag.start_drag.start_y;\r\n\r\n      if ((Date.now() - this.drag.timestamp > 50) ||\r\n          (this._is_number(sX) && this._is_number(sY) && this._mouse_position_change({x: sX, y: sY}, pos) > 20)) {\r\n        this._start_dnd(e);\r\n      }\r\n    }\r\n\r\n    var drag = this.drag;\r\n\r\n    if (drag.mode) {\r\n      if (!gantt._checkTimeout(this, 40))//limit update frequency\r\n        return;\r\n\r\n      this._update_on_move(e);\r\n\r\n    }\r\n  },\r\n  _update_on_move: function (e) {\r\n    var drag = this.drag;\r\n\r\n    if (drag.mode) {\r\n      var pos = gantt._get_mouse_pos(e);\r\n      if (drag.pos && drag.pos.x == pos.x)\r\n        return;\r\n\r\n      drag.pos = pos;\r\n\r\n      var curr_date = gantt.dateFromPos(pos.x);\r\n      if (!curr_date || isNaN(curr_date.getTime()))\r\n        return;\r\n\r\n\r\n      var shift = pos.x - drag.start_x;\r\n      var ev = gantt.getTask(drag.id);\r\n\r\n\r\n      if (this._handlers[drag.mode]) {\r\n        var original = gantt.mixin({}, ev);\r\n        var copy = gantt.mixin({}, ev);\r\n        this._handlers[drag.mode].apply(this, [copy, shift, drag]);\r\n        gantt.mixin(ev, copy, true);\r\n        //gantt._update_parents(drag.id, true);\r\n        gantt.callEvent(\"onTaskDrag\", [ev.id, drag.mode, copy, original, e]);\r\n\r\n        gantt.mixin(ev, copy, true);\r\n        gantt._update_parents(drag.id);\r\n        gantt.refreshTask(drag.id);\r\n      }\r\n\r\n    }\r\n  },\r\n\r\n  on_mouse_down: function (e, src) {\r\n    // on Mac we do not get onmouseup event when clicking right mouse button leaving us in dnd state\r\n    // let's ignore right mouse button then\r\n    if (e.button == 2)\r\n      return;\r\n\r\n    var id = gantt.locate(e);\r\n    var task = null;\r\n    if (gantt.isTaskExists(id)) {\r\n      task = gantt.getTask(id);\r\n    }\r\n\r\n    if (gantt._is_readonly(task) || this.drag.mode) return;\r\n\r\n    this.clear_drag_state();\r\n\r\n    src = src || (e.target || e.srcElement);\r\n\r\n    var className = gantt._getClassName(src);\r\n    if (!className || !this._get_drag_mode(className)) {\r\n      if (src.parentNode)\r\n        return this.on_mouse_down(e, src.parentNode);\r\n      else\r\n        return;\r\n    }\r\n\r\n    var drag = this._get_drag_mode(className);\r\n\r\n    if (!drag) {\r\n      if (gantt.checkEvent(\"onMouseDown\") && gantt.callEvent(\"onMouseDown\", [className.split(\" \")[0]])) {\r\n        if (src.parentNode)\r\n          return this.on_mouse_down(e, src.parentNode);\r\n\r\n      }\r\n    } else {\r\n      if (drag.mode && drag.mode != gantt.config.drag_mode.ignore && gantt.config[\"drag_\" + drag.mode]) {\r\n        id = gantt.locate(src);\r\n        task = gantt.copy(gantt.getTask(id) || {});\r\n\r\n        if (gantt._is_readonly(task)) {\r\n          this.clear_drag_state();\r\n          return false;\r\n        }\r\n\r\n        if (gantt._is_flex_task(task) && drag.mode != gantt.config.drag_mode.progress) {//only progress drag is allowed for tasks with flexible duration\r\n          this.clear_drag_state();\r\n          return;\r\n        }\r\n\r\n        drag.id = id;\r\n        var pos = gantt._get_mouse_pos(e);\r\n\r\n        drag.start_x = pos.x;\r\n        drag.start_y = pos.y;\r\n        drag.obj = task;\r\n        this.drag.start_drag = drag;\r\n        this.drag.timestamp = Date.now();\r\n\r\n      } else\r\n        this.clear_drag_state();\r\n    }\r\n  },\r\n  _fix_dnd_scale_time: function (task, drag) {\r\n    var unit = gantt._tasks.unit,\r\n        step = gantt._tasks.step;\r\n    if (!gantt.config.round_dnd_dates) {\r\n      unit = 'minute';\r\n      step = gantt.config.time_step;\r\n    }\r\n\r\n    function fixStart(task) {\r\n      if (!gantt.isWorkTime(task.start_date, undefined, task))\r\n        task.start_date = gantt.calculateEndDate({\r\n          start_date: task.start_date,\r\n          duration: -1,\r\n          unit: gantt.config.duration_unit,\r\n          task: task\r\n        });\r\n    }\r\n\r\n    function fixEnd(task) {\r\n      if (!gantt.isWorkTime(new Date(task.end_date - 1), undefined, task))\r\n        task.end_date = gantt.calculateEndDate({\r\n          start_date: task.end_date,\r\n          duration: 1,\r\n          unit: gantt.config.duration_unit,\r\n          task: task\r\n        });\r\n    }\r\n\r\n    if (drag.mode == gantt.config.drag_mode.resize) {\r\n      if (drag.left) {\r\n        task.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n        fixStart(task);\r\n      } else {\r\n        task.end_date = gantt.roundDate({date: task.end_date, unit: unit, step: step});\r\n        fixEnd(task);\r\n      }\r\n    } else if (drag.mode == gantt.config.drag_mode.move) {\r\n      task.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n      fixStart(task);\r\n\r\n      task.end_date = gantt.calculateEndDate(task);\r\n    }\r\n  },\r\n  _fix_working_times: function (task, drag) {\r\n    var drag = drag || {mode: gantt.config.drag_mode.move};\r\n    if (gantt.config.work_time && gantt.config.correct_work_time) {\r\n      if (drag.mode == gantt.config.drag_mode.resize) {\r\n        if (drag.left) {\r\n          task.start_date = gantt.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n        } else {\r\n          task.end_date = gantt.getClosestWorkTime({date: task.end_date, dir: 'past', task: task});\r\n        }\r\n      } else if (drag.mode == gantt.config.drag_mode.move) {\r\n        gantt.correctTaskWorkTime(task);\r\n      }\r\n    }\r\n  },\r\n  on_mouse_up: function (e) {\r\n    var drag = this.drag;\r\n    if (drag.mode && drag.id) {\r\n      //drop\r\n      var ev = gantt.getTask(drag.id);\r\n\r\n      if (gantt.config.work_time && gantt.config.correct_work_time) {\r\n        this._fix_working_times(ev, drag);\r\n      }\r\n\r\n      this._fix_dnd_scale_time(ev, drag);\r\n\r\n      gantt._init_task_timing(ev);\r\n\r\n      if (!this._fireEvent(\"before_finish\", drag.mode, [drag.id, drag.mode, gantt.copy(drag.obj), e])) {\r\n        drag.obj._dhx_changed = false;\r\n        gantt.mixin(ev, drag.obj, true);\r\n\r\n        gantt.updateTask(ev.id);\r\n      } else {\r\n        var drag_id = drag.id;\r\n\r\n        gantt._init_task_timing(ev);\r\n\r\n        this.clear_drag_state();\r\n        gantt.updateTask(ev.id);\r\n        this._fireEvent(\"after_finish\", drag.mode, [drag_id, drag.mode, e]);\r\n      }\r\n\r\n    }\r\n    this.clear_drag_state();\r\n  },\r\n  _get_drag_mode: function (className) {\r\n    var modes = gantt.config.drag_mode;\r\n    var classes = (className || \"\").split(\" \");\r\n    var classname = classes[0];\r\n    var drag = {mode: null, left: null};\r\n    switch (classname) {\r\n      case \"gantt_task_line\":\r\n      case \"gantt_task_content\":\r\n        drag.mode = modes.move;\r\n        break;\r\n      case \"gantt_task_drag\":\r\n        drag.mode = modes.resize;\r\n        if (classes[1] && classes[1].indexOf(\"left\", classes[1].length - \"left\".length) !== -1) {\r\n          drag.left = true;\r\n        } else {\r\n          drag.left = false;\r\n        }\r\n        break;\r\n      case \"gantt_task_progress_drag\":\r\n        drag.mode = modes.progress;\r\n        break;\r\n      case \"gantt_link_control\":\r\n      case \"gantt_link_point\":\r\n        drag.mode = modes.ignore;\r\n        break;\r\n      default:\r\n        drag = null;\r\n        break;\r\n    }\r\n    return drag;\r\n\r\n  },\r\n\r\n  _start_dnd: function (e) {\r\n    var drag = this.drag = this.drag.start_drag;\r\n    delete drag.start_drag;\r\n\r\n    var cfg = gantt.config;\r\n    var id = drag.id;\r\n    if (!cfg[\"drag_\" + drag.mode] || !gantt.callEvent(\"onBeforeDrag\", [id, drag.mode, e]) || !this._fireEvent(\"before_start\", drag.mode, [id, drag.mode, e])) {\r\n      this.clear_drag_state();\r\n    } else {\r\n      delete drag.start_drag;\r\n      gantt.callEvent(\"onTaskDragStart\", []);\r\n    }\r\n\r\n  },\r\n  _fireEvent: function (stage, mode, params) {\r\n    gantt.assert(this._events[stage], \"Invalid stage:{\" + stage + \"}\");\r\n\r\n    var trigger = this._events[stage][mode];\r\n\r\n    gantt.assert(trigger, \"Unknown after drop mode:{\" + mode + \"}\");\r\n    gantt.assert(params, \"Invalid event arguments\");\r\n\r\n\r\n    if (!gantt.checkEvent(trigger))\r\n      return true;\r\n\r\n    return gantt.callEvent(trigger, params);\r\n  }\r\n};\r\n\r\ngantt.roundTaskDates = function (task) {\r\n  var drag_state = gantt._tasks_dnd.drag;\r\n\r\n  if (!drag_state) {\r\n    drag_state = {mode: gantt.config.drag_mode.move};\r\n  }\r\n  gantt._tasks_dnd._fix_dnd_scale_time(task, drag_state);\r\n};\r\n\r\n\r\ngantt._render_link = function (id) {\r\n  var link = this.getLink(id);\r\n  var renders = gantt._get_link_renderers();\r\n  for (var i = 0; i < renders.length; i++)\r\n    renders[i].render_item(link);\r\n};\r\n\r\ngantt._get_link_type = function (from_start, to_start) {\r\n  var type = null;\r\n  if (from_start && to_start) {\r\n    type = gantt.config.links.start_to_start;\r\n  } else if (!from_start && to_start) {\r\n    type = gantt.config.links.finish_to_start;\r\n  } else if (!from_start && !to_start) {\r\n    type = gantt.config.links.finish_to_finish;\r\n  } else if (from_start && !to_start) {\r\n    type = gantt.config.links.start_to_finish;\r\n  }\r\n  return type;\r\n};\r\n\r\ngantt.isLinkAllowed = function (from, to, from_start, to_start) {\r\n  var link = null;\r\n  if (typeof(from) == \"object\") {\r\n    link = from;\r\n  } else {\r\n    link = {source: from, target: to, type: this._get_link_type(from_start, to_start)};\r\n  }\r\n\r\n  if (!link) return false;\r\n  if (!(link.source && link.target && link.type)) return false;\r\n  if (link.source == link.target) return false;\r\n\r\n  var res = true;\r\n  //any custom rules\r\n  if (this.checkEvent(\"onLinkValidation\"))\r\n    res = this.callEvent(\"onLinkValidation\", [link]);\r\n\r\n  return res;\r\n};\r\n\r\ngantt._render_link_element = function (link) {\r\n  var dots = this._path_builder.get_points(link);\r\n  var drawer = gantt._drawer;\r\n  var lines = drawer.get_lines(dots);\r\n\r\n  var div = document.createElement(\"div\");\r\n\r\n\r\n  var css = \"gantt_task_link\";\r\n\r\n  if (link.color) {\r\n    css += \" gantt_link_inline_color\";\r\n  }\r\n  var cssTemplate = this.templates.link_class ? this.templates.link_class(link) : \"\";\r\n  if (cssTemplate) {\r\n    css += \" \" + cssTemplate;\r\n  }\r\n\r\n  if (this.config.highlight_critical_path && this.isCriticalLink) {\r\n    if (this.isCriticalLink(link))\r\n      css += \" gantt_critical_link\";\r\n  }\r\n\r\n  div.className = css;\r\n  div.setAttribute(gantt.config.link_attribute, link.id);\r\n  for (var i = 0; i < lines.length; i++) {\r\n    if (i == lines.length - 1) {\r\n      lines[i].size -= gantt.config.link_arrow_size;\r\n    }\r\n    var el = drawer.render_line(lines[i], lines[i + 1]);\r\n    if (link.color) {\r\n      el.firstChild.style.backgroundColor = link.color;\r\n    }\r\n    div.appendChild(el);\r\n  }\r\n\r\n  var direction = lines[lines.length - 1].direction;\r\n  var endpoint = gantt._render_link_arrow(dots[dots.length - 1], direction);\r\n  if (link.color) {\r\n    endpoint.style.borderColor = link.color;\r\n  }\r\n  div.appendChild(endpoint);\r\n\r\n  gantt._waiAria.linkAttr(link, div);\r\n\r\n  return div;\r\n};\r\n\r\ngantt._render_link_arrow = function (point, direction) {\r\n  var div = document.createElement(\"div\");\r\n  var drawer = gantt._drawer;\r\n  var top = point.y;\r\n  var left = point.x;\r\n\r\n  var size = gantt.config.link_arrow_size;\r\n  var line_width = gantt.config.row_height;\r\n  var className = \"gantt_link_arrow gantt_link_arrow_\" + direction;\r\n  switch (direction) {\r\n    case drawer.dirs.right:\r\n      top -= (size - line_width) / 2;\r\n      left -= size;\r\n      break;\r\n    case drawer.dirs.left:\r\n      top -= (size - line_width) / 2;\r\n      break;\r\n    case drawer.dirs.up:\r\n      left -= size;\r\n      break;\r\n    case drawer.dirs.down:\r\n      top += size * 2;\r\n      left -= size;\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n  div.style.cssText = [\r\n    \"top:\" + top + \"px\",\r\n    \"left:\" + left + 'px'].join(';');\r\n  div.className = className;\r\n\r\n  return div;\r\n};\r\n\r\n\r\ngantt._drawer = {\r\n  current_pos: null,\r\n  dirs: {\"left\": 'left', \"right\": 'right', \"up\": 'up', \"down\": 'down'},\r\n  path: [],\r\n  clear: function () {\r\n    this.current_pos = null;\r\n    this.path = [];\r\n  },\r\n  point: function (pos) {\r\n    this.current_pos = gantt.copy(pos);\r\n  },\r\n  get_lines: function (dots) {\r\n    this.clear();\r\n    this.point(dots[0]);\r\n    for (var i = 1; i < dots.length; i++) {\r\n      this.line_to(dots[i]);\r\n    }\r\n    return this.get_path();\r\n  },\r\n  line_to: function (pos) {\r\n    var next = gantt.copy(pos);\r\n    var prev = this.current_pos;\r\n\r\n    var line = this._get_line(prev, next);\r\n    this.path.push(line);\r\n    this.current_pos = next;\r\n  },\r\n  get_path: function () {\r\n    return this.path;\r\n  },\r\n  get_wrapper_sizes: function (v) {\r\n    var res,\r\n        wrapper_size = gantt.config.link_wrapper_width,\r\n        line_size = gantt.config.link_line_width,\r\n        y = v.y + (gantt.config.row_height - wrapper_size) / 2;\r\n    switch (v.direction) {\r\n      case this.dirs.left:\r\n        res = {\r\n          top: y,\r\n          height: wrapper_size,\r\n          lineHeight: wrapper_size,\r\n          left: v.x - v.size - wrapper_size / 2,\r\n          width: v.size + wrapper_size\r\n        };\r\n        break;\r\n      case this.dirs.right:\r\n        res = {\r\n          top: y,\r\n          lineHeight: wrapper_size,\r\n          height: wrapper_size,\r\n          left: v.x - wrapper_size / 2,\r\n          width: v.size + wrapper_size\r\n        };\r\n        break;\r\n      case this.dirs.up:\r\n        res = {\r\n          top: y - v.size,\r\n          lineHeight: v.size + wrapper_size,\r\n          height: v.size + wrapper_size,\r\n          left: v.x - wrapper_size / 2,\r\n          width: wrapper_size\r\n        };\r\n        break;\r\n      case this.dirs.down:\r\n        res = {\r\n          top: y /*- wrapper_size/2*/,\r\n          lineHeight: v.size + wrapper_size,\r\n          height: v.size + wrapper_size,\r\n          left: v.x - wrapper_size / 2,\r\n          width: wrapper_size\r\n        };\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return res;\r\n  },\r\n  get_line_sizes: function (v) {\r\n    var res,\r\n        line_size = gantt.config.link_line_width,\r\n        wrapper_size = gantt.config.link_wrapper_width,\r\n        size = v.size + line_size;\r\n    switch (v.direction) {\r\n      case this.dirs.left:\r\n      case this.dirs.right:\r\n        res = {\r\n          height: line_size,\r\n          width: size,\r\n          marginTop: (wrapper_size - line_size) / 2,\r\n          marginLeft: (wrapper_size - line_size) / 2\r\n        };\r\n        break;\r\n      case this.dirs.up:\r\n      case this.dirs.down:\r\n        res = {\r\n          height: size,\r\n          width: line_size,\r\n          marginTop: (wrapper_size - line_size) / 2,\r\n          marginLeft: (wrapper_size - line_size) / 2\r\n        };\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n\r\n    return res;\r\n  },\r\n  render_line: function (v) {\r\n    var pos = this.get_wrapper_sizes(v);\r\n    var wrapper = document.createElement(\"div\");\r\n    wrapper.style.cssText = [\r\n      \"top:\" + pos.top + \"px\",\r\n      \"left:\" + pos.left + \"px\",\r\n      \"height:\" + pos.height + \"px\",\r\n      \"width:\" + pos.width + \"px\"\r\n    ].join(';');\r\n    wrapper.className = \"gantt_line_wrapper\";\r\n\r\n    var innerPos = this.get_line_sizes(v);\r\n    var inner = document.createElement(\"div\");\r\n    inner.style.cssText = [\r\n      \"height:\" + innerPos.height + \"px\",\r\n      \"width:\" + innerPos.width + \"px\",\r\n      \"margin-top:\" + innerPos.marginTop + \"px\",\r\n      \"margin-left:\" + innerPos.marginLeft + \"px\"\r\n    ].join(\";\");\r\n\r\n    inner.className = \"gantt_link_line_\" + v.direction;\r\n    wrapper.appendChild(inner);\r\n\r\n    return wrapper;\r\n  },\r\n  _get_line: function (from, to) {\r\n    var direction = this.get_direction(from, to);\r\n    var vect = {\r\n      x: from.x,\r\n      y: from.y,\r\n      direction: this.get_direction(from, to)\r\n    };\r\n    if (direction == this.dirs.left || direction == this.dirs.right) {\r\n      vect.size = Math.abs(from.x - to.x);\r\n    } else {\r\n      vect.size = Math.abs(from.y - to.y);\r\n    }\r\n    return vect;\r\n  },\r\n  get_direction: function (from, to) {\r\n    var direction = 0;\r\n    if (to.x < from.x) {\r\n      direction = this.dirs.left;\r\n    } else if (to.x > from.x) {\r\n      direction = this.dirs.right;\r\n    } else if (to.y > from.y) {\r\n      direction = this.dirs.down;\r\n    } else {\r\n      direction = this.dirs.up;\r\n    }\r\n    return direction;\r\n  }\r\n\r\n};\r\ngantt._y_from_ind = function (index) {\r\n  return (index) * gantt.config.row_height;\r\n};\r\ngantt._path_builder = {\r\n\r\n  path: [],\r\n  clear: function () {\r\n    this.path = [];\r\n  },\r\n  current: function () {\r\n    return this.path[this.path.length - 1];\r\n  },\r\n  point: function (next) {\r\n    if (!next)\r\n      return this.current();\r\n\r\n    this.path.push(gantt.copy(next));\r\n    return next;\r\n  },\r\n  point_to: function (direction, diff, point) {\r\n    if (!point)\r\n      point = gantt.copy(this.point());\r\n    else\r\n      point = {x: point.x, y: point.y};\r\n    var dir = gantt._drawer.dirs;\r\n    switch (direction) {\r\n      case (dir.left):\r\n        point.x -= diff;\r\n        break;\r\n      case (dir.right):\r\n        point.x += diff;\r\n        break;\r\n      case (dir.up):\r\n        point.y -= diff;\r\n        break;\r\n      case (dir.down):\r\n        point.y += diff;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return this.point(point);\r\n  },\r\n  get_points: function (link) {\r\n    var pt = this.get_endpoint(link);\r\n    var xy = gantt.config;\r\n\r\n\r\n    var dy = pt.e_y - pt.y;\r\n    var dx = pt.e_x - pt.x;\r\n\r\n    var dir = gantt._drawer.dirs;\r\n\r\n    this.clear();\r\n    this.point({x: pt.x, y: pt.y});\r\n\r\n    var shiftX = 2 * xy.link_arrow_size;//just random size for first line\r\n\r\n\r\n    var forward = (pt.e_x > pt.x);\r\n    if (link.type == gantt.config.links.start_to_start) {\r\n      this.point_to(dir.left, shiftX);\r\n      if (forward) {\r\n        this.point_to(dir.down, dy);\r\n        this.point_to(dir.right, dx);\r\n      } else {\r\n        this.point_to(dir.right, dx);\r\n        this.point_to(dir.down, dy);\r\n      }\r\n      this.point_to(dir.right, shiftX);\r\n\r\n    } else if (link.type == gantt.config.links.finish_to_start) {\r\n      forward = (pt.e_x > (pt.x + 2 * shiftX));\r\n      this.point_to(dir.right, shiftX);\r\n      if (forward) {\r\n        dx -= shiftX;\r\n        this.point_to(dir.down, dy);\r\n        this.point_to(dir.right, dx);\r\n      } else {\r\n        dx -= 2 * shiftX;\r\n        var sign = dy > 0 ? 1 : -1;\r\n\r\n        this.point_to(dir.down, sign * (xy.row_height / 2));\r\n        this.point_to(dir.right, dx);\r\n        this.point_to(dir.down, sign * ( Math.abs(dy) - (xy.row_height / 2)));\r\n        this.point_to(dir.right, shiftX);\r\n      }\r\n\r\n    } else if (link.type == gantt.config.links.finish_to_finish) {\r\n      this.point_to(dir.right, shiftX);\r\n      if (forward) {\r\n        this.point_to(dir.right, dx);\r\n        this.point_to(dir.down, dy);\r\n      } else {\r\n        this.point_to(dir.down, dy);\r\n        this.point_to(dir.right, dx);\r\n      }\r\n      this.point_to(dir.left, shiftX);\r\n    } else if (link.type == gantt.config.links.start_to_finish) {\r\n\r\n      forward = (pt.e_x > (pt.x - 2 * shiftX));\r\n      this.point_to(dir.left, shiftX);\r\n\r\n      if (!forward) {\r\n        dx += shiftX;\r\n        this.point_to(dir.down, dy);\r\n        this.point_to(dir.right, dx);\r\n      } else {\r\n        dx += 2 * shiftX;\r\n        var sign = dy > 0 ? 1 : -1;\r\n        this.point_to(dir.down, sign * (xy.row_height / 2));\r\n        this.point_to(dir.right, dx);\r\n        this.point_to(dir.down, sign * ( Math.abs(dy) - (xy.row_height / 2)));\r\n        this.point_to(dir.left, shiftX);\r\n      }\r\n\r\n    }\r\n\r\n    return this.path;\r\n  },\r\n  get_endpoint: function (link) {\r\n    var types = gantt.config.links;\r\n    var from_start = false, to_start = false;\r\n\r\n    if (link.type == types.start_to_start) {\r\n      from_start = to_start = true;\r\n    } else if (link.type == types.finish_to_finish) {\r\n      from_start = to_start = false;\r\n    } else if (link.type == types.finish_to_start) {\r\n      from_start = false;\r\n      to_start = true;\r\n    } else if (link.type == types.start_to_finish) {\r\n      from_start = true;\r\n      to_start = false;\r\n    } else {\r\n      gantt.assert(false, \"Invalid link type\");\r\n    }\r\n\r\n    var from = gantt._get_task_visible_pos(gantt._pull[link.source], from_start);\r\n    var to = gantt._get_task_visible_pos(gantt._pull[link.target], to_start);\r\n\r\n    return {\r\n      x: from.x,\r\n      e_x: to.x,\r\n      y: from.y,\r\n      e_y: to.y\r\n    };\r\n  }\r\n};\r\n\r\ngantt._init_links_dnd = function () {\r\n  var dnd = new gantt._DnD(this.$task_bars, {sensitivity: 0, updates_per_second: 60}),\r\n      start_marker = \"task_left\",\r\n      end_marker = \"task_right\",\r\n      link_edge_marker = \"gantt_link_point\",\r\n      link_landing_hover_area = \"gantt_link_control\";\r\n\r\n  dnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\r\n    var target = (e.target || e.srcElement);\r\n    resetDndState();\r\n    if (gantt.getState().drag_id)\r\n      return false;\r\n\r\n\r\n    if (gantt._locate_css(target, link_edge_marker)) {\r\n      if (gantt._locate_css(target, start_marker))\r\n        gantt._link_source_task_start = true;\r\n\r\n      var sid = gantt._link_source_task = this.locate(e);\r\n\r\n\r\n      var t = gantt.getTask(sid);\r\n      if (gantt._is_readonly(t)) {\r\n        resetDndState();\r\n        return false;\r\n      }\r\n\r\n      var shift = 0;\r\n      if (gantt._get_safe_type(t.type) == gantt.config.types.milestone) {\r\n        shift = (gantt._get_visible_milestone_width() - gantt._get_milestone_width()) / 2;\r\n      }\r\n\r\n      this._dir_start = getLinePos(t, !!gantt._link_source_task_start, shift);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n\r\n  }, this));\r\n\r\n  dnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\r\n    if (this.config.touch) {\r\n      this._show_link_points = true;\r\n      this.refreshData();\r\n    }\r\n    updateMarkedHtml(dnd.config.marker);\r\n  }, this));\r\n\r\n  function getLinePos(task, to_start, shift) {\r\n    var pos = gantt._get_task_pos(task, !!to_start);\r\n    pos.y += gantt.config.row_height / 2;\r\n\r\n    shift = shift || 0;\r\n    pos.x += (to_start ? -1 : 1) * shift;\r\n    return pos;\r\n  }\r\n\r\n  dnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\r\n    var dd = dnd.config;\r\n    var pos = dnd.getPosition(e);\r\n    advanceMarker(dd.marker, pos);\r\n    var landing = gantt._is_link_drop_area(e);\r\n\r\n    var prevTarget = gantt._link_target_task;\r\n    var prevLanding = gantt._link_landing;\r\n    var prevToStart = gantt._link_target_task_start;\r\n\r\n    var targ = gantt.locate(e),\r\n        to_start = true;\r\n    if (landing) {\r\n      //refreshTask\r\n      to_start = !gantt._locate_css(e, end_marker);\r\n      landing = !!targ;\r\n    }\r\n\r\n    gantt._link_target_task = targ;\r\n    gantt._link_landing = landing;\r\n    gantt._link_target_task_start = to_start;\r\n\r\n    if (landing) {\r\n      var t = gantt.getTask(targ);\r\n\r\n      var node = gantt._locate_css(e, link_landing_hover_area);\r\n      var shift = 0;\r\n      if (node) {\r\n        shift = Math.floor(node.offsetWidth / 2);\r\n      }\r\n\r\n      this._dir_end = getLinePos(t, !!gantt._link_target_task_start, shift);\r\n    } else {\r\n      this._dir_end = gantt._get_mouse_pos(e);\r\n    }\r\n\r\n    var targetChanged = !(prevLanding == landing && prevTarget == targ && prevToStart == to_start);\r\n    if (targetChanged) {\r\n      if (prevTarget)\r\n        gantt.refreshTask(prevTarget, false);\r\n      if (targ)\r\n        gantt.refreshTask(targ, false);\r\n    }\r\n\r\n    if (targetChanged) {\r\n      updateMarkedHtml(dd.marker);\r\n    }\r\n\r\n\r\n    showDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\r\n\r\n    return true;\r\n  }, this));\r\n\r\n\r\n  dnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\r\n    var drag = getDndState();\r\n\r\n    if (drag.from && drag.to && drag.from != drag.to) {\r\n      var type = gantt._get_link_type(drag.from_start, drag.to_start);\r\n\r\n      var link = {source: drag.from, target: drag.to, type: type};\r\n      if (link.type && gantt.isLinkAllowed(link))\r\n        gantt.addLink(link);\r\n    }\r\n\r\n    resetDndState();\r\n\r\n    if (this.config.touch) {\r\n      this._show_link_points = false;\r\n      this.refreshData();\r\n    }\r\n    else {\r\n      if (drag.from)\r\n        gantt.refreshTask(drag.from, false);\r\n      if (drag.to)\r\n        gantt.refreshTask(drag.to, false);\r\n    }\r\n    removeDirectionLine();\r\n  }, this));\r\n\r\n  function updateMarkedHtml(marker) {\r\n    var link = getDndState();\r\n\r\n    var css = [\"gantt_link_tooltip\"];\r\n    if (link.from && link.to) {\r\n      if (gantt.isLinkAllowed(link.from, link.to, link.from_start, link.to_start)) {\r\n        css.push(\"gantt_allowed_link\");\r\n      } else {\r\n        css.push(\"gantt_invalid_link\");\r\n      }\r\n    }\r\n\r\n    var className = gantt.templates.drag_link_class(link.from, link.from_start, link.to, link.to_start);\r\n    if (className)\r\n      css.push(className);\r\n\r\n    var html = \"<div class='\" + className + \"'>\" +\r\n        gantt.templates.drag_link(link.from, link.from_start, link.to, link.to_start) +\r\n        \"</div>\";\r\n    marker.innerHTML = html;\r\n  }\r\n\r\n  function advanceMarker(marker, pos) {\r\n    marker.style.left = pos.x + 5 + \"px\";\r\n    marker.style.top = pos.y + 5 + \"px\";\r\n  }\r\n\r\n  function getDndState() {\r\n    return {\r\n      from: gantt._link_source_task,\r\n      to: gantt._link_target_task,\r\n      from_start: gantt._link_source_task_start,\r\n      to_start: gantt._link_target_task_start\r\n    };\r\n  }\r\n\r\n  function resetDndState() {\r\n    gantt._link_source_task =\r\n        gantt._link_source_task_start =\r\n            gantt._link_target_task = null;\r\n    gantt._link_target_task_start = true;\r\n  }\r\n\r\n  function showDirectingLine(s_x, s_y, e_x, e_y) {\r\n    var div = getDirectionLine();\r\n\r\n    var link = getDndState();\r\n\r\n    var css = [\"gantt_link_direction\"];\r\n    if (gantt.templates.link_direction_class) {\r\n      css.push(gantt.templates.link_direction_class(link.from, link.from_start, link.to, link.to_start));\r\n    }\r\n\r\n    var dist = Math.sqrt((Math.pow(e_x - s_x, 2)) + (Math.pow(e_y - s_y, 2)));\r\n    dist = Math.max(0, dist - 3);\r\n    if (!dist)\r\n      return;\r\n\r\n    div.className = css.join(\" \");\r\n    var tan = (e_y - s_y) / (e_x - s_x),\r\n        angle = Math.atan(tan);\r\n\r\n    if (coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 2) {\r\n      angle += Math.PI;\r\n    } else if (coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 3) {\r\n      angle -= Math.PI;\r\n    }\r\n\r\n\r\n    var sin = Math.sin(angle),\r\n        cos = Math.cos(angle),\r\n        top = Math.round(s_y),\r\n        left = Math.round(s_x);\r\n\r\n\r\n    var style = [\r\n      \"-webkit-transform: rotate(\" + angle + \"rad)\",\r\n      \"-moz-transform: rotate(\" + angle + \"rad)\",\r\n      \"-ms-transform: rotate(\" + angle + \"rad)\",\r\n      \"-o-transform: rotate(\" + angle + \"rad)\",\r\n      \"transform: rotate(\" + angle + \"rad)\",\r\n      \"width:\" + Math.round(dist) + \"px\"\r\n    ];\r\n\r\n    if (window.navigator.userAgent.indexOf(\"MSIE 8.0\") != -1) {\r\n      //ms-filter breaks styles in ie9, so add it only for 8th\r\n      style.push(\"-ms-filter: \\\"\" + ieTransform(sin, cos) + \"\\\"\");\r\n\r\n      var shiftLeft = Math.abs(Math.round(s_x - e_x)),\r\n          shiftTop = Math.abs(Math.round(e_y - s_y));\r\n      //fix rotation axis\r\n      switch (coordinateCircleQuarter(s_x, e_x, s_y, e_y)) {\r\n        case 1:\r\n          top -= shiftTop;\r\n          break;\r\n        case 2:\r\n          left -= shiftLeft;\r\n          top -= shiftTop;\r\n          break;\r\n        case 3:\r\n          left -= shiftLeft;\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n    }\r\n\r\n    style.push(\"top:\" + top + \"px\");\r\n    style.push(\"left:\" + left + \"px\");\r\n\r\n    div.style.cssText = style.join(\";\");\r\n  }\r\n\r\n  function ieTransform(sin, cos) {\r\n    return \"progid:DXImageTransform.Microsoft.Matrix(\" +\r\n        \"M11 = \" + cos + \",\" +\r\n        \"M12 = -\" + sin + \",\" +\r\n        \"M21 = \" + sin + \",\" +\r\n        \"M22 = \" + cos + \",\" +\r\n        \"SizingMethod = 'auto expand'\" +\r\n        \")\";\r\n  }\r\n\r\n  function coordinateCircleQuarter(sX, eX, sY, eY) {\r\n    if (eX >= sX) {\r\n      if (eY <= sY) {\r\n        return 1;\r\n      } else {\r\n        return 4;\r\n      }\r\n    } else {\r\n      if (eY <= sY) {\r\n        return 2;\r\n      } else {\r\n        return 3;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  function getDirectionLine() {\r\n    if (!dnd._direction) {\r\n      dnd._direction = document.createElement(\"div\");\r\n      gantt.$task_links.appendChild(dnd._direction);\r\n    }\r\n    return dnd._direction;\r\n  }\r\n\r\n  function removeDirectionLine() {\r\n    if (dnd._direction) {\r\n      if (dnd._direction.parentNode)\t//the event line can be detached because of data refresh\r\n        dnd._direction.parentNode.removeChild(dnd._direction);\r\n\r\n      dnd._direction = null;\r\n    }\r\n  }\r\n\r\n  gantt._is_link_drop_area = function (e) {\r\n    return !!gantt._locate_css(e, link_landing_hover_area);\r\n  };\r\n};\r\ngantt._get_link_state = function () {\r\n  return {\r\n    link_landing_area: this._link_landing,\r\n    link_target_id: this._link_target_task,\r\n    link_target_start: this._link_target_task_start,\r\n    link_source_id: this._link_source_task,\r\n    link_source_start: this._link_source_task_start\r\n  };\r\n};\r\n\r\n//helper for rendering bars and links\r\ngantt._task_renderer = function (id, render_one, node, filter) {\r\n  //hash of dom elements is needed to redraw single bar/link\r\n  if (!this._task_area_pulls)\r\n    this._task_area_pulls = {};\r\n\r\n  if (!this._task_area_renderers)\r\n    this._task_area_renderers = {};\r\n\r\n  if (this._task_area_renderers[id])\r\n    return this._task_area_renderers[id];\r\n\r\n  if (!render_one)\r\n    this.assert(false, \"Invalid renderer call\");\r\n\r\n  if (node)\r\n    node.setAttribute(this.config.layer_attribute, true);\r\n\r\n  this._task_area_renderers[id] = {\r\n    render_item: function (item, container) {\r\n      container = container || node;\r\n\r\n      if (filter) {\r\n        if (!filter(item)) {\r\n          this.remove_item(item.id);\r\n          return;\r\n        }\r\n      }\r\n\r\n      var dom = render_one.call(gantt, item);\r\n      this.append(item, dom, container);\r\n\r\n    },\r\n\r\n    clear: function (container) {\r\n      this.rendered = gantt._task_area_pulls[id] = {};\r\n      this.clear_container(container);\r\n    },\r\n    clear_container: function (container) {\r\n      container = container || node;\r\n      if (container)\r\n        container.innerHTML = \"\";\r\n    },\r\n    render_items: function (items, container) {\r\n      container = container || node;\r\n\r\n      var buffer = document.createDocumentFragment();\r\n      this.clear(container);\r\n      for (var i = 0, vis = items.length; i < vis; i++) {\r\n        this.render_item(items[i], buffer);\r\n      }\r\n\r\n      container.appendChild(buffer);\r\n    },\r\n    append: function (item, node, container) {\r\n      if (!node) {\r\n        if (this.rendered[item.id]) {\r\n          this.remove_item(item.id);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (this.rendered[item.id] && this.rendered[item.id].parentNode) {\r\n        this.replace_item(item.id, node);\r\n      } else {\r\n        container.appendChild(node);\r\n      }\r\n      this.rendered[item.id] = node;\r\n\r\n    },\r\n    replace_item: function (item_id, newNode) {\r\n      var item = this.rendered[item_id];\r\n      if (item && item.parentNode) {\r\n        item.parentNode.replaceChild(newNode, item);\r\n      }\r\n      this.rendered[item_id] = newNode;\r\n    },\r\n    remove_item: function (item_id) {\r\n      this.hide(item_id);\r\n      delete this.rendered[item_id];\r\n    },\r\n    hide: function (item_id) {\r\n      var item = this.rendered[item_id];\r\n      if (item && item.parentNode) {\r\n        item.parentNode.removeChild(item);\r\n      }\r\n    },\r\n    restore: function (item) {\r\n      var dom = this.rendered[item.id];\r\n      if (dom) {\r\n        if (!dom.parentNode) {\r\n          this.append(item, dom, node);\r\n        }\r\n      } else {\r\n        this.render_item(item, node);\r\n      }\r\n    },\r\n    change_id: function (oldid, newid) {\r\n      this.rendered[newid] = this.rendered[oldid];\r\n      delete this.rendered[oldid];\r\n    },\r\n    rendered: this._task_area_pulls[id],\r\n    node: node,\r\n    unload: function () {\r\n      this.clear();\r\n      delete gantt._task_area_renderers[id];\r\n      delete gantt._task_area_pulls[id];\r\n    }\r\n  };\r\n\r\n  return this._task_area_renderers[id];\r\n};\r\n\r\ngantt._clear_renderers = function () {\r\n  for (var i in this._task_area_renderers) {\r\n    this._task_renderer(i).unload();\r\n  }\r\n};\r\n\r\ngantt._is_layer = function (dom_element) {\r\n  return (dom_element && dom_element.hasAttribute && dom_element.hasAttribute(this.config.layer_attribute));\r\n};\r\n\r\n\r\ngantt._show_link_points = false;\r\n\r\ngantt._init_tasks = function () {\r\n  //store temporary configs\r\n  this._tasks = {\r\n    col_width: this.config.columnWidth,\r\n    width: [], // width of each column\r\n    full_width: 0, // width of all columns\r\n    trace_x: [],\r\n    rendered: {}\r\n  };\r\n\r\n\r\n  this._click.gantt_task_link = this.bind(function (e, trg) {\r\n    var id = this.locate(e, gantt.config.link_attribute);\r\n    if (id) {\r\n      this.callEvent(\"onLinkClick\", [id, e]);\r\n    }\r\n  }, this);\r\n\r\n  this._click.gantt_scale_cell = this.bind(function (e, trg) {\r\n    var pos = gantt._get_mouse_pos(e);\r\n    var date = gantt.dateFromPos(pos.x);\r\n    var coll = Math.floor(gantt._day_index_by_date(date));\r\n\r\n    var coll_date = gantt._tasks.trace_x[coll];\r\n\r\n    gantt.callEvent(\"onScaleClick\", [e, coll_date]);\r\n  }, this);\r\n\r\n  this._dbl_click.gantt_task_link = this.bind(function (e, id, trg) {\r\n    var id = this.locate(e, gantt.config.link_attribute);\r\n    this._delete_link_handler(id, e);\r\n  }, this);\r\n\r\n  this._dbl_click.gantt_link_point = this.bind(function (e, id, trg) {\r\n    var id = this.locate(e),\r\n        task = this.getTask(id);\r\n\r\n\r\n    var link = null;\r\n    if (trg.parentNode && gantt._getClassName(trg.parentNode)) {\r\n      if (gantt._getClassName(trg.parentNode).indexOf(\"_left\") > -1) {\r\n        link = task.$target[0];\r\n      } else {\r\n        link = task.$source[0];\r\n      }\r\n    }\r\n    if (link)\r\n      this._delete_link_handler(link, e);\r\n    return false;\r\n  }, this);\r\n\r\n  this._tasks_dnd.init();\r\n  this._init_links_dnd();\r\n\r\n  this._link_layers.clear();\r\n\r\n\r\n  var links_layer = this.addLinkLayer({\r\n    renderer: this._render_link_element,\r\n    container: this.$task_links,\r\n    filter: gantt._create_filter([gantt._filter_link, gantt._is_chart_visible].concat(this._get_link_filters()))\r\n  });\r\n  this._linkRenderer = this._link_layers.getRenderer(links_layer);\r\n\r\n  this._task_layers.clear();\r\n  var bar_layer = this.addTaskLayer({\r\n    renderer: this._render_task_element,\r\n    container: this.$task_bars,\r\n    filter: gantt._create_filter([gantt._filter_task, gantt._is_chart_visible].concat(this._get_task_filters()))\r\n  });\r\n  this._taskRenderer = this._task_layers.getRenderer(bar_layer);\r\n\r\n  this.addTaskLayer({\r\n    renderer: this._render_grid_item,\r\n    container: this.$grid_data,\r\n    filter: gantt._create_filter([gantt._filter_task, gantt._is_grid_visible].concat(this._get_task_filters()))\r\n  });\r\n  this.addTaskLayer({\r\n    renderer: this._render_bg_line,\r\n    container: this.$task_bg,\r\n    filter: gantt._create_filter([gantt._filter_task, gantt._is_chart_visible, gantt._is_std_background].concat(this._get_task_filters()))\r\n  });\r\n\r\n\r\n  function refreshId(renders, oldId, newId, item) {\r\n    for (var i = 0; i < renders.length; i++) {\r\n      renders[i].change_id(oldId, newId);\r\n      renders[i].render_item(item);\r\n    }\r\n  }\r\n\r\n  if (this._onTaskIdChange)\r\n    this.detachEvent(this._onTaskIdChange);\r\n\r\n  this._onTaskIdChange = this.attachEvent(\"onTaskIdChange\", function (oldId, newId) {\r\n    var render = this._get_task_renderers();\r\n    refreshId(render, oldId, newId, this.getTask(newId));\r\n  });\r\n\r\n  if (this._onLinkIdChange)\r\n    this.detachEvent(this._onLinkIdChange);\r\n\r\n  this._onLinkIdChange = this.attachEvent(\"onLinkIdChange\", function (oldId, newId) {\r\n    var render = this._get_link_renderers();\r\n    refreshId(render, oldId, newId, this.getLink(newId));\r\n  });\r\n};\r\n\r\ngantt._get_task_filters = function () {\r\n  return [];\r\n};\r\ngantt._get_link_filters = function () {\r\n  return [];\r\n};\r\n\r\n\r\ngantt._is_chart_visible = function () {\r\n  return !!this.config.show_chart;\r\n};\r\n\r\ngantt._filter_task = function (id, task) {\r\n  var min = null, max = null;\r\n  if (this.config.start_date && this.config.end_date) {\r\n    if (this._isAllowedUnscheduledTask(task)) return true;\r\n    min = this.config.start_date.valueOf();\r\n    max = this.config.end_date.valueOf();\r\n\r\n    if (+task.start_date > max || +task.end_date < +min)\r\n      return false;\r\n  }\r\n  return true;\r\n};\r\ngantt._filter_link = function (id, link) {\r\n  if (!this.config.show_links) {\r\n    return false;\r\n  }\r\n\r\n  if (!(gantt.isTaskVisible(link.source) && gantt.isTaskVisible(link.target)) ||\r\n      gantt._isAllowedUnscheduledTask(gantt.getTask(link.source)) || gantt._isAllowedUnscheduledTask(gantt.getTask(link.target)))\r\n    return false;\r\n\r\n  return this.callEvent(\"onBeforeLinkDisplay\", [id, link]);\r\n};\r\ngantt._is_std_background = function () {\r\n  return !this.config.static_background;\r\n};\r\n\r\ngantt._delete_link_handler = function (id, e) {\r\n  if (id && this.callEvent(\"onLinkDblClick\", [id, e])) {\r\n    var link = gantt.getLink(id);\r\n    if (gantt._is_readonly(link)) return;\r\n\r\n    var title = \"\";\r\n    var question = gantt.locale.labels.link + \" \" + this.templates.link_description(this.getLink(id)) + \" \" + gantt.locale.labels.confirm_link_deleting;\r\n\r\n    window.setTimeout(function () {\r\n      gantt._dhtmlx_confirm(question, title, function () {\r\n        gantt.deleteLink(id);\r\n      });\r\n    }, (gantt.config.touch ? 300 : 1));\r\n  }\r\n};\r\ngantt.getTaskNode = function (id) {\r\n  return this._taskRenderer.rendered[id];\r\n};\r\ngantt.getLinkNode = function (id) {\r\n  return this._linkRenderer.rendered[id];\r\n};\r\n\r\n\r\ngantt._get_tasks_data = function () {\r\n  var rows = [];\r\n  var order = this._get_data_range();\r\n\r\n  for (var i = 0; i < order.length; i++) {\r\n    var item = this._pull[order[i]];\r\n    item.$index = i;\r\n    //this._update_parents(item.id, true);\r\n    this.resetProjectDates(item);\r\n    rows.push(item);\r\n  }\r\n  return rows;\r\n};\r\n\r\ngantt._get_data_range = function () {\r\n  return this._order;\r\n};\r\n\r\ngantt._get_links_data = function () {\r\n  return this._links.slice();\r\n};\r\ngantt._render_data = function () {\r\n  this.callEvent(\"onBeforeDataRender\", []);\r\n\r\n  if (!this._order_synced) {\r\n    this._sync_order();\r\n  } else {\r\n    this._order_synced = false;\r\n  }\r\n\r\n\r\n  var data = this._get_tasks_data();\r\n\r\n  var renderers = this._get_task_renderers();\r\n  for (var i = 0; i < renderers.length; i++) {\r\n    renderers[i].clear();\r\n  }\r\n\r\n  var links = gantt._get_links_data();\r\n  renderers = this._get_link_renderers();\r\n  for (var i = 0; i < renderers.length; i++)\r\n    renderers[i].clear();\r\n\r\n  this._update_layout_sizes();\r\n  this._scroll_resize();\r\n\r\n  var renderers = this._get_task_renderers();\r\n  for (var i = 0; i < renderers.length; i++) {\r\n    renderers[i].render_items(data);\r\n  }\r\n\r\n  var links = gantt._get_links_data();\r\n  renderers = this._get_link_renderers();\r\n  for (var i = 0; i < renderers.length; i++)\r\n    renderers[i].render_items(links);\r\n\r\n  this.callEvent(\"onDataRender\", []);\r\n};\r\n\r\ngantt._update_layout_sizes = function () {\r\n  var cfg = this._tasks;\r\n\r\n  cfg.bar_height = this._get_task_height();\r\n\r\n  //task bars layer\r\n  var taskHeight = Math.max(gantt._y - (gantt._scroll_sizes().x ? gantt._scroll_sizes().scroll_size + 1 : 0) - 1, 0);\r\n  this.$task_data.style.height = Math.max(taskHeight - this.config.scale_height, 0) + 'px';\r\n\r\n  if (gantt.config.smart_rendering) {\r\n    this.$task_bg.style.height = gantt.config.row_height * this.getVisibleTaskCount() + \"px\";\r\n  } else {\r\n    this.$task_bg.style.height = \"\";\r\n  }\r\n\r\n  this.$task_bg.style.backgroundImage = \"\";\r\n\r\n  //timeline area layers\r\n  var data_els = this.$task_data.childNodes;\r\n  for (var i = 0, len = data_els.length; i < len; i++) {\r\n    var el = data_els[i];\r\n    if (this._is_layer(el) && el.style)\r\n      el.style.width = cfg.full_width + \"px\";\r\n  }\r\n\r\n  //grid area\r\n  if (this._is_grid_visible()) {\r\n    var columns = this.getGridColumns();\r\n    var width = 0;\r\n    for (var i = 0; i < columns.length; i++)\r\n      width += columns[i].width;\r\n    this.$grid_data.style.width = Math.max(width - 1, 0) + \"px\";\r\n  }\r\n};\r\n\r\ngantt._scale_range_unit = function () {\r\n  var unit = this.config.scale_unit;\r\n  if (this.config.scale_offset_minimal) {\r\n    var scales = this._get_scales();\r\n    unit = scales[scales.length - 1].unit;\r\n  }\r\n  return unit;\r\n};\r\n\r\ngantt._init_tasks_range = function () {\r\n  var unit = this._scale_range_unit();\r\n  if (this.config.start_date && this.config.end_date) {\r\n    this._min_date = this.date[unit + \"_start\"](new Date(this.config.start_date));\r\n\r\n    var end = new Date(this.config.end_date);\r\n    var start_interval = this.date[unit + \"_start\"](new Date(end));\r\n    if (+end != +start_interval) {\r\n      end = this.date.add(start_interval, 1, unit);\r\n    } else {\r\n      end = start_interval;\r\n    }\r\n\r\n    this._max_date = end;\r\n    return;\r\n  }\r\n\r\n  //reset project timing\r\n  this._get_tasks_data();\r\n\r\n  var range = this.getSubtaskDates();\r\n  this._min_date = range.start_date;\r\n  this._max_date = range.end_date;\r\n\r\n  if (!(this._max_date && this._min_date)) {\r\n    this._min_date = new Date();\r\n    this._max_date = new Date();\r\n  }\r\n\r\n  this._min_date = this.date[unit + \"_start\"](this._min_date);\r\n  this._min_date = this.calculateEndDate({\r\n    start_date: this.date[unit + \"_start\"](this._min_date),\r\n    duration: -1,\r\n    unit: unit\r\n  });//one free column before first task\r\n\r\n  this._max_date = this.date[unit + \"_start\"](this._max_date);\r\n  this._max_date = this.calculateEndDate({start_date: this._max_date, duration: 2, unit: unit});//one free column after last task\r\n};\r\n\r\n\r\ngantt._prepare_scale_html = function (config, fromPos, toPos) {\r\n  var cells = [];\r\n  var date = null, content = null, css = null;\r\n\r\n  if (config.template || config.date) {\r\n    content = config.template || this.date.date_to_str(config.date);\r\n  }\r\n\r\n  var startIndex = 0,\r\n      endIndex = config.count;\r\n\r\n  if (this.config.smart_scales && (!isNaN(fromPos) && !isNaN(toPos))) {\r\n    startIndex = this._findBinary(config.left, fromPos);\r\n    endIndex = this._findBinary(config.left, toPos) + 1;\r\n  }\r\n\r\n  css = config.css || function () {\r\n      };\r\n  if (!config.css && this.config.inherit_scale_class) {\r\n    css = gantt.templates.scale_cell_class;\r\n  }\r\n\r\n  for (var i = startIndex; i < endIndex; i++) {\r\n    if (!config.trace_x[i]) break;\r\n\r\n    date = new Date(config.trace_x[i]);\r\n    var value = content.call(this, date),\r\n        width = config.width[i],\r\n        height = config.height - (this.config.smart_scales ? (config.index ? 1 : 0) : 0),\r\n        left = config.left[i],\r\n        style = \"\",\r\n        template = \"\",\r\n        cssclass = \"\";\r\n\r\n    if (width) {\r\n      var position = this.config.smart_scales ? (\"position:absolute;left:\" + left + \"px\") : \"\";\r\n\r\n      style = \"width:\" + (width) + \"px;height:\" + height + \"px;\" + position;\r\n      cssclass = \"gantt_scale_cell\" + (i == config.count - 1 ? \" gantt_last_cell\" : \"\");\r\n\r\n      template = css.call(this, date);\r\n      if (template) cssclass += \" \" + template;\r\n      var ariaAttr = gantt._waiAria.getTimelineCellAttr(value);\r\n      var newValue = value.split(' ');\r\n      var val = \"\";\r\n      if(newValue.length > 4){\r\n        for (let i = 0; i < newValue.length; i++) {\r\n          if (newValue[i] === '(week') {\r\n            newValue[i] = ''\r\n          }\r\n          // if(newValue[i] === '-'){\r\n          //   newValue[i] = ''\r\n          // }\r\n          newValue[newValue.length-1] = newValue[newValue.length-1].split(')')[0];\r\n        }\r\n        val = newValue[1] + '' + newValue[0] + ' ' + newValue[2] + ' ' + newValue[4] + '' + newValue[3] + ' (' + newValue[6] + '' + newValue[5] +')';\r\n      }else{\r\n        val = value\r\n      }\r\n      var cell = \"<div class='\" + cssclass + \"'\" + ariaAttr + \" style='\" + style + \"'>\" + val + \"</div>\";\r\n      cells.push(cell);\r\n    } else {\r\n      //do not render ignored cells\r\n    }\r\n\r\n  }\r\n  return cells.join(\"\");\r\n};\r\ngantt._get_scales = function () {\r\n  var helpers = this._scale_helpers;\r\n  var scales = [helpers.primaryScale()].concat(this.config.subscales);\r\n\r\n  helpers.sortScales(scales);\r\n  return scales;\r\n};\r\n\r\ngantt._get_scale_chunk_html = function (scales, fromPos, toPos) {\r\n  var html = [];\r\n\r\n  var css = this.templates.scale_row_class;\r\n  for (var i = 0; i < scales.length; i++) {\r\n    var cssClass = \"gantt_scale_line\";\r\n    var tplClass = css(scales[i]);\r\n    if (tplClass) {\r\n      cssClass += \" \" + tplClass;\r\n    }\r\n\r\n    html.push(\"<div class=\\\"\" + cssClass + \"\\\" style=\\\"height:\" + (scales[i].height) + \"px;position:relative;line-height:\" + (scales[i].height) + \"px\\\">\" + this._prepare_scale_html(scales[i], fromPos, toPos) + \"</div>\");\r\n  }\r\n\r\n  return html.join(\"\");\r\n};\r\n\r\ngantt._refreshScales = function () {\r\n  if (!this.config.smart_scales) return;\r\n  if (!this.config.show_chart) return;\r\n\r\n  var scales = this._scales;\r\n  var left = gantt.getScrollState().x;\r\n  this.$task_scale.innerHTML = this._get_scale_chunk_html(scales, left, left + this._x - this._get_grid_width());\r\n};\r\ngantt.attachEvent(\"onGanttScroll\", function (oldLeft, oldTop, left, top) {\r\n  if (gantt.config.smart_scales) {\r\n    if (oldLeft != left) {\r\n      gantt._refreshScales();\r\n    }\r\n  }\r\n});\r\n\r\ngantt.attachEvent(\"onGanttRender\", function () {\r\n  if (gantt.config.smart_scales) {\r\n    gantt._refreshScales();\r\n  }\r\n});\r\n\r\ngantt._render_tasks_scales = function () {\r\n  this._init_tasks_range();\r\n  this._scroll_resize();\r\n  this._set_sizes();\r\n\r\n  var scales_html = \"\",\r\n      outer_width = 0,\r\n      data_width = 0,\r\n      scale_height = 0;\r\n\r\n  if (this._is_chart_visible()) {\r\n    var helpers = this._scale_helpers;\r\n    var scales = this._get_scales();\r\n    scale_height = (this.config.scale_height - 1);\r\n    var resize = this._get_resize_options();\r\n    var avail_width = resize.x ? Math.max(this.config.autosize_min_width, 0) : (Math.max(this._x - this._get_grid_width() - 2, 0));\r\n    var cfgs = helpers.prepareConfigs(scales, this.config.min_column_width, avail_width, scale_height);\r\n    var cfg = this._tasks = cfgs[cfgs.length - 1];\r\n    this._scales = cfgs;\r\n\r\n    //var scrollX = this.getScrollState()\r\n    scales_html = this._get_scale_chunk_html(cfgs, 0, this._x - this._get_grid_width());\r\n\r\n    var scrollSizes = this._scroll_sizes();\r\n    outer_width = cfg.full_width + (this._scroll_sizes().y ? scrollSizes.scroll_size : 0) + \"px\";\r\n    data_width = cfg.full_width + \"px\";\r\n    scale_height += \"px\";\r\n  }\r\n\r\n  if (this._is_chart_visible()) {\r\n    this.$task.style.display = \"\";\r\n  } else {\r\n    this.$task.style.display = \"none\";\r\n  }\r\n\r\n  this.$task_scale.style.height = scale_height;\r\n\r\n  this.$task_data.style.width =\r\n      this.$task_scale.style.width = outer_width;\r\n\r\n  this.$task_scale.innerHTML = scales_html;\r\n\r\n};\r\n\r\ngantt._render_bg_line = function (item) {\r\n  var cfg = gantt._tasks;\r\n  var count = cfg.count;\r\n  var row = document.createElement(\"div\");\r\n  if (gantt.config.show_task_cells) {\r\n    for (var j = 0; j < count; j++) {\r\n      var width = cfg.width[j],\r\n          cssclass = \"\";\r\n\r\n      if (width > 0) {//do not render skipped columns\r\n        var cell = document.createElement(\"div\");\r\n        cell.style.width = (width) + \"px\";\r\n\r\n        cssclass = \"gantt_task_cell\" + (j == count - 1 ? \" gantt_last_cell\" : \"\");\r\n        cssTemplate = this.templates.task_cell_class(item, cfg.trace_x[j]);\r\n        if (cssTemplate)\r\n          cssclass += \" \" + cssTemplate;\r\n        cell.className = cssclass;\r\n\r\n        row.appendChild(cell);\r\n      }\r\n\r\n    }\r\n  }\r\n  var odd = gantt.getGlobalTaskIndex(item.id) % 2 !== 0;\r\n  var cssTemplate = gantt.templates.task_row_class(item.start_date, item.end_date, item);\r\n  var css = \"gantt_task_row\" + (odd ? \" odd\" : \"\") + (cssTemplate ? ' ' + cssTemplate : '');\r\n\r\n  if (this.getState().selected_task == item.id) {\r\n    css += \" gantt_selected\";\r\n  }\r\n\r\n  //var row = \"<div class='\" + css + \"' \" + this.config.task_attribute + \"='\" + item.id + \"'>\" + cells.join(\"\") + \"</div>\";\r\n\r\n  row.className = css;\r\n\r\n  if (gantt.config.smart_rendering) {\r\n    row.style.position = \"absolute\";\r\n    row.style.top = this.getTaskTop(item.id) + \"px\";\r\n    row.style.width = \"100%\";\r\n  }\r\n  row.style.height = (gantt.config.row_height) + \"px\";\r\n  row.setAttribute(this.config.task_attribute, item.id);\r\n  return row;\r\n};\r\n\r\n\r\ngantt._adjust_scales = function () {\r\n  if (this.config.fit_tasks) {\r\n    var old_min = +this._min_date,\r\n        old_max = +this._max_date;\r\n    this._init_tasks_range();\r\n    if (+this._min_date != old_min || +this._max_date != old_max) {\r\n      this.render();\r\n\r\n      this.callEvent(\"onScaleAdjusted\", []);\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n//refresh task and related links\r\ngantt.refreshTask = function (taskId, refresh_links) {\r\n  var renders = this._get_task_renderers();\r\n\r\n  var task = this.getTask(taskId);\r\n  if (task && this.isTaskVisible(taskId)) {\r\n    for (var i = 0; i < renders.length; i++)\r\n      renders[i].render_item(task);\r\n\r\n    if (refresh_links !== undefined && !refresh_links)\r\n      return;\r\n\r\n    for (var i = 0; i < task.$source.length; i++) {\r\n      gantt.refreshLink(task.$source[i]);\r\n    }\r\n    for (var i = 0; i < task.$target.length; i++) {\r\n      gantt.refreshLink(task.$target[i]);\r\n    }\r\n  } else {\r\n    //this._render_data();\r\n  }\r\n};\r\ngantt.refreshLink = function (linkId) {\r\n  if (this.isLinkExists(linkId)) {\r\n    this._render_link(linkId);\r\n  } else {\r\n    var renders = this._get_link_renderers();\r\n    for (var i = 0; i < renders.length; i++)\r\n      renders[i].remove_item(linkId);\r\n  }\r\n};\r\n\r\n\r\ngantt._combine_item_class = function (basic, template, itemId) {\r\n  var css = [basic];\r\n  if (template)\r\n    css.push(template);\r\n\r\n  var state = gantt.getState();\r\n\r\n  var task = this.getTask(itemId);\r\n\r\n  if (this._get_safe_type(task.type) == this.config.types.milestone) {\r\n    css.push(\"gantt_milestone\");\r\n  }\r\n\r\n  if (this._get_safe_type(task.type) == this.config.types.project) {\r\n    css.push(\"gantt_project\");\r\n  }\r\n\r\n  if (this._is_flex_task(task))\r\n    css.push(\"gantt_dependent_task\");\r\n\r\n  if (this.config.select_task && itemId == state.selected_task)\r\n    css.push(\"gantt_selected\");\r\n\r\n  if (itemId == state.drag_id) {\r\n    css.push(\"gantt_drag_\" + state.drag_mode);\r\n    if (state.touch_drag) {\r\n      css.push(\"gantt_touch_\" + state.drag_mode);\r\n    }\r\n  }\r\n  var links = gantt._get_link_state();\r\n  if (links.link_source_id == itemId)\r\n    css.push(\"gantt_link_source\");\r\n\r\n  if (links.link_target_id == itemId)\r\n    css.push(\"gantt_link_target\");\r\n\r\n\r\n  if (this.config.highlight_critical_path && this.isCriticalTask) {\r\n    if (this.isCriticalTask(task))\r\n      css.push(\"gantt_critical_task\");\r\n  }\r\n\r\n  if (links.link_landing_area &&\r\n      (links.link_target_id && links.link_source_id) &&\r\n      (links.link_target_id != links.link_source_id)) {\r\n\r\n    var from_id = links.link_source_id;\r\n    var from_start = links.link_source_start;\r\n    var to_start = links.link_target_start;\r\n\r\n    var allowDrag = gantt.isLinkAllowed(from_id, itemId, from_start, to_start);\r\n\r\n    var dragClass = \"\";\r\n    if (allowDrag) {\r\n      if (to_start)\r\n        dragClass = \"link_start_allow\";\r\n      else\r\n        dragClass = \"link_finish_allow\";\r\n    } else {\r\n      if (to_start)\r\n        dragClass = \"link_start_deny\";\r\n      else\r\n        dragClass = \"link_finish_deny\";\r\n    }\r\n    css.push(dragClass);\r\n  }\r\n  return css.join(\" \");\r\n};\r\n\r\ngantt._render_pair = function (parent, css, task, content) {\r\n  var state = gantt.getState();\r\n\r\n  if (+task.start_date >= +state.min_date)\r\n    parent.appendChild(content(css + \" task_left\"));\r\n\r\n  if (+task.end_date <= +state.max_date)\r\n    parent.appendChild(content(css + \" task_right\"));\r\n};\r\n\r\ngantt._get_task_height = function () {\r\n  // height of the bar item\r\n  var height = this.config.task_height;\r\n  if (height == \"full\")\r\n    height = this.config.row_height - 5;\r\n  //item height cannot be bigger than row height\r\n  height = Math.min(height, this.config.row_height);\r\n  return Math.max(height, 0);\r\n};\r\n\r\ngantt._get_milestone_width = function () {\r\n  return this._get_task_height();\r\n};\r\ngantt._get_visible_milestone_width = function () {\r\n  var origWidth = gantt._get_task_height();//m-s have square shape\r\n  return Math.sqrt(2 * origWidth * origWidth);\r\n};\r\n\r\n// TODO: remove reduntant methods for task positioning\r\ngantt.getTaskPosition = function (task, start_date, end_date) {\r\n  var x = this.posFromDate(start_date || task.start_date);\r\n  var x2 = this.posFromDate(end_date || task.end_date);\r\n  x2 = Math.max(x, x2);\r\n  var y = this.getTaskTop(task.id);\r\n  var height = gantt._get_task_height();\r\n  return {\r\n    left: x,\r\n    top: y,\r\n    height: height,\r\n    width: Math.max((x2 - x), 0)\r\n  };\r\n};\r\n\r\ngantt._get_task_width = function (task, start, end) {\r\n  return Math.round(this._get_task_pos(task, false).x - this._get_task_pos(task, true).x);\r\n};\r\n\r\ngantt._is_readonly = function (item) {\r\n  if (item && item[this.config.editable_property]) {\r\n    return false;\r\n  } else {\r\n    return (item && item[this.config.readonly_property]) || this.config.readonly;\r\n  }\r\n};\r\ngantt._task_default_render = function (task) {\r\n  if (this._isAllowedUnscheduledTask(task))\r\n    return;\r\n\r\n  var pos = this._get_task_pos(task);\r\n\r\n  var cfg = this.config;\r\n  var height = this._get_task_height();\r\n\r\n  var padd = Math.floor((this.config.row_height - height) / 2);\r\n  if (this._get_safe_type(task.type) == cfg.types.milestone && cfg.link_line_width > 1) {\r\n    //little adjust milestone position, so horisontal corners would match link arrow when thickness of link line is more than 1px\r\n    padd += 1;\r\n  }\r\n\r\n  var div = document.createElement(\"div\");\r\n  var width = gantt._get_task_width(task);\r\n\r\n  var type = this._get_safe_type(task.type);\r\n\r\n  div.setAttribute(this.config.task_attribute, task.id);\r\n\r\n  if (cfg.show_progress && type != this.config.types.milestone) {\r\n    this._render_task_progress(task, div, width);\r\n  }\r\n\r\n  //use separate div to display content above progress bar\r\n  var content = gantt._render_task_content(task, width);\r\n  if (task.textColor) {\r\n    content.style.color = task.textColor;\r\n  }\r\n  div.appendChild(content);\r\n\r\n  var css = this._combine_item_class(\"gantt_task_line\",\r\n      this.templates.task_class(task.start_date, task.end_date, task),\r\n      task.id);\r\n  if (task.color || task.progressColor || task.textColor) {\r\n    css += \" gantt_task_inline_color\";\r\n  }\r\n  div.className = css;\r\n\r\n  var styles = [\r\n    \"left:\" + pos.x + \"px\",\r\n    \"top:\" + (padd + pos.y) + 'px',\r\n    \"height:\" + height + 'px',\r\n    \"line-height:\" + (Math.max(height < 30 ? height - 2 : height, 0)) + 'px',\r\n    \"width:\" + width + 'px'\r\n  ];\r\n  if (task.color) {\r\n    styles.push(\"background-color:\" + task.color);\r\n  }\r\n  if (task.textColor) {\r\n    styles.push(\"color:\" + task.textColor);\r\n  }\r\n\r\n  div.style.cssText = styles.join(\";\");\r\n  var side = this._render_leftside_content(task);\r\n  if (side) div.appendChild(side);\r\n\r\n  side = this._render_rightside_content(task);\r\n  if (side) div.appendChild(side);\r\n\r\n  gantt._waiAria.setTaskBarAttr(task, div);\r\n\r\n  if (!this._is_readonly(task)) {\r\n    if (cfg.drag_resize && !this._is_flex_task(task) && type != this.config.types.milestone) {\r\n      gantt._render_pair(div, \"gantt_task_drag\", task, function (css) {\r\n        var el = document.createElement(\"div\");\r\n        el.className = css;\r\n        return el;\r\n      });\r\n    }\r\n    if (cfg.drag_links && this.config.show_links) {\r\n      gantt._render_pair(div, \"gantt_link_control\", task, function (css) {\r\n        var outer = document.createElement(\"div\");\r\n        outer.className = css;\r\n        outer.style.cssText = [\r\n          \"height:\" + height + 'px',\r\n          \"line-height:\" + height + 'px'\r\n        ].join(\";\");\r\n        var inner = document.createElement(\"div\");\r\n        inner.className = \"gantt_link_point\";\r\n        inner.style.display = gantt._show_link_points ? \"block\" : \"\";\r\n        outer.appendChild(inner);\r\n        return outer;\r\n      });\r\n    }\r\n  }\r\n  return div;\r\n};\r\n\r\n\r\ngantt._render_task_element = function (task) {\r\n  var painters = this.config.type_renderers;\r\n  var renderer = painters[this._get_safe_type(task.type)],\r\n      defaultRenderer = this._task_default_render;\r\n\r\n  if (!renderer) {\r\n    renderer = defaultRenderer;\r\n  }\r\n  return renderer.call(this, task, this.bind(defaultRenderer, this));\r\n};\r\n\r\ngantt._render_side_content = function (task, template, cssClass) {\r\n  if (!template) return null;\r\n\r\n  var text = template(task.start_date, task.end_date, task);\r\n  if (!text) return null;\r\n  var content = document.createElement(\"div\");\r\n  content.className = \"gantt_side_content \" + cssClass;\r\n  content.innerHTML = text;\r\n  return content;\r\n};\r\n\r\n\r\ngantt._render_leftside_content = function (task) {\r\n  var css = \"gantt_left \" + gantt._get_link_crossing_css(true, task);\r\n  return gantt._render_side_content(task, this.templates.leftside_text, css);\r\n};\r\ngantt._render_rightside_content = function (task) {\r\n  var css = \"gantt_right \" + gantt._get_link_crossing_css(false, task);\r\n  return gantt._render_side_content(task, this.templates.rightside_text, css);\r\n};\r\n\r\ngantt._get_conditions = function (leftside) {\r\n  if (leftside) {\r\n    return {\r\n      $source: [\r\n        gantt.config.links.start_to_start\r\n      ],\r\n      $target: [\r\n        gantt.config.links.start_to_start,\r\n        gantt.config.links.finish_to_start\r\n      ]\r\n    };\r\n  } else {\r\n    return {\r\n      $source: [\r\n        gantt.config.links.finish_to_start,\r\n        gantt.config.links.finish_to_finish\r\n      ],\r\n      $target: [\r\n        gantt.config.links.finish_to_finish\r\n      ]\r\n    };\r\n  }\r\n};\r\n\r\ngantt._get_link_crossing_css = function (left, task) {\r\n  var cond = gantt._get_conditions(left);\r\n\r\n  for (var i in cond) {\r\n    var links = task[i];\r\n    for (var ln = 0; ln < links.length; ln++) {\r\n      var link = gantt.getLink(links[ln]);\r\n\r\n      for (var tp = 0; tp < cond[i].length; tp++) {\r\n        if (link.type == cond[i][tp]) {\r\n          return \"gantt_link_crossing\";\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return \"\";\r\n};\r\n\r\n\r\ngantt._render_task_content = function (task, width) {\r\n  var content = document.createElement(\"div\");\r\n  if (this._get_safe_type(task.type) != this.config.types.milestone)\r\n    content.innerHTML = this.templates.task_text(task.start_date, task.end_date, task);\r\n  content.className = \"gantt_task_content\";\r\n  //content.style.width = width + 'px';\r\n  return content;\r\n};\r\ngantt._render_task_progress = function (task, element, maxWidth) {\r\n  var done = task.progress * 1 || 0;\r\n\r\n  maxWidth = Math.max(maxWidth - 2, 0);//2px for borders\r\n  var pr = document.createElement(\"div\");\r\n  var width = Math.round(maxWidth * done);\r\n\r\n  width = Math.min(maxWidth, width);\r\n  if (task.progressColor) {\r\n    pr.style.backgroundColor = task.progressColor;\r\n    pr.style.opacity = 1;\r\n  }\r\n  pr.style.width = width + 'px';\r\n  pr.className = \"gantt_task_progress\";\r\n  pr.innerHTML = this.templates.progress_text(task.start_date, task.end_date, task);\r\n  element.appendChild(pr);\r\n  if (this.config.drag_progress && !gantt._is_readonly(task)) {\r\n    var drag = document.createElement(\"div\");\r\n    drag.style.left = width + 'px';\r\n    drag.className = \"gantt_task_progress_drag\";\r\n    pr.appendChild(drag);\r\n    element.appendChild(drag);\r\n  }\r\n};\r\ngantt._get_line = function (step) {\r\n  var steps = {\r\n    \"second\": 1,\r\n    \"minute\": 60,\r\n    \"hour\": 60 * 60,\r\n    \"day\": 60 * 60 * 24,\r\n    \"week\": 60 * 60 * 24 * 7,\r\n    \"month\": 60 * 60 * 24 * 30,\r\n    \"quarter\": 60 * 60 * 24 * 30 * 3,\r\n    \"year\": 60 * 60 * 24 * 365\r\n  };\r\n  return steps[step] || steps.hour;\r\n};\r\n\r\n\r\ngantt.dateFromPos = function (x) {\r\n  var scale = this._tasks;\r\n  if (x < 0 || x > scale.full_width || !scale.full_width) {\r\n    return null;\r\n  }\r\n\r\n  var ind = this._findBinary(this._tasks.left, x);\r\n  var summ = this._tasks.left[ind];\r\n\r\n  var col_width = scale.width[ind] || scale.col_width;\r\n  var part = 0;\r\n  if (col_width)\r\n    part = (x - summ) / col_width;\r\n\r\n  var unit = 0;\r\n  if (part) {\r\n    unit = gantt._get_coll_duration(scale, scale.trace_x[ind]);\r\n  }\r\n\r\n  var date = new Date(scale.trace_x[ind].valueOf() + Math.round(part * unit));\r\n  return date;\r\n};\r\n\r\ngantt.posFromDate = function (date) {\r\n  if (!this._is_chart_visible())\r\n    return 0;\r\n\r\n  var ind = gantt._day_index_by_date(date);\r\n  this.assert(ind >= 0, \"Invalid day index\");\r\n\r\n  var wholeCells = Math.floor(ind);\r\n  var partCell = ind % 1;\r\n\r\n  var pos = gantt._tasks.left[Math.min(wholeCells, gantt._tasks.width.length - 1)];\r\n  if (wholeCells == gantt._tasks.width.length)\r\n    pos += gantt._tasks.width[gantt._tasks.width.length - 1];\r\n  //for(var i=1; i <= wholeCells; i++)\r\n  //\tpos += gantt._tasks.width[i-1];\r\n\r\n  if (partCell) {\r\n    if (wholeCells < gantt._tasks.width.length) {\r\n      pos += gantt._tasks.width[wholeCells] * (partCell % 1);\r\n    } else {\r\n      pos += 1;\r\n    }\r\n\r\n  }\r\n  return pos;\r\n};\r\n\r\ngantt._day_index_by_date = function (date) {\r\n  var pos = new Date(date).valueOf();\r\n  var days = gantt._tasks.trace_x,\r\n      ignores = gantt._tasks.ignore_x;\r\n\r\n  if (pos <= this._min_date)\r\n    return 0;\r\n\r\n  if (pos >= this._max_date)\r\n    return days.length;\r\n\r\n  /*var day = null;\r\n   for (var xind = 0, length = days.length-1; xind < length; xind++) {\r\n   // | 8:00, 8:30 | 8:15 should be checked against 8:30\r\n   // clicking at the most left part of the cell, say 8:30 should create event in that cell, not previous one\r\n   day = +days[xind+1];\r\n   if (pos < day && !ignores[day])\r\n   break;\r\n   }*/\r\n\r\n  var day_ind = gantt._findBinary(days, pos);\r\n  var day = +gantt._tasks.trace_x[day_ind];\r\n  while (ignores[day]) {\r\n    day = gantt._tasks.trace_x[++day_ind];\r\n  }\r\n\r\n  if (!day) return 0;\r\n\r\n  return day_ind + ((date - days[day_ind]) / gantt._get_coll_duration(gantt._tasks, days[day_ind]));\r\n\r\n\r\n};\r\ngantt._findBinary = function (array, target) {\r\n  // modified binary search, target value not exactly match array elements, looking for closest one\r\n\r\n  var low = 0, high = array.length - 1, i, item, prev;\r\n  while (low <= high) {\r\n\r\n    i = Math.floor((low + high) / 2);\r\n    item = +array[i];\r\n    prev = +array[i - 1];\r\n    if (item < target) {\r\n      low = i + 1;\r\n      continue;\r\n    }\r\n    if (item > target) {\r\n      if (!(!isNaN(prev) && prev < target)) {\r\n        high = i - 1;\r\n        continue;\r\n      } else {\r\n        // if target is between 'i' and 'i-1' return 'i - 1'\r\n        return i - 1;\r\n      }\r\n\r\n    }\r\n\r\n    return i;\r\n  }\r\n  return array.length - 1;\r\n};\r\ngantt._get_coll_duration = function (scale, date) {\r\n  return gantt.date.add(date, scale.step, scale.unit) - date;\r\n};\r\n\r\ngantt._get_x_pos = function (task, to_start) {\r\n  to_start = to_start !== false;\r\n  var x = gantt.posFromDate(to_start ? task.start_date : task.end_date);\r\n};\r\n\r\ngantt.getTaskTop = function (task_id) {\r\n  return this._y_from_ind(this.getGlobalTaskIndex(task_id));\r\n};\r\n\r\ngantt._get_task_coord = function (task, to_start, x_correction) {\r\n  to_start = to_start !== false;\r\n  x_correction = x_correction || 0;\r\n  var isMilestone = (this._get_safe_type(task.type) == this.config.types.milestone);\r\n\r\n  var date = null;\r\n\r\n  if (to_start || isMilestone) {\r\n    date = (task.start_date || this._default_task_date(task));\r\n  } else {\r\n    date = (task.end_date || this.calculateEndDate({start_date: this._default_task_date(task), task: task}));\r\n  }\r\n  var x = this.posFromDate(date),\r\n      y = this.getTaskTop(task.id);\r\n\r\n  if (isMilestone) {\r\n    if (to_start) {\r\n      x -= x_correction;\r\n    } else {\r\n      x += x_correction;\r\n    }\r\n  }\r\n  return {x: x, y: y};\r\n};\r\ngantt._get_task_pos = function (task, to_start) {\r\n  to_start = to_start !== false;\r\n  var mstoneCorrection = gantt._get_milestone_width() / 2;\r\n  return this._get_task_coord(task, to_start, mstoneCorrection);\r\n};\r\n\r\ngantt._get_task_visible_pos = function (task, to_start) {\r\n  to_start = to_start !== false;\r\n  var mstoneCorrection = gantt._get_visible_milestone_width() / 2;\r\n  return this._get_task_coord(task, to_start, mstoneCorrection);\r\n};\r\n\r\n\r\ngantt._correct_shift = function (start, back) {\r\n  return start -= ((new Date(gantt._min_date)).getTimezoneOffset() - (new Date(start)).getTimezoneOffset()) * 60000 * (back ? -1 : 1);\r\n};\r\n\r\n\r\ngantt._get_mouse_pos = function (ev) {\r\n  if (ev.pageX || ev.pageY)\r\n    var pos = {x: ev.pageX, y: ev.pageY};\r\n\r\n  var d = gantt.env.isIE ? document.documentElement : document.body;\r\n  var pos = {\r\n    x: ev.clientX + d.scrollLeft - d.clientLeft,\r\n    y: ev.clientY + d.scrollTop - d.clientTop\r\n  };\r\n\r\n  var box = gantt._get_position(gantt.$task_data);\r\n  pos.x = pos.x - box.x + gantt.$task_data.scrollLeft;\r\n  pos.y = pos.y - box.y + gantt.$task_data.scrollTop;\r\n  return pos;\r\n};\r\n\r\ngantt._is_layer = function (dom_element) {\r\n  return (dom_element && dom_element.hasAttribute && dom_element.hasAttribute(this.config.layer_attribute));\r\n};\r\n\r\n// --#include core/tasks_canvas_render.js\r\ngantt.attachEvent(\"onGanttReady\", function () {\r\n  gantt._task_layers.add();\r\n  gantt._link_layers.add();\r\n});\r\n\r\ngantt._layers = {\r\n  prepareConfig: function (config) {\r\n    if (typeof config == \"function\") {\r\n      config = {renderer: config};\r\n    }\r\n\r\n    var id = config.id = gantt.uid();\r\n\r\n    if (!config.container)\r\n      config.container = document.createElement(\"div\");\r\n\r\n    return config;\r\n  },\r\n  create: function (get_container, rel_root) {\r\n    return {\r\n      tempCollection: [],\r\n      renderers: {},\r\n      container: get_container,\r\n      getRenderers: function () {\r\n        var res = [];\r\n        for (var i in this.renderers) {\r\n          res.push(this.renderers[i]);\r\n        }\r\n        return res;\r\n      },\r\n      getRenderer: function (id) {\r\n        return this.renderers[id];\r\n      },\r\n      add: function (layer) {\r\n        if (layer)\r\n          this.tempCollection.push(layer);\r\n\r\n        if (!this.container()) return;\r\n\r\n        var container = this.container();\r\n\r\n        var pending = this.tempCollection;\r\n        for (var i = 0; i < pending.length; i++) {\r\n          var layer = pending[i];\r\n          var node = layer.container,\r\n              id = layer.id,\r\n              topmost = layer.topmost;\r\n          if (!node.parentNode) {\r\n            //insert on top or below the tasks\r\n            if (topmost) {\r\n              container.appendChild(node);\r\n            } else {\r\n              var rel = rel_root ? rel_root() : container.firstChild;\r\n              if (rel)\r\n                container.insertBefore(node, rel);\r\n              else\r\n                container.appendChild(node);\r\n            }\r\n          }\r\n          this.renderers[id] = gantt._task_renderer(id, layer.renderer, node, layer.filter);\r\n          this.tempCollection.splice(i, 1);\r\n          i--;\r\n        }\r\n      },\r\n      remove: function (id) {\r\n        this.renderers[id].unload();\r\n        delete this.renderers[id];\r\n      },\r\n      clear: function () {\r\n        for (var i in this.renderers) {\r\n          this.renderers[i].unload();\r\n        }\r\n        this.renderers = {};\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\ngantt._create_filter = function (filter_methods) {\r\n  if (!(filter_methods instanceof Array)) {\r\n    filter_methods = Array.prototype.slice.call(arguments, 0);\r\n  }\r\n\r\n  return function (obj) {\r\n    var res = true;\r\n    for (var i = 0, len = filter_methods.length; i < len; i++) {\r\n      var filter_method = filter_methods[i];\r\n      if (filter_method) {\r\n        res = res && (filter_method.apply(gantt, [obj.id, obj]) !== false);\r\n      }\r\n    }\r\n\r\n    return res;\r\n  };\r\n};\r\n\r\ngantt._add_generic_layer = function (layersManager, filters) {\r\n  return function (config) {\r\n    if (config.filter === undefined) {\r\n      config.filter = gantt._create_filter(filters);\r\n    }\r\n    config = gantt._layers.prepareConfig(config);\r\n    layersManager.add(config);\r\n    return config.id;\r\n  };\r\n};\r\n\r\ngantt._task_layers = gantt._layers.create(function () {\r\n  return gantt.$task_data;\r\n}, function () {\r\n  return gantt.$task_links;\r\n});\r\n\r\ngantt._link_layers = gantt._layers.create(function () {\r\n  return gantt.$task_data;\r\n});\r\n\r\ngantt.addTaskLayer = gantt._add_generic_layer(gantt._task_layers, [gantt._filter_task, gantt._is_chart_visible].concat(gantt._get_task_filters()));\r\n\r\ngantt.removeTaskLayer = function (id) {\r\n  gantt._task_layers.remove(id);\r\n};\r\n\r\ngantt.addLinkLayer = gantt._add_generic_layer(gantt._link_layers, [gantt._filter_link, gantt._is_chart_visible].concat(gantt._get_link_filters()));\r\ngantt.removeLinkLayer = function (id) {\r\n  gantt._link_layers.remove(id);\r\n};\r\n\r\ngantt._get_task_renderers = function () {\r\n  return this._task_layers.getRenderers();\r\n};\r\ngantt._get_link_renderers = function () {\r\n  return this._link_layers.getRenderers();\r\n};\r\n\r\ngantt._pull = {};\r\ngantt._branches = {};\r\ngantt._order = [];\r\ngantt._lpull = {};\r\ngantt._links = [];\r\ngantt._order_full = [];\r\n\r\ngantt.load = function (url, type, callback) {\r\n  this._load_url = url;\r\n  this.assert(arguments.length, \"Invalid load arguments\");\r\n\r\n  var tp = 'json', cl = null;\r\n  if (arguments.length >= 3) {\r\n    tp = type;\r\n    cl = callback;\r\n  } else {\r\n    if (typeof arguments[1] == \"string\")\r\n      tp = arguments[1];\r\n    else if (typeof arguments[1] == \"function\")\r\n      cl = arguments[1];\r\n  }\r\n\r\n  this._load_type = tp;\r\n\r\n  this.callEvent(\"onLoadStart\", [url, tp]);\r\n\r\n  this.ajax.get(url, gantt.bind(function (l) {\r\n    this.on_load(l, tp);\r\n    this.callEvent(\"onLoadEnd\", [url, tp]);\r\n    if (typeof cl == \"function\")\r\n      cl.call(this);\r\n  }, this));\r\n};\r\ngantt.parse = function (data, type) {\r\n  this.on_load({xmlDoc: {responseText: data}}, type);\r\n};\r\n\r\ngantt.serialize = function (type) {\r\n  type = type || \"json\";\r\n  return this[type].serialize();\r\n};\r\n\r\n/*\r\n tasks and relations\r\n {\r\n data:[\r\n {\r\n \"id\":\"string\",\r\n \"text\":\"...\",\r\n \"start_date\":\"Date or string\",\r\n \"end_date\":\"Date or string\",\r\n \"duration\":\"number\",\r\n \"progress\":\"0..1\",\r\n \"parent_id\":\"string\",\r\n \"order\":\"number\"\r\n },...],\r\n links:[\r\n {\r\n id:\"string\",\r\n source:\"string\",\r\n target:\"string\",\r\n type:\"string\"\r\n },...],\r\n collections:{\r\n collectionName:[\r\n {key:, label:, optional:...},...\r\n ],...\r\n }\r\n }\r\n\r\n gantt._pull - id to object hash\r\n gantt._branch - array of per branch arrays of objects|ids\r\n gantt._order - array of visible elements\r\n gantt._order_full - array of all elements\r\n\r\n gantt._links\r\n * */\r\n\r\ngantt.on_load = function (resp, type) {\r\n  this.callEvent(\"onBeforeParse\", []);\r\n  if (!type)\r\n    type = \"json\";\r\n  this.assert(this[type], \"Invalid data type:'\" + type + \"'\");\r\n\r\n  var raw = resp.xmlDoc.responseText;\r\n\r\n  var data = this[type].parse(raw, resp);\r\n  this._process_loading(data);\r\n};\r\n\r\ngantt._load_task = function (task) {\r\n  this._init_task(task);\r\n  if (this.callEvent(\"onTaskLoading\", [task])) {\r\n    this._pull[task.id] = task;\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\ngantt._build_pull = function (tasks) {\r\n  var task = null,\r\n      loaded = [];\r\n  for (var i = 0, len = tasks.length; i < len; i++) {\r\n    task = tasks[i];\r\n    if (this._load_task(task))\r\n      loaded.push(task);\r\n  }\r\n  return loaded;\r\n};\r\n\r\ngantt._build_hierarchy = function (tasks) {\r\n  var task = null;\r\n  for (var i = 0, len = tasks.length; i < len; i++) {\r\n    task = tasks[i];\r\n    this.setParent(task, this.getParent(task) || this.config.root_id);\r\n  }\r\n\r\n  // calculating $level for each item\r\n  for (var i = 0, len = tasks.length; i < len; i++) {\r\n    task = tasks[i];\r\n    this._add_branch(task);\r\n    task.$level = this.calculateTaskLevel(task);\r\n  }\r\n};\r\n\r\ngantt._process_loading = function (data) {\r\n  if (data.collections)\r\n    this._load_collections(data.collections);\r\n\r\n  var order = this._build_pull(data.data);\r\n  this._build_hierarchy(order);\r\n\r\n  this._sync_order();\r\n  this._order_synced = true;\r\n  this._init_links(data.links || (data.collections ? data.collections.links : []));\r\n  this.callEvent(\"onParse\", []);\r\n  this.render();\r\n  if (this.config.initial_scroll) {\r\n    var id = (this._order[0] || this.config.root_id);\r\n    if (id)\r\n      this.showTask(id);\r\n  }\r\n};\r\n\r\n\r\ngantt._init_links = function (links) {\r\n  if (links)\r\n    for (var i = 0; i < links.length; i++) {\r\n      if (links[i]) {\r\n        var link = this._init_link(links[i]);\r\n        this._lpull[link.id] = link;\r\n      }\r\n    }\r\n  this._sync_links();\r\n};\r\n\r\n\r\ngantt._load_collections = function (collections) {\r\n  var collections_loaded = false;\r\n  for (var key in collections) {\r\n    if (collections.hasOwnProperty(key)) {\r\n      collections_loaded = true;\r\n      var collection = collections[key];\r\n      var arr = this.serverList[key];\r\n      if (!arr) continue;\r\n      arr.splice(0, arr.length); //clear old options\r\n      for (var j = 0; j < collection.length; j++) {\r\n        var option = collection[j];\r\n        var obj = this.copy(option);\r\n        obj.key = obj.value;// resulting option object\r\n\r\n        for (var option_key in option) {\r\n          if (option.hasOwnProperty(option_key)) {\r\n            if (option_key == \"value\" || option_key == \"label\")\r\n              continue;\r\n            obj[option_key] = option[option_key]; // obj['value'] = option['value']\r\n          }\r\n        }\r\n        arr.push(obj);\r\n      }\r\n    }\r\n  }\r\n  if (collections_loaded)\r\n    this.callEvent(\"onOptionsLoad\", []);\r\n};\r\n\r\ngantt._sync_order = function (silent) {\r\n  this._order = [];\r\n  this._order_full = [];\r\n  this._order_search = {};\r\n  this._sync_order_item({parent: this.config.root_id, $open: true, $ignore: true, id: this.config.root_id});\r\n\r\n  if (!silent) {\r\n    this._scroll_resize();\r\n    this._set_sizes();\r\n  }\r\n};\r\ngantt.attachEvent(\"onBeforeTaskDisplay\", function (id, task) {\r\n  return !task.$ignore;\r\n});\r\ngantt._sync_order_item = function (item, hidden) {\r\n  if (item.id !== gantt.config.root_id) {  //do not trigger event for virtual root\r\n\r\n    this._order_full.push(item.id);\r\n    if (!hidden && this._filter_task(item.id, item) &&\r\n        this.callEvent(\"onBeforeTaskDisplay\", [item.id, item])) {\r\n      this._order.push(item.id);\r\n      this._order_search[item.id] = this._order.length - 1;\r\n    }\r\n  }\r\n\r\n  var children = this.getChildren(item.id);\r\n  if (children) {\r\n    for (var i = 0; i < children.length; i++)\r\n      this._sync_order_item(this._pull[children[i]], hidden || !item.$open);\r\n  }\r\n};\r\n\r\ngantt.getTaskCount = function () {\r\n  return this._order_full.length;\r\n};\r\n\r\ngantt.getLinkCount = function () {\r\n  return this._links.length;\r\n};\r\n\r\ngantt.getVisibleTaskCount = function () {\r\n  return this._order.length;\r\n};\r\ngantt.getTaskIndex = function (id) {\r\n  var branch = this.getChildren(this.getParent(id));\r\n  for (var i = 0; i < branch.length; i++)\r\n    if (branch[i] == id)\r\n      return i;\r\n\r\n  return -1;\r\n};\r\n\r\ngantt.getGlobalTaskIndex = function (id) {\r\n  this.assert(id, \"Invalid argument\");\r\n  var index = this._order_search[id];\r\n  if (index !== undefined)\r\n    return index;\r\n  else\r\n    return -1;\r\n};\r\n\r\n//leave old method for possible backward compatibility issue\r\ngantt._get_visible_order = gantt.getGlobalTaskIndex;\r\n\r\ngantt.eachTask = function (code, parent, master) {\r\n  parent = parent || this.config.root_id;\r\n  master = master || this;\r\n\r\n  var branch = this.getChildren(parent);\r\n  if (branch)\r\n    for (var i = 0; i < branch.length; i++) {\r\n      var item = this._pull[branch[i]];\r\n      code.call(master, item);\r\n      if (this.hasChild(item.id))\r\n        this.eachTask(code, item.id, master);\r\n    }\r\n};\r\ngantt._eachParent = function (callback, startTask, master) {\r\n  master = master || this;\r\n  var task = startTask;\r\n  while (this.getParent(task)) {\r\n    if (!this.isTaskExists(this.getParent(task))) break;\r\n    task = this.getTask(this.getParent(task));\r\n    callback.call(master, task);\r\n  }\r\n};\r\ngantt.json = {\r\n  parse: function (data) {\r\n    gantt.assert(data, \"Invalid data\");\r\n\r\n    if (typeof data == \"string\") {\r\n      if (window.JSON)\r\n        data = JSON.parse(data);\r\n      else {\r\n        gantt.assert(false, \"JSON is not supported\");\r\n      }\r\n    }\r\n\r\n    if (data.dhx_security)\r\n      gantt.security_key = data.dhx_security;\r\n    return data;\r\n  },\r\n  serializeTask: function (task) {\r\n    return this._copyObject(task);\r\n  },\r\n  serializeLink: function (link) {\r\n    return this._copyLink(link);\r\n  },\r\n  _copyLink: function (obj) {\r\n    var copy = {};\r\n    for (var key in obj)\r\n      copy[key] = obj[key];\r\n    return copy;\r\n  },\r\n  _copyObject: function (obj) {\r\n    var copy = {};\r\n    for (var key in obj) {\r\n      if (key.charAt(0) == \"$\")\r\n        continue;\r\n      copy[key] = obj[key];\r\n\r\n      if (copy[key] instanceof Date) {\r\n        copy[key] = gantt.templates.xml_format(copy[key]);\r\n      }\r\n    }\r\n    return copy;\r\n  },\r\n  serialize: function () {\r\n    var tasks = [];\r\n    var links = [];\r\n\r\n    gantt.eachTask(function (obj) {\r\n      gantt.resetProjectDates(obj);\r\n      tasks.push(this.serializeTask(obj));\r\n    }, gantt.config.root_id, this);\r\n\r\n    var rawLinks = gantt.getLinks();\r\n    for (var i = 0; i < rawLinks.length; i++) {\r\n      links.push(this.serializeLink(rawLinks[i]));\r\n    }\r\n\r\n    return {\r\n      data: tasks,\r\n      links: links\r\n    };\r\n  }\r\n};\r\n\r\n/*\r\n <data>\r\n <task id:\"some\" parent_id=\"0\" progress=\"0.5\">\r\n <text>My task 1</text>\r\n <start_date>16.08.2013</start_date>\r\n <end_date>22.08.2013</end_date>\r\n </task>\r\n <coll_options>\r\n <links>\r\n <link source='a1' target='b2' type='c3' />\r\n </links>\r\n </coll_options>\r\n </data>\r\n */\r\n\r\ngantt.xml = {\r\n  _xmlNodeToJSON: function (node, attrs_only) {\r\n    var t = {};\r\n    for (var i = 0; i < node.attributes.length; i++)\r\n      t[node.attributes[i].name] = node.attributes[i].value;\r\n\r\n    if (!attrs_only) {\r\n      for (var i = 0; i < node.childNodes.length; i++) {\r\n        var child = node.childNodes[i];\r\n        if (child.nodeType == 1)\r\n          t[child.tagName] = child.firstChild ? child.firstChild.nodeValue : \"\";\r\n      }\r\n\r\n      if (!t.text) t.text = node.firstChild ? node.firstChild.nodeValue : \"\";\r\n    }\r\n\r\n    return t;\r\n  },\r\n  _getCollections: function (loader) {\r\n    var collection = {};\r\n    var opts = gantt.ajax.xpath(\"//coll_options\", loader);\r\n    for (var i = 0; i < opts.length; i++) {\r\n      var bind = opts[i].getAttribute(\"for\");\r\n      var arr = collection[bind] = [];\r\n      var itms = gantt.ajax.xpath(\".//item\", opts[i]);\r\n      for (var j = 0; j < itms.length; j++) {\r\n        var itm = itms[j];\r\n        var attrs = itm.attributes;\r\n        var obj = {key: itms[j].getAttribute(\"value\"), label: itms[j].getAttribute(\"label\")};\r\n        for (var k = 0; k < attrs.length; k++) {\r\n          var attr = attrs[k];\r\n          if (attr.nodeName == \"value\" || attr.nodeName == \"label\")\r\n            continue;\r\n          obj[attr.nodeName] = attr.nodeValue;\r\n        }\r\n        arr.push(obj);\r\n      }\r\n    }\r\n    return collection;\r\n  },\r\n  _getXML: function (text, loader, toptag) {\r\n    toptag = toptag || \"data\";\r\n    if (!loader.getXMLTopNode) {\r\n      loader = gantt.ajax.parse(loader);\r\n    }\r\n\r\n    var xml = gantt.ajax.xmltop(toptag, loader.xmlDoc);\r\n    if (xml.tagName != toptag) throw \"Invalid XML data\";\r\n\r\n    var skey = xml.getAttribute(\"dhx_security\");\r\n    if (skey)\r\n      gantt.security_key = skey;\r\n\r\n    return xml;\r\n  },\r\n  parse: function (text, loader) {\r\n    loader = this._getXML(text, loader);\r\n    var data = {};\r\n\r\n    var evs = data.data = [];\r\n    var xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n    for (var i = 0; i < xml.length; i++)\r\n      evs[i] = this._xmlNodeToJSON(xml[i]);\r\n\r\n    data.collections = this._getCollections(loader);\r\n    return data;\r\n  },\r\n  _copyLink: function (obj) {\r\n    return \"<item id='\" + obj.id + \"' source='\" + obj.source + \"' target='\" + obj.target + \"' type='\" + obj.type + \"' />\";\r\n  },\r\n  _copyObject: function (obj) {\r\n    return \"<task id='\" + obj.id + \"' parent='\" + (obj.parent || \"\") + \"' start_date='\" + obj.start_date + \"' duration='\" + obj.duration + \"' open='\" + (!!obj.open) + \"' progress='\" + obj.progress + \"' end_date='\" + obj.end_date + \"'><![CDATA[\" + obj.text + \"]]></task>\";\r\n  },\r\n  serialize: function () {\r\n    var tasks = [];\r\n    var links = [];\r\n\r\n    var json = gantt.json.serialize();\r\n    for (var i = 0, len = json.data.length; i < len; i++) {\r\n      tasks.push(this._copyObject(json.data[i]));\r\n    }\r\n    for (var i = 0, len = json.links.length; i < len; i++) {\r\n      links.push(this._copyLink(json.links[i]));\r\n    }\r\n    return \"<data>\" + tasks.join(\"\") + \"<coll_options for='links'>\" + links.join(\"\") + \"</coll_options></data>\";\r\n  }\r\n};\r\n\r\n\r\ngantt.oldxml = {\r\n  parse: function (text, loader) {\r\n    loader = gantt.xml._getXML(text, loader, \"projects\");\r\n    var data = {collections: {links: []}};\r\n\r\n    var evs = data.data = [];\r\n    var xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n    for (var i = 0; i < xml.length; i++) {\r\n      evs[i] = gantt.xml._xmlNodeToJSON(xml[i]);\r\n      var parent = xml[i].parentNode;\r\n\r\n      if (parent.tagName == \"project\")\r\n        evs[i].parent = \"project-\" + parent.getAttribute(\"id\");\r\n      else\r\n        evs[i].parent = parent.parentNode.getAttribute(\"id\");\r\n    }\r\n\r\n    xml = gantt.ajax.xpath(\"//project\", loader);\r\n    for (var i = 0; i < xml.length; i++) {\r\n      var ev = gantt.xml._xmlNodeToJSON(xml[i], true);\r\n      ev.id = \"project-\" + ev.id;\r\n      evs.push(ev);\r\n    }\r\n\r\n    for (var i = 0; i < evs.length; i++) {\r\n      var ev = evs[i];\r\n      ev.start_date = ev.startdate || ev.est;\r\n      ev.end_date = ev.enddate;\r\n      ev.text = ev.name;\r\n      ev.duration = ev.duration / 8;\r\n      ev.open = 1;\r\n      if (!ev.duration && !ev.end_date) ev.duration = 1;\r\n      if (ev.predecessortasks)\r\n        data.collections.links.push({\r\n          target: ev.id,\r\n          source: ev.predecessortasks,\r\n          type: gantt.config.links.finish_to_start\r\n        });\r\n    }\r\n\r\n    return data;\r\n  },\r\n  serialize: function () {\r\n    gantt.message(\"Serialization to 'old XML' is not implemented\");\r\n  }\r\n};\r\n\r\ngantt.serverList = function (name, array) {\r\n  if (array) {\r\n    this.serverList[name] = array.slice(0);\r\n  } else if (!this.serverList[name]) {\r\n    this.serverList[name] = [];\r\n  }\r\n  return this.serverList[name];\r\n};\r\n\r\ngantt._calendars = {};\r\n\r\ngantt._calendars.calendarArgumentsHelper = {\r\n  getWorkHoursArguments: function () {\r\n    var config = arguments[0];\r\n    if (config.date instanceof Date) {\r\n      config = {\r\n        date: config\r\n      };\r\n    } else {\r\n      config = gantt.mixin({}, config);\r\n    }\r\n    return config;\r\n  },\r\n  setWorkTimeArguments: function () {\r\n    return arguments[0];\r\n  },\r\n  unsetWorkTimeArguments: function () {\r\n    return arguments[0];\r\n  },\r\n  isWorkTimeArguments: function () {\r\n    var config = arguments[0];\r\n    if (!config.date) {\r\n      config = {};\r\n      config.date = arguments[0];\r\n      config.unit = arguments[1];\r\n      config.task = arguments[2];\r\n      config.calendar = arguments[3];\r\n    } else {\r\n      config = gantt.mixin({}, config);\r\n      config.unit = config.unit || gantt.config.duration_unit;\r\n      config.task = config.task || null;\r\n      config.calendar = config.calendar || null;\r\n    }\r\n\r\n    config.unit = config.unit || gantt.config.duration_unit;\r\n\r\n    return config;\r\n  },\r\n  getClosestWorkTimeArguments: function (config) {\r\n    config = arguments[0];\r\n    if (config instanceof Date) {\r\n      config = {\r\n        date: config\r\n      };\r\n    } else {\r\n      config = gantt.mixin({}, config);\r\n    }\r\n    config.dir = config.dir || 'any';\r\n    config.unit = config.unit || gantt.config.duration_unit;\r\n\r\n    return config;\r\n  },\r\n\r\n  getDurationConfig: function (start, end, task, calendar) {\r\n    this.start_date = start;\r\n    this.end_date = end;\r\n    this.task = task;\r\n    this.calendar = calendar;\r\n    this.unit = null;\r\n    this.step = null;\r\n    return this;\r\n  },\r\n  _getStartEndConfig: function (param) {\r\n    var argumentType = gantt._calendars.calendarArgumentsHelper.getDurationConfig;\r\n    var config;\r\n    if (param instanceof argumentType)\r\n      return param;\r\n\r\n    if (param instanceof Date) {\r\n      config = new argumentType(arguments[0], arguments[1], arguments[2], arguments[3]);\r\n    } else {\r\n      config = new argumentType(param.start_date, param.end_date, param.task);\r\n      if (param.id) {\r\n        config.task = param;\r\n      }\r\n    }\r\n\r\n    config.unit = config.unit || gantt.config.duration_unit;\r\n    config.step = config.step || gantt.config.duration_step;\r\n    config.start_date = config.start_date || config.start || config.date;\r\n\r\n    return config;\r\n  },\r\n\r\n  getDurationArguments: function (start, end, unit, step) {\r\n    return gantt._calendars.calendarArgumentsHelper._getStartEndConfig.apply(this, arguments);\r\n  },\r\n\r\n  hasDurationArguments: function (start, end, unit, step) {\r\n    return gantt._calendars.calendarArgumentsHelper._getStartEndConfig.apply(this, arguments);\r\n  },\r\n\r\n  calculateEndDateArguments: function (start, duration, unit, step) {\r\n    var config = arguments[0];\r\n    if (config instanceof Date) {\r\n      config = {\r\n        start_date: arguments[0],\r\n        duration: arguments[1],\r\n        unit: arguments[2],\r\n        task: arguments[3],\r\n        calendar: arguments[4]\r\n      };\r\n    } else {\r\n      config = gantt.mixin({}, config);\r\n    }\r\n\r\n    config.unit = config.unit || gantt.config.duration_unit;\r\n    config.step = config.step || gantt.config.duration_step;\r\n\r\n    return config;\r\n  }\r\n};\r\ngantt._calendars.calendarStrategy = {\r\n  units: [\r\n    \"year\",\r\n    \"month\",\r\n    \"week\",\r\n    \"day\",\r\n    \"hour\",\r\n    \"minute\"\r\n  ],\r\n  // cache previously calculated worktime\r\n  _workingUnitsCache: {\r\n    //_cache: {},\r\n\r\n    get: function (unit, date) {\r\n      var result = -1;// default value (if not existed in the cache)\r\n\r\n      var cache = this._cache;\r\n      if (cache && cache[unit]) {\r\n        var units = cache[unit];\r\n        var time = date.getTime();\r\n        if (units[time] !== undefined)\r\n          result = units[time];\r\n      }\r\n      return result;\r\n    },\r\n\r\n    put: function (unit, date, value) {\r\n      if (!unit || !date) return false;\r\n\r\n      var cache = this._cache;\r\n\r\n      var time = date.getTime();\r\n\r\n      value = !!value;\r\n\r\n      if (!cache) return false;\r\n      if (!cache[unit]) cache[unit] = {};\r\n      cache[unit][time] = value;\r\n      return true;\r\n    },\r\n\r\n    clear: function () {\r\n      this._cache = {};\r\n    }\r\n  },\r\n  _getUnitOrder: function (unit) {\r\n    for (var i = 0, len = this.units.length; i < len; i++) {\r\n      if (this.units[i] == unit)\r\n        return i;\r\n    }\r\n  },\r\n  _timestamp: function (settings) {\r\n\r\n    var timestamp = null;\r\n    if ((settings.day || settings.day === 0)) {\r\n      timestamp = settings.day;\r\n    } else if (settings.date) {\r\n      // store worktime datestamp in utc so it could be recognized in different timezones (e.g. opened locally and sent to the export service in different timezone)\r\n      timestamp = Date.UTC(settings.date.getFullYear(), settings.date.getMonth(), settings.date.getDate());\r\n    }\r\n    return timestamp;\r\n  },\r\n  _checkIfWorkingUnit: function (date, unit, order) {\r\n    if (order === undefined) {\r\n      order = this._getUnitOrder(unit);\r\n    }\r\n\r\n    // disable worktime check for custom time units\r\n    if (order === undefined) {\r\n      return true;\r\n    }\r\n    if (order) {\r\n      //check if bigger time unit is a work time (hour < day < month...)\r\n      //i.e. don't check particular hour if the whole day is marked as not working\r\n      if (!this._isWorkTime(date, this.units[order - 1], order - 1))\r\n        return false;\r\n    }\r\n    if (!this[\"_is_work_\" + unit])\r\n      return true;\r\n    return this[\"_is_work_\" + unit](date);\r\n  },\r\n  //checkings for particular time units\r\n  //methods for month-year-week can be defined, otherwise always return 'true'\r\n  _is_work_day: function (date) {\r\n    var val = this._getWorkHours(date);\r\n\r\n    if (val instanceof Array) {\r\n      return val.length > 0;\r\n    }\r\n    return false;\r\n  },\r\n  _is_work_hour: function (date) {\r\n    var hours = this._getWorkHours(date); // [7,12] or []\r\n    var hour = date.getHours();\r\n    for (var i = 0; i < hours.length; i += 2) {\r\n      if (hours[i + 1] === undefined) {\r\n        return hours[i] == hour;\r\n      } else {\r\n        if (hour >= hours[i] && hour < hours[i + 1])\r\n          return true;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n  _internDatesPull: {},\r\n  _nextDate: function (start, unit, step) {\r\n\r\n    return gantt.date.add(start, step, unit);\r\n\r\n    /*var start_value = +start,\r\n     key = unit + \"_\" + step;\r\n     var interned = this._internDatesPull[key];\r\n     if(!interned){\r\n     interned = this._internDatesPull[key] = {};\r\n     }\r\n     var calculated;\r\n     if(!interned[start_value]){\r\n     interned[start_value] = calculated = gantt.date.add(start, step, unit);\r\n     //interned[start_value] = gantt.date.add(start, step, unit);\r\n     }\r\n     return calculated || interned[start_value];*/\r\n  },\r\n  _getWorkUnitsBetweenGeneric: function (from, to, unit, step) {\r\n    var start = new Date(from),\r\n        end = new Date(to);\r\n    step = step || 1;\r\n    var units = 0;\r\n\r\n\r\n    var next = null;\r\n    var stepStart,\r\n        stepEnd;\r\n\r\n    // calculating decimal durations, i.e. 2016-09-20 00:05:00 - 2016-09-20 01:00:00 ~ 0.95 instead of 1\r\n    // and also  2016-09-20 00:00:00 - 2016-09-20 00:05:00 ~ 0.05 instead of 1\r\n    // durations must be rounded later\r\n    var checkFirst = false;\r\n    stepStart = gantt.date[unit + \"_start\"](new Date(start));\r\n    if (stepStart.valueOf() != start.valueOf()) {\r\n      checkFirst = true;\r\n    }\r\n    var checkLast = false;\r\n    stepEnd = gantt.date[unit + \"_start\"](new Date(to));\r\n    if (stepEnd.valueOf() != to.valueOf()) {\r\n      checkLast = true;\r\n    }\r\n\r\n    var isLastStep = false;\r\n    while (start.valueOf() < end.valueOf()) {\r\n      next = this._nextDate(start, unit, step);\r\n      isLastStep = (next.valueOf() > end.valueOf());\r\n\r\n      if (this._isWorkTime(start, unit)) {\r\n        if (checkFirst || (checkLast && isLastStep)) {\r\n          stepStart = gantt.date[unit + \"_start\"](new Date(start));\r\n          stepEnd = gantt.date.add(stepStart, step, unit);\r\n        }\r\n\r\n        if (checkFirst) {\r\n          checkFirst = false;\r\n          next = this._nextDate(stepStart, unit, step);\r\n          units += ((stepEnd.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n        } else if (checkLast && isLastStep) {\r\n          checkLast = false;\r\n          units += ((end.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n\r\n        } else {\r\n          units++;\r\n        }\r\n      }\r\n      start = next;\r\n    }\r\n    return units;\r\n  },\r\n  _getHoursPerDay: function (date) {\r\n    var hours = this._getWorkHours(date);\r\n    var res = 0;\r\n    for (var i = 0; i < hours.length; i += 2) {\r\n      res += ((hours[i + 1] - hours[i]) || 0);\r\n    }\r\n    return res;\r\n  },\r\n  _getWorkHoursForRange: function (from, to) {\r\n    var hours = 0;\r\n    var start = new Date(from),\r\n        end = new Date(to);\r\n\r\n    while (start.valueOf() < end.valueOf()) {\r\n      if (this._isWorkTime(start, \"day\"))\r\n        hours += this._getHoursPerDay(start);\r\n      start = this._nextDate(start, \"day\", 1);\r\n    }\r\n    return hours;\r\n  },\r\n  _getWorkUnitsBetweenHours: function (from, to, unit, step) {\r\n    var start = new Date(from),\r\n        end = new Date(to);\r\n    step = step || 1;\r\n\r\n    var firstDayStart = new Date(start);\r\n    var firstDayEnd = gantt.date.add(gantt.date.day_start(new Date(start)), 1, \"day\");\r\n\r\n    if (end.valueOf() <= firstDayEnd.valueOf()) {\r\n      return this._getWorkUnitsBetweenGeneric(from, to, unit, step);\r\n    } else {\r\n\r\n      var lastDayStart = gantt.date.day_start(new Date(end));\r\n      var lastDayEnd = end;\r\n\r\n      var startPart = this._getWorkUnitsBetweenGeneric(firstDayStart, firstDayEnd, unit, step);\r\n      var endPart = this._getWorkUnitsBetweenGeneric(lastDayStart, lastDayEnd, unit, step);\r\n\r\n      var hourRange = this._getWorkHoursForRange(firstDayEnd, lastDayStart);\r\n      hourRange = ((hourRange / step) + startPart + endPart);\r\n\r\n      return hourRange;\r\n    }\r\n  },\r\n\r\n  _getCalendar: function () {\r\n    return this.worktime;\r\n  },\r\n  _setCalendar: function (settings) {\r\n    this.worktime = settings;\r\n  },\r\n\r\n  _tryChangeCalendarSettings: function (payload) {\r\n    var backup = JSON.stringify(this._getCalendar());\r\n    payload();\r\n    if (this._isEmptyCalendar(this._getCalendar())) {\r\n      gantt.assert(false, \"Invalid calendar settings, no worktime available\");\r\n      this._setCalendar(JSON.parse(backup));\r\n      this._workingUnitsCache.clear();\r\n      return false;\r\n    }\r\n    return true;\r\n\r\n  },\r\n\r\n  _isEmptyCalendar: function (settings) {\r\n    var result = false,\r\n        datesArray = [],\r\n        isFullWeekSet = true;\r\n    for (var i in settings.dates) {\r\n      result |= !!settings.dates[i];\r\n      datesArray.push(i);\r\n    }\r\n\r\n    var checkFullArray = [];\r\n    for (var i = 0; i < datesArray.length; i++) {\r\n      if (datesArray[i] < 10) {\r\n        checkFullArray.push(datesArray[i]);\r\n      }\r\n    }\r\n    checkFullArray.sort();\r\n\r\n    for (var i = 0; i < 7; i++) {\r\n      if (checkFullArray[i] != i)\r\n        isFullWeekSet = false;\r\n    }\r\n    if (isFullWeekSet)\r\n      return !result;\r\n    return !(result || !!settings.hours); // can still return false if separated dates are set to true\r\n  },\r\n\r\n  getWorkHours: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.getWorkHoursArguments.apply(this, arguments);\r\n    return this._getWorkHours(config.date);\r\n  },\r\n  _getWorkHours: function (date) {\r\n    var t = this._timestamp({date: date});\r\n    var hours = true;\r\n    var calendar = this._getCalendar();\r\n    if (calendar.dates[t] !== undefined) {\r\n      hours = calendar.dates[t];//custom day\r\n    } else if (calendar.dates[date.getDay()] !== undefined) {\r\n      hours = calendar.dates[date.getDay()];//week day\r\n    }\r\n    if (hours === true) {\r\n      return calendar.hours;\r\n    } else if (hours) {\r\n      return hours;\r\n    }\r\n    return [];\r\n  },\r\n\r\n  setWorkTime: function (settings) {\r\n    return this._tryChangeCalendarSettings(gantt.bind(function () {\r\n      var hours = settings.hours !== undefined ? settings.hours : true;\r\n      var timestamp = this._timestamp(settings);\r\n      if (timestamp !== null) {\r\n        this._getCalendar().dates[timestamp] = hours;\r\n      } else {\r\n        this._getCalendar().hours = hours;\r\n      }\r\n      this._workingUnitsCache.clear();\r\n    }, this));\r\n  },\r\n\r\n  unsetWorkTime: function (settings) {\r\n    return this._tryChangeCalendarSettings(gantt.bind(function () {\r\n      if (!settings) {\r\n        this.reset_calendar();\r\n      } else {\r\n\r\n        var timestamp = this._timestamp(settings);\r\n\r\n        if (timestamp !== null) {\r\n          delete this._getCalendar().dates[timestamp];\r\n        }\r\n      }\r\n      // Clear work units cache\r\n      this._workingUnitsCache.clear();\r\n    }, this));\r\n  },\r\n\r\n  _isWorkTime: function (date, unit, order) {\r\n    //Check if this item has in the cache\r\n    var is_work_unit = this._workingUnitsCache.get(unit, date);\r\n\r\n    if (is_work_unit == -1) {\r\n      // calculate if not cached\r\n      is_work_unit = this._checkIfWorkingUnit(date, unit, order);\r\n      this._workingUnitsCache.put(unit, date, is_work_unit);\r\n    }\r\n\r\n    return is_work_unit;\r\n  },\r\n\r\n  isWorkTime: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.isWorkTimeArguments.apply(this, arguments);\r\n    return this._isWorkTime(config.date, config.unit);\r\n  },\r\n\r\n  calculateDuration: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.getDurationArguments.apply(this, arguments);\r\n\r\n    if (!config.unit) {\r\n      return false;\r\n    }\r\n\r\n    var res = 0;\r\n    if (config.unit == \"hour\") {\r\n      res = this._getWorkUnitsBetweenHours(config.start_date, config.end_date, config.unit, config.step);\r\n    } else {\r\n      res = this._getWorkUnitsBetweenGeneric(config.start_date, config.end_date, config.unit, config.step);\r\n    }\r\n\r\n    // getDuration.. returns decimal durations\r\n    return Math.round(res);\r\n  },\r\n  hasDuration: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.getDurationArguments.apply(this, arguments);\r\n\r\n    var from = config.start_date,\r\n        to = config.end_date,\r\n        unit = config.unit,\r\n        step = config.step;\r\n\r\n    if (!unit) {\r\n      return false;\r\n    }\r\n    var start = new Date(from),\r\n        end = new Date(to);\r\n    step = step || 1;\r\n\r\n    while (start.valueOf() < end.valueOf()) {\r\n      if (this._isWorkTime(start, unit))\r\n        return true;\r\n      start = this._nextDate(start, unit, step);\r\n    }\r\n    return false;\r\n  },\r\n\r\n  calculateEndDate: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.calculateEndDateArguments.apply(this, arguments);\r\n\r\n    var from = config.start_date,\r\n        duration = config.duration,\r\n        unit = config.unit,\r\n        step = config.step;\r\n\r\n    var mult = (config.duration >= 0) ? 1 : -1;\r\n    return this._calculateEndDate(from, duration, unit, step * mult);\r\n  },\r\n  _calculateEndDate: function (from, duration, unit, step) {\r\n    if (!unit)\r\n      return false;\r\n\r\n    var start = new Date(from),\r\n        added = 0;\r\n    step = step || 1;\r\n    duration = Math.abs(duration * 1);\r\n\r\n    while (added < duration) {\r\n      var next = this._nextDate(start, unit, step);\r\n      //if(this.isWorkTime(step > 0 ? start : next, unit))\r\n      if (this._isWorkTime(step > 0 ? new Date(next.valueOf() - 1) : new Date(next.valueOf() + 1), unit))\r\n        added++;\r\n      start = next;\r\n    }\r\n    return start;\r\n  },\r\n\r\n  getClosestWorkTime: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.getClosestWorkTimeArguments.apply(this, arguments);\r\n    return this._getClosestWorkTime(config);\r\n  },\r\n\r\n  _getClosestWorkTime: function (settings) {\r\n    if (this._isWorkTime(settings.date, settings.unit))\r\n      return settings.date;\r\n\r\n    var unit = settings.unit;\r\n\r\n    var curr = gantt.date[unit + '_start'](settings.date);\r\n\r\n    var future_target = new Date(curr),\r\n        prev_target = new Date(curr),\r\n        tick = true,\r\n        maximum_loop = 3000,//be extra sure we won't fall into infinite loop, 3k seems big enough\r\n        count = 0,\r\n        both_directins = (settings.dir == 'any' || !settings.dir);\r\n\r\n    var inc = 1;\r\n    if (settings.dir == 'past')\r\n      inc = -1;\r\n\r\n    //will seek closest working hour in future or in past, one step in one direction per iteration\r\n    while (!this._isWorkTime(curr, unit)) {\r\n\r\n      if (both_directins) {\r\n        curr = tick ? future_target : prev_target;\r\n        inc = inc * (-1);\r\n      }\r\n      var tzOffset = curr.getTimezoneOffset();\r\n      curr = gantt.date.add(curr, inc, unit);\r\n\r\n      curr = gantt._correct_dst_change(curr, tzOffset, inc, unit);\r\n      if (gantt.date[unit + '_start'])\r\n        curr = gantt.date[unit + '_start'](curr);\r\n\r\n      if (both_directins) {\r\n        if (tick) {\r\n          future_target = curr;\r\n        } else {\r\n          prev_target = curr;\r\n        }\r\n      }\r\n      tick = !tick;\r\n      count++;\r\n      if (count > maximum_loop) {\r\n        gantt.assert(false, \"Invalid working time check\");\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (curr == prev_target || settings.dir == 'past') {\r\n      curr = gantt.date.add(curr, 1, unit);\r\n    }\r\n\r\n    return curr;\r\n  }\r\n};\r\n\r\ngantt._calendars.disabledWorkTimeCalendar = {\r\n  getWorkHours: function () {\r\n    return [0, 24];\r\n  },\r\n  setWorkTime: function () {\r\n    return true;\r\n  },\r\n  unsetWorkTime: function () {\r\n    return true;\r\n  },\r\n  isWorkTime: function () {\r\n    return true;\r\n  },\r\n  getClosestWorkTime: function (config) {\r\n    var config = gantt._calendars.calendarArgumentsHelper.getClosestWorkTimeArguments.apply(this, arguments);\r\n    return config.date;\r\n  },\r\n\r\n  calculateDuration: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.getDurationArguments.apply(this, arguments);\r\n    var from = config.start_date,\r\n        to = config.end_date,\r\n        unit = config.unit,\r\n        step = config.step;\r\n\r\n    return this._calculateDuration(from, to, unit, step);\r\n  },\r\n  _calculateDuration: function (start, end, unit, step) {\r\n    var fixedUnits = {\r\n      \"week\": 1000 * 60 * 60 * 24 * 7,\r\n      \"day\": 1000 * 60 * 60 * 24,\r\n      \"hour\": 1000 * 60 * 60,\r\n      \"minute\": 1000 * 60\r\n    };\r\n\r\n    var res = 0;\r\n    if (fixedUnits[unit]) {\r\n      res = Math.round((end - start) / (step * fixedUnits[unit]));\r\n    } else {\r\n      var from = new Date(start),\r\n          to = new Date(end);\r\n      while (from.valueOf() < to.valueOf()) {\r\n        res += 1;\r\n        from = gantt.date.add(from, step, unit);\r\n      }\r\n\r\n      if (from.valueOf() != end.valueOf()) {\r\n        res += (to - from) / (gantt.date.add(from, step, unit) - from);\r\n      }\r\n    }\r\n\r\n    return Math.round(res);\r\n  },\r\n\r\n  hasDuration: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.getDurationArguments.apply(this, arguments);\r\n    var from = config.start_date,\r\n        to = config.end_date,\r\n        unit = config.unit,\r\n        step = config.step;\r\n\r\n    if (!unit) {\r\n      return false;\r\n    }\r\n    from = new Date(from);\r\n    to = new Date(to);\r\n\r\n    return (from.valueOf() < to.valueOf());\r\n  },\r\n\r\n  calculateEndDate: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.calculateEndDateArguments.apply(this, arguments);\r\n\r\n    var start = config.start_date,\r\n        duration = config.duration,\r\n        unit = config.unit,\r\n        step = config.step;\r\n\r\n    return gantt.date.add(start, step * duration, unit);\r\n  }\r\n};\r\n\r\n(function () {\r\n  var workingUnitsCache = function () {\r\n    this._cache = {};\r\n  };\r\n  workingUnitsCache.prototype = gantt._calendars.calendarStrategy._workingUnitsCache;\r\n\r\n  gantt._calendars.CalendarAPICore = function () {\r\n    this._workingUnitsCache = new workingUnitsCache();\r\n  };\r\n  gantt._calendars.CalendarAPICore.prototype = gantt._calendars.calendarStrategy;\r\n})();\r\n\r\ngantt._calendars.calendarManager = {\r\n  _calendars: {},\r\n  _getDayHoursForMultiple: function (calendars, date) {\r\n    var units = [],\r\n        tick = true,\r\n        currPos = 0,\r\n        is_work_hour = false,\r\n        start = gantt.date.day_start(new Date(date));\r\n    for (var hour = 0; hour < 24; hour++) {\r\n      is_work_hour = calendars.reduce(function (acc, calendar) {\r\n        return acc && calendar._is_work_hour(start);\r\n      }, true);\r\n      if (is_work_hour) {\r\n        if (tick) {\r\n          units[currPos] = hour;\r\n          units[currPos + 1] = (hour + 1);\r\n          currPos += 2;\r\n        } else {\r\n          units[currPos - 1] += 1;\r\n        }\r\n        tick = false;\r\n      } else if (!tick) {\r\n        tick = true;\r\n      }\r\n      start = gantt.date.add(start, 1, \"hour\");\r\n    }\r\n    if (!units.length)\r\n      units = false;\r\n    return units;\r\n  },\r\n  mergeCalendars: function () {\r\n    var newCalendar = this.createCalendar(),\r\n        day,\r\n        units = [];\r\n    var calendars = Array.prototype.slice.call(arguments, 0);\r\n    newCalendar.worktime.hours = [0, 24];\r\n    newCalendar.worktime.dates = {};\r\n    var start = gantt.date.day_start(new Date(259200000)); // 1970 day=0\r\n    for (day = 0; day < 7; day++) {\r\n      units = this._getDayHoursForMultiple(calendars, start);\r\n      newCalendar.worktime.dates[day] = units;\r\n      start = gantt.date.add(start, 1, \"day\");\r\n    }\r\n    for (var i = 0; i < calendars.length; i++) {\r\n      for (var value in calendars[i].worktime.dates) if (+value > 10000) {\r\n        units = this._getDayHoursForMultiple(calendars, new Date(+value));\r\n        newCalendar.worktime.dates[value] = units;\r\n      }\r\n    }\r\n    return newCalendar;\r\n  },\r\n\r\n  _convertWorktimeSettings: function (settings) {\r\n    var days = settings.days;\r\n    if (days) {\r\n      settings.dates = settings.dates || {};\r\n      for (var i = 0; i < days.length; i++) {\r\n        settings.dates[i] = days[i];\r\n        if (!(days[i] instanceof Array)) {\r\n          settings.dates[i] = !!days[i];\r\n        }\r\n      }\r\n      delete settings.days;\r\n    }\r\n    return settings;\r\n  },\r\n\r\n  createCalendar: function (parentCalendar) {\r\n    var settings;\r\n\r\n    if (!parentCalendar) {\r\n      parentCalendar = {};\r\n    }\r\n\r\n    if (parentCalendar.worktime) {\r\n      settings = gantt.copy(parentCalendar.worktime);\r\n    } else {\r\n      settings = gantt.copy(parentCalendar);\r\n    }\r\n\r\n    var defaults = gantt.copy(this.defaults.fulltime.worktime);\r\n    gantt.mixin(settings, defaults);\r\n\r\n    var id = gantt.uid();\r\n    var calendar = {\r\n      id: id + \"\",\r\n      worktime: this._convertWorktimeSettings(settings)\r\n    };\r\n\r\n    var apiCore = new gantt._calendars.CalendarAPICore();\r\n    gantt.mixin(apiCore, calendar);\r\n\r\n    // validate/check if empty calendar\r\n    if (!apiCore._tryChangeCalendarSettings(function () {\r\n        })) {\r\n      return null;\r\n    } else {\r\n      return apiCore;\r\n    }\r\n  },\r\n\r\n  getCalendar: function (id) {\r\n    id = id || \"global\";\r\n    this.createDefaultCalendars();\r\n    return this._calendars[id];\r\n  },\r\n\r\n  getCalendars: function () {\r\n    var res = [];\r\n    for (var i in this._calendars) {\r\n      res.push(this.getCalendar(i));\r\n    }\r\n    return res;\r\n  },\r\n\r\n  getTaskCalendar: function (task) {\r\n    if (!task) {\r\n      return this.getCalendar();\r\n    } else if (task[gantt.config.calendar_property]) {\r\n      return this.getCalendar(task[gantt.config.calendar_property]);\r\n    } else if (gantt.config.resource_calendars) {\r\n\r\n      for (var field in gantt.config.resource_calendars) {\r\n        var resource = gantt.config.resource_calendars[field];\r\n        if (task[field]) {\r\n          var calendarId = resource[task[field]];\r\n          if (calendarId) {\r\n            return this.getCalendar(calendarId);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.getCalendar();\r\n  },\r\n\r\n  addCalendar: function (calendar) { // puts new calendar to Global Storage - gantt.calendarManager._calendars {}\r\n    if (!(calendar instanceof gantt._calendars.CalendarAPICore)) {\r\n      var id = calendar.id;\r\n      calendar = this.createCalendar(calendar);\r\n      calendar.id = id;\r\n    }\r\n\r\n    calendar.id = calendar.id || gantt.uid();\r\n    this._calendars[calendar.id] = calendar;\r\n    if (!gantt.config.worktimes)\r\n      gantt.config.worktimes = {};\r\n    gantt.config.worktimes[calendar.id] = calendar.worktime;\r\n    return calendar.id;\r\n  },\r\n\r\n  deleteCalendar: function (calendar) {\r\n    if (calendar && this._calendars[calendar.id])\r\n      delete this._calendars[calendar.id];\r\n    if (gantt.config.worktimes && gantt.config.worktimes[calendar.id])\r\n      delete gantt.config.worktimes[calendar.id];\r\n  },\r\n\r\n  restoreConfigCalendars: function (configs) {\r\n    for (var i in configs) {\r\n      if (this._calendars[i])\r\n        continue;\r\n\r\n      var settings = configs[i];\r\n      var calendar = this.createCalendar(settings);\r\n      calendar.id = i;\r\n      this.addCalendar(calendar);\r\n    }\r\n  },\r\n\r\n  defaults: {\r\n    global: {\r\n      id: \"global\",\r\n      worktime: {\r\n        hours: [8, 17],\r\n        days: [0, 1, 1, 1, 1, 1, 0]\r\n      }\r\n    },\r\n    fulltime: {\r\n      id: \"fulltime\",\r\n      worktime: {\r\n        hours: [0, 24],\r\n        days: [1, 1, 1, 1, 1, 1, 1]\r\n      }\r\n    }\r\n  },\r\n\r\n  createDefaultCalendars: function () {\r\n    this.restoreConfigCalendars(this.defaults);\r\n    this.restoreConfigCalendars(gantt.config.worktimes);\r\n  }\r\n};\r\n\r\ngantt._timeCalculator = {\r\n  _getCalendar: function (config) {\r\n    var calendar;\r\n    if (!gantt.config.work_time) {\r\n      calendar = gantt._calendars.disabledWorkTimeCalendar;\r\n    } else {\r\n      var manager = gantt._calendars.calendarManager;\r\n      if (config.task) {\r\n        calendar = manager.getTaskCalendar(config.task);\r\n      } else if (config.id) {\r\n        calendar = manager.getTaskCalendar(config);\r\n      } else if (config.calendar) {\r\n        calendar = config.calendar;\r\n      }\r\n      if (!calendar) {\r\n        calendar = manager.getTaskCalendar();\r\n      }\r\n    }\r\n    return calendar;\r\n  },\r\n\r\n  getWorkHours: function (config) {\r\n    config = gantt._calendars.calendarArgumentsHelper.getWorkHoursArguments.apply(this, arguments);\r\n\r\n    var calendar = this._getCalendar(config);\r\n\r\n    return calendar.getWorkHours(config.date);\r\n  },\r\n\r\n  setWorkTime: function (config, calendar) {\r\n    config = gantt._calendars.calendarArgumentsHelper.setWorkTimeArguments.apply(this, arguments);\r\n\r\n    if (!calendar)\r\n      calendar = gantt._calendars.calendarManager.getCalendar(); // Global\r\n    return calendar.setWorkTime(config);\r\n  },\r\n\r\n  unsetWorkTime: function (config, calendar) {\r\n    config = gantt._calendars.calendarArgumentsHelper.unsetWorkTimeArguments.apply(this, arguments);\r\n\r\n    if (!calendar)\r\n      calendar = gantt._calendars.calendarManager.getCalendar(); // Global\r\n    return calendar.unsetWorkTime(config);\r\n  },\r\n  isWorkTime: function (date, unit, task, calendar) {\r\n    var config = gantt._calendars.calendarArgumentsHelper.isWorkTimeArguments.apply(this, arguments);\r\n\r\n    calendar = this._getCalendar(config);\r\n    return calendar.isWorkTime(config);\r\n  },\r\n  getClosestWorkTime: function (config) {\r\n    config = gantt._calendars.calendarArgumentsHelper.getClosestWorkTimeArguments.apply(this, arguments);\r\n\r\n    var calendar = this._getCalendar(config);\r\n\r\n    return calendar.getClosestWorkTime(config);\r\n  },\r\n\r\n  calculateDuration: function () { // start_date_date, end_date, task\r\n    var config = gantt._calendars.calendarArgumentsHelper.getDurationArguments.apply(this, arguments);\r\n\r\n\r\n    var calendar = this._getCalendar(config);\r\n    return calendar.calculateDuration(config);\r\n  },\r\n  hasDuration: function () {\r\n    var config = gantt._calendars.calendarArgumentsHelper.hasDurationArguments.apply(this, arguments);\r\n\r\n    var calendar = this._getCalendar(config);\r\n\r\n    return calendar.hasDuration(config);\r\n  },\r\n  calculateEndDate: function (config) { // start_date, duration, unit, task\r\n    var config = gantt._calendars.calendarArgumentsHelper.calculateEndDateArguments.apply(this, arguments);\r\n\r\n    var calendar = this._getCalendar(config);\r\n    return calendar.calculateEndDate(config);\r\n  }\r\n};\r\n\r\n(function () {\r\n  var calManager = gantt._calendars.calendarManager;\r\n\r\n  gantt.createCalendar = gantt.bind(calManager.createCalendar, calManager);\r\n  gantt.addCalendar = gantt.bind(calManager.addCalendar, calManager);\r\n  gantt.getCalendar = gantt.bind(calManager.getCalendar, calManager);\r\n  gantt.getCalendars = gantt.bind(calManager.getCalendars, calManager);\r\n  gantt.getTaskCalendar = gantt.bind(calManager.getTaskCalendar, calManager);\r\n  gantt.deleteCalendar = gantt.bind(calManager.deleteCalendar, calManager);\r\n\r\n})();\r\n\r\ngantt.getTask = function (id) {\r\n  gantt.assert(id, \"Invalid argument for gantt.getTask\");\r\n  var task = this._pull[id];\r\n  gantt.assert(task, \"Task not found id=\" + id);\r\n  return task;\r\n};\r\ngantt.getTaskByTime = function (from, to) {\r\n  var p = this._pull,\r\n      res = [],\r\n      pos = 0,\r\n      taken = 0;\r\n\r\n  if (!(from || to)) {\r\n    for (var t in p) res.push(p[t]);\r\n  } else {\r\n    from = +from || -Infinity;\r\n    to = +to || Infinity;\r\n    for (var t in p) {\r\n      var task = p[t];\r\n      if (+task.start_date < to && +task.end_date > from)\r\n        res.push(task);\r\n    }\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\ngantt.isTaskExists = function (id) {\r\n  return gantt.defined(this._pull[id]);\r\n};\r\n\r\ngantt.isUnscheduledTask = function (task) {\r\n  return (!!task.unscheduled || !task.start_date);\r\n};\r\n\r\ngantt._isAllowedUnscheduledTask = function (task) {\r\n  return !!(task.unscheduled && gantt.config.show_unscheduled);\r\n};\r\ngantt.isTaskVisible = function (id) {\r\n  if (!this._pull[id])\r\n    return false;\r\n\r\n  var task = this._pull[id];\r\n  if (!((+task.start_date < +this._max_date && +task.end_date > +this._min_date) || gantt._isAllowedUnscheduledTask(task)))\r\n    return false;\r\n\r\n  if (this._order_search[id] !== undefined) return true;\r\n  return false;\r\n};\r\n\r\n\r\ngantt.updateTask = function (id, item) {\r\n  if (!gantt.defined(item)) item = this.getTask(id);\r\n  if (this.callEvent(\"onBeforeTaskUpdate\", [id, item]) === false) return false;\r\n\r\n  this._pull[item.id] = item;\r\n  if (!this._is_parent_sync(item)) {\r\n    this._resync_parent(item);\r\n  }\r\n\r\n  if (this._isAllowedUnscheduledTask(item)) {\r\n    this._init_task(item);\r\n    this._sync_links();\r\n  }\r\n\r\n  this._update_parents(item.id);\r\n  this.refreshTask(item.id);\r\n  this._sync_order(true);\r\n  this.callEvent(\"onAfterTaskUpdate\", [id, item]);\r\n\r\n\r\n  this._adjust_scales();\r\n};\r\n\r\ngantt._add_branch = function (task, index) {\r\n  var pid = this.getParent(task);\r\n  if (!this.hasChild(pid))\r\n    this._branches[pid] = [];\r\n  var branch = this.getChildren(pid);\r\n  var added_already = false;\r\n  for (var i = 0, length = branch.length; i < length; i++) {\r\n    if (branch[i] == task.id) {\r\n      added_already = true;\r\n      break;\r\n    }\r\n  }\r\n  if (!added_already) {\r\n    if (index * 1 == index) {\r\n      branch.splice(index, 0, task.id);\r\n    } else {\r\n      branch.push(task.id);\r\n    }\r\n  }\r\n\r\n  this._sync_parent(task);\r\n};\r\n\r\ngantt._move_branch = function (task, old_parent, new_parent) {\r\n  this.setParent(task, new_parent);\r\n  this._sync_parent(task);\r\n  this._replace_branch_child(old_parent, task.id);\r\n  if (this.isTaskExists(new_parent) || new_parent == this.config.root_id) {\r\n\r\n    this._add_branch(task);\r\n  } else {\r\n    delete this._branches[task.id];\r\n  }\r\n  task.$level = this.calculateTaskLevel(task);\r\n  this.eachTask(function (child) {\r\n    child.$level = this.calculateTaskLevel(child);\r\n  }, task.id);\r\n  this._sync_order();\r\n};\r\ngantt._resync_parent = function (task) {\r\n  this._move_branch(task, task.$rendered_parent, this.getParent(task));\r\n};\r\ngantt._sync_parent = function (task) {\r\n  task.$rendered_parent = this.getParent(task);\r\n};\r\ngantt._is_parent_sync = function (task) {\r\n  return (task.$rendered_parent == this.getParent(task));\r\n};\r\n\r\n\r\ngantt._replace_branch_child = function (node, old_id, new_id) {\r\n  var branch = this.getChildren(node);\r\n  if (branch) {\r\n    var newbranch = [];\r\n    for (var i = 0; i < branch.length; i++) {\r\n      if (branch[i] != old_id)\r\n        newbranch.push(branch[i]);\r\n      else if (new_id)\r\n        newbranch.push(new_id);\r\n    }\r\n    this._branches[node] = newbranch;\r\n  }\r\n  this._sync_order();\r\n};\r\n\r\ngantt.addTask = function (item, parent, index) {\r\n  if (!gantt.defined(item.id))\r\n    item.id = gantt.uid();\r\n\r\n  if (!gantt.defined(parent)) parent = this.getParent(item) || 0;\r\n  if (!this.isTaskExists(parent)) parent = 0;\r\n  this.setParent(item, parent);\r\n  item = this._init_task(item);\r\n\r\n  if (this.callEvent(\"onBeforeTaskAdd\", [item.id, item]) === false) return false;\r\n\r\n  this._pull[item.id] = item;\r\n\r\n  this._add_branch(item, index);\r\n  this._sync_order(true);\r\n  this.callEvent(\"onAfterTaskAdd\", [item.id, item]);\r\n\r\n  this.refreshData();\r\n  this._adjust_scales();\r\n\r\n  return item.id;\r\n};\r\n\r\n\r\ngantt._default_task_date = function (item, parent_id) {\r\n  var parent = (parent_id && parent_id != this.config.root_id) ? this.getTask(parent_id) : false,\r\n      startDate = '';\r\n  if (parent) {\r\n    startDate = parent.start_date;\r\n  } else {\r\n    var first = this._order[0];\r\n    startDate = first ? (this.getTask(first).start_date ? this.getTask(first).start_date : (this.getTask(first).end_date ? this.calculateEndDate({\r\n      start_date: this.getTask(first).end_date,\r\n      duration: -this.config.duration_step\r\n    }) : '')) : this.config.start_date || this.getState().min_date;\r\n  }\r\n  gantt.assert(startDate, \"Invalid dates\");\r\n  return new Date(startDate);\r\n};\r\n\r\ngantt._set_default_task_timing = function (task) {\r\n  task.start_date = task.start_date || gantt._default_task_date(task, this.getParent(task));\r\n  task.duration = task.duration || this.config.duration_step;\r\n  task.end_date = task.end_date || this.calculateEndDate(task);\r\n};\r\n\r\ngantt.createTask = function (item, parent, index) {\r\n  item = item || {};\r\n  if (!gantt.defined(item.id))\r\n    item.id = gantt.uid();\r\n\r\n  if (!item.start_date) {\r\n    item.start_date = gantt._default_task_date(item, parent);\r\n  }\r\n  if (item.text === undefined) {\r\n    item.text = gantt.locale.labels.new_task;\r\n  }\r\n  if (item.duration === undefined) {\r\n    item.duration = 1;\r\n  }\r\n\r\n  if (parent) {\r\n    this.setParent(item, parent);\r\n    var parentObj = this.getTask(parent);\r\n    parentObj.$open = true;\r\n  }\r\n\r\n  if (!this.callEvent(\"onTaskCreated\", [item])) {\r\n    return null;\r\n  }\r\n  if (this.config.details_on_create) {\r\n    item.$new = true;\r\n    this._pull[item.id] = this._init_task(item);\r\n\r\n    this._add_branch(item, index);\r\n    item.$level = this.calculateTaskLevel(item);\r\n    this.selectTask(item.id);\r\n    this.refreshData();\r\n    this.showLightbox(item.id);\r\n  } else {\r\n    if (this.addTask(item, parent, index)) {\r\n      this.showTask(item.id);\r\n      this.selectTask(item.id);\r\n    }\r\n  }\r\n  return item.id;\r\n};\r\n\r\ngantt.deleteTask = function (id) {\r\n  return this._deleteTask(id);\r\n};\r\n\r\n//TODO: do something with overcomplicated dataprocessor logic\r\ngantt._getChildLinks = function (id) {\r\n  var item = this.getTask(id);\r\n  if (!item) {\r\n    return [];\r\n  }\r\n\r\n  var links = item.$source.concat(item.$target);\r\n\r\n  var branches = this.getChildren(item.id);\r\n  for (var i = 0; i < branches.length; i++) {\r\n    links = links.concat(this._getChildLinks(branches[i]));\r\n  }\r\n\r\n  var res = {};\r\n  for (var i = 0; i < links.length; i++) {\r\n    res[links[i]] = true;\r\n  }\r\n  links = [];\r\n  for (var i in res) {\r\n    if (this.isLinkExists(i))\r\n      links.push(i);\r\n  }\r\n\r\n  return links;\r\n};\r\ngantt._getTaskTree = function (id) {\r\n  var item = this.getTask(id);\r\n  if (!item) {\r\n    return [];\r\n  }\r\n\r\n  var items = [];\r\n  var branches = this.getChildren(item.id);\r\n  for (var i = 0; i < branches.length; i++) {\r\n    items.push(branches[i]);\r\n    items = items.concat(this._getTaskTree(branches[i]));\r\n  }\r\n  return items;\r\n};\r\ngantt._deleteRelatedLinks = function (links, silent) {\r\n  var use_dp = (this._dp && !silent) && this.config.cascade_delete;\r\n  var prev_mode = '';\r\n  var send_changes = use_dp ? this._dp.updateMode != 'off' : false;\r\n  if (use_dp) {\r\n    prev_mode = this._dp.updateMode;\r\n    this._dp.setUpdateMode(\"off\");\r\n  }\r\n  for (var i = 0; i < links.length; i++) {\r\n    if (use_dp) {\r\n      this._dp.setGanttMode(\"links\");\r\n      this._dp.setUpdated(links[i], true, \"deleted\");\r\n    }\r\n    this._deleteLink(links[i], true);\r\n  }\r\n\r\n  if (use_dp) {\r\n    this._dp.setUpdateMode(prev_mode);\r\n    if (send_changes)\r\n      this._dp.sendAllData();\r\n  }\r\n};\r\ngantt._deleteRelatedTasks = function (id, silent) {\r\n  var use_dp = (this._dp && !silent) && this.config.cascade_delete;\r\n  var prev_mode = '';\r\n\r\n  if (use_dp) {\r\n    prev_mode = this._dp.updateMode;\r\n    this._dp.setGanttMode(\"tasks\");\r\n    this._dp.setUpdateMode(\"off\");\r\n  }\r\n  var tree = this._getTaskTree(id);\r\n  for (var i = 0; i < tree.length; i++) {\r\n    // add deleted subrow into dataprocessor update list manually\r\n    // because silent mode is on\r\n    var t_id = tree[i];\r\n    this._unset_task(t_id);\r\n    if (use_dp) {\r\n      this._dp.setUpdated(t_id, true, \"deleted\");\r\n    }\r\n  }\r\n  if (use_dp) {\r\n\r\n    this._dp.setUpdateMode(prev_mode);\r\n  }\r\n};\r\ngantt._unset_task = function (id) {\r\n  var item = this.getTask(id);\r\n  this._update_flags(id, null);\r\n  delete this._pull[id];\r\n  this._move_branch(item, this.getParent(item), null);\r\n};\r\ngantt._deleteTask = function (id, silent) {\r\n  var item = this.getTask(id);\r\n  if (!silent && this.callEvent(\"onBeforeTaskDelete\", [id, item]) === false) return false;\r\n\r\n  var links = gantt._getChildLinks(id);\r\n  this._deleteRelatedTasks(id, silent);\r\n  this._deleteRelatedLinks(links, silent);\r\n  this._unset_task(id);\r\n  if (!silent) {\r\n    this._sync_order(true);\r\n    this.callEvent(\"onAfterTaskDelete\", [id, item]);\r\n    this.refreshData();\r\n  }\r\n  return true;\r\n};\r\n\r\ngantt.clearAll = function () {\r\n  this._clear_data();\r\n  this.callEvent(\"onClear\", []);\r\n  this.refreshData();\r\n};\r\ngantt._clear_data = function () {\r\n  this._pull = {};\r\n  this._branches = {};\r\n  this._order = [];\r\n  this._order_full = [];\r\n  this._lpull = {};\r\n  this._links = [];\r\n  this._update_flags();\r\n  this.userdata = {};\r\n};\r\n\r\ngantt._update_flags = function (oldid, newid) {\r\n  // TODO: need a proper way to update all possible flags\r\n  if (oldid === undefined) {\r\n    this._lightbox_id = this._selected_task = null;\r\n    if (this._tasks_dnd.drag) {\r\n      this._tasks_dnd.drag.id = null;\r\n    }\r\n  } else {\r\n    if (this._lightbox_id == oldid)\r\n      this._lightbox_id = newid;\r\n    if (this._selected_task == oldid) {\r\n      this._selected_task = newid;\r\n    }\r\n    if (this._tasks_dnd.drag && this._tasks_dnd.drag.id == oldid) {\r\n      this._tasks_dnd.drag.id = newid;\r\n    }\r\n  }\r\n};\r\ngantt.changeTaskId = function (oldid, newid) {\r\n  var item = this._pull[newid] = this._pull[oldid];\r\n  this._pull[newid].id = newid;\r\n  delete this._pull[oldid];\r\n\r\n  this._update_flags(oldid, newid);\r\n  this._replace_branch_child(this.getParent(item), oldid, newid);\r\n\r\n  for (var id in this._pull) {\r\n    var task = this._pull[id];\r\n    if (this.getParent(task) == oldid) {\r\n      this.setParent(task, newid);\r\n      this._resync_parent(task);\r\n    }\r\n  }\r\n\r\n  var links = this._get_task_links(item);\r\n\r\n  for (var i = 0; i < links.length; i++) {\r\n    var link = this.getLink(links[i]);\r\n    if (link.source == oldid) {\r\n      link.source = newid;\r\n    }\r\n    if (link.target == oldid) {\r\n      link.target = newid;\r\n    }\r\n  }\r\n\r\n\r\n  this.callEvent(\"onTaskIdChange\", [oldid, newid]);\r\n};\r\n\r\ngantt._get_task_links = function (task) {\r\n  var links = [];\r\n\r\n  if (task.$source) {\r\n    links = links.concat(task.$source);\r\n  }\r\n  if (task.$target) {\r\n    links = links.concat(task.$target);\r\n  }\r\n\r\n  return links;\r\n};\r\n\r\ngantt._get_duration_unit = function () {\r\n  return (gantt._get_line(this.config.duration_unit) * 1000) || this.config.duration_unit;\r\n};\r\n\r\ngantt._get_safe_type = function (type) {\r\n  return \"task\";\r\n};\r\ngantt._get_type_name = function (type_value) {\r\n  for (var i in this.config.types) {\r\n    if (this.config.types[i] == type_value) {\r\n      return i;\r\n    }\r\n  }\r\n  return \"task\";\r\n};\r\n\r\n// TODO: rework public api for date methods\r\ngantt.getWorkHours = function (date) {\r\n  return gantt._timeCalculator.getWorkHours(date);\r\n};\r\n\r\ngantt.setWorkTime = function (config) {\r\n  return gantt._timeCalculator.setWorkTime(config);\r\n};\r\n\r\ngantt.unsetWorkTime = function (config) {\r\n  gantt._timeCalculator.unsetWorkTime(config);\r\n};\r\n\r\ngantt.isWorkTime = function (date, unit, task) {\r\n  return gantt._timeCalculator.isWorkTime(date, unit, task);\r\n};\r\n\r\ngantt.correctTaskWorkTime = function (task) {\r\n  if (gantt.config.work_time && gantt.config.correct_work_time) {\r\n    if (!gantt.isWorkTime(task.start_date, task)) {\r\n      task.start_date = gantt.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n      task.end_date = gantt.calculateEndDate(task);\r\n    } else if (!gantt.isWorkTime(new Date(+task.end_date - 1), task)) {\r\n      task.end_date = gantt.calculateEndDate(task);\r\n    }\r\n  }\r\n};\r\n\r\ngantt.getClosestWorkTime = function (config) {\r\n  return gantt._timeCalculator.getClosestWorkTime(config);\r\n};\r\n\r\ngantt.calculateDuration = function (start_date, end_date, task) {\r\n  return gantt._timeCalculator.calculateDuration(start_date, end_date, task);\r\n};\r\ngantt._hasDuration = function (start_date, end_date, task) {\r\n  return gantt._timeCalculator.hasDuration(start_date, end_date, task);\r\n};\r\n\r\ngantt.calculateEndDate = function (start, duration, unit, task) {\r\n  return gantt._timeCalculator.calculateEndDate(start, duration, unit, task);\r\n};\r\n\r\ngantt._init_task = function (task) {\r\n  if (!gantt.defined(task.id))\r\n    task.id = gantt.uid();\r\n\r\n  if (task.start_date)\r\n    task.start_date = gantt.date.parseDate(task.start_date, \"xml_date\");\r\n  if (task.end_date)\r\n    task.end_date = gantt.date.parseDate(task.end_date, \"xml_date\");\r\n\r\n\r\n  var duration = null;\r\n  if (task.duration || task.duration === 0) {\r\n    task.duration = duration = task.duration * 1;\r\n  }\r\n\r\n  if (duration) {\r\n    if (task.start_date && !task.end_date) {\r\n      task.end_date = this.calculateEndDate(task);\r\n    } else if (!task.start_date && task.end_date) {\r\n      task.start_date = this.calculateEndDate({start_date: task.end_date, duration: -task.duration, task: task});\r\n    }\r\n  }\r\n\r\n\r\n  if (this._isAllowedUnscheduledTask(task)) {\r\n    this._set_default_task_timing(task);\r\n  }\r\n  gantt._init_task_timing(task);\r\n  if (task.start_date && task.end_date)\r\n    gantt.correctTaskWorkTime(task);\r\n\r\n  task.$source = [];\r\n  task.$target = [];\r\n  if (task.parent === undefined) {\r\n    this.setParent(task, this.config.root_id);\r\n  }\r\n\r\n  if (!gantt.defined(task.$open)) {\r\n    task.$open = gantt.defined(task.open) ? task.open : this.config.open_tree_initially;\r\n  }\r\n  task.$level = this.calculateTaskLevel(task);\r\n  return task;\r\n};\r\n\r\ngantt._get_task_timing_mode = function (task, force) {\r\n  var task_type = this._get_safe_type(task.type);\r\n\r\n  var state = {\r\n    type: task_type,\r\n    $no_start: false,\r\n    $no_end: false\r\n  };\r\n\r\n  if (!force && task_type == task.$rendered_type) {\r\n    state.$no_start = task.$no_start;\r\n    state.$no_end = task.$no_end;\r\n    return state;\r\n  }\r\n\r\n  if (task_type == this.config.types.project) {\r\n    //project duration is always defined by children duration\r\n    state.$no_end = state.$no_start = true;\r\n  } else if (task_type != this.config.types.milestone) {\r\n    //tasks can have fixed duration, children duration(as projects), or one date fixed, and other defined by nested items\r\n    state.$no_end = !(task.end_date || task.duration);\r\n    state.$no_start = !task.start_date;\r\n\r\n    if (this._isAllowedUnscheduledTask(task)) {\r\n      state.$no_end = state.$no_start = false;\r\n    }\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\ngantt._init_task_timing = function (task) {\r\n  var task_mode = gantt._get_task_timing_mode(task, true);\r\n\r\n  var dirty = task.$rendered_type != task_mode.type;\r\n\r\n  var task_type = task_mode.type;\r\n\r\n  if (dirty) {\r\n    task.$no_start = task_mode.$no_start;\r\n    task.$no_end = task_mode.$no_end;\r\n    task.$rendered_type = task_mode.type;\r\n  }\r\n\r\n  if (dirty && task_type != this.config.types.milestone) {\r\n    if (task_type == this.config.types.project) {\r\n      //project duration is always defined by children duration\r\n      this._set_default_task_timing(task);\r\n    }\r\n  }\r\n\r\n  if (task_type == this.config.types.milestone) {\r\n    task.end_date = task.start_date;\r\n  }\r\n  if (task.start_date && task.end_date) {\r\n    task.duration = this.calculateDuration(task);\r\n  }\r\n  task.duration = task.duration || 0;\r\n};\r\n\r\ngantt._is_flex_task = function (task) {\r\n  var mode = gantt._get_task_timing_mode(task);\r\n\r\n  return !!(mode.$no_end || mode.$no_start);\r\n};\r\n\r\n// downward calculation of project duration\r\ngantt.resetProjectDates = function (task) {\r\n  var taskMode = this._get_task_timing_mode(task);\r\n  if (taskMode.$no_end || taskMode.$no_start) {\r\n    var dates = this.getSubtaskDates(task.id);\r\n    this._assign_project_dates(task, dates.start_date, dates.end_date);\r\n  }\r\n};\r\n\r\ngantt.getSubtaskDates = function (task_id) {\r\n  var min = null,\r\n      max = null,\r\n      root = task_id !== undefined ? task_id : gantt.config.root_id;\r\n\r\n  this.eachTask(function (child) {\r\n    if (this._get_safe_type(child.type) == gantt.config.types.project || this.isUnscheduledTask(child))\r\n      return;\r\n\r\n    if ((child.start_date && !child.$no_start) && (!min || min > child.start_date.valueOf()))\r\n      min = child.start_date.valueOf();\r\n    if ((child.end_date && !child.$no_end) && (!max || max < child.end_date.valueOf()))\r\n      max = child.end_date.valueOf();\r\n  }, root);\r\n\r\n  return {\r\n    start_date: min ? new Date(min) : null,\r\n    end_date: max ? new Date(max) : null\r\n  };\r\n};\r\n\r\ngantt._assign_project_dates = function (task, from, to) {\r\n  var taskTiming = this._get_task_timing_mode(task);\r\n  if (taskTiming.$no_start) {\r\n    if (from && from != Infinity) {\r\n      task.start_date = new Date(from);\r\n    } else {\r\n      task.start_date = this._default_task_date(task, this.getParent(task));\r\n    }\r\n  }\r\n\r\n  if (taskTiming.$no_end) {\r\n    if (to && to != -Infinity) {\r\n      task.end_date = new Date(to);\r\n    } else {\r\n      task.end_date = this.calculateEndDate({\r\n        start_date: task.start_date,\r\n        duration: this.config.duration_step,\r\n        task: task\r\n      });\r\n    }\r\n  }\r\n  if (taskTiming.$no_start || taskTiming.$no_end) {\r\n    this._init_task_timing(task);\r\n  }\r\n};\r\n\r\n// upward calculation of project duration\r\ngantt._update_parents = function (taskId, silent) {\r\n  if (!taskId) return;\r\n\r\n  var task = this.getTask(taskId);\r\n  var pid = this.getParent(task);\r\n\r\n  var taskTiming = this._get_task_timing_mode(task);\r\n\r\n  var has_changed = true;\r\n\r\n  if (taskTiming.$no_start || taskTiming.$no_end) {\r\n    var oldStart = task.start_date.valueOf(),\r\n        oldEnd = task.end_date.valueOf();\r\n\r\n    gantt.resetProjectDates(task);\r\n\r\n    // not refresh parent projects if dates hasn't changed\r\n    if (oldStart == task.start_date.valueOf() && oldEnd == task.end_date.valueOf()) {\r\n      has_changed = false;\r\n    }\r\n\r\n    if (has_changed && !silent) {\r\n      this.refreshTask(task.id, true);\r\n    }\r\n  }\r\n\r\n\r\n  if (has_changed && pid && this.isTaskExists(pid)) {\r\n    this._update_parents(pid, silent);\r\n  }\r\n};\r\ngantt.isChildOf = function (child_id, parent_id) {\r\n  if (!this.isTaskExists(child_id))\r\n    return false;\r\n  if (parent_id === this.config.root_id)\r\n    return this.isTaskExists(child_id);\r\n\r\n  var task = this.getTask(child_id);\r\n  var pid = this.getParent(child_id);\r\n\r\n  while (task && this.isTaskExists(pid)) {\r\n    task = this.getTask(pid);\r\n\r\n    if (task && task.id == parent_id)\r\n      return true;\r\n    pid = this.getParent(task);\r\n  }\r\n  return false;\r\n};\r\n\r\ngantt.roundDate = function (config) {\r\n  if (config instanceof Date) {\r\n    config = {\r\n      date: config,\r\n      unit: gantt._tasks.unit,\r\n      step: gantt._tasks.step\r\n    };\r\n  }\r\n  var date = config.date,\r\n      steps = config.step,\r\n      unit = config.unit;\r\n\r\n  var upper, lower, colIndex;\r\n  if (unit == gantt._tasks.unit && steps == gantt._tasks.step &&\r\n      +date >= +gantt._min_date && +date <= +gantt._max_date) {\r\n    //find date in time scale config\r\n    colIndex = Math.floor(gantt._day_index_by_date(date));\r\n\r\n    if (!gantt._tasks.trace_x[colIndex]) {\r\n      colIndex -= 1;// end of time scale\r\n    }\r\n    lower = new Date(gantt._tasks.trace_x[colIndex]);\r\n\r\n    upper = new Date(lower);\r\n    if (gantt._tasks.trace_x[colIndex + 1]) {\r\n      upper = new Date(gantt._tasks.trace_x[colIndex + 1]);\r\n    } else {\r\n      upper = gantt.date.add(lower, steps, unit);\r\n    }\r\n  } else {\r\n    colIndex = Math.floor(gantt._day_index_by_date(date));\r\n\r\n    upper = gantt.date[unit + \"_start\"](new Date(this._min_date));\r\n    if (gantt._tasks.trace_x[colIndex]) {\r\n      upper = gantt.date[unit + \"_start\"](gantt._tasks.trace_x[colIndex]);// end of time scale\r\n    }\r\n\r\n    while (+upper < +date) {\r\n      upper = gantt.date[unit + \"_start\"](gantt.date.add(upper, steps, unit));\r\n\r\n      var tzOffset = upper.getTimezoneOffset();\r\n\r\n      upper = gantt._correct_dst_change(upper, tzOffset, upper, unit);\r\n      if (gantt.date[unit + '_start'])\r\n        upper = gantt.date[unit + '_start'](upper);\r\n    }\r\n\r\n    lower = gantt.date.add(upper, -1 * steps, unit);\r\n\r\n  }\r\n  if (config.dir && config.dir == 'future')\r\n    return upper;\r\n  if (config.dir && config.dir == 'past')\r\n    return lower;\r\n\r\n  if (Math.abs(date - lower) < Math.abs(upper - date)) {\r\n    return lower;\r\n  } else {\r\n    return upper;\r\n  }\r\n\r\n};\r\n\r\n\r\ngantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\r\n  gantt._init_task_timing(task);\r\n  return true;\r\n});\r\ngantt.attachEvent(\"onBeforeTaskAdd\", function (id, task) {\r\n  gantt._init_task_timing(task);\r\n  return true;\r\n});\r\n\r\ngantt.calculateTaskLevel = function (item) {\r\n  var level = 0;\r\n  this._eachParent(function () {\r\n    level++;\r\n  }, item);\r\n  return level;\r\n};\r\n\r\n\r\ngantt.sort = function (field, desc, parent, silent) {\r\n  var render = !silent;//4th argument to cancel redraw after sorting\r\n\r\n  if (!this.isTaskExists(parent)) {\r\n    parent = this.config.root_id;\r\n  }\r\n\r\n  if (!field) field = \"order\";\r\n  var criteria = (typeof(field) == \"string\") ? (function (a, b) {\r\n    if (a[field] == b[field]) {\r\n      return 0;\r\n    }\r\n\r\n    var result = a[field] > b[field];\r\n    return result ? 1 : -1;\r\n  }) : field;\r\n\r\n  if (desc) {\r\n    var original_criteria = criteria;\r\n    criteria = function (a, b) {\r\n      return original_criteria(b, a);\r\n    };\r\n  }\r\n\r\n  var els = this.getChildren(parent);\r\n  if (els) {\r\n    var temp = [];\r\n    for (var i = els.length - 1; i >= 0; i--)\r\n      temp[i] = this._pull[els[i]];\r\n\r\n    temp.sort(criteria);\r\n\r\n    for (var i = 0; i < temp.length; i++) {\r\n      els[i] = temp[i].id;\r\n      this.sort(field, desc, els[i], true);\r\n    }\r\n  }\r\n\r\n  if (render) {\r\n    this.render();\r\n  }\r\n};\r\n\r\ngantt.getNext = function (id) {\r\n  for (var i = 0; i < this._order.length - 1; i++) {\r\n    if (this._order[i] == id)\r\n      return this._order[i + 1];\r\n  }\r\n  return null;\r\n};\r\ngantt.getPrev = function (id) {\r\n  for (var i = 1; i < this._order.length; i++) {\r\n    if (this._order[i] == id)\r\n      return this._order[i - 1];\r\n  }\r\n  return null;\r\n};\r\n\r\ngantt._get_parent_id = function (task) {\r\n  var parent = this.config.root_id;\r\n  if (task) {\r\n    parent = task.parent;\r\n  }\r\n  return parent;\r\n};\r\n\r\ngantt.getParent = function (id) {\r\n  var task = null;\r\n  if (id.id !== undefined) {\r\n    task = id;\r\n  } else {\r\n    task = gantt.getTask(id);\r\n  }\r\n\r\n  return this._get_parent_id(task);\r\n};\r\n\r\n\r\ngantt.setParent = function (task, new_pid) {\r\n  task.parent = new_pid;\r\n};\r\n\r\ngantt.getSiblings = function (id) {\r\n  if (!this.isTaskExists(id)) {\r\n    return [];\r\n  }\r\n  var parent = this.getParent(id);\r\n  return this.getChildren(parent);\r\n};\r\ngantt.getNextSibling = function (id) {\r\n  var siblings = this.getSiblings(id);\r\n  for (var i = 0, len = siblings.length; i < len; i++) {\r\n    if (siblings[i] == id)\r\n      return siblings[i + 1] || null;\r\n  }\r\n  return null;\r\n};\r\ngantt.getPrevSibling = function (id) {\r\n  var siblings = this.getSiblings(id);\r\n  for (var i = 0, len = siblings.length; i < len; i++) {\r\n    if (siblings[i] == id)\r\n      return siblings[i - 1] || null;\r\n  }\r\n  return null;\r\n};\r\n\r\ngantt._dp_init = function (dp) {\r\n  dp.setTransactionMode(\"POST\", true);\r\n  dp.serverProcessor += (dp.serverProcessor.indexOf(\"?\") != -1 ? \"&\" : \"?\") + \"editing=true\";\r\n  dp._serverProcessor = dp.serverProcessor;\r\n\r\n  dp.styles = {\r\n    updated: \"gantt_updated\",\r\n    order: \"gantt_updated\",\r\n    inserted: \"gantt_inserted\",\r\n    deleted: \"gantt_deleted\",\r\n    invalid: \"gantt_invalid\",\r\n    error: \"gantt_error\",\r\n    clear: \"\"\r\n  };\r\n\r\n  dp._methods = [\"_row_style\", \"setCellTextStyle\", \"_change_id\", \"_delete_task\"];\r\n\r\n  dp.setGanttMode = function (mode) {\r\n    var modes = dp.modes || {};\r\n    if (dp._ganttMode) {\r\n      modes[dp._ganttMode] = {\r\n        _in_progress: dp._in_progress,\r\n        _invalid: dp._invalid,\r\n        updatedRows: dp.updatedRows\r\n      };\r\n    }\r\n\r\n    var newState = modes[mode];\r\n    if (!newState) {\r\n      newState = modes[mode] = {\r\n        _in_progress: {},\r\n        _invalid: {},\r\n        updatedRows: []\r\n      };\r\n    }\r\n    dp._in_progress = newState._in_progress;\r\n    dp._invalid = newState._invalid;\r\n    dp.updatedRows = newState.updatedRows;\r\n    dp.modes = modes;\r\n    dp._ganttMode = mode;\r\n  };\r\n\r\n  this._sendTaskOrder = function (id, item) {\r\n    if (item.$drop_target) {\r\n      dp.setGanttMode(\"tasks\");\r\n      this.getTask(id).target = item.$drop_target;\r\n      dp.setUpdated(id, true, \"order\");\r\n      delete this.getTask(id).$drop_target;\r\n    }\r\n  };\r\n  this.attachEvent(\"onAfterTaskAdd\", function (id, item) {\r\n    dp.setGanttMode(\"tasks\");\r\n    dp.setUpdated(id, true, \"inserted\");\r\n  });\r\n  this.attachEvent(\"onAfterTaskUpdate\", function (id, item) {\r\n    dp.setGanttMode(\"tasks\");\r\n    dp.setUpdated(id, true);\r\n\r\n    gantt._sendTaskOrder(id, item);\r\n  });\r\n\r\n  function clientSideDelete(id) {\r\n    var updated = dp.updatedRows.slice();\r\n    var clientOnly = false;\r\n\r\n    for (var i = 0; i < updated.length && !dp._in_progress[id]; i++) {\r\n      if (updated[i] == id) {\r\n        if (gantt.getUserData(id, \"!nativeeditor_status\") == \"inserted\") {\r\n          clientOnly = true;\r\n        }\r\n        dp.setUpdated(id, false);\r\n      }\r\n    }\r\n    return clientOnly;\r\n  }\r\n\r\n  this.attachEvent(\"onAfterTaskDelete\", function (id, item) {\r\n    dp.setGanttMode(\"tasks\");\r\n\r\n    // not send delete request if item is not inserted into the db - just remove it from the client\r\n    var needDbDelete = !clientSideDelete(id);\r\n    if (!needDbDelete)\r\n      return;\r\n\r\n    dp.setUpdated(id, true, \"deleted\");\r\n\r\n    if (dp.updateMode != 'off' && !dp._tSend) {\r\n      dp.sendAllData();\r\n    }\r\n\r\n  });\r\n\r\n  this.attachEvent(\"onAfterLinkUpdate\", function (id, item) {\r\n    dp.setGanttMode(\"links\");\r\n    dp.setUpdated(id, true);\r\n  });\r\n  this.attachEvent(\"onAfterLinkAdd\", function (id, item) {\r\n    dp.setGanttMode(\"links\");\r\n    dp.setUpdated(id, true, \"inserted\");\r\n  });\r\n  this.attachEvent(\"onAfterLinkDelete\", function (id, item) {\r\n    dp.setGanttMode(\"links\");\r\n\r\n    var needDbDelete = !clientSideDelete(id);\r\n    if (!needDbDelete)\r\n      return;\r\n\r\n    dp.setUpdated(id, true, \"deleted\");\r\n  });\r\n  this.attachEvent(\"onRowDragEnd\", function (id, target) {\r\n    gantt._sendTaskOrder(id, gantt.getTask(id));\r\n  });\r\n\r\n\r\n  var tasks = null,\r\n      links = null;\r\n  this.attachEvent(\"onTaskIdChange\", function (oldId, newId) {\r\n    if (!dp._waitMode) return;\r\n\r\n    var children = gantt.getChildren(newId);\r\n    if (children.length) {\r\n      tasks = tasks || {};\r\n\r\n      for (var i = 0; i < children.length; i++) {\r\n        var ch = this.getTask(children[i]);\r\n        tasks[ch.id] = ch;\r\n      }\r\n    }\r\n\r\n    var item = this.getTask(newId),\r\n        itemLinks = this._get_task_links(item);\r\n\r\n    if (itemLinks.length) {\r\n      links = links || {};\r\n\r\n      for (var i = 0; i < itemLinks.length; i++) {\r\n        var link = this.getLink(itemLinks[i]);\r\n        links[link.id] = link;\r\n      }\r\n    }\r\n  });\r\n\r\n  dp.attachEvent(\"onAfterUpdateFinish\", function () {\r\n    if (tasks || links) {\r\n      gantt.batchUpdate(function () {\r\n        for (var id in tasks) {\r\n          gantt.updateTask(tasks[id].id);\r\n        }\r\n\r\n        for (var id in links) {\r\n          gantt.updateLink(links[id].id);\r\n        }\r\n        tasks = null;\r\n        links = null;\r\n      });\r\n      if (tasks) {\r\n        gantt._dp.setGanttMode(\"tasks\");\r\n      } else {\r\n        gantt._dp.setGanttMode(\"links\");\r\n      }\r\n    }\r\n  });\r\n\r\n  dp.attachEvent(\"onBeforeDataSending\", function () {\r\n    var url = this._serverProcessor;\r\n    if (this._tMode == \"REST\") {\r\n      var mode = this._ganttMode.substr(0, this._ganttMode.length - 1);// links, tasks -> /link/id, /task/id\r\n\r\n      url = url.substring(0, url.indexOf(\"?\") > -1 ? url.indexOf(\"?\") : url.length);\r\n      //editing=true&\r\n      this.serverProcessor = url + (url.slice(-1) == \"/\" ? \"\" : \"/\") + mode;\r\n    } else {\r\n      this.serverProcessor = url + gantt._urlSeparator(url) + \"gantt_mode=\" + this._ganttMode;\r\n    }\r\n\r\n    return true;\r\n  });\r\n\r\n  this._init_dp_live_update_hooks(dp);\r\n\r\n  var afterUpdate = dp.afterUpdate;\r\n  dp.afterUpdate = function () {\r\n    var xml;\r\n    if (arguments.length == 3) {\r\n      xml = arguments[1];\r\n    } else {\r\n      // old dataprocessor\r\n      xml = arguments[4];\r\n    }\r\n    var mode = dp._ganttMode;\r\n    var reqUrl = xml.filePath;\r\n\r\n    if (this._tMode != \"REST\") {\r\n      if (reqUrl.indexOf(\"gantt_mode=links\") != -1) {\r\n        mode = \"links\";\r\n      } else {\r\n        mode = \"tasks\";\r\n      }\r\n    } else {\r\n      if (reqUrl.indexOf(\"/link\") > reqUrl.indexOf(\"/task\")) {\r\n        mode = \"links\";\r\n      } else {\r\n        mode = \"tasks\";\r\n      }\r\n    }\r\n    dp.setGanttMode(mode);\r\n\r\n    var res = afterUpdate.apply(dp, arguments);\r\n    dp.setGanttMode(mode);\r\n    return res;\r\n  };\r\n\r\n  dp._getRowData = gantt.bind(function (id, pref) {\r\n    var task;\r\n    if (dp._ganttMode == \"tasks\")\r\n      task = this.isTaskExists(id) ? this.getTask(id) : {id: id};\r\n    else\r\n      task = this.isLinkExists(id) ? this.getLink(id) : {id: id};\r\n\r\n    task = gantt.copy(task);\r\n\r\n    var data = {};\r\n    for (var key in task) {\r\n      if (key.substr(0, 1) == \"$\") continue;\r\n      var value = task[key];\r\n      if (value instanceof Date)\r\n        data[key] = this.templates.xml_format(value);\r\n      else if (value === null)\r\n        data[key] = \"\";\r\n      else\r\n        data[key] = value;\r\n    }\r\n\r\n    var taskTiming = this._get_task_timing_mode(task);\r\n    if (taskTiming.$no_start) {\r\n      task.start_date = \"\";\r\n      task.duration = \"\";\r\n    }\r\n    if (taskTiming.$no_end) {\r\n      task.end_date = \"\";\r\n      task.duration = \"\";\r\n    }\r\n    data[dp.action_param] = this.getUserData(id, dp.action_param);\r\n    return data;\r\n  }, this);\r\n\r\n  this._change_id = gantt.bind(function (oldid, newid) {\r\n    if (dp._ganttMode != \"tasks\")\r\n      this.changeLinkId(oldid, newid);\r\n    else\r\n      this.changeTaskId(oldid, newid);\r\n  }, this);\r\n\r\n  this._row_style = function (row_id, classname) {\r\n    if (dp._ganttMode != \"tasks\") return;\r\n    if (!gantt.isTaskExists(row_id))\r\n      return;\r\n\r\n    var task = gantt.getTask(row_id);\r\n    task.$dataprocessor_class = classname;\r\n    gantt.refreshTask(row_id);\r\n  };\r\n\r\n  // fake method for dataprocessor\r\n  this._delete_task = function (row_id, node) {\r\n  };\r\n\r\n  this._dp = dp;\r\n};\r\n\r\n\r\ngantt.getUserData = function (id, name) {\r\n  if (!this.userdata) this.userdata = {};\r\n  if (this.userdata[id] && this.userdata[id][name]) return this.userdata[id][name];\r\n  return \"\";\r\n};\r\ngantt.setUserData = function (id, name, value) {\r\n  if (!this.userdata) this.userdata = {};\r\n  if (!this.userdata[id]) this.userdata[id] = {};\r\n  this.userdata[id][name] = value;\r\n};\r\n\r\n\r\ngantt._init_link = function (link) {\r\n  if (!gantt.defined(link.id))\r\n    link.id = gantt.uid();\r\n  return link;\r\n};\r\n\r\ngantt._sync_links = function () {\r\n\r\n  var task = null;\r\n  for (var i = 0, len = this._order_full.length; i < len; i++) {\r\n    task = this._pull[this._order_full[i]];\r\n    task.$source = [];\r\n    task.$target = [];\r\n  }\r\n  this._links = [];\r\n\r\n  for (var id in this._lpull) {\r\n\r\n    var link = this._lpull[id];\r\n\r\n    this._links.push(link);\r\n    if (this._pull[link.source])\r\n      this._pull[link.source].$source.push(id);\r\n    if (this._pull[link.target])\r\n      this._pull[link.target].$target.push(id);\r\n  }\r\n};\r\n\r\ngantt.getLink = function (id) {\r\n  gantt.assert(this._lpull[id], \"Link doesn't exist\");\r\n  return this._lpull[id];\r\n};\r\n\r\ngantt._get_linked_task = function (link, getTarget) {\r\n  var task = null;\r\n  var taskId = getTarget ? link.target : link.source;\r\n\r\n  if (gantt.isTaskExists(taskId)) {\r\n    task = gantt.getTask(taskId);\r\n  }\r\n  var role = getTarget ? \"target\" : \"source\";\r\n  gantt.assert(task, \"Link \" + role + \" not found. Task id=\" + taskId + \", link id=\" + link.id);\r\n  return task;\r\n};\r\ngantt._get_link_target = function (link) {\r\n  return gantt._get_linked_task(link, true);\r\n};\r\n\r\ngantt._get_link_source = function (link) {\r\n  return gantt._get_linked_task(link, false);\r\n};\r\n\r\ngantt.getLinks = function () {\r\n  var links = [];\r\n  for (var key in gantt._lpull)\r\n    links.push(gantt._lpull[key]);\r\n  return links;\r\n};\r\n\r\ngantt.isLinkExists = function (id) {\r\n  return gantt.defined(this._lpull[id]);\r\n};\r\n\r\ngantt.addLink = function (link) {\r\n  link = this._init_link(link);\r\n\r\n  if (this.callEvent(\"onBeforeLinkAdd\", [link.id, link]) === false) return false;\r\n\r\n  this._lpull[link.id] = link;\r\n  this._sync_links();\r\n  this._render_link(link.id);\r\n  this.callEvent(\"onAfterLinkAdd\", [link.id, link]);\r\n  return link.id;\r\n};\r\n\r\ngantt.updateLink = function (id, data) {\r\n  if (!gantt.defined(data))\r\n    data = this.getLink(id);\r\n\r\n  if (this.callEvent(\"onBeforeLinkUpdate\", [id, data]) === false) return false;\r\n\r\n  this._lpull[id] = data;\r\n  this._sync_links();\r\n  this._render_link(id);\r\n  this.callEvent(\"onAfterLinkUpdate\", [id, data]);\r\n  return true;\r\n};\r\n\r\ngantt.deleteLink = function (id) {\r\n  return this._deleteLink(id);\r\n};\r\n\r\ngantt._deleteLink = function (id, silent) {\r\n  var link = this.getLink(id);\r\n  if (!silent && this.callEvent(\"onBeforeLinkDelete\", [id, link]) === false) return false;\r\n\r\n  delete this._lpull[id];\r\n  this._sync_links();\r\n  this.refreshLink(id);\r\n  if (!silent) this.callEvent(\"onAfterLinkDelete\", [id, link]);\r\n  return true;\r\n};\r\n\r\ngantt.changeLinkId = function (oldid, newid) {\r\n  if (this._lpull[oldid]) {\r\n    this._lpull[newid] = this._lpull[oldid];\r\n    this._lpull[newid].id = newid;\r\n    delete this._lpull[oldid];\r\n\r\n    this._sync_links();\r\n    this.callEvent(\"onLinkIdChange\", [oldid, newid]);\r\n  }\r\n};\r\n\r\n\r\ngantt.getChildren = function (id) {\r\n  return gantt.defined(this._branches[id]) ? this._branches[id] : [];\r\n};\r\ngantt.hasChild = function (id) {\r\n  return (gantt.defined(this._branches[id]) && this._branches[id].length);\r\n};\r\n\r\n\r\ngantt.refreshData = function () {\r\n  this._render_data();\r\n};\r\n\r\ngantt._isTask = function (task) {\r\n  var taskTiming = this._get_task_timing_mode(task);\r\n  return (!task.type || task.type != gantt.config.types.project) && !(taskTiming.$no_start || taskTiming.$no_end);\r\n};\r\n\r\ngantt._isProject = function (task) {\r\n  return !this._isTask(task);\r\n};\r\ngantt._configure = function (col, data, force) {\r\n  for (var key in data)\r\n    if (typeof col[key] == \"undefined\" || force)\r\n      col[key] = data[key];\r\n};\r\ngantt._init_skin = function () {\r\n  gantt._get_skin(false);\r\n  gantt._init_skin = function () {\r\n  };\r\n};\r\ngantt._get_skin = function (force) {\r\n  var skin = gantt.skin;\r\n  if (!skin || force) {\r\n    var links = document.getElementsByTagName(\"link\");\r\n    for (var i = 0; i < links.length; i++) {\r\n      var res = links[i].href.match(\"dhtmlxgantt_([a-z\\_]+).css\");\r\n      if (res) {\r\n        if (gantt.skins[res[1]] || !skin) {\r\n          skin = res[1];\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  gantt.skin = skin || \"terrace\";\r\n  var skinset = gantt.skins[gantt.skin] || gantt.skins[\"terrace\"];\r\n\r\n  //apply skin related settings\r\n  this._configure(gantt.config, skinset.config, force);\r\n\r\n  var config = gantt.getGridColumns();\r\n  if (config[1] && typeof config[1].width == \"undefined\")\r\n    config[1].width = skinset._second_column_width;\r\n  if (config[2] && typeof config[2].width == \"undefined\")\r\n    config[2].width = skinset._third_column_width;\r\n\r\n  if (skinset._lightbox_template)\r\n    gantt._lightbox_template = skinset._lightbox_template;\r\n\r\n  gantt.resetLightbox();\r\n};\r\ngantt.resetSkin = function () {\r\n  this.skin = \"\";\r\n  this._get_skin(true);\r\n};\r\ngantt.skins = {};\r\n\r\n\r\ngantt._lightbox_methods = {};\r\ngantt._lightbox_template = \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>\";\r\n\r\ngantt.showLightbox = function (id) {\r\n  if (!id || gantt._is_readonly(this.getTask(id))) return;\r\n  if (!this.callEvent(\"onBeforeLightbox\", [id])) return;\r\n\r\n  var task = this.getTask(id);\r\n\r\n  var box = this.getLightbox(this._get_safe_type(task.type));\r\n  this._center_lightbox(box);\r\n  this.showCover();\r\n  this._fill_lightbox(id, box);\r\n\r\n  this._waiAria.lightboxVisibleAttr(box);\r\n\r\n  this.callEvent(\"onLightbox\", [id]);\r\n};\r\ngantt._get_timepicker_step = function () {\r\n  if (this.config.round_dnd_dates) {\r\n    var scale = gantt._tasks,\r\n        step = (this._get_line(scale.unit) * scale.step) / 60;//timepicker step is measured in minutes\r\n    if (step >= 60 * 24 || !this._is_chart_visible()) {\r\n      step = this.config.time_step;\r\n    }\r\n    return step;\r\n  }\r\n  return this.config.time_step;\r\n};\r\ngantt.getLabel = function (property, key) {\r\n  var sections = this._get_typed_lightbox_config();\r\n  for (var i = 0; i < sections.length; i++) {\r\n    if (sections[i].map_to == property) {\r\n      var options = sections[i].options;\r\n      for (var j = 0; j < options.length; j++) {\r\n        if (options[j].key == key) {\r\n          return options[j].label;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return \"\";\r\n};\r\n\r\ngantt.updateCollection = function (list_name, collection) {\r\n  collection = collection.slice(0);\r\n  var list = gantt.serverList(list_name);\r\n  if (!list) return false;\r\n  list.splice(0, list.length);\r\n  list.push.apply(list, collection || []);\r\n  gantt.resetLightbox();\r\n};\r\ngantt.getLightboxType = function () {\r\n  return this._get_safe_type(this._lightbox_type);\r\n};\r\ngantt.getLightbox = function (type) {\r\n  if (type === undefined)\r\n    type = this.getLightboxType();\r\n\r\n  if (!this._lightbox || this.getLightboxType() != this._get_safe_type(type)) {\r\n    this._lightbox_type = this._get_safe_type(type);\r\n    var d = document.createElement(\"DIV\");\r\n    d.className = \"gantt_cal_light\";\r\n\r\n    var full_width = this._is_lightbox_timepicker();\r\n    if (gantt.config.wide_form || full_width)\r\n      d.className += \" gantt_cal_light_wide\";\r\n\r\n    if (full_width) {\r\n      gantt.config.wide_form = true;\r\n      d.className += \" gantt_cal_light_full\";\r\n    }\r\n\r\n\r\n    d.style.visibility = \"hidden\";\r\n\r\n    var html = this._lightbox_template;\r\n\r\n    var ariaAttr;\r\n    var buttons = this.config.buttons_left;\r\n    for (var i = 0; i < buttons.length; i++) {\r\n      // needed to migrate from 'dhx_something' to 'gantt_something' naming in a lightbox\r\n      var button = this.config._migrate_buttons[buttons[i]] ? this.config._migrate_buttons[buttons[i]] : buttons[i];\r\n\r\n      ariaAttr = this._waiAria.lightboxButtonAttrString(button);\r\n      html += \"<div \" + ariaAttr + \" class='gantt_btn_set gantt_left_btn_set \" + button + \"_set'><div dhx_button='1' class='\" + button + \"'></div><div>\" + this.locale.labels[button] + \"</div></div>\";\r\n\r\n    }\r\n    buttons = this.config.buttons_right;\r\n    for (var i = 0; i < buttons.length; i++) {\r\n      var button = this.config._migrate_buttons[buttons[i]] ? this.config._migrate_buttons[buttons[i]] : buttons[i];\r\n      ariaAttr = this._waiAria.lightboxButtonAttrString(button);\r\n\r\n      html += \"<div \" + ariaAttr + \" class='gantt_btn_set gantt_right_btn_set \" + button + \"_set' style='float:right;'><div dhx_button='1' class='\" + button + \"'></div><div>\" + this.locale.labels[button] + \"</div></div>\";\r\n\r\n    }\r\n    html += \"</div>\";\r\n    d.innerHTML = html;\r\n\r\n    gantt._waiAria.lightboxAttr(d);\r\n\r\n    if (gantt.config.drag_lightbox) {\r\n      d.firstChild.onmousedown = gantt._ready_to_dnd;\r\n      d.firstChild.onselectstart = function () {\r\n        return false;\r\n      };\r\n      d.firstChild.style.cursor = \"pointer\";\r\n      gantt._init_dnd_events();\r\n\r\n    }\r\n\r\n    document.body.insertBefore(d, document.body.firstChild);\r\n    this._lightbox = d;\r\n\r\n    var sns = this._get_typed_lightbox_config(type);\r\n    html = this._render_sections(sns);\r\n\r\n    var ds = d.getElementsByTagName(\"div\");\r\n    for (var i = 0; i < ds.length; i++) {\r\n      var t_ds = ds[i];\r\n      if (t_ds.className == \"gantt_cal_larea\") {\r\n        t_ds.innerHTML = html;\r\n        break;\r\n      }\r\n    }\r\n\r\n    // bind labels to lightbox inputs\r\n    for (var i = 0; i < sns.length; i++) {\r\n      var section = sns[i];\r\n      if (!section.id || !document.getElementById(section.id))\r\n        continue;\r\n\r\n      var labelBlock = document.getElementById(section.id);\r\n      var label = labelBlock.querySelector(\"label\");\r\n      var inputBlock = labelBlock.nextSibling;\r\n      if (!inputBlock)\r\n        continue;\r\n\r\n      var input = inputBlock.querySelector(\"input, select, textarea\");\r\n      if (input) {\r\n        section.inputId = input.id || \"input_\" + gantt.uid();\r\n        if (!input.id)\r\n          input.id = section.inputId;\r\n\r\n        label.setAttribute(\"for\", section.inputId);\r\n      }\r\n    }\r\n\r\n    //sizes\r\n    this.resizeLightbox();\r\n\r\n    this._init_lightbox_events(this);\r\n    d.style.display = \"none\";\r\n    d.style.visibility = \"visible\";\r\n  }\r\n  return this._lightbox;\r\n};\r\n\r\ngantt._render_sections = function (sns) {\r\n  var html = \"\";\r\n  for (var i = 0; i < sns.length; i++) {\r\n    var block = this.form_blocks[sns[i].type];\r\n    if (!block) continue; //ignore incorrect blocks\r\n    sns[i].id = \"area_\" + this.uid();\r\n\r\n    var display = sns[i].hidden ? \" style='display:none'\" : \"\";\r\n    var button = \"\";\r\n    if (sns[i].button) {\r\n      button = \"<div class='gantt_custom_button' index='\" + i + \"'><div class='gantt_custom_button_\" + sns[i].button + \"'></div><div class='gantt_custom_button_label'>\" + this.locale.labels[\"button_\" + sns[i].button] + \"</div></div>\";\r\n    }\r\n    if (this.config.wide_form) {\r\n      html += \"<div class='gantt_wrap_section' \" + display + \">\";\r\n    }\r\n    html += \"<div id='\" + sns[i].id + \"' class='gantt_cal_lsection'><label>\" + button + this.locale.labels[\"section_\" + sns[i].name] + \"</label></div>\" + block.render.call(this, sns[i]);\r\n    html += \"</div>\";\r\n  }\r\n  return html;\r\n};\r\n\r\n\r\ngantt.resizeLightbox = function () {\r\n  var d = this._lightbox;\r\n  if (!d) return;\r\n\r\n  var con = d.childNodes[1];\r\n  con.style.height = \"0px\";\r\n  con.style.height = con.scrollHeight + \"px\";\r\n  d.style.height = con.scrollHeight + this.config.lightbox_additional_height + \"px\";\r\n  con.style.height = con.scrollHeight + \"px\"; //it is incredible , how ugly IE can be\r\n\r\n\r\n};\r\n\r\ngantt._center_lightbox = function (box) {\r\n  if (box) {\r\n    box.style.display = \"block\";\r\n\r\n    var scroll_top = window.pageYOffset || document.body.scrollTop || document.documentElement.scrollTop;\r\n    var scroll_left = window.pageXOffset || document.body.scrollLeft || document.documentElement.scrollLeft;\r\n\r\n    var view_height = window.innerHeight || document.documentElement.clientHeight;\r\n\r\n    if (scroll_top) // if vertical scroll on window\r\n      box.style.top = Math.round(scroll_top + Math.max((view_height - box.offsetHeight) / 2, 0)) + \"px\";\r\n    else // vertical scroll on body\r\n      box.style.top = Math.round(Math.max(((view_height - box.offsetHeight) / 2), 0) + 9) + \"px\"; // +9 for compatibility with auto tests\r\n\r\n    // not quite accurate but used for compatibility reasons\r\n    if (document.documentElement.scrollWidth > document.body.offsetWidth) // if horizontal scroll on the window\r\n      box.style.left = Math.round(scroll_left + (document.body.offsetWidth - box.offsetWidth) / 2) + \"px\";\r\n    else // horizontal scroll on the body\r\n      box.style.left = Math.round((document.body.offsetWidth - box.offsetWidth) / 2) + \"px\";\r\n  }\r\n};\r\ngantt.showCover = function () {\r\n  if (this._cover) return;\r\n\r\n  this._cover = document.createElement(\"DIV\");\r\n  this._cover.className = \"gantt_cal_cover\";\r\n  var _document_height = ((document.height !== undefined) ? document.height : document.body.offsetHeight);\r\n  var _scroll_height = ((document.documentElement) ? document.documentElement.scrollHeight : 0);\r\n  this._cover.style.height = Math.max(_document_height, _scroll_height) + 'px';\r\n  document.body.appendChild(this._cover);\r\n};\r\n\r\n\r\ngantt._init_lightbox_events = function () {\r\n  gantt.lightbox_events = {};\r\n\r\n\r\n  gantt.lightbox_events[\"gantt_save_btn\"] = function (e) {\r\n    gantt._save_lightbox();\r\n  };\r\n\r\n\r\n  gantt.lightbox_events[\"gantt_delete_btn\"] = function (e) {\r\n    if (!gantt.callEvent(\"onLightboxDelete\", [gantt._lightbox_id]))\r\n      return;\r\n\r\n    if (gantt.isTaskExists(gantt._lightbox_id)) {\r\n      gantt.$click.buttons[\"delete\"](gantt._lightbox_id);\r\n    } else {\r\n      gantt.hideLightbox();\r\n    }\r\n\r\n  };\r\n\r\n\r\n  gantt.lightbox_events[\"gantt_cancel_btn\"] = function (e) {\r\n    gantt._cancel_lightbox();\r\n  };\r\n\r\n\r\n  gantt.lightbox_events[\"default\"] = function (e, src) {\r\n    if (src.getAttribute(\"dhx_button\")) {\r\n      gantt.callEvent(\"onLightboxButton\", [src.className, src, e]);\r\n    } else {\r\n      var index, block, sec;\r\n\r\n      var className = gantt._getClassName(src);\r\n      if (className.indexOf(\"gantt_custom_button\") != -1) {\r\n        if (className.indexOf(\"gantt_custom_button_\") != -1) {\r\n          index = src.parentNode.getAttribute(\"index\");\r\n          sec = src;\r\n          while (sec && gantt._getClassName(sec).indexOf(\"gantt_cal_lsection\") == -1) {\r\n            sec = sec.parentNode;\r\n          }\r\n        } else {\r\n          index = src.getAttribute(\"index\");\r\n          sec = src.parentNode;\r\n          src = src.firstChild;\r\n        }\r\n      }\r\n\r\n      var sections = gantt._get_typed_lightbox_config();\r\n\r\n      if (index) {\r\n        index = index * 1;\r\n        block = gantt.form_blocks[sections[index * 1].type];\r\n        block.button_click(index, src, sec, sec.nextSibling);\r\n      }\r\n    }\r\n  };\r\n  this.event(gantt.getLightbox(), \"click\", function (e) {\r\n    e = e || window.event;\r\n    var src = e.target ? e.target : e.srcElement;\r\n\r\n    var className = gantt._getClassName(src);\r\n    if (!className) {\r\n      src = src.previousSibling;\r\n      className = gantt._getClassName(src);\r\n    }\r\n    if (src && className && className.indexOf(\"gantt_btn_set\") === 0) {\r\n      src = src.firstChild;\r\n      className = gantt._getClassName(src);\r\n    }\r\n    if (src && className) {\r\n      var func = gantt.defined(gantt.lightbox_events[src.className]) ? gantt.lightbox_events[src.className] : gantt.lightbox_events[\"default\"];\r\n      return func(e, src);\r\n    }\r\n    return false;\r\n  });\r\n\r\n  gantt.getLightbox().onkeydown = function (e) {\r\n    var event = e || window.event;\r\n    var target = e.target || e.srcElement;\r\n    var buttonTarget = !!(gantt._getClassName(target).indexOf(\"gantt_btn_set\") > -1);\r\n\r\n    switch ((e || event).keyCode) {\r\n      case 32: {//space\r\n        if ((e || event).shiftKey) return;\r\n        if (buttonTarget && target.click) {\r\n          target.click();\r\n        }\r\n        break;\r\n      }\r\n      case gantt.keys.edit_save:\r\n        if ((e || event).shiftKey) return;\r\n        if (buttonTarget && target.click) {\r\n          target.click();\r\n        } else {\r\n          gantt._save_lightbox();\r\n        }\r\n        break;\r\n      case gantt.keys.edit_cancel:\r\n        gantt._cancel_lightbox();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  };\r\n};\r\n\r\ngantt._cancel_lightbox = function () {\r\n  var task = this.getLightboxValues();\r\n  this.callEvent(\"onLightboxCancel\", [this._lightbox_id, task.$new]);\r\n  if (gantt.isTaskExists(task.id) && task.$new) {\r\n    this._deleteTask(task.id, true);\r\n  }\r\n\r\n  this.refreshData();\r\n  this.hideLightbox();\r\n};\r\n\r\ngantt._save_lightbox = function () {\r\n  var task = this.getLightboxValues();\r\n  if (!this.callEvent(\"onLightboxSave\", [this._lightbox_id, task, !!task.$new]))\r\n    return;\r\n\r\n  if (task.$new) {\r\n    delete task.$new;\r\n    this._replace_branch_child(this.getParent(task.id), task.id);\r\n\r\n    this.addTask(task);\r\n  } else if (this.isTaskExists(task.id)) {\r\n    this.mixin(this.getTask(task.id), task, true);\r\n    this.updateTask(task.id);\r\n  }\r\n  this.refreshData();\r\n\r\n  // TODO: do we need any blockable events here to prevent closing lightbox?\r\n  this.hideLightbox();\r\n};\r\n\r\ngantt._resolve_default_mapping = function (section) {\r\n  var mapping = section.map_to;\r\n  var time_controls = {\"time\": true, \"time_optional\": true, \"duration\": true, \"duration_optional\": true};\r\n  if (time_controls[section.type]) {\r\n    if (section.map_to == 'auto') {\r\n      mapping = {start_date: \"start_date\", end_date: \"end_date\", duration: \"duration\"};\r\n    } else if (typeof(section.map_to) === \"string\") {\r\n      mapping = {start_date: section.map_to};\r\n    }\r\n  }\r\n\r\n  return mapping;\r\n};\r\n\r\ngantt.getLightboxValues = function () {\r\n  var task = {};\r\n\r\n  if (gantt.isTaskExists(this._lightbox_id)) {\r\n    task = this.mixin({}, this.getTask(this._lightbox_id));\r\n  }\r\n\r\n  var sns = this._get_typed_lightbox_config();\r\n  for (var i = 0; i < sns.length; i++) {\r\n    var node = document.getElementById(sns[i].id);\r\n    node = (node ? node.nextSibling : node);\r\n    var block = this.form_blocks[sns[i].type];\r\n    if (!block) continue;\r\n    var res = block.get_value.call(this, node, task, sns[i]);\r\n    var map_to = gantt._resolve_default_mapping(sns[i]);\r\n    if (typeof map_to == \"string\" && map_to != \"auto\") {\r\n      task[map_to] = res;\r\n    } else if (typeof map_to == \"object\") {\r\n      for (var property in map_to) {\r\n        if (map_to[property])\r\n          task[map_to[property]] = res[property];\r\n      }\r\n    }\r\n  }\r\n  return task;\r\n};\r\n\r\n\r\ngantt.hideLightbox = function () {\r\n  var box = this.getLightbox();\r\n  if (box) box.style.display = \"none\";\r\n\r\n  this._waiAria.lightboxHiddenAttr(box);\r\n  this._lightbox_id = null;\r\n\r\n  this.hideCover();\r\n  this.callEvent(\"onAfterLightbox\", []);\r\n};\r\ngantt.hideCover = function () {\r\n  if (this._cover)\r\n    this._cover.parentNode.removeChild(this._cover);\r\n  this._cover = null;\r\n};\r\n\r\ngantt.resetLightbox = function () {\r\n  if (gantt._lightbox && !gantt._custom_lightbox)\r\n    gantt._lightbox.parentNode.removeChild(gantt._lightbox);\r\n  gantt._lightbox = null;\r\n};\r\ngantt._set_lightbox_values = function (data, box) {\r\n  var task = data;\r\n  var s = box.getElementsByTagName(\"span\");\r\n  var lightboxHeader = [];\r\n  if (gantt.templates.lightbox_header) {\r\n    lightboxHeader.push(\"\");\r\n    lightboxHeader.push(gantt.templates.lightbox_header(task.start_date, task.end_date, task));\r\n    s[1].innerHTML = \"\";\r\n    s[2].innerHTML = gantt.templates.lightbox_header(task.start_date, task.end_date, task);\r\n  } else {\r\n    lightboxHeader.push(this.templates.task_time(task.start_date, task.end_date, task));\r\n    lightboxHeader.push((this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70)); //IE6 fix\r\n    s[1].innerHTML = this.templates.task_time(task.start_date, task.end_date, task);\r\n    s[2].innerHTML = (this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70); //IE6 fix\r\n  }\r\n  s[1].innerHTML = lightboxHeader[0];\r\n  s[2].innerHTML = lightboxHeader[1];\r\n\r\n  gantt._waiAria.lightboxHeader(box, lightboxHeader.join(\" \"));\r\n\r\n  var sns = this._get_typed_lightbox_config(this.getLightboxType());\r\n  for (var i = 0; i < sns.length; i++) {\r\n    var section = sns[i];\r\n\r\n    if (!this.form_blocks[section.type]) {\r\n      continue;//skip incorrect sections, same check is done during rendering\r\n    }\r\n\r\n\r\n    var node = document.getElementById(section.id).nextSibling;\r\n    var block = this.form_blocks[section.type];\r\n    var map_to = gantt._resolve_default_mapping(sns[i]);\r\n    var value = this.defined(task[map_to]) ? task[map_to] : section.default_value;\r\n    block.set_value.call(gantt, node, value, task, section);\r\n\r\n    if (section.focus)\r\n      block.focus.call(gantt, node);\r\n  }\r\n  if (data.id)\r\n    gantt._lightbox_id = data.id;\r\n};\r\ngantt._fill_lightbox = function (id, box) {\r\n  var task = this.getTask(id);\r\n  this._set_lightbox_values(task, box);\r\n};\r\n\r\n\r\ngantt.getLightboxSection = function (name) {\r\n  var config = this._get_typed_lightbox_config();\r\n  var i = 0;\r\n  for (i; i < config.length; i++)\r\n    if (config[i].name == name)\r\n      break;\r\n  var section = config[i];\r\n  if (!section)\r\n    return null;\r\n\r\n  if (!this._lightbox)\r\n    this.getLightbox();\r\n  var header = document.getElementById(section.id);\r\n  var node = header.nextSibling;\r\n\r\n  var result = {\r\n    section: section,\r\n    header: header,\r\n    node: node,\r\n    getValue: function (ev) {\r\n      return gantt.form_blocks[section.type].get_value.call(gantt, node, (ev || {}), section);\r\n    },\r\n    setValue: function (value, ev) {\r\n      return gantt.form_blocks[section.type].set_value.call(gantt, node, value, (ev || {}), section);\r\n    }\r\n  };\r\n\r\n  var handler = this._lightbox_methods[\"get_\" + section.type + \"_control\"];\r\n  return handler ? handler(result) : result;\r\n};\r\n\r\ngantt._lightbox_methods.get_template_control = function (result) {\r\n  result.control = result.node;\r\n  return result;\r\n};\r\ngantt._lightbox_methods.get_select_control = function (result) {\r\n  result.control = result.node.getElementsByTagName('select')[0];\r\n  return result;\r\n};\r\ngantt._lightbox_methods.get_textarea_control = function (result) {\r\n  result.control = result.node.getElementsByTagName('textarea')[0];\r\n  return result;\r\n};\r\ngantt._lightbox_methods.get_time_control = function (result) {\r\n  result.control = result.node.getElementsByTagName('select'); // array\r\n  return result;\r\n};\r\n\r\n\r\ngantt._init_dnd_events = function () {\r\n  this.event(document.body, \"mousemove\", gantt._move_while_dnd);\r\n  this.event(document.body, \"mouseup\", gantt._finish_dnd);\r\n  gantt._init_dnd_events = function () {\r\n  };\r\n};\r\ngantt._move_while_dnd = function (e) {\r\n  if (gantt._dnd_start_lb) {\r\n    if (!document.gantt_unselectable) {\r\n      document.body.className += \" gantt_unselectable\";\r\n      document.gantt_unselectable = true;\r\n    }\r\n    var lb = gantt.getLightbox();\r\n    var now = (e && e.target) ? [e.pageX, e.pageY] : [event.clientX, event.clientY];\r\n    lb.style.top = gantt._lb_start[1] + now[1] - gantt._dnd_start_lb[1] + \"px\";\r\n    lb.style.left = gantt._lb_start[0] + now[0] - gantt._dnd_start_lb[0] + \"px\";\r\n  }\r\n};\r\ngantt._ready_to_dnd = function (e) {\r\n  var lb = gantt.getLightbox();\r\n  gantt._lb_start = [parseInt(lb.style.left, 10), parseInt(lb.style.top, 10)];\r\n  gantt._dnd_start_lb = (e && e.target) ? [e.pageX, e.pageY] : [event.clientX, event.clientY];\r\n};\r\ngantt._finish_dnd = function () {\r\n  if (gantt._lb_start) {\r\n    gantt._lb_start = gantt._dnd_start_lb = false;\r\n    document.body.className = document.body.className.replace(\" gantt_unselectable\", \"\");\r\n    document.gantt_unselectable = false;\r\n  }\r\n};\r\n\r\n\r\ngantt._focus = function (node, select) {\r\n  if (node && node.focus) {\r\n    if (gantt.config.touch) {\r\n      //do not focus editor, to prevent auto-zoom\r\n    } else {\r\n      try {\r\n        if (select && node.select) node.select();\r\n        node.focus();\r\n      } catch (e) {\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n\r\ngantt.form_blocks = {\r\n  getTimePicker: function (sns, hidden) {\r\n    var time_format = sns.time_format;\r\n    if (!time_format) {\r\n      // default order\r\n      var time_format = [\"%d\", \"%m\", \"%Y\"];\r\n      if (gantt._get_line(gantt._tasks.unit) < gantt._get_line(\"day\")) {\r\n        time_format.push(\"%H:%i\");\r\n      }\r\n    }\r\n    // map: default order => real one\r\n    sns._time_format_order = {size: 0};\r\n\r\n\r\n    var cfg = this.config;\r\n    var dt = this.date.date_part(new Date(gantt._min_date.valueOf()));\r\n    var last = 24 * 60, first = 0;\r\n    if (gantt.config.limit_time_select) {\r\n      last = 60 * cfg.last_hour + 1;\r\n      first = 60 * cfg.first_hour;\r\n      dt.setHours(cfg.first_hour);\r\n    }\r\n    var html = \"\";\r\n\r\n    for (var p = 0; p < time_format.length; p++) {\r\n      var time_option = time_format[p];\r\n\r\n      // adding spaces between selects\r\n      if (p > 0) {\r\n        html += \" \";\r\n      }\r\n\r\n      var options = '';\r\n      switch (time_option) {\r\n        case \"%Y\":\r\n          sns._time_format_order[2] = p;\r\n          sns._time_format_order.size++;\r\n          //year\r\n\r\n          var range, offset, start_year, end_year;\r\n\r\n          if (sns.year_range) {\r\n            if (!isNaN(sns.year_range)) {\r\n              range = sns.year_range;\r\n            } else if (sns.year_range.push) {\r\n              // if\r\n              start_year = sns.year_range[0];\r\n              end_year = sns.year_range[1];\r\n            }\r\n          }\r\n\r\n          range = range || 10;\r\n          offset = offset || Math.floor(range / 2);\r\n          start_year = start_year || dt.getFullYear() - offset;\r\n          end_year = end_year || start_year + range;\r\n\r\n\r\n          for (var i = start_year; i < end_year; i++)\r\n            options += \"<option value='\" + (i) + \"'>\" + (i) + \"</option>\";\r\n          break;\r\n        case \"%m\":\r\n          sns._time_format_order[1] = p;\r\n          sns._time_format_order.size++;\r\n          //month\r\n          for (var i = 0; i < 12; i++)\r\n            options += \"<option value='\" + i + \"'>\" + this.locale.date.month_full[i] + \"</option>\";\r\n          break;\r\n        case \"%d\":\r\n          sns._time_format_order[0] = p;\r\n          sns._time_format_order.size++;\r\n          //days\r\n          for (var i = 1; i < 32; i++)\r\n            options += \"<option value='\" + i + \"'>\" + i + \"</option>\";\r\n          break;\r\n        case \"%H:%i\":\r\n          //  var last = 24*60, first = 0;\r\n          sns._time_format_order[3] = p;\r\n          sns._time_format_order.size++;\r\n          //hours\r\n          var i = first;\r\n          var tdate = dt.getDate();\r\n          sns._time_values = [];\r\n\r\n          while (i < last) {\r\n            var time = this.templates.time_picker(dt);\r\n            options += \"<option value='\" + i + \"'>\" + time + \"</option>\";\r\n            sns._time_values.push(i);\r\n            dt.setTime(dt.valueOf() + this._get_timepicker_step() * 60 * 1000);\r\n            var diff = (dt.getDate() != tdate) ? 1 : 0; // moved or not to the next day\r\n            i = diff * 24 * 60 + dt.getHours() * 60 + dt.getMinutes();\r\n          }\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      if (options) {\r\n\r\n        var ariaAttrs = gantt._waiAria.lightboxSelectAttrString(time_option);\r\n\r\n        var readonly = sns.readonly ? \"disabled='disabled'\" : \"\";\r\n        var display = hidden ? \" style='display:none' \" : \"\";\r\n        html += \"<select \" + readonly + display + ariaAttrs + \">\" + options + \"</select>\";\r\n      }\r\n    }\r\n    return html;\r\n  },\r\n  _fill_lightbox_select: function (s, i, d, map, cfg) {\r\n    s[i + map[0]].value = d.getDate();\r\n    s[i + map[1]].value = d.getMonth();\r\n    s[i + map[2]].value = d.getFullYear();\r\n    if (gantt.defined(map[3])) {\r\n      var v = d.getHours() * 60 + d.getMinutes();\r\n      v = Math.round(v / gantt._get_timepicker_step()) * gantt._get_timepicker_step();\r\n      var input = s[i + map[3]];\r\n      input.value = v;\r\n      //in case option not shown\r\n      input.setAttribute('data-value', v);\r\n    }\r\n  },\r\n  template: {\r\n    render: function (sns) {\r\n      var height = (sns.height || \"30\") + \"px\";\r\n      return \"<div class='gantt_cal_ltext gantt_cal_template' style='height:\" + height + \";'></div>\";\r\n    },\r\n    set_value: function (node, value, ev, config) {\r\n      node.innerHTML = value || \"\";\r\n    },\r\n    get_value: function (node, ev, config) {\r\n      return node.innerHTML || \"\";\r\n    },\r\n    focus: function (node) {\r\n    }\r\n  },\r\n  textarea: {\r\n    render: function (sns) {\r\n      var height = (sns.height || \"130\") + \"px\";\r\n      return \"<div class='gantt_cal_ltext' style='height:\" + height + \";'><textarea></textarea></div>\";\r\n    },\r\n    set_value: function (node, value, ev) {\r\n      this.form_blocks.textarea._get_input(node).value = value || \"\";\r\n    },\r\n    get_value: function (node, ev) {\r\n      return this.form_blocks.textarea._get_input(node).value;\r\n    },\r\n    focus: function (node) {\r\n      var a = this.form_blocks.textarea._get_input(node);\r\n      gantt._focus(a, true);\r\n    },\r\n    _get_input: function (node) {\r\n      return node.querySelector(\"textarea\");\r\n    }\r\n  },\r\n  select: {\r\n    render: function (sns) {\r\n      var height = (sns.height || \"23\") + \"px\";\r\n      var html = \"<div class='gantt_cal_ltext' style='height:\" + height + \";'><select style='width:100%;'>\";\r\n      for (var i = 0; i < sns.options.length; i++)\r\n        html += \"<option value='\" + sns.options[i].key + \"'>\" + sns.options[i].label + \"</option>\";\r\n      html += \"</select></div>\";\r\n      return html;\r\n    },\r\n    set_value: function (node, value, ev, sns) {\r\n      var select = node.firstChild;\r\n      if (!select._dhx_onchange && sns.onchange) {\r\n        select.onchange = sns.onchange;\r\n        select._dhx_onchange = true;\r\n      }\r\n      if (typeof value == \"undefined\")\r\n        value = (select.options[0] || {}).value;\r\n      select.value = value || \"\";\r\n    },\r\n    get_value: function (node, ev) {\r\n      return node.firstChild.value;\r\n    },\r\n    focus: function (node) {\r\n      var a = node.firstChild;\r\n      gantt._focus(a, true);\r\n    }\r\n  },\r\n  time: {\r\n    render: function (sns) {\r\n      var time = this.form_blocks.getTimePicker.call(this, sns);\r\n      var parts = [\"<div style='height:\" + (sns.height || 30) + \"px;padding-top:0px;font-size:inherit;text-align:center;' class='gantt_section_time'>\"];\r\n      parts.push(time);\r\n\r\n      if (sns.single_date) {\r\n        time = this.form_blocks.getTimePicker.call(this, sns, true);\r\n        parts.push(\"<span></span>\");\r\n      } else {\r\n        parts.push(\"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>\");\r\n      }\r\n\r\n      parts.push(time);\r\n      parts.push(\"</div>\");\r\n      return parts.join('');\r\n    },\r\n    set_value: function (node, value, ev, config) {\r\n      var cfg = config;\r\n      var s = node.getElementsByTagName(\"select\");\r\n\r\n      var map = config._time_format_order;\r\n      var map_size = config._time_format_size;\r\n\r\n      if (cfg.auto_end_date) {\r\n        var _update_lightbox_select = function () {\r\n          start_date = new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, 0, 0);\r\n          end_date = gantt.calculateEndDate({start_date: start_date, duration: 1, task: ev});\r\n          this.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n        };\r\n        for (var i = 0; i < 4; i++) {\r\n          s[i].onchange = _update_lightbox_select;\r\n        }\r\n      }\r\n\r\n      var mapping = gantt._resolve_default_mapping(config);\r\n\r\n      if (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n      var start_date = ev[mapping.start_date] || new Date();\r\n      var end_date = ev[mapping.end_date] || gantt.calculateEndDate({start_date: start_date, duration: 1, task: ev});\r\n\r\n      this.form_blocks._fill_lightbox_select(s, 0, start_date, map, cfg);\r\n      this.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n    },\r\n\r\n    get_value: function (node, ev, config) {\r\n      var s = node.getElementsByTagName(\"select\");\r\n      var map = config._time_format_order;\r\n\r\n      var hours = 0, minutes = 0;\r\n      if (gantt.defined(map[3])) {\r\n        var time = parseInt(s[map[3]].value, 10);\r\n        hours = Math.floor(time / 60);\r\n        minutes = time % 60;\r\n      }\r\n      var start_date = new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n\r\n      hours = minutes = 0;\r\n      if (gantt.defined(map[3])) {\r\n        var time = parseInt(s[map.size + map[3]].value, 10);\r\n        hours = Math.floor(time / 60);\r\n        minutes = time % 60;\r\n      }\r\n      var end_date = new Date(s[map[2] + map.size].value, s[map[1] + map.size].value, s[map[0] + map.size].value, hours, minutes);\r\n\r\n      if (end_date <= start_date)\r\n        end_date = gantt.date.add(start_date, gantt._get_timepicker_step(), \"minute\");\r\n\r\n      var mapped_fields = gantt._resolve_default_mapping(config);\r\n\r\n      var res = {\r\n        start_date: new Date(start_date),\r\n        end_date: new Date(end_date)\r\n      };\r\n      if (typeof mapped_fields == \"string\") {\r\n        return res.start_date;\r\n      } else {\r\n        return res;\r\n      }\r\n    },\r\n    focus: function (node) {\r\n      gantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n    }\r\n  },\r\n  duration: {\r\n    render: function (sns) {\r\n      var time = this.form_blocks.getTimePicker.call(this, sns);\r\n      time = \"<div class='gantt_time_selects'>\" + time + \"</div>\";\r\n      var label = this.locale.labels[this.config.duration_unit + \"s\"];\r\n\r\n      var singleDate = sns.single_date ? ' style=\"display:none\"' : \"\";\r\n      var readonly = sns.readonly ? \" disabled='disabled'\" : \"\";\r\n\r\n      var ariaAttr = this._waiAria.lightboxDurationInputAttrString(sns);\r\n\r\n      var duration = \"<div class='gantt_duration' \" + singleDate + \">\" +\r\n          \"<input type='button' class='gantt_duration_dec' value=''\" + readonly + \">\" +\r\n          \"<input type='text' value='5' class='gantt_duration_value'\" + readonly + \" \" + ariaAttr + \">\" +\r\n          \"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \"> \" + label + \" <span></span>\" +\r\n          \"</div>\";\r\n      var html = \"<div style='height:\" + (sns.height || 30) + \"px;padding-top:0px;font-size:inherit;' class='gantt_section_time'>\" + time + \" \" + duration + \"</div>\";\r\n      return html;\r\n    },\r\n    set_value: function (node, value, ev, config) {\r\n      var cfg = config;\r\n      var s = node.getElementsByTagName(\"select\");\r\n      var inps = node.getElementsByTagName(\"input\");\r\n\r\n      var duration = inps[1];\r\n      var btns = [inps[0], inps[2]];\r\n      var endspan = node.getElementsByTagName(\"span\")[0];\r\n\r\n      var map = config._time_format_order;\r\n\r\n      function _calc_date() {\r\n        var start_date = gantt.form_blocks.duration._get_start_date.call(gantt, node, config);\r\n        var duration = gantt.form_blocks.duration._get_duration.call(gantt, node, config);\r\n        var end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: ev});\r\n\r\n        endspan.innerHTML = gantt.templates.task_date(end_date);\r\n      }\r\n\r\n      function _change_duration(step) {\r\n        var value = duration.value;\r\n        value = parseInt(value, 10);\r\n        if (window.isNaN(value))\r\n          value = 0;\r\n        value += step;\r\n        if (value < 1) value = 1;\r\n        duration.value = value;\r\n        _calc_date();\r\n      }\r\n\r\n      btns[0].onclick = gantt.bind(function () {\r\n        _change_duration(-1 * this.config.duration_step);\r\n      }, this);\r\n      btns[1].onclick = gantt.bind(function () {\r\n        _change_duration(1 * this.config.duration_step);\r\n      }, this);\r\n      s[0].onchange = _calc_date;\r\n      s[1].onchange = _calc_date;\r\n      s[2].onchange = _calc_date;\r\n      if (s[3]) s[3].onchange = _calc_date;\r\n      duration.onkeydown = gantt.bind(function (e) {\r\n        e = e || window.event;\r\n        // up\r\n        var code = (e.charCode || e.keyCode || e.which);\r\n\r\n        if (code == 40) {\r\n          _change_duration(-1 * this.config.duration_step);\r\n          return false;\r\n        }\r\n        // down\r\n        if (code == 38) {\r\n          _change_duration(1 * this.config.duration_step);\r\n          return false;\r\n        }\r\n        window.setTimeout(function (e) {\r\n          _calc_date();\r\n        }, 1);\r\n      }, this);\r\n\r\n      duration.onchange = gantt.bind(function (e) {\r\n        _calc_date();\r\n      }, this);\r\n\r\n      var mapping = gantt._resolve_default_mapping(config);\r\n      if (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n      var start_date = ev[mapping.start_date] || new Date();\r\n      var end_date = ev[mapping.end_date] || gantt.calculateEndDate({start_date: start_date, duration: 1, task: ev});\r\n      var duration_val = Math.round(ev[mapping.duration]) || gantt.calculateDuration({\r\n            start_date: start_date,\r\n            end_date: end_date,\r\n            task: ev\r\n          });\r\n\r\n      gantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, cfg);\r\n      duration.value = duration_val;\r\n      _calc_date();\r\n    },\r\n\r\n    _get_start_date: function (node, config) {\r\n      var s = node.getElementsByTagName(\"select\");\r\n      var map = config._time_format_order;\r\n      var hours = 0;\r\n      var minutes = 0;\r\n      if (gantt.defined(map[3])) {\r\n        var input = s[map[3]];\r\n        var time = parseInt(input.value, 10);\r\n        if (isNaN(time) && input.hasAttribute(\"data-value\")) {\r\n          time = parseInt(input.getAttribute(\"data-value\"), 10);\r\n        }\r\n\r\n        hours = Math.floor(time / 60);\r\n        minutes = time % 60;\r\n      }\r\n      return new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n    },\r\n    _get_duration: function (node, config) {\r\n      var duration = node.getElementsByTagName(\"input\")[1];\r\n      duration = parseInt(duration.value, 10);\r\n      if (!duration || window.isNaN(duration)) duration = 1;\r\n      if (duration < 0) duration *= -1;\r\n      return duration;\r\n    },\r\n\r\n    get_value: function (node, ev, config) {\r\n      var start_date = gantt.form_blocks.duration._get_start_date(node, config);\r\n      var duration = gantt.form_blocks.duration._get_duration(node, config);\r\n\r\n      var end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: ev});\r\n      var mapped_fields = gantt._resolve_default_mapping(config);\r\n      var res = {\r\n        start_date: new Date(start_date),\r\n        end_date: new Date(end_date),\r\n        duration: duration\r\n      };\r\n      if (typeof mapped_fields == \"string\") {\r\n        return res.start_date;\r\n      } else {\r\n        return res;\r\n      }\r\n    },\r\n    focus: function (node) {\r\n      gantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n    }\r\n  },\r\n  parent: {\r\n    _filter: function (options, config, item_id) {\r\n      var filter = config.filter || function () {\r\n            return true;\r\n          };\r\n\r\n      options = options.slice(0);\r\n\r\n      for (var i = 0; i < options.length; i++) {\r\n        var task = options[i];\r\n        if (task.id == item_id || gantt.isChildOf(task.id, item_id) || filter(task.id, task) === false) {\r\n          options.splice(i, 1);\r\n          i--;\r\n        }\r\n      }\r\n      return options;\r\n    },\r\n\r\n    _display: function (config, item_id) {\r\n      var tasks = [],\r\n          options = [];\r\n      if (item_id) {\r\n        tasks = gantt.getTaskByTime();\r\n        if (config.allow_root) {\r\n          tasks.unshift({id: gantt.config.root_id, text: config.root_label || \"\"});\r\n        }\r\n        tasks = this._filter(tasks, config, item_id);\r\n        if (config.sort) {\r\n          tasks.sort(config.sort);\r\n        }\r\n      }\r\n      var text = config.template || gantt.templates.task_text;\r\n      for (var i = 0; i < tasks.length; i++) {\r\n        var label = text.apply(gantt, [tasks[i].start_date, tasks[i].end_date, tasks[i]]);\r\n        if (label === undefined) {\r\n          label = \"\";\r\n        }\r\n        options.push({\r\n          key: tasks[i].id,\r\n          label: label\r\n        });\r\n      }\r\n      config.options = options;\r\n      config.map_to = config.map_to || \"parent\";\r\n      return gantt.form_blocks.select.render.apply(this, arguments);\r\n    },\r\n    render: function (sns) {\r\n      return gantt.form_blocks.parent._display(sns, false);\r\n    },\r\n    set_value: function (node, value, ev, config) {\r\n      var tmpDom = document.createElement(\"div\");\r\n      tmpDom.innerHTML = gantt.form_blocks.parent._display(config, ev.id);\r\n      var newOptions = tmpDom.removeChild(tmpDom.firstChild);\r\n      node.onselect = null;\r\n      node.parentNode.replaceChild(newOptions, node);\r\n\r\n      return gantt.form_blocks.select.set_value.apply(gantt, [newOptions, value, ev, config]);\r\n    },\r\n    get_value: function () {\r\n      return gantt.form_blocks.select.get_value.apply(gantt, arguments);\r\n    },\r\n    focus: function () {\r\n      return gantt.form_blocks.select.focus.apply(gantt, arguments);\r\n    }\r\n  }\r\n};\r\n\r\ngantt._is_lightbox_timepicker = function () {\r\n  var s = this._get_typed_lightbox_config();\r\n  for (var i = 0; i < s.length; i++)\r\n    if (s[i].name == \"time\" && s[i].type == \"time\")\r\n      return true;\r\n  return false;\r\n};\r\n\r\ngantt._dhtmlx_confirm = function (message, title, callback, ok) {\r\n  if (!message)\r\n    return callback();\r\n  var opts = {text: message};\r\n  if (title)\r\n    opts.title = title;\r\n  if (ok) {\r\n    opts.ok = ok;\r\n  }\r\n  if (callback) {\r\n    opts.callback = function (result) {\r\n      if (result)\r\n        callback();\r\n    };\r\n  }\r\n  gantt.confirm(opts);\r\n};\r\n\r\ngantt._get_typed_lightbox_config = function (type) {\r\n  if (type === undefined) {\r\n    type = this.getLightboxType();\r\n  }\r\n\r\n  var field = this._get_type_name(type);\r\n\r\n  if (gantt.config.lightbox[field + \"_sections\"]) {\r\n    return gantt.config.lightbox[field + \"_sections\"];\r\n  } else {\r\n    return gantt.config.lightbox.sections;\r\n  }\r\n};\r\n\r\ngantt._silent_redraw_lightbox = function (type) {\r\n  var oldType = this.getLightboxType();\r\n\r\n  if (this.getState().lightbox) {\r\n    var taskId = this.getState().lightbox;\r\n    var formData = this.getLightboxValues(),\r\n        task = this.copy(this.getTask(taskId));\r\n\r\n    this.resetLightbox();\r\n\r\n    var updTask = this.mixin(task, formData, true);\r\n    var box = this.getLightbox(type ? type : undefined);\r\n    this._center_lightbox(this.getLightbox());\r\n    this._set_lightbox_values(updTask, box);\r\n  } else {\r\n    this.resetLightbox();\r\n    this.getLightbox(type ? type : undefined);\r\n  }\r\n  this.callEvent(\"onLightboxChange\", [oldType, this.getLightboxType()]);\r\n};\r\ngantt._extend_to_optional = function (lightbox_block) {\r\n\r\n  var duration = lightbox_block;\r\n  var optional_time = {\r\n    render: duration.render,\r\n    focus: duration.focus,\r\n    set_value: function (node, value, task, section) {\r\n      var mapping = gantt._resolve_default_mapping(section);\r\n      if (!task[mapping.start_date] || (mapping.start_date == \"start_date\" && this._isAllowedUnscheduledTask(task))) {\r\n        optional_time.disable(node, section);\r\n        var val = {};\r\n\r\n        for (var i in mapping) {\r\n          //take default values from the time control from task start/end dates\r\n          val[mapping[i]] = task[i];\r\n        }\r\n\r\n        return duration.set_value.call(gantt, node, value, val, section);//set default value\r\n      } else {\r\n        optional_time.enable(node, section);\r\n        return duration.set_value.call(gantt, node, value, task, section);\r\n      }\r\n    },\r\n    get_value: function (node, task, section) {\r\n      if (section.disabled) {\r\n        return {start_date: null};\r\n      } else {\r\n        return duration.get_value.call(gantt, node, task, section);\r\n      }\r\n    },\r\n    update_block: function (node, section) {\r\n      gantt.callEvent(\"onSectionToggle\", [gantt._lightbox_id, section]);\r\n      node.style.display = section.disabled ? \"none\" : \"block\";\r\n\r\n      if (section.button) {\r\n        var button = node.previousSibling.querySelector(\".gantt_custom_button_label\"),\r\n            labels = gantt.locale.labels;\r\n\r\n        var button_text = section.disabled ? labels[section.name + \"_enable_button\"] : labels[section.name + \"_disable_button\"];\r\n\r\n        button.innerHTML = button_text;\r\n      }\r\n      gantt.resizeLightbox();\r\n    },\r\n    disable: function (node, section) {\r\n      section.disabled = true;\r\n      optional_time.update_block(node, section);\r\n\r\n    },\r\n    enable: function (node, section) {\r\n      section.disabled = false;\r\n      optional_time.update_block(node, section);\r\n    },\r\n    button_click: function (index, el, section, container) {\r\n      if (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n        return;\r\n      }\r\n      var config = gantt._get_typed_lightbox_config()[index];\r\n      if (config.disabled) {\r\n        optional_time.enable(container, config);\r\n      } else {\r\n        optional_time.disable(container, config);\r\n      }\r\n    }\r\n  };\r\n  return optional_time;\r\n};\r\n\r\ngantt.form_blocks.duration_optional = gantt._extend_to_optional(gantt.form_blocks.duration);\r\ngantt.form_blocks.time_optional = gantt._extend_to_optional(gantt.form_blocks.time);\r\n/**\r\n *    @desc: constructor, data processor object\r\n *    @param: serverProcessorURL - url used for update\r\n *    @type: public\r\n */\r\ngantt.dataProcessor = function (serverProcessorURL) {\r\n  this.serverProcessor = serverProcessorURL;\r\n  this.action_param = \"!nativeeditor_status\";\r\n\r\n  this.object = null;\r\n  this.updatedRows = []; //ids of updated rows\r\n\r\n  this.autoUpdate = true;\r\n  this.updateMode = \"cell\";\r\n  this._tMode = \"GET\";\r\n  this._headers = null;\r\n  this._payload = null;\r\n  this.post_delim = \"_\";\r\n\r\n  this._waitMode = 0;\r\n  this._in_progress = {};//?\r\n  this._invalid = {};\r\n  this.mandatoryFields = [];\r\n  this.messages = [];\r\n\r\n  this.styles = {\r\n    updated: \"font-weight:bold;\",\r\n    inserted: \"font-weight:bold;\",\r\n    deleted: \"text-decoration : line-through;\",\r\n    invalid: \"background-color:FFE0E0;\",\r\n    invalid_cell: \"border-bottom:2px solid red;\",\r\n    error: \"color:red;\",\r\n    clear: \"font-weight:normal;text-decoration:none;\"\r\n  };\r\n\r\n  this.enableUTFencoding(true);\r\n  gantt._eventable(this);\r\n\r\n  return this;\r\n};\r\n\r\ngantt.dataProcessor.prototype = {\r\n  setTransactionMode: function (mode, total) {\r\n    if (typeof mode == \"object\") {\r\n      this._tMode = mode.mode || this._tMode;\r\n\r\n      if (gantt.defined(mode.headers)) {\r\n        this._headers = mode.headers;\r\n      }\r\n\r\n      if (gantt.defined(mode.payload)) {\r\n        this._payload = mode.payload;\r\n      }\r\n\r\n    } else {\r\n      this._tMode = mode;\r\n      this._tSend = total;\r\n    }\r\n\r\n    if (this._tMode == \"REST\") {\r\n      this._tSend = false;\r\n      this._endnm = true;\r\n    }\r\n\r\n    if (this._tMode == \"JSON\") {\r\n      this._tSend = false;\r\n      this._endnm = true;\r\n      this._headers = this._headers || {};\r\n      this._headers[\"Content-type\"] = \"application/json\";\r\n    }\r\n  },\r\n  escape: function (data) {\r\n    if (this._utf)\r\n      return encodeURIComponent(data);\r\n    else\r\n      return escape(data);\r\n  },\r\n  /**\r\n   *    @desc: allows to set escaping mode\r\n   *    @param: true - utf based escaping, simple - use current page encoding\r\n   *    @type: public\r\n   */\r\n  enableUTFencoding: function (mode) {\r\n    this._utf = !!mode;\r\n  },\r\n  /**\r\n   *    @desc: allows to define, which column may trigger update\r\n   *    @param: val - array or list of true/false values\r\n   *    @type: public\r\n   */\r\n  setDataColumns: function (val) {\r\n    this._columns = (typeof val == \"string\") ? val.split(\",\") : val;\r\n  },\r\n  /**\r\n   *    @desc: get state of updating\r\n   *    @returns:   true - all in sync with server, false - some items not updated yet.\r\n   *    @type: public\r\n   */\r\n  getSyncState: function () {\r\n    return !this.updatedRows.length;\r\n  },\r\n  /**\r\n   *    @desc: enable/disable named field for data syncing, will use column ids for grid\r\n   *    @param:   mode - true/false\r\n   *    @type: public\r\n   */\r\n  enableDataNames: function (mode) {\r\n    this._endnm = !!mode;\r\n  },\r\n  /**\r\n   *    @desc: enable/disable mode , when only changed fields and row id send to the server side, instead of all fields in default mode\r\n   *    @param:   mode - true/false\r\n   *    @type: public\r\n   */\r\n  enablePartialDataSend: function (mode) {\r\n    this._changed = !!mode;\r\n  },\r\n  /**\r\n   *    @desc: set if rows should be send to server automaticaly\r\n   *    @param: mode - \"row\" - based on row selection changed, \"cell\" - based on cell editing finished, \"off\" - manual data sending\r\n   *    @type: public\r\n   */\r\n  setUpdateMode: function (mode, dnd) {\r\n    this.autoUpdate = (mode == \"cell\");\r\n    this.updateMode = mode;\r\n    this.dnd = dnd;\r\n  },\r\n  ignore: function (code, master) {\r\n    this._silent_mode = true;\r\n    code.call(master || window);\r\n    this._silent_mode = false;\r\n  },\r\n  /**\r\n   *    @desc: mark row as updated/normal. check mandatory fields,initiate autoupdate (if turned on)\r\n   *    @param: rowId - id of row to set update-status for\r\n   *    @param: state - true for \"updated\", false for \"not updated\"\r\n   *    @param: mode - update mode name\r\n   *    @type: public\r\n   */\r\n  setUpdated: function (rowId, state, mode) {\r\n    if (this._silent_mode) return;\r\n    var ind = this.findRow(rowId);\r\n\r\n    mode = mode || \"updated\";\r\n    var existing = this.obj.getUserData(rowId, this.action_param);\r\n    if (existing && mode == \"updated\") mode = existing;\r\n    if (state) {\r\n      this.set_invalid(rowId, false); //clear previous error flag\r\n      this.updatedRows[ind] = rowId;\r\n      this.obj.setUserData(rowId, this.action_param, mode);\r\n      if (this._in_progress[rowId])\r\n        this._in_progress[rowId] = \"wait\";\r\n    } else {\r\n      if (!this.is_invalid(rowId)) {\r\n        this.updatedRows.splice(ind, 1);\r\n        this.obj.setUserData(rowId, this.action_param, \"\");\r\n      }\r\n    }\r\n\r\n    //clear changed flag\r\n    if (!state)\r\n      this._clearUpdateFlag(rowId);\r\n\r\n    this.markRow(rowId, state, mode);\r\n    if (state && this.autoUpdate) this.sendData(rowId);\r\n  },\r\n  _clearUpdateFlag: function (id) {\r\n  },\r\n  markRow: function (id, state, mode) {\r\n    var str = \"\";\r\n    var invalid = this.is_invalid(id);\r\n    if (invalid) {\r\n      str = this.styles[invalid];\r\n      state = true;\r\n    }\r\n    if (this.callEvent(\"onRowMark\", [id, state, mode, invalid])) {\r\n      //default logic\r\n      str = this.styles[state ? mode : \"clear\"] + str;\r\n\r\n      this.obj[this._methods[0]](id, str);\r\n\r\n      if (invalid && invalid.details) {\r\n        str += this.styles[invalid + \"_cell\"];\r\n        for (var i = 0; i < invalid.details.length; i++)\r\n          if (invalid.details[i])\r\n            this.obj[this._methods[1]](id, i, str);\r\n      }\r\n    }\r\n  },\r\n  getState: function (id) {\r\n    return this.obj.getUserData(id, this.action_param);\r\n  },\r\n  is_invalid: function (id) {\r\n    return this._invalid[id];\r\n  },\r\n  set_invalid: function (id, mode, details) {\r\n    if (details) mode = {\r\n      value: mode, details: details, toString: function () {\r\n        return this.value.toString();\r\n      }\r\n    };\r\n    this._invalid[id] = mode;\r\n  },\r\n  /**\r\n   *    @desc: check mandatory fields and varify values of cells, initiate update (if specified)\r\n   *    @param: rowId - id of row to set update-status for\r\n   *    @type: public\r\n   */\r\n  checkBeforeUpdate: function (rowId) {\r\n    return true;\r\n  },\r\n  /**\r\n   *    @desc: send row(s) values to server\r\n   *    @param: rowId - id of row which data to send. If not specified, then all \"updated\" rows will be send\r\n   *    @type: public\r\n   */\r\n  sendData: function (rowId) {\r\n    if (this._waitMode && (this.obj.mytype == \"tree\" || this.obj._h2)) return;\r\n    if (this.obj.editStop) this.obj.editStop();\r\n\r\n\r\n    if (typeof rowId == \"undefined\" || this._tSend) return this.sendAllData();\r\n    if (this._in_progress[rowId]) return false;\r\n\r\n    this.messages = [];\r\n    if (!this.checkBeforeUpdate(rowId) && this.callEvent(\"onValidationError\", [rowId, this.messages])) return false;\r\n    this._beforeSendData(this._getRowData(rowId), rowId);\r\n  },\r\n  _beforeSendData: function (data, rowId) {\r\n    if (!this.callEvent(\"onBeforeUpdate\", [rowId, this.getState(rowId), data])) return false;\r\n    this._sendData(data, rowId);\r\n  },\r\n  serialize: function (data, id) {\r\n    if (typeof data == \"string\")\r\n      return data;\r\n    if (typeof id != \"undefined\")\r\n      return this.serialize_one(data, \"\");\r\n    else {\r\n      var stack = [];\r\n      var keys = [];\r\n      for (var key in data)\r\n        if (data.hasOwnProperty(key)) {\r\n          stack.push(this.serialize_one(data[key], key + this.post_delim));\r\n          keys.push(key);\r\n        }\r\n      stack.push(\"ids=\" + this.escape(keys.join(\",\")));\r\n      if (gantt.security_key)\r\n        stack.push(\"dhx_security=\" + gantt.security_key);\r\n      return stack.join(\"&\");\r\n    }\r\n  },\r\n  serialize_one: function (data, pref) {\r\n    if (typeof data == \"string\")\r\n      return data;\r\n    var stack = [];\r\n    for (var key in data)\r\n      if (data.hasOwnProperty(key)) {\r\n        if ((key == \"id\" || key == this.action_param) && this._tMode == \"REST\") continue;\r\n        stack.push(this.escape((pref || \"\") + key) + \"=\" + this.escape(data[key]));\r\n      }\r\n    return stack.join(\"&\");\r\n  },\r\n  _applyPayload: function (url) {\r\n    if (this._payload)\r\n      for (var key in this._payload)\r\n        url = url + gantt._urlSeparator(url) + this.escape(key) + \"=\" + this.escape(this._payload[key]);\r\n    return url;\r\n  },\r\n  _sendData: function (a1, rowId) {\r\n    if (!a1) return; //nothing to send\r\n    if (!this.callEvent(\"onBeforeDataSending\", rowId ? [rowId, this.getState(rowId), a1] : [null, null, a1])) return false;\r\n\r\n    if (rowId)\r\n      this._in_progress[rowId] = (new Date()).valueOf();\r\n\r\n    var that = this;\r\n    var back = function (xml) {\r\n      var ids = [];\r\n      if (rowId)\r\n        ids.push(rowId);\r\n      else if (a1)\r\n        for (var key in a1)\r\n          ids.push(key);\r\n\r\n      return that.afterUpdate(that, xml, ids);\r\n    };\r\n\r\n    var a3 = this.serverProcessor + (this._user ? (gantt._urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, \"dhx_version=\" + this.obj.getUserData(0, \"version\")].join(\"&\")) : \"\");\r\n    var a4 = this._applyPayload(a3);\r\n\r\n    if (this._tMode == \"GET\") {\r\n      gantt.ajax.query({\r\n        url: a4 + gantt._urlSeparator(a4) + this.serialize(a1, rowId),\r\n        method: \"GET\",\r\n        callback: back,\r\n        headers: this._headers\r\n      });\r\n    } else if (this._tMode == \"POST\") {\r\n      gantt.ajax.query({\r\n        url: a4,\r\n        method: \"POST\",\r\n        headers: this._headers,\r\n        data: this.serialize(a1, rowId),\r\n        callback: back\r\n      });\r\n    } else if (this._tMode == \"JSON\") {\r\n      var action = a1[this.action_param];\r\n      var data = {};\r\n      for (var key in a1) data[key] = a1[key];\r\n      delete data[this.action_param];\r\n      delete data.id;\r\n      delete data.gr_id;\r\n\r\n      gantt.ajax.query({\r\n        url: a4,\r\n        method: \"POST\",\r\n        headers: this._headers,\r\n        callback: back,\r\n        data: JSON.stringify({\r\n          id: rowId,\r\n          action: action,\r\n          data: data\r\n        })\r\n      });\r\n    }\r\n    else if (this._tMode == \"REST\") {\r\n      var state = this.getState(rowId);\r\n      var url = a3.replace(/(\\&|\\?)editing\\=true/, \"\");\r\n      var data = \"\";\r\n      var method = \"post\";\r\n\r\n      if (state == \"inserted\") {\r\n        data = this.serialize(a1, rowId);\r\n      } else if (state == \"deleted\") {\r\n        method = \"DELETE\";\r\n        url = url + (url.slice(-1) == \"/\" ? \"\" : \"/\") + rowId;\r\n      } else {\r\n        method = \"PUT\";\r\n        data = this.serialize(a1, rowId);\r\n        url = url + (url.slice(-1) == \"/\" ? \"\" : \"/\") + rowId;\r\n      }\r\n\r\n\r\n      url = this._applyPayload(url);\r\n      gantt.ajax.query({\r\n        url: url,\r\n        method: method,\r\n        headers: this._headers,\r\n        data: data,\r\n        callback: back\r\n      });\r\n    }\r\n\r\n    this._waitMode++;\r\n  },\r\n  sendAllData: function () {\r\n    if (!this.updatedRows.length) return;\r\n\r\n    this.messages = [];\r\n    var valid = true;\r\n    for (var i = 0; i < this.updatedRows.length; i++)\r\n      valid &= this.checkBeforeUpdate(this.updatedRows[i]);\r\n    if (!valid && !this.callEvent(\"onValidationError\", [\"\", this.messages])) return false;\r\n\r\n    if (this._tSend)\r\n      this._sendData(this._getAllData());\r\n    else\r\n      for (var i = 0; i < this.updatedRows.length; i++)\r\n        if (!this._in_progress[this.updatedRows[i]]) {\r\n          if (this.is_invalid(this.updatedRows[i])) continue;\r\n          this._beforeSendData(this._getRowData(this.updatedRows[i]), this.updatedRows[i]);\r\n          if (this._waitMode && (this.obj.mytype == \"tree\" || this.obj._h2)) return; //block send all for tree\r\n        }\r\n  },\r\n\r\n  _getAllData: function (rowId) {\r\n    var out = {};\r\n    var has_one = false;\r\n    for (var i = 0; i < this.updatedRows.length; i++) {\r\n      var id = this.updatedRows[i];\r\n      if (this._in_progress[id] || this.is_invalid(id)) continue;\r\n      var row = this._getRowData(id);\r\n      if (!this.callEvent(\"onBeforeUpdate\", [id, this.getState(id), row])) continue;\r\n      out[id] = row;\r\n      has_one = true;\r\n      this._in_progress[id] = (new Date()).valueOf();\r\n    }\r\n    return has_one ? out : null;\r\n  },\r\n\r\n\r\n  /**\r\n   *    @desc: specify column which value should be varified before sending to server\r\n   *    @param: ind - column index (0 based)\r\n   *    @param: verifFunction - function (object) which should verify cell value (if not specified, then value will be compared to empty string). Two arguments will be passed into it: value and column name\r\n   *    @type: public\r\n   */\r\n  setVerificator: function (ind, verifFunction) {\r\n    this.mandatoryFields[ind] = verifFunction || (function (value) {\r\n          return (value !== \"\");\r\n        });\r\n  },\r\n  /**\r\n   *    @desc: remove column from list of those which should be verified\r\n   *    @param: ind - column Index (0 based)\r\n   *    @type: public\r\n   */\r\n  clearVerificator: function (ind) {\r\n    this.mandatoryFields[ind] = false;\r\n  },\r\n\r\n\r\n  findRow: function (pattern) {\r\n    var i = 0;\r\n    for (i = 0; i < this.updatedRows.length; i++)\r\n      if (pattern == this.updatedRows[i]) break;\r\n    return i;\r\n  },\r\n\r\n\r\n  /**\r\n   *    @desc: define custom actions\r\n   *    @param: name - name of action, same as value of action attribute\r\n   *    @param: handler - custom function, which receives a XMl response content for action\r\n   *    @type: private\r\n   */\r\n  defineAction: function (name, handler) {\r\n    if (!this._uActions) this._uActions = [];\r\n    this._uActions[name] = handler;\r\n  },\r\n\r\n\r\n  /**\r\n   *     @desc: used in combination with setOnBeforeUpdateHandler to create custom client-server transport system\r\n   *     @param: sid - id of item before update\r\n   *     @param: tid - id of item after up0ate\r\n   *     @param: action - action name\r\n   *     @type: public\r\n   *     @topic: 0\r\n   */\r\n  afterUpdateCallback: function (sid, tid, action, btag) {\r\n    var marker = sid;\r\n    var correct = (action != \"error\" && action != \"invalid\");\r\n    if (!correct) this.set_invalid(sid, action);\r\n    if ((this._uActions) && (this._uActions[action]) && (!this._uActions[action](btag)))\r\n      return (delete this._in_progress[marker]);\r\n\r\n    if (this._in_progress[marker] != \"wait\")\r\n      this.setUpdated(sid, false);\r\n\r\n    var soid = sid;\r\n\r\n    switch (action) {\r\n      case \"inserted\":\r\n      case \"insert\":\r\n        if (tid != sid) {\r\n          this.setUpdated(sid, false);\r\n          this.obj[this._methods[2]](sid, tid);\r\n          sid = tid;\r\n        }\r\n        break;\r\n      case \"delete\":\r\n      case \"deleted\":\r\n        this.obj.setUserData(sid, this.action_param, \"true_deleted\");\r\n        this.obj[this._methods[3]](sid);\r\n        delete this._in_progress[marker];\r\n        return this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\r\n    }\r\n\r\n    if (this._in_progress[marker] != \"wait\") {\r\n      if (correct) this.obj.setUserData(sid, this.action_param, '');\r\n      delete this._in_progress[marker];\r\n    } else {\r\n      delete this._in_progress[marker];\r\n      this.setUpdated(tid, true, this.obj.getUserData(sid, this.action_param));\r\n    }\r\n\r\n    this.callEvent(\"onAfterUpdate\", [soid, action, tid, btag]);\r\n  },\r\n\r\n  /**\r\n   *    @desc: response from server\r\n   *    @param: xml - XMLLoader object with response XML\r\n   *    @type: private\r\n   */\r\n  afterUpdate: function (that, xml, id) {\r\n    //try to use json first\r\n    if (window.JSON) {\r\n      var tag;\r\n\r\n      try {\r\n        tag = JSON.parse(xml.xmlDoc.responseText);\r\n      } catch (e) {\r\n\r\n        // empty response also can be processed by json handler\r\n        if (!xml.xmlDoc.responseText.length) {\r\n          tag = {};\r\n        }\r\n      }\r\n\r\n      if (tag) {\r\n        var action = tag.action || this.getState(id) || \"updated\";\r\n        var sid = tag.sid || id[0];\r\n        var tid = tag.tid || id[0];\r\n        that.afterUpdateCallback(sid, tid, action, tag);\r\n        that.finalizeUpdate();\r\n        return;\r\n      }\r\n    }\r\n    //xml response\r\n    var top = gantt.ajax.xmltop(\"data\", xml.xmlDoc); //fix incorrect content type in IE\r\n    if (!top) return this.cleanUpdate(id);\r\n    var atag = gantt.ajax.xpath(\"//data/action\", top);\r\n    if (!atag.length) return this.cleanUpdate(id);\r\n\r\n    for (var i = 0; i < atag.length; i++) {\r\n      var btag = atag[i];\r\n      var action = btag.getAttribute(\"type\");\r\n      var sid = btag.getAttribute(\"sid\");\r\n      var tid = btag.getAttribute(\"tid\");\r\n\r\n      that.afterUpdateCallback(sid, tid, action, btag);\r\n    }\r\n    that.finalizeUpdate();\r\n  },\r\n  cleanUpdate: function (id) {\r\n    if (id)\r\n      for (var i = 0; i < id.length; i++)\r\n        delete this._in_progress[id[i]];\r\n  },\r\n  finalizeUpdate: function () {\r\n    if (this._waitMode) this._waitMode--;\r\n\r\n    if ((this.obj.mytype == \"tree\" || this.obj._h2) && this.updatedRows.length)\r\n      this.sendData();\r\n    this.callEvent(\"onAfterUpdateFinish\", []);\r\n    if (!this.updatedRows.length)\r\n      this.callEvent(\"onFullSync\", []);\r\n  },\r\n\r\n\r\n  /**\r\n   *    @desc: initializes data-processor\r\n   *    @param: anObj - dhtmlxGrid object to attach this data-processor to\r\n   *    @type: public\r\n   */\r\n  init: function (anObj) {\r\n    this.obj = anObj;\r\n    if (this.obj._dp_init)\r\n      this.obj._dp_init(this);\r\n  },\r\n\r\n\r\n  setOnAfterUpdate: function (ev) {\r\n    this.attachEvent(\"onAfterUpdate\", ev);\r\n  },\r\n  enableDebug: function (mode) {\r\n  },\r\n  setOnBeforeUpdateHandler: function (func) {\r\n    this.attachEvent(\"onBeforeDataSending\", func);\r\n  },\r\n\r\n\r\n  /* starts autoupdate mode\r\n   @param interval\r\n   time interval for sending update requests\r\n   */\r\n  setAutoUpdate: function (interval, user) {\r\n    interval = interval || 2000;\r\n\r\n    this._user = user || (new Date()).valueOf();\r\n    this._need_update = false;\r\n    //this._loader = null;\r\n    this._update_busy = false;\r\n\r\n    this.attachEvent(\"onAfterUpdate\", function (sid, action, tid, xml_node) {\r\n      this.afterAutoUpdate(sid, action, tid, xml_node);\r\n    });\r\n    this.attachEvent(\"onFullSync\", function () {\r\n      this.fullSync();\r\n    });\r\n\r\n    var self = this;\r\n    window.setInterval(function () {\r\n      self.loadUpdate();\r\n    }, interval);\r\n  },\r\n\r\n\r\n  /* process updating request answer\r\n   if status == collision version is depricated\r\n   set flag for autoupdating immidiatly\r\n   */\r\n  afterAutoUpdate: function (sid, action, tid, xml_node) {\r\n    if (action == 'collision') {\r\n      this._need_update = true;\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  },\r\n\r\n\r\n  /* callback function for onFillSync event\r\n   call update function if it's need\r\n   */\r\n  fullSync: function () {\r\n    if (this._need_update) {\r\n      this._need_update = false;\r\n      this.loadUpdate();\r\n    }\r\n    return true;\r\n  },\r\n\r\n\r\n  /* sends query to the server and call callback function\r\n   */\r\n  getUpdates: function (url, callback) {\r\n    if (this._update_busy)\r\n      return false;\r\n    else\r\n      this._update_busy = true;\r\n\r\n    //this._loader = this._loader || new dtmlXMLLoaderObject(true);\r\n\r\n    //this._loader.async=true;\r\n    //this._loader.waitCall=callback;\r\n    //this._loader.loadXML(url);\r\n    gantt.ajax.get(url, callback);\r\n\r\n  },\r\n\r\n\r\n  /* returns xml node value\r\n   @param node\r\n   xml node\r\n   */\r\n  _v: function (node) {\r\n    if (node.firstChild) return node.firstChild.nodeValue;\r\n    return \"\";\r\n  },\r\n\r\n\r\n  /* returns values array of xml nodes array\r\n   @param arr\r\n   array of xml nodes\r\n   */\r\n  _a: function (arr) {\r\n    var res = [];\r\n    for (var i = 0; i < arr.length; i++) {\r\n      res[i] = this._v(arr[i]);\r\n    }\r\n    return res;\r\n  },\r\n\r\n\r\n  /* loads updates and processes them\r\n   */\r\n  loadUpdate: function () {\r\n    var self = this;\r\n    var version = this.obj.getUserData(0, \"version\");\r\n    var url = this.serverProcessor + gantt._urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, \"dhx_version=\" + version].join(\"&\");\r\n    url = url.replace(\"editing=true&\", \"\");\r\n    this.getUpdates(url, function (xml) {\r\n      var vers = gantt.ajax.xpath(\"//userdata\", xml);\r\n      self.obj.setUserData(0, \"version\", self._v(vers[0]));\r\n\r\n      var upds = gantt.ajax.xpath(\"//update\", xml);\r\n      if (upds.length) {\r\n        self._silent_mode = true;\r\n\r\n        for (var i = 0; i < upds.length; i++) {\r\n          var status = upds[i].getAttribute('status');\r\n          var id = upds[i].getAttribute('id');\r\n          var parent = upds[i].getAttribute('parent');\r\n          switch (status) {\r\n            case 'inserted':\r\n              self.callEvent(\"insertCallback\", [upds[i], id, parent]);\r\n              break;\r\n            case 'updated':\r\n              self.callEvent(\"updateCallback\", [upds[i], id, parent]);\r\n              break;\r\n            case 'deleted':\r\n              self.callEvent(\"deleteCallback\", [upds[i], id, parent]);\r\n              break;\r\n          }\r\n        }\r\n\r\n        self._silent_mode = false;\r\n      }\r\n\r\n      self._update_busy = false;\r\n      self = null;\r\n    });\r\n  }\r\n\r\n};\r\ngantt._init_dp_live_update_hooks = function (dp) {\r\n  dp.attachEvent(\"insertCallback\", gantt._insert_callback);\r\n  dp.attachEvent(\"updateCallback\", gantt._update_callback);\r\n  dp.attachEvent(\"deleteCallback\", gantt._delete_callback);\r\n};\r\n\r\ngantt._update_callback = function (upd, id) {\r\n  var data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\r\n  if (!gantt.isTaskExists(id))\r\n    return;\r\n  var objData = gantt.getTask(id);\r\n  for (var key in data) {\r\n    var property = data[key];\r\n    switch (key) {\r\n      case \"id\":\r\n        continue;\r\n      case \"start_date\":\r\n      case \"end_date\":\r\n        property = gantt.templates.xml_date(property);\r\n        break;\r\n      case \"duration\":\r\n        objData.end_date = gantt.calculateEndDate({start_date: objData.start_date, duration: property, task: objData});\r\n        break;\r\n    }\r\n    objData[key] = property;\r\n  }\r\n  gantt.updateTask(id);\r\n  gantt.refreshData();\r\n};\r\ngantt._insert_callback = function (upd, id, parent, mode) {\r\n  var data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild),\r\n      methods = {\r\n        add: gantt.addTask,\r\n        isExist: gantt.isTaskExists\r\n      };\r\n  if (mode == \"links\") {\r\n    methods.add = gantt.addLink;\r\n    methods.isExist = gantt.isLinkExists;\r\n  }\r\n  if (methods.isExist.call(gantt, id))\r\n    return;\r\n  data.id = id;\r\n  methods.add.call(gantt, data);\r\n};\r\ngantt._delete_callback = function (upd, id, parent, mode) {\r\n  var methods = {\r\n    \"delete\": gantt.deleteTask,\r\n    \"isExist\": gantt.isTaskExists\r\n  };\r\n  if (mode == \"links\") {\r\n    methods[\"delete\"] = gantt.deleteLink;\r\n    methods.isExist = gantt.isLinkExists;\r\n  }\r\n  if (methods.isExist.call(gantt, id))\r\n    methods[\"delete\"].call(gantt, id);\r\n};\r\n\r\n\r\n// --#include core/data_task_types.js\r\n\r\n/*\r\n asserts will be removed in final code, so you can place them anythere\r\n without caring about performance impacts\r\n */\r\ngantt.assert = function (check, message) {\r\n  //jshint -W087\r\n  if (!check) {\r\n    if (gantt.config.show_errors && gantt.callEvent(\"onError\", [message]) !== false) {\r\n      gantt.message({type: \"error\", text: message, expire: -1});\r\n      //debugger;\r\n    }\r\n  }\r\n};\r\n\r\n//initial initialization\r\ngantt.init = function (node, from, to) {\r\n  this.callEvent(\"onBeforeGanttReady\", []);\r\n  if (from && to) {\r\n    this.config.start_date = this._min_date = new Date(from);\r\n    this.config.end_date = this._max_date = new Date(to);\r\n  }\r\n  this._init_skin();\r\n  this.date.init();\r\n\r\n  if (!this.config.scroll_size)\r\n    this.config.scroll_size = this._detectScrollSize();\r\n\r\n  var resizeDelay;\r\n  gantt.event(window, \"resize\", function () {\r\n    clearTimeout(resizeDelay);\r\n    resizeDelay = setTimeout(function () {\r\n      gantt.render();\r\n    }, 300);\r\n  });\r\n\r\n  //can be called only once\r\n  this.init = function (node) {\r\n    if (this.$container && this.$container.parentNode) {\r\n      this.$container.parentNode.removeChild(this.$container);\r\n      this.$container = null;\r\n\r\n    }\r\n    this._reinit(node);\r\n  };\r\n\r\n  this._reinit(node);\r\n};\r\n\r\ngantt._reinit = function (node) {\r\n  this._init_html_area(node);\r\n  this._set_sizes();\r\n\r\n  this._clear_renderers();\r\n  this.resetLightbox();\r\n  this._update_flags();\r\n  this._init_touch_events();\r\n  this._init_templates();\r\n  this._init_grid();\r\n  this._init_tasks();\r\n\r\n\r\n  this._set_scroll_events();\r\n\r\n  gantt.event(this.$container, \"click\", this._on_click);\r\n  gantt.event(this.$container, \"dblclick\", this._on_dblclick);\r\n  gantt.event(this.$container, \"mousemove\", this._on_mousemove);\r\n  gantt.event(this.$container, \"contextmenu\", this._on_contextmenu);\r\n\r\n  this.callEvent(\"onGanttReady\", []);\r\n\r\n  this.render();\r\n};\r\n\r\n//renders initial html markup\r\ngantt._init_html_area = function (node) {\r\n  if (typeof node == \"string\")\r\n    this._obj = document.getElementById(node);\r\n  else\r\n    this._obj = node;\r\n  this.assert(this._obj, \"Invalid html container: \" + node);\r\n\r\n  var gridAriaAttr = this._waiAria.gridAttrString();\r\n  var gridDataAriaAttr = this._waiAria.gridDataAttrString();\r\n\r\n  var html = \"<div class='gantt_container'><div class='gantt_grid' \" + gridAriaAttr + \"></div><div class='gantt_task'></div>\";\r\n  html += \"<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>\";\r\n  this._obj.innerHTML = html;\r\n  //store links for further reference\r\n  this.$container = this._obj.firstChild;\r\n  var childs = this.$container.childNodes;\r\n  this.$grid = childs[0];\r\n  this.$task = childs[1];\r\n  this.$scroll_ver = childs[2];\r\n  this.$scroll_hor = childs[3];\r\n\r\n  this.$grid.innerHTML = \"<div class='gantt_grid_scale' \" +\r\n      gantt._waiAria.gridScaleRowAttrString() + \"></div><div class='gantt_grid_data' \" + gridDataAriaAttr + \"></div>\";\r\n  this.$grid_scale = this.$grid.childNodes[0];\r\n  this.$grid_data = this.$grid.childNodes[1];\r\n\r\n  this.$task.innerHTML = \"<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>\";\r\n  this.$task_scale = this.$task.childNodes[0];\r\n\r\n  this.$task_data = this.$task.childNodes[1];\r\n\r\n  this.$task_bg = this.$task_data.childNodes[0];\r\n  this.$task_links = this.$task_data.childNodes[1];\r\n  this.$task_bars = this.$task_data.childNodes[2];\r\n};\r\n\r\ngantt.$click = {\r\n  buttons: {\r\n    \"edit\": function (id) {\r\n      gantt.showLightbox(id);\r\n    },\r\n    \"delete\": function (id) {\r\n      var question = gantt.locale.labels.confirm_deleting;\r\n      var title = gantt.locale.labels.confirm_deleting_title;\r\n\r\n      gantt._dhtmlx_confirm(question, title, function () {\r\n        if (!gantt.isTaskExists(id)) {\r\n          gantt.hideLightbox();\r\n          return;\r\n        }\r\n\r\n        var task = gantt.getTask(id);\r\n        if (task.$new) {\r\n          gantt._deleteTask(id, true);\r\n          gantt.refreshData();\r\n        } else {\r\n          gantt.deleteTask(id);\r\n        }\r\n\r\n        gantt.hideLightbox();\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\ngantt._calculate_content_height = function () {\r\n  var scale_height = this.config.scale_height,\r\n      rows_height = this._order.length * this.config.row_height,\r\n      hor_scroll_height = this._scroll_hor ? this.config.scroll_size + 1 : 0;\r\n\r\n  if (!(this._is_grid_visible() || this._is_chart_visible())) {\r\n    return 0;\r\n  } else {\r\n    return scale_height + rows_height + 2 + hor_scroll_height;\r\n  }\r\n};\r\ngantt._calculate_content_width = function () {\r\n  var grid_width = this._get_grid_width(),\r\n      chart_width = this._tasks ? this._tasks.full_width : 0,\r\n      ver_scroll_width = this._scroll_ver ? this.config.scroll_size + 1 : 0;\r\n\r\n  if (!this._is_chart_visible()) {\r\n    chart_width = 0;\r\n  }\r\n  if (!this._is_grid_visible()) {\r\n    grid_width = 0;\r\n  }\r\n  return grid_width + chart_width + 1;\r\n};\r\n\r\ngantt._get_resize_options = function () {\r\n  var res = {x: false, y: false};\r\n  if (this.config.autosize == \"xy\") {\r\n    res.x = res.y = true;\r\n  } else if (this.config.autosize == \"y\" || this.config.autosize === true) {\r\n    res.y = true;\r\n  } else if (this.config.autosize == \"x\") {\r\n    res.x = true;\r\n  }\r\n  return res;\r\n};\r\n\r\ngantt._clean_el_size = function (value) {\r\n  return ((value || \"\").toString().replace(\"px\", \"\") * 1 || 0);\r\n};\r\ngantt._get_box_styles = function () {\r\n  var computed = null;\r\n  if (window.getComputedStyle) {\r\n    computed = window.getComputedStyle(this._obj, null);\r\n  } else {\r\n    //IE with elem.currentStyle does not calculate sizes from %, so will use the default approach\r\n    computed = {\r\n      \"width\": this._obj.clientWidth,\r\n      \"height\": this._obj.clientHeight\r\n    };\r\n  }\r\n  var properties = [\r\n    \"width\",\r\n    \"height\",\r\n\r\n    \"paddingTop\",\r\n    \"paddingBottom\",\r\n    \"paddingLeft\",\r\n    \"paddingRight\",\r\n\r\n    \"borderLeftWidth\",\r\n    \"borderRightWidth\",\r\n    \"borderTopWidth\",\r\n    \"borderBottomWidth\"\r\n  ];\r\n  var styles = {\r\n    boxSizing: (computed.boxSizing == \"border-box\")\r\n  };\r\n\r\n  if (computed.MozBoxSizing) {\r\n    styles.boxSizing = (computed.MozBoxSizing == \"border-box\");\r\n  }\r\n  for (var i = 0; i < properties.length; i++) {\r\n    styles[properties[i]] = computed[properties[i]] ? this._clean_el_size(computed[properties[i]]) : 0;\r\n  }\r\n\r\n\r\n  var box = {\r\n    horPaddings: (styles.paddingLeft + styles.paddingRight + styles.borderLeftWidth + styles.borderRightWidth),\r\n    vertPaddings: (styles.paddingTop + styles.paddingBottom + styles.borderTopWidth + styles.borderBottomWidth),\r\n    borderBox: styles.boxSizing,\r\n    innerWidth: styles.width,\r\n    innerHeight: styles.height,\r\n    outerWidth: styles.width,\r\n    outerHeight: styles.height\r\n  };\r\n\r\n\r\n  if (box.borderBox) {\r\n    box.innerWidth -= box.horPaddings;\r\n    box.innerHeight -= box.vertPaddings;\r\n  } else {\r\n    box.outerWidth += box.horPaddings;\r\n    box.outerHeight += box.vertPaddings;\r\n  }\r\n\r\n  return box;\r\n};\r\ngantt._do_autosize = function () {\r\n  var resize = this._get_resize_options();\r\n  var boxSizes = this._get_box_styles();\r\n  if (resize.y) {\r\n    var reqHeight = this._calculate_content_height();\r\n    if (boxSizes.borderBox) {\r\n      reqHeight += boxSizes.vertPaddings;\r\n    }\r\n\r\n    this._obj.style.height = reqHeight + 'px';\r\n  }\r\n  if (resize.x) {\r\n    var reqWidth = this._calculate_content_width();\r\n    if (boxSizes.borderBox) {\r\n      reqWidth += boxSizes.horPaddings;\r\n    }\r\n    this._obj.style.width = reqWidth + 'px';\r\n  }\r\n};\r\n//set sizes to top level html element\r\ngantt._set_sizes = function () {\r\n  this._do_autosize();\r\n\r\n  var boxSizes = this._get_box_styles();\r\n  this._y = boxSizes.innerHeight;\r\n\r\n  if (this._y < 20) return;\r\n\r\n  //same height\r\n  this.$grid.style.height = this.$task.style.height = Math.max(this._y - this.$scroll_hor.offsetHeight - 2, 0) + \"px\";\r\n\r\n  var dataHeight = Math.max((this._y - (this.config.scale_height || 0) - this.$scroll_hor.offsetHeight - 2), 0);\r\n  this.$grid_data.style.height = this.$task_data.style.height = dataHeight + \"px\";\r\n\r\n  //share width\r\n  var gridWidth = Math.max(this._get_grid_width() - 1, 0);\r\n  this.$grid.style.width = gridWidth + \"px\";\r\n  this.$grid.style.display = gridWidth === 0 ? 'none' : '';\r\n\r\n  boxSizes = this._get_box_styles();\r\n  this._x = boxSizes.innerWidth;\r\n\r\n  if (this._x < 20) return;\r\n\r\n  this.$grid_data.style.width = Math.max(this._get_grid_width() - 1, 0) + \"px\";\r\n  this.$task.style.width = Math.max(this._x - this._get_grid_width() - 2, 0) + \"px\";\r\n};\r\n\r\ngantt.getScrollState = function () {\r\n  if (this.$task && this.$task_data)\r\n    return {x: this.$task.scrollLeft, y: this.$task_data.scrollTop};\r\n  else\r\n    return null;\r\n};\r\n\r\ngantt._save_scroll_state = function (x, y) {\r\n  // according to Chrome profiler\r\n  // getting-setting scrollLeft for restoring scroll position after render takes surprisingly big amount of time\r\n  // 2x-3x times more than setting innerHTML (if using gantt.config.static_background)\r\n  // Will store scroll position in memory instead of getting actual values from DOM\r\n  var pos = {};\r\n  this._cached_scroll_pos = this._cached_scroll_pos || {};\r\n  if (x !== undefined) {\r\n    pos.x = Math.max(x, 0);\r\n  }\r\n  if (y !== undefined) {\r\n    pos.y = Math.max(y, 0);\r\n  }\r\n  this.mixin(this._cached_scroll_pos, pos, true);\r\n\r\n};\r\ngantt._restore_scroll_state = function () {\r\n  var res = {x: 0, y: 0};\r\n  if (this._cached_scroll_pos) {\r\n    res.x = this._cached_scroll_pos.x || res.x;\r\n    res.y = this._cached_scroll_pos.y || res.y;\r\n  }\r\n  return res;\r\n};\r\ngantt.scrollTo = function (left, top) {\r\n  var oldScrollState = this._restore_scroll_state();\r\n\r\n  if (left * 1 == left) {\r\n    this.$task.scrollLeft = left;\r\n    this._save_scroll_state(left, undefined);\r\n  }\r\n  if (top * 1 == top) {\r\n    this.$scroll_ver.scrollTop = top;\r\n    this.$task_data.scrollTop = top;\r\n    this.$grid_data.scrollTop = top;\r\n    this._save_scroll_state(undefined, this.config.show_chart ? this.$task_data.scrollTop : this.$scroll_ver.scrollTop);\r\n  }\r\n\r\n  var scroll = gantt._restore_scroll_state();\r\n  this.callEvent(\"onGanttScroll\", [oldScrollState.x, oldScrollState.y, scroll.x, scroll.y]);\r\n};\r\n\r\ngantt.showDate = function (date) {\r\n  var date_x = this.posFromDate(date);\r\n  var scroll_to = Math.max(date_x - this.config.task_scroll_offset, 0);\r\n  this.scrollTo(scroll_to);\r\n};\r\ngantt.showTask = function (id) {\r\n  var pos = this._get_task_pos(this.getTask(id));\r\n\r\n  var left = Math.max(pos.x - this.config.task_scroll_offset, 0);\r\n\r\n  var dataHeight = this._scroll_sizes().y;\r\n  var top;\r\n  if (!dataHeight) {\r\n    top = pos.y;\r\n  } else {\r\n    top = pos.y - (dataHeight - this.config.row_height) / 2;\r\n  }\r\n\r\n  this.scrollTo(left, top);\r\n};\r\n\r\n\r\n//called after window resize\r\ngantt._on_resize = gantt.setSizes = function () {\r\n  // TODO: remove redundancy from layout sizes calculation\r\n  // Set_sizes and scroll_resize affects each other result depending each one called first.\r\n  // Need to call set_sizes twice to ensure sizes are calculated correctly after resize\r\n  gantt._set_sizes();\r\n  gantt._scroll_resize();\r\n  gantt._set_sizes();\r\n};\r\n\r\n//renders self\r\ngantt.render = function () {\r\n  this.callEvent(\"onBeforeGanttRender\", []);\r\n\r\n  var pos = this.copy(this._restore_scroll_state());\r\n  var visible_date = null;\r\n  if (pos) {\r\n    visible_date = gantt.dateFromPos(pos.x + this.config.task_scroll_offset);\r\n  }\r\n\r\n  this._render_grid();\t//grid.js\r\n  this._render_tasks_scales();\t//tasks.js\r\n  this._scroll_resize();\r\n  this._on_resize();\r\n  this._render_data();\r\n\r\n  if (this.config.preserve_scroll && pos) {\r\n\r\n    var new_pos = gantt._restore_scroll_state();\r\n    var new_date = gantt.dateFromPos(new_pos.x);\r\n    if (!(+visible_date == +new_date && new_pos.y == pos.y)) {\r\n      if (visible_date) {\r\n        this.showDate(visible_date);\r\n      }\r\n      gantt.scrollTo(undefined, pos.y);\r\n    }\r\n  }\r\n\r\n  this.callEvent(\"onGanttRender\", []);\r\n};\r\n\r\n\r\ngantt._set_scroll_events = function () {\r\n  this.event(this.$scroll_hor, \"scroll\", function () {\r\n    //in safari we can catch previous onscroll after setting new value from mouse-wheel event\r\n    //set delay to prevent value drifiting\r\n    if ((new Date()) - ( gantt._wheel_time || 0 ) < 100) return true;\r\n    if (gantt._touch_scroll_active) return;\r\n    var left = gantt.$scroll_hor.scrollLeft;\r\n    gantt.scrollTo(left);\r\n  });\r\n  this.event(this.$scroll_ver, \"scroll\", function () {\r\n    if (gantt._touch_scroll_active) return;\r\n    var top = gantt.$scroll_ver.scrollTop;\r\n    var prev = gantt.$scroll_ver.prevTop;\r\n    if (top == prev) return;\r\n    gantt.$scroll_ver.prevTop = top;\r\n\r\n    gantt.scrollTo(null, top);\r\n  });\r\n  this.event(this.$task, \"scroll\", function () {\r\n    var left = gantt.$task.scrollLeft,\r\n        barLeft = gantt.$scroll_hor.scrollLeft;\r\n    if (barLeft != left)\r\n      gantt.$scroll_hor.scrollLeft = left;\r\n  });\r\n  this.event(this.$task_data, \"scroll\", function () {\r\n    var top = gantt.$task_data.scrollTop,\r\n        barTop = gantt.$scroll_ver.scrollTop;\r\n    if (barTop != top)\r\n      gantt.$scroll_ver.scrollTop = top;\r\n  });\r\n\r\n  var ff = gantt.env.isFF;// && !window._KHTMLrv;\r\n  function onMouseWheel(e) {\r\n    var res = gantt._get_resize_options();\r\n    gantt._wheel_time = new Date();\r\n\r\n    var wx = ff ? (e.deltaX * -20) : e.wheelDeltaX * 2;\r\n    var wy = ff ? (e.deltaY * -40) : e.wheelDelta;\r\n\r\n    if (e.shiftKey && !(e.deltaX || e.wheelDeltaX)) {\r\n      // shift+mousewheel for horizontal scroll\r\n      wx = wy * 2;\r\n      wy = 0;\r\n    }\r\n\r\n    if (wx && Math.abs(wx) > Math.abs(wy)) {\r\n      if (res.x) return true;//no horisontal scroll, must not block scrolling\r\n      if (!gantt.$scroll_hor || !gantt.$scroll_hor.offsetWidth) return true;\r\n\r\n      var dir = wx / -40;\r\n      var oldLeft = gantt.$task.scrollLeft;\r\n      var left = oldLeft + dir * 30;\r\n      gantt.scrollTo(left, null);\r\n      gantt.$scroll_hor.scrollLeft = left;\r\n      // not block scroll if position hasn't changed\r\n      if (oldLeft == gantt.$task.scrollLeft) {\r\n        return true;\r\n      }\r\n    } else {\r\n      if (res.y) return true;//no vertical scroll, must not block scrolling\r\n      if (!gantt.$scroll_ver || !gantt.$scroll_ver.offsetHeight) return true;\r\n\r\n      var dir = wy / -40;\r\n      if (typeof wy == \"undefined\")\r\n        dir = e.detail;\r\n\r\n      var oldTop = gantt.$scroll_ver.scrollTop;\r\n      var top = gantt.$scroll_ver.scrollTop + dir * 30;\r\n\r\n      if (!gantt.config.prevent_default_scroll &&\r\n          (gantt._cached_scroll_pos && ((gantt._cached_scroll_pos.y == top) || (gantt._cached_scroll_pos.y <= 0 && top <= 0)))) return true;\r\n\r\n\r\n      gantt.scrollTo(null, top);\r\n      gantt.$scroll_ver.scrollTop = top;\r\n\r\n      // not block scroll if position hasn't changed\r\n      if (oldTop == gantt.$scroll_ver.scrollTop) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    if (e.preventDefault)\r\n      e.preventDefault();\r\n    e.cancelBubble = true;\r\n    return false;\r\n  }\r\n\r\n  if (ff)\r\n    this.event(gantt.$container, \"wheel\", onMouseWheel);\r\n  else\r\n    this.event(gantt.$container, \"mousewheel\", onMouseWheel);\r\n\r\n};\r\n\r\n\r\ngantt._scroll_resize = function () {\r\n  if (this._x < 20 || this._y < 20) return;\r\n\r\n  var scrolls = this._scroll_sizes();\r\n\r\n  if (scrolls.x) {\r\n    this.$scroll_hor.style.display = \"block\";\r\n    this.$scroll_hor.style.height = scrolls.scroll_size + \"px\";\r\n    this.$scroll_hor.style.width = scrolls.x + \"px\";\r\n    this.$scroll_hor.firstChild.style.width = scrolls.x_inner + \"px\";\r\n  } else {\r\n    this.$scroll_hor.style.display = \"none\";\r\n    this.$scroll_hor.style.height = this.$scroll_hor.style.width = '0px';\r\n  }\r\n\r\n  if (scrolls.y) {\r\n    this.$scroll_ver.style.display = \"block\";\r\n    this.$scroll_ver.style.width = scrolls.scroll_size + \"px\";\r\n    this.$scroll_ver.style.height = scrolls.y + \"px\";\r\n    this.$scroll_ver.style.top = this.config.scale_height + \"px\";\r\n    this.$scroll_ver.firstChild.style.height = scrolls.y_inner + \"px\";\r\n  } else {\r\n    this.$scroll_ver.style.display = \"none\";\r\n    this.$scroll_ver.style.width = this.$scroll_ver.style.height = '0px';\r\n  }\r\n};\r\n\r\ngantt._scroll_sizes = function () {\r\n  var grid_width = this._get_grid_width();\r\n\r\n  var task_width = Math.max(this._x - grid_width, 0);\r\n  var task_height = Math.max(this._y - this.config.scale_height, 0);\r\n\r\n  var scroll_size = this.config.scroll_size + 1;//1px for inner content\r\n\r\n  var resize = this._get_resize_options();\r\n  var task_data_height = this.config.row_height * this._order.length;\r\n  var scroll_ver = this._scroll_ver = resize.y ? false : (task_data_height > task_height);\r\n\r\n  var task_data_width = Math.max(this._tasks.full_width - (!scroll_ver ? scroll_size : 0), 0);\r\n\r\n  var scroll_hor = this._scroll_hor = resize.x ? false : (task_data_width > task_width);\r\n\r\n  var scrolls = {\r\n    x: false,\r\n    y: false,\r\n    scroll_size: scroll_size,\r\n    x_inner: (task_data_width + grid_width + scroll_size + 2),\r\n    //y_inner: Math.max(task_height, task_data_height)\r\n    y_inner: task_data_height\r\n  };\r\n  if (scroll_hor) {\r\n    scrolls.x = Math.max((this._x - (scroll_ver ? scroll_size : 2)), 0);\r\n  }\r\n  if (scroll_ver) {\r\n    scrolls.y = Math.max((this._y - (scroll_hor ? scroll_size : 2) - this.config.scale_height), 0);\r\n  }\r\n  return scrolls;\r\n};\r\n\r\ngantt._getClassName = function (node) {\r\n  if (!node) return \"\";\r\n\r\n  var className = node.className || \"\";\r\n  if (className.baseVal)//'className' exist but not a string - IE svg element in DOM\r\n    className = className.baseVal;\r\n\r\n  if (!className.indexOf)\r\n    className = '';\r\n\r\n  return gantt._trim(className);\r\n};\r\n\r\ngantt.locate = function (e) {\r\n  var trg = gantt._get_target_node(e);\r\n\r\n  //ignore empty cells\r\n  var className = gantt._getClassName(trg);\r\n\r\n  if ((className || \"\").indexOf(\"gantt_task_cell\") >= 0) return null;\r\n\r\n  var attribute = arguments[1] || this.config.task_attribute;\r\n\r\n  while (trg) {\r\n    if (trg.getAttribute) {\t//text nodes has not getAttribute\r\n      var test = trg.getAttribute(attribute);\r\n      if (test) return test;\r\n    }\r\n    trg = trg.parentNode;\r\n  }\r\n  return null;\r\n};\r\ngantt._get_target_node = function (e) {\r\n  var trg;\r\n  if (e.tagName)\r\n    trg = e;\r\n  else {\r\n    e = e || window.event;\r\n    trg = e.target || e.srcElement;\r\n  }\r\n  return trg;\r\n};\r\ngantt._trim = function (str) {\r\n  var func = String.prototype.trim || function () {\r\n        return this.replace(/^\\s+|\\s+$/g, \"\");\r\n      };\r\n  return func.apply(str);\r\n};\r\n\r\ngantt._locate_css = function (e, classname, strict) {\r\n  if (strict === undefined)\r\n    strict = true;\r\n\r\n  var trg = gantt._get_target_node(e);\r\n  var css = '';\r\n  var test = false;\r\n  while (trg) {\r\n    css = gantt._getClassName(trg);\r\n\r\n    if (css) {\r\n      var ind = css.indexOf(classname);\r\n      if (ind >= 0) {\r\n        if (!strict)\r\n          return trg;\r\n\r\n        //check that we have exact match\r\n        var left = (ind === 0) || (!gantt._trim(css.charAt(ind - 1)));\r\n        var right = ((ind + classname.length >= css.length)) || (!gantt._trim(css.charAt(ind + classname.length)));\r\n\r\n        if (left && right)\r\n          return trg;\r\n      }\r\n    }\r\n\r\n    trg = trg.parentNode;\r\n  }\r\n  return null;\r\n};\r\ngantt._locateHTML = function (e, attribute) {\r\n  var trg = gantt._get_target_node(e);\r\n  attribute = attribute || this.config.task_attribute;\r\n\r\n  while (trg) {\r\n    if (trg.getAttribute) {\t//text nodes has not getAttribute\r\n      var test = trg.getAttribute(attribute);\r\n      if (test) return trg;\r\n    }\r\n    trg = trg.parentNode;\r\n  }\r\n  return null;\r\n};\r\n\r\ngantt.getTaskRowNode = function (id) {\r\n  var els = this.$grid_data.childNodes;\r\n  var attribute = this.config.task_attribute;\r\n  for (var i = 0; i < els.length; i++) {\r\n    if (els[i].getAttribute) {\r\n      var value = els[i].getAttribute(attribute);\r\n      if (value == id) return els[i];\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\ngantt.getState = function () {\r\n  return {\r\n    drag_id: this._tasks_dnd.drag ? this._tasks_dnd.drag.id : undefined,\r\n    drag_mode: this._tasks_dnd.drag ? this._tasks_dnd.drag.mode : undefined,\r\n    drag_from_start: this._tasks_dnd.drag ? this._tasks_dnd.drag.left : undefined,\r\n    selected_task: this._selected_task,\r\n    min_date: this._min_date ? new Date(this._min_date) : undefined,\r\n    max_date: this._max_date ? new Date(this._max_date) : undefined,\r\n    lightbox: this._lightbox_id,\r\n    touch_drag: this._touch_drag,\r\n\r\n    scale_unit: this._tasks ? this._tasks.unit : undefined,\r\n    scale_step: this._tasks ? this._tasks.step : undefined\r\n  };\r\n};\r\n\r\n\r\ngantt._checkTimeout = function (host, updPerSecond) {\r\n  if (!updPerSecond)\r\n    return true;\r\n  var timeout = 1000 / updPerSecond;\r\n  if (timeout < 1) return true;\r\n\r\n  if (host._on_timeout)\r\n    return false;\r\n\r\n  setTimeout(function () {\r\n    delete host._on_timeout;\r\n  }, timeout);\r\n\r\n  host._on_timeout = true;\r\n  return true;\r\n};\r\n\r\ngantt.selectTask = function (id) {\r\n  if (!this.config.select_task)\r\n    return false;\r\n  if (id) {\r\n\r\n    if (this._selected_task == id)\r\n      return this._selected_task;\r\n\r\n    if (!this.callEvent(\"onBeforeTaskSelected\", [id])) {\r\n      return false;\r\n    }\r\n\r\n    this.unselectTask();\r\n    this._selected_task = id;\r\n\r\n    this.refreshTask(id);\r\n    this.callEvent(\"onTaskSelected\", [id]);\r\n  }\r\n  return this._selected_task;\r\n};\r\ngantt.unselectTask = function (id) {\r\n  var id = id || this._selected_task;\r\n  if (!id)\r\n    return;\r\n  this._selected_task = null;\r\n  this.refreshTask(id);\r\n  this.callEvent(\"onTaskUnselected\", [id]);\r\n};\r\ngantt.getSelectedId = function () {\r\n  return this.defined(this._selected_task) ? this._selected_task : null;\r\n};\r\n\r\ngantt.changeLightboxType = function (type) {\r\n  if (this.getLightboxType() == type)\r\n    return true;\r\n  gantt._silent_redraw_lightbox(type);\r\n};\r\n\r\ngantt._is_render_active = function () {\r\n  return !this._skip_render;\r\n};\r\n\r\ngantt._correct_dst_change = function (date, prevOffset, step, unit) {\r\n  var time_unit = gantt._get_line(unit) * step;\r\n  if (time_unit > 60 * 60 && time_unit < 60 * 60 * 24) {\r\n    //correct dst change only if current unit is more than one hour and less than day (days have own checking), e.g. 12h\r\n    var offsetChanged = date.getTimezoneOffset() - prevOffset;\r\n    if (offsetChanged) {\r\n      date = gantt.date.add(date, offsetChanged, \"minute\");\r\n    }\r\n  }\r\n  return date;\r\n};\r\n\r\n(function () {\r\n  var methods = {};\r\n  gantt._disableMethod = function (methodName, dummyMethod) {\r\n    dummyMethod = typeof dummyMethod == \"function\" ? dummyMethod : function () {\r\n    };\r\n\r\n    if (!methods[methodName]) {\r\n      methods[methodName] = this[methodName];\r\n      this[methodName] = dummyMethod;\r\n    }\r\n  };\r\n  gantt._restoreMethod = function (methodName) {\r\n    if (methods[methodName]) {\r\n      this[methodName] = methods[methodName];\r\n      methods[methodName] = null;\r\n    }\r\n  };\r\n  gantt._disableMethods = function (methodsHash) {\r\n    for (var i in methodsHash) {\r\n      this._disableMethod(i, methodsHash[i]);\r\n    }\r\n  };\r\n  gantt._restoreMethods = function () {\r\n    for (var i in methods) {\r\n      this._restoreMethod(i);\r\n    }\r\n  };\r\n\r\n})();\r\n\r\ngantt._batchUpdatePayload = function (callback) {\r\n  try {\r\n    callback();\r\n  } catch (e) {\r\n    window.console.error(e);\r\n  }\r\n};\r\n\r\ngantt.batchUpdate = function (callback, noRedraw) {\r\n\r\n  if (!this._is_render_active()) {\r\n    // batch mode is already active\r\n    this._batchUpdatePayload(callback);\r\n    return;\r\n  }\r\n\r\n  var call_dp = (this._dp && this._dp.updateMode != \"off\");\r\n  var dp_mode;\r\n  if (call_dp) {\r\n    dp_mode = this._dp.updateMode;\r\n    this._dp.setUpdateMode(\"off\");\r\n  }\r\n\r\n  // temporary disable some methods while updating multiple tasks\r\n  var resetProjects = {};\r\n  var methods = {\r\n    \"_sync_order\": true,\r\n    \"_sync_links\": true,\r\n    \"_adjust_scales\": true,\r\n    \"render\": true,\r\n    \"_render_data\": true,\r\n    \"refreshTask\": true,\r\n    \"refreshLink\": true,\r\n    \"resetProjectDates\": function (task) {\r\n      resetProjects[task.id] = task;\r\n    }\r\n  };\r\n  this._disableMethods(methods);\r\n\r\n  this._skip_render = true;\r\n  this.callEvent(\"onBeforeBatchUpdate\", []);\r\n\r\n  this._batchUpdatePayload(callback);\r\n  this.callEvent(\"onAfterBatchUpdate\", []);\r\n\r\n  this._restoreMethods();\r\n  // do required updates after changes applied\r\n  this._sync_order();\r\n  this._sync_links();\r\n  for (var i in resetProjects) {\r\n    this.resetProjectDates(resetProjects[i]);\r\n  }\r\n  this._adjust_scales();\r\n\r\n  this._skip_render = false;\r\n\r\n  if (!noRedraw) {\r\n    this.render();\r\n  }\r\n\r\n  if (call_dp) {\r\n    this._dp.setUpdateMode(dp_mode);\r\n    this._dp.setGanttMode(\"tasks\");\r\n    this._dp.sendData();\r\n    this._dp.setGanttMode(\"links\");\r\n    this._dp.sendData();\r\n  }\r\n};\r\n\r\n\r\n// browser\r\n\r\ngantt.env = {\r\n  isIE: (navigator.userAgent.indexOf(\"MSIE\") >= 0 || navigator.userAgent.indexOf(\"Trident\") >= 0),\r\n  isIE6: (!window.XMLHttpRequest && navigator.userAgent.indexOf(\"MSIE\") >= 0),\r\n  isIE7: (navigator.userAgent.indexOf(\"MSIE 7.0\") >= 0 && navigator.userAgent.indexOf(\"Trident\") < 0),\r\n  isIE8: (navigator.userAgent.indexOf(\"MSIE 8.0\") >= 0 && navigator.userAgent.indexOf(\"Trident\") >= 0),\r\n  isOpera: (navigator.userAgent.indexOf(\"Opera\") >= 0),\r\n  isChrome: (navigator.userAgent.indexOf(\"Chrome\") >= 0),\r\n  isKHTML: (navigator.userAgent.indexOf(\"Safari\") >= 0 || navigator.userAgent.indexOf(\"Konqueror\") >= 0),\r\n  isFF: (navigator.userAgent.indexOf(\"Firefox\") >= 0),\r\n  isIPad: (navigator.userAgent.search(/iPad/gi) >= 0),\r\n  isEdge: (navigator.userAgent.indexOf(\"Edge\") != -1)\r\n};\r\n\r\n\r\ngantt.ajax = {\r\n\r\n  // if false - dhxr param will added to prevent caching on client side (default),\r\n  // if true - do not add extra params\r\n  cache: true,\r\n\r\n  // default method for load/loadStruct, post/get allowed\r\n  // get - since 4.1.1, this should fix 412 error for macos safari\r\n  method: \"get\",\r\n\r\n  parse: function (data) {\r\n    if (typeof data !== \"string\") return data;\r\n\r\n    var obj;\r\n    data = data.replace(/^[\\s]+/, \"\");\r\n    if (window.DOMParser && !gantt.env.isIE) { // ff,ie9\r\n      obj = (new window.DOMParser()).parseFromString(data, \"text/xml\");\r\n    } else if (window.ActiveXObject !== window.undefined) {\r\n      obj = new window.ActiveXObject(\"Microsoft.XMLDOM\");\r\n      obj.async = \"false\";\r\n      obj.loadXML(data);\r\n    }\r\n    return obj;\r\n  },\r\n  xmltop: function (tagname, xhr, obj) {\r\n    if (typeof xhr.status == \"undefined\" || xhr.status < 400) {\r\n      var xml = (!xhr.responseXML) ? gantt.ajax.parse(xhr.responseText || xhr) : (xhr.responseXML || xhr);\r\n      if (xml && xml.documentElement !== null && !xml.getElementsByTagName(\"parsererror\").length) {\r\n        return xml.getElementsByTagName(tagname)[0];\r\n      }\r\n    }\r\n    if (obj !== -1) gantt.callEvent(\"onLoadXMLError\", [\"Incorrect XML\", arguments[1], obj]);\r\n    return document.createElement(\"DIV\");\r\n  },\r\n  xpath: function (xpathExp, docObj) {\r\n    if (!docObj.nodeName) docObj = docObj.responseXML || docObj;\r\n    if (gantt.env.isIE) {\r\n      return docObj.selectNodes(xpathExp) || [];\r\n    } else {\r\n      var rows = [];\r\n      var first;\r\n      var col = (docObj.ownerDocument || docObj).evaluate(xpathExp, docObj, null, XPathResult.ANY_TYPE, null);\r\n\r\n      while (true) {\r\n        first = col.iterateNext();\r\n        if (first) {\r\n          rows.push(first);\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      return rows;\r\n    }\r\n  },\r\n  query: function (config) {\r\n    gantt.ajax._call(\r\n        (config.method || \"GET\"),\r\n        config.url,\r\n        config.data || \"\",\r\n        (config.async || true),\r\n        config.callback,\r\n        null,\r\n        config.headers\r\n    );\r\n  },\r\n  get: function (url, onLoad) {\r\n    this._call(\"GET\", url, null, true, onLoad);\r\n  },\r\n  getSync: function (url) {\r\n    return this._call(\"GET\", url, null, false);\r\n  },\r\n  put: function (url, postData, onLoad) {\r\n    this._call(\"PUT\", url, postData, true, onLoad);\r\n  },\r\n  del: function (url, postData, onLoad) {\r\n    this._call(\"DELETE\", url, postData, true, onLoad);\r\n  },\r\n  post: function (url, postData, onLoad) {\r\n    if (arguments.length == 1) {\r\n      postData = \"\";\r\n    } else if (arguments.length == 2 && (typeof(postData) == \"function\" || typeof(window[postData]) == \"function\")) {\r\n      onLoad = postData;\r\n      postData = \"\";\r\n    } else {\r\n      postData = String(postData);\r\n    }\r\n    this._call(\"POST\", url, postData, true, onLoad);\r\n  },\r\n  postSync: function (url, postData) {\r\n    postData = (postData === null ? \"\" : String(postData));\r\n    return this._call(\"POST\", url, postData, false);\r\n  },\r\n  getLong: function (url, onLoad) {\r\n    this._call(\"GET\", url, null, true, onLoad, {url: url});\r\n  },\r\n  postLong: function (url, postData, onLoad) {\r\n    if (arguments.length == 2 && (typeof(postData) == \"function\" || typeof(window[postData]))) {\r\n      onLoad = postData;\r\n      postData = \"\";\r\n    }\r\n    this._call(\"POST\", url, postData, true, onLoad, {url: url, postData: postData});\r\n  },\r\n  _call: function (method, url, postData, async, onLoad, longParams, headers) {\r\n\r\n    var t = (window.XMLHttpRequest && !gantt.env.isIE ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\"));\r\n    var isQt = (navigator.userAgent.match(/AppleWebKit/) !== null && navigator.userAgent.match(/Qt/) !== null && navigator.userAgent.match(/Safari/) !== null);\r\n\r\n    if (!!async) {\r\n      t.onreadystatechange = function () {\r\n        if ((t.readyState == 4) || (isQt && t.readyState == 3)) { // what for long response and status 404?\r\n          if (t.status != 200 || t.responseText === \"\")\r\n            if (!gantt.callEvent(\"onAjaxError\", [t])) return;\r\n\r\n          window.setTimeout(function () {\r\n            if (typeof(onLoad) == \"function\") {\r\n              onLoad.apply(window, [{xmlDoc: t, filePath: url}]); // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n            }\r\n            if (longParams) {\r\n              if (typeof(longParams.postData) != \"undefined\") {\r\n                gantt.ajax.postLong(longParams.url, longParams.postData, onLoad);\r\n              } else {\r\n                gantt.ajax.getLong(longParams.url, onLoad);\r\n              }\r\n            }\r\n            onLoad = null;\r\n            t = null;\r\n          }, 1);\r\n        }\r\n      };\r\n    }\r\n\r\n    if (method == \"GET\" && !this.cache) {\r\n      url += (url.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + \"dhxr\" + new Date().getTime() + \"=1\";\r\n    }\r\n\r\n    t.open(method, url, async);\r\n\r\n    if (headers) {\r\n      for (var key in headers)\r\n        t.setRequestHeader(key, headers[key]);\r\n    } else if (method.toUpperCase() == \"POST\" || method == \"PUT\" || method == \"DELETE\") {\r\n      t.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n    } else if (method == \"GET\") {\r\n      postData = null;\r\n    }\r\n\r\n    t.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\r\n    t.send(postData);\r\n\r\n    if (!async) return {xmlDoc: t, filePath: url}; // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n\r\n  }\r\n};\r\n\r\n\r\ngantt._urlSeparator = function (str) {\r\n  if (str.indexOf(\"?\") != -1)\r\n    return \"&\";\r\n  else\r\n    return \"?\";\r\n};\r\n\r\n\r\n(function () {\r\n  var _dhx_msg_cfg = null;\r\n\r\n  function callback(config, result) {\r\n    var usercall = config.callback;\r\n    gantt.modalbox.hide(config.box);\r\n\r\n    _dhx_msg_cfg = config.box = null;\r\n    if (usercall)\r\n      usercall(result);\r\n  }\r\n\r\n  function modal_key(e) {\r\n    if (_dhx_msg_cfg) {\r\n      e = e || event;\r\n      var code = e.which || event.keyCode;\r\n      var preventDefault = false;\r\n\r\n      if (gantt.message.keyboard) {\r\n        if (code == 13 || code == 32) {\r\n          // default behavior is to confirm/submit popup on space/enter\r\n          // if browser focus is set on button element - do button click instead of default behavior\r\n          var target = e.target || e.srcElement;\r\n          if (gantt._getClassName(target).indexOf(\"gantt_popup_button\") > -1 && target.click) {\r\n            target.click();\r\n          } else {\r\n            callback(_dhx_msg_cfg, true);\r\n            preventDefault = true;\r\n          }\r\n        }\r\n\r\n        if (code == 27) {\r\n          callback(_dhx_msg_cfg, false);\r\n          preventDefault = true;\r\n        }\r\n      }\r\n\r\n      if (preventDefault) {\r\n        if (e.preventDefault)\r\n          e.preventDefault();\r\n        return !(e.cancelBubble = true);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (document.attachEvent)\r\n    document.attachEvent(\"onkeydown\", modal_key);\r\n  else\r\n    document.addEventListener(\"keydown\", modal_key, true);\r\n\r\n  function modality(mode) {\r\n    if (!modality.cover) {\r\n      modality.cover = document.createElement(\"DIV\");\r\n      //necessary for IE only\r\n      modality.cover.onkeydown = modal_key;\r\n      modality.cover.className = \"dhx_modal_cover\";\r\n      document.body.appendChild(modality.cover);\r\n    }\r\n    var height = document.body.scrollHeight;\r\n    modality.cover.style.display = mode ? \"inline-block\" : \"none\";\r\n  }\r\n\r\n  function button(text, result) {\r\n    var buttonAriaAttrs = gantt._waiAria.messageButtonAttrString(text);\r\n    var button_css = \"gantt_\" + text.toLowerCase().replace(/ /g, \"_\") + \"_button\" + \" dhtmlx_\" + text.toLowerCase().replace(/ /g, \"_\") + \"_button\"; // dhtmlx_ok_button, dhtmlx_click_me_button\r\n    return \"<div \" + buttonAriaAttrs + \" class='gantt_popup_button dhtmlx_popup_button \" + button_css + \"' result='\" + result + \"' ><div>\" + text + \"</div></div>\";\r\n  }\r\n\r\n  function info(text) {\r\n    if (!t.area) {\r\n      t.area = document.createElement(\"DIV\");\r\n      t.area.className = \"gantt_message_area dhtmlx_message_area\";\r\n      t.area.style[t.position] = \"5px\";\r\n      document.body.appendChild(t.area);\r\n    }\r\n\r\n    t.hide(text.id);\r\n    var message = document.createElement(\"DIV\");\r\n    message.innerHTML = \"<div>\" + text.text + \"</div>\";\r\n    message.className = \"gantt-info dhtmlx-info gantt-\" + text.type + \" dhtmlx-\" + text.type;\r\n    message.onclick = function () {\r\n      t.hide(text.id);\r\n      text = null;\r\n    };\r\n\r\n    gantt._waiAria.messageInfoAttr(message);\r\n\r\n    if (t.position == \"bottom\" && t.area.firstChild)\r\n      t.area.insertBefore(message, t.area.firstChild);\r\n    else\r\n      t.area.appendChild(message);\r\n\r\n    if (text.expire > 0)\r\n      t.timers[text.id] = window.setTimeout(function () {\r\n        t.hide(text.id);\r\n      }, text.expire);\r\n\r\n    t.pull[text.id] = message;\r\n    message = null;\r\n\r\n    return text.id;\r\n  }\r\n\r\n  function getFirstDefined() {\r\n    var values = [].slice.apply(arguments, [0]);\r\n\r\n    for (var i = 0; i < values.length; i++) {\r\n      if (values[i]) {\r\n        return values[i];\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  function _boxStructure(config, ok, cancel) {\r\n    var box = document.createElement(\"DIV\");\r\n\r\n    var contentId = gantt.uid();\r\n    gantt._waiAria.messageModalAttr(box, contentId);\r\n\r\n\r\n    box.className = \" gantt_modal_box dhtmlx_modal_box gantt-\" + config.type + \" dhtmlx-\" + config.type;\r\n    box.setAttribute(\"dhxbox\", 1);\r\n\r\n    var inner = '';\r\n\r\n    if (config.width)\r\n      box.style.width = config.width;\r\n    if (config.height)\r\n      box.style.height = config.height;\r\n    if (config.title)\r\n      inner += '<div class=\"gantt_popup_title dhtmlx_popup_title\">' + config.title + '</div>';\r\n    inner += '<div class=\"gantt_popup_text dhtmlx_popup_text\" id=\"' + contentId + '\"><span>' + (config.content ? '' : config.text) + '</span></div><div  class=\"gantt_popup_controls dhtmlx_popup_controls\">';\r\n    if (ok)\r\n      inner += button(getFirstDefined(config.ok, gantt.locale.labels.message_ok, \"OK\"), true);\r\n    if (cancel)\r\n      inner += button(getFirstDefined(config.cancel, gantt.locale.labels.message_cancel, \"Cancel\"), false);\r\n    if (config.buttons) {\r\n      for (var i = 0; i < config.buttons.length; i++)\r\n        inner += button(config.buttons[i], i);\r\n    }\r\n    inner += '</div>';\r\n    box.innerHTML = inner;\r\n\r\n    if (config.content) {\r\n      var node = config.content;\r\n      if (typeof node == \"string\")\r\n        node = document.getElementById(node);\r\n      if (node.style.display == 'none')\r\n        node.style.display = \"\";\r\n      box.childNodes[config.title ? 1 : 0].appendChild(node);\r\n    }\r\n\r\n    box.onclick = function (e) {\r\n      e = e || event;\r\n      var source = e.target || e.srcElement;\r\n      if (!source.className) source = source.parentNode;\r\n      if (source.className.split(\" \")[0] == \"gantt_popup_button\") {\r\n        var result = source.getAttribute(\"result\");\r\n        result = (result == \"true\") || (result == \"false\" ? false : result);\r\n        callback(config, result);\r\n      }\r\n    };\r\n    config.box = box;\r\n    if (ok || cancel)\r\n      _dhx_msg_cfg = config;\r\n\r\n    return box;\r\n  }\r\n\r\n  function _createBox(config, ok, cancel) {\r\n    var box = config.tagName ? config : _boxStructure(config, ok, cancel);\r\n\r\n    if (!config.hidden)\r\n      modality(true);\r\n    document.body.appendChild(box);\r\n    var x = Math.abs(Math.floor(((window.innerWidth || document.documentElement.offsetWidth) - box.offsetWidth) / 2));\r\n    var y = Math.abs(Math.floor(((window.innerHeight || document.documentElement.offsetHeight) - box.offsetHeight) / 2));\r\n    if (config.position == \"top\")\r\n      box.style.top = \"-3px\";\r\n    else\r\n      box.style.top = y + 'px';\r\n    box.style.left = x + 'px';\r\n    //necessary for IE only\r\n    box.onkeydown = modal_key;\r\n\r\n    gantt.modalbox.focus(box);\r\n\r\n    if (config.hidden)\r\n      gantt.modalbox.hide(box);\r\n\r\n    gantt.callEvent(\"onMessagePopup\", [box]);\r\n    return box;\r\n  }\r\n\r\n  function alertPopup(config) {\r\n    return _createBox(config, true, false);\r\n  }\r\n\r\n  function confirmPopup(config) {\r\n    return _createBox(config, true, true);\r\n  }\r\n\r\n  function boxPopup(config) {\r\n    return _createBox(config);\r\n  }\r\n\r\n  function box_params(text, type, callback) {\r\n    if (typeof text != \"object\") {\r\n      if (typeof type == \"function\") {\r\n        callback = type;\r\n        type = \"\";\r\n      }\r\n      text = {text: text, type: type, callback: callback};\r\n    }\r\n    return text;\r\n  }\r\n\r\n  function params(text, type, expire, id) {\r\n    if (typeof text != \"object\")\r\n      text = {text: text, type: type, expire: expire, id: id};\r\n    text.id = text.id || t.uid();\r\n    text.expire = text.expire || t.expire;\r\n    return text;\r\n  }\r\n\r\n  gantt.alert = function () {\r\n    var text = box_params.apply(this, arguments);\r\n    text.type = text.type || \"confirm\";\r\n    return alertPopup(text);\r\n  };\r\n  gantt.confirm = function () {\r\n    var text = box_params.apply(this, arguments);\r\n    text.type = text.type || \"alert\";\r\n    return confirmPopup(text);\r\n  };\r\n  gantt.modalbox = function () {\r\n    var text = box_params.apply(this, arguments);\r\n    text.type = text.type || \"alert\";\r\n    return boxPopup(text);\r\n  };\r\n  gantt.modalbox.hide = function (node) {\r\n    while (node && node.getAttribute && !node.getAttribute(\"dhxbox\"))\r\n      node = node.parentNode;\r\n    if (node) {\r\n      node.parentNode.removeChild(node);\r\n      modality(false);\r\n\r\n      gantt.callEvent(\"onAfterMessagePopup\", [node]);\r\n    }\r\n  };\r\n\r\n  gantt.modalbox.focus = function (node) {\r\n    setTimeout(function () {\r\n      var focusable = gantt._getFocusableNodes(node);\r\n      if (focusable.length) {\r\n        if (focusable[0].focus) focusable[0].focus();\r\n      }\r\n    }, 1);\r\n  };\r\n\r\n  var t = gantt.message = function (text, type, expire, id) {\r\n    text = params.apply(this, arguments);\r\n    text.type = text.type || \"info\";\r\n\r\n    var subtype = text.type.split(\"-\")[0];\r\n    switch (subtype) {\r\n      case \"alert\":\r\n        return alertPopup(text);\r\n      case \"confirm\":\r\n        return confirmPopup(text);\r\n      case \"modalbox\":\r\n        return boxPopup(text);\r\n      default:\r\n        return info(text);\r\n    }\r\n  };\r\n\r\n  t.seed = (new Date()).valueOf();\r\n  t.uid = function () {\r\n    return t.seed++;\r\n  };\r\n  t.expire = 4000;\r\n  t.keyboard = true;\r\n  t.position = \"top\";\r\n  t.pull = {};\r\n  t.timers = {};\r\n\r\n  t.hideAll = function () {\r\n    for (var key in t.pull)\r\n      t.hide(key);\r\n  };\r\n  t.hide = function (id) {\r\n    var obj = t.pull[id];\r\n    if (obj && obj.parentNode) {\r\n      window.setTimeout(function () {\r\n        obj.parentNode.removeChild(obj);\r\n        obj = null;\r\n      }, 2000);\r\n      obj.className += \" hidden\";\r\n\r\n      if (t.timers[id])\r\n        window.clearTimeout(t.timers[id]);\r\n      delete t.pull[id];\r\n    }\r\n  };\r\n})();\r\n\r\ngantt.date = {\r\n  init: function () {\r\n    var s = gantt.locale.date.month_short;\r\n    var t = gantt.locale.date.month_short_hash = {};\r\n    for (var i = 0; i < s.length; i++)\r\n      t[s[i]] = i;\r\n\r\n    var s = gantt.locale.date.month_full;\r\n    var t = gantt.locale.date.month_full_hash = {};\r\n    for (var i = 0; i < s.length; i++)\r\n      t[s[i]] = i;\r\n  },\r\n  date_part: function (date) {\r\n    var old = new Date(date);\r\n    date.setHours(0);\r\n    this.hour_start(date);\r\n    if (date.getHours() && //shift to yesterday on dst\r\n        (date.getDate() < old.getDate() || date.getMonth() < old.getMonth() || date.getFullYear() < old.getFullYear()))\r\n      date.setTime(date.getTime() + 60 * 60 * 1000 * (24 - date.getHours()));\r\n    return date;\r\n  },\r\n  time_part: function (date) {\r\n    return (date.valueOf() / 1000 - date.getTimezoneOffset() * 60) % 86400;\r\n  },\r\n  week_start: function (date) {\r\n    var shift = date.getDay();\r\n    if (gantt.config.start_on_monday) {\r\n      if (shift === 0) shift = 6;\r\n      else shift--;\r\n    }\r\n    return this.date_part(this.add(date, -1 * shift, \"day\"));\r\n  },\r\n  month_start: function (date) {\r\n    date.setDate(1);\r\n    return this.date_part(date);\r\n  },\r\n  year_start: function (date) {\r\n    date.setMonth(0);\r\n    return this.month_start(date);\r\n  },\r\n  day_start: function (date) {\r\n    return this.date_part(date);\r\n  },\r\n  hour_start: function (date) {\r\n    if (date.getMinutes())\r\n      date.setMinutes(0);\r\n    this.minute_start(date);\r\n\r\n    return date;\r\n  },\r\n  minute_start: function (date) {\r\n    if (date.getSeconds())\r\n      date.setSeconds(0);\r\n    if (date.getMilliseconds())\r\n      date.setMilliseconds(0);\r\n    return date;\r\n  },\r\n  _add_days: function (date, inc) {\r\n    var ndate = new Date(date.valueOf());\r\n\r\n    ndate.setDate(ndate.getDate() + inc);\r\n    if (inc >= 0 && (!date.getHours() && ndate.getHours()) &&//shift to yesterday on dst\r\n        (ndate.getDate() <= date.getDate() || ndate.getMonth() < date.getMonth() || ndate.getFullYear() < date.getFullYear()))\r\n      ndate.setTime(ndate.getTime() + 60 * 60 * 1000 * (24 - ndate.getHours()));\r\n    return ndate;\r\n  },\r\n\r\n  add: function (date, inc, mode) {\r\n    /*jsl:ignore*/\r\n    var ndate = new Date(date.valueOf());\r\n    switch (mode) {\r\n      case \"day\":\r\n        ndate = gantt.date._add_days(ndate, inc);\r\n        break;\r\n      case \"week\":\r\n        ndate = gantt.date._add_days(ndate, inc * 7);\r\n        break;\r\n      case \"month\":\r\n        ndate.setMonth(ndate.getMonth() + inc);\r\n        break;\r\n      case \"year\":\r\n        ndate.setYear(ndate.getFullYear() + inc);\r\n        break;\r\n      case \"hour\":\r\n        /*\r\n         adding hours/minutes via setHour(getHour() + inc) gives weird result when\r\n         adding one hour to the time before switch to a Daylight Saving time\r\n\r\n         example: //Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n         new Date(2014, 02, 30, 1).setHours(2)\r\n         >>Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n\r\n         setTime seems working as expected\r\n         */\r\n        ndate.setTime(ndate.getTime() + inc * 60 * 60 * 1000);\r\n        break;\r\n      case \"minute\":\r\n\r\n        ndate.setTime(ndate.getTime() + inc * 60 * 1000);\r\n\r\n        break;\r\n      default:\r\n        return gantt.date[\"add_\" + mode](date, inc, mode);\r\n    }\r\n    return ndate;\r\n    /*jsl:end*/\r\n  },\r\n  to_fixed: function (num) {\r\n    if (num < 10)    return \"0\" + num;\r\n    return num;\r\n  },\r\n  copy: function (date) {\r\n    return new Date(date.valueOf());\r\n  },\r\n  date_to_str: function (format, utc) {\r\n    format = format.replace(/%[a-zA-Z]/g, function (a) {\r\n      switch (a) {\r\n        case \"%d\":\r\n          return \"\\\"+gantt.date.to_fixed(date.getDate())+\\\"\";\r\n        case \"%m\":\r\n          return \"\\\"+gantt.date.to_fixed((date.getMonth()+1))+\\\"\";\r\n        case \"%j\":\r\n          return \"\\\"+date.getDate()+\\\"\";\r\n        case \"%n\":\r\n          return \"\\\"+(date.getMonth()+1)+\\\"\";\r\n        case \"%y\":\r\n          return \"\\\"+gantt.date.to_fixed(date.getFullYear()%100)+\\\"\";\r\n        case \"%Y\":\r\n          return \"\\\"+date.getFullYear()+\\\"\";\r\n        case \"%D\":\r\n          return \"\\\"+gantt.locale.date.day_short[date.getDay()]+\\\"\";\r\n        case \"%l\":\r\n          return \"\\\"+gantt.locale.date.day_full[date.getDay()]+\\\"\";\r\n        case \"%M\":\r\n          return \"\\\"+gantt.locale.date.month_short[date.getMonth()]+\\\"\";\r\n        case \"%F\":\r\n          return \"\\\"+gantt.locale.date.month_full[date.getMonth()]+\\\"\";\r\n        case \"%h\":\r\n          return \"\\\"+gantt.date.to_fixed((date.getHours()+11)%12+1)+\\\"\";\r\n        case \"%g\":\r\n          return \"\\\"+((date.getHours()+11)%12+1)+\\\"\";\r\n        case \"%G\":\r\n          return \"\\\"+date.getHours()+\\\"\";\r\n        case \"%H\":\r\n          return \"\\\"+gantt.date.to_fixed(date.getHours())+\\\"\";\r\n        case \"%i\":\r\n          return \"\\\"+gantt.date.to_fixed(date.getMinutes())+\\\"\";\r\n        case \"%a\":\r\n          return \"\\\"+(date.getHours()>11?\\\"pm\\\":\\\"am\\\")+\\\"\";\r\n        case \"%A\":\r\n          return \"\\\"+(date.getHours()>11?\\\"PM\\\":\\\"AM\\\")+\\\"\";\r\n        case \"%s\":\r\n          return \"\\\"+gantt.date.to_fixed(date.getSeconds())+\\\"\";\r\n        case \"%W\":\r\n          return \"\\\"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+\\\"\";\r\n        default:\r\n          return a;\r\n      }\r\n    });\r\n    if (utc) format = format.replace(/date\\.get/g, \"date.getUTC\");\r\n    return new Function(\"date\", \"return \\\"\" + format + \"\\\";\");\r\n  },\r\n  str_to_date: function (format, utc) {\r\n    var splt = \"var temp=date.match(/[a-zA-Z]+|[0-9]+/g);\";\r\n    var mask = format.match(/%[a-zA-Z]/g);\r\n    for (var i = 0; i < mask.length; i++) {\r\n      switch (mask[i]) {\r\n        case \"%j\":\r\n        case \"%d\":\r\n          splt += \"set[2]=temp[\" + i + \"]||1;\";\r\n          break;\r\n        case \"%n\":\r\n        case \"%m\":\r\n          splt += \"set[1]=(temp[\" + i + \"]||1)-1;\";\r\n          break;\r\n        case \"%y\":\r\n          splt += \"set[0]=temp[\" + i + \"]*1+(temp[\" + i + \"]>50?1900:2000);\";\r\n          break;\r\n        case \"%g\":\r\n        case \"%G\":\r\n        case \"%h\":\r\n        case \"%H\":\r\n          splt += \"set[3]=temp[\" + i + \"]||0;\";\r\n          break;\r\n        case \"%i\":\r\n          splt += \"set[4]=temp[\" + i + \"]||0;\";\r\n          break;\r\n        case \"%Y\":\r\n          splt += \"set[0]=temp[\" + i + \"]||0;\";\r\n          break;\r\n        case \"%a\":\r\n        case \"%A\":\r\n          splt += \"set[3]=set[3]%12+((temp[\" + i + \"]||'').toLowerCase()=='am'?0:12);\";\r\n          break;\r\n        case \"%s\":\r\n          splt += \"set[5]=temp[\" + i + \"]||0;\";\r\n          break;\r\n        case \"%M\":\r\n          splt += \"set[1]=gantt.locale.date.month_short_hash[temp[\" + i + \"]]||0;\";\r\n          break;\r\n        case \"%F\":\r\n          splt += \"set[1]=gantt.locale.date.month_full_hash[temp[\" + i + \"]]||0;\";\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n    var code = \"set[0],set[1],set[2],set[3],set[4],set[5]\";\r\n    if (utc) code = \" Date.UTC(\" + code + \")\";\r\n    return new Function(\"date\", \"var set=[0,0,1,0,0,0]; \" + splt + \" return new Date(\" + code + \");\");\r\n  },\r\n  getISOWeek: function (ndate) {\r\n    if (!ndate) return false;\r\n    var nday = ndate.getDay();\r\n    if (nday === 0) {\r\n      nday = 7;\r\n    }\r\n    var first_thursday = new Date(ndate.valueOf());\r\n    first_thursday.setDate(ndate.getDate() + (4 - nday));\r\n    var year_number = first_thursday.getFullYear(); // year of the first Thursday\r\n    var ordinal_date = Math.round((first_thursday.getTime() - new Date(year_number, 0, 1).getTime()) / 86400000); //ordinal date of the first Thursday - 1 (so not really ordinal date)\r\n    var week_number = 1 + Math.floor(ordinal_date / 7);\r\n    return week_number;\r\n  },\r\n  getUTCISOWeek: function (ndate) {\r\n    return this.getISOWeek(ndate);\r\n  },\r\n  convert_to_utc: function (date) {\r\n    return new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());\r\n  },\r\n  parseDate: function (date, format) {\r\n    // raw date may be of type string, number (timestamp) or something else\r\n    // do not check for instanceof Date explicitly, since we may swap native date with different date implementation at some point\r\n    if (date && !date.getFullYear) {\r\n      if (gantt.defined(format)) {\r\n        if (typeof(format) == \"string\")\r\n          format = gantt.defined(gantt.templates[format]) ? gantt.templates[format] : gantt.date.str_to_date(format);\r\n        else\r\n          format = gantt.templates.xml_date;\r\n      }\r\n      if (date)\r\n        date = format(date);\r\n      else\r\n        date = null;\r\n    }\r\n    return date;\r\n  }\r\n};\r\ngantt.date.quarter_start = function (date) {\r\n  gantt.date.month_start(date);\r\n  var m = date.getMonth(),\r\n      res_month;\r\n\r\n  if (m >= 9) {\r\n    res_month = 9;\r\n  } else if (m >= 6) {\r\n    res_month = 6;\r\n  } else if (m >= 3) {\r\n    res_month = 3;\r\n  } else {\r\n    res_month = 0;\r\n  }\r\n\r\n  date.setMonth(res_month);\r\n  return date;\r\n};\r\ngantt.date.add_quarter = function (date, inc) {\r\n  return gantt.date.add(date, inc * 3, \"month\");\r\n};\r\nif (window.jQuery) {\r\n\r\n  (function ($) {\r\n\r\n    var methods = [];\r\n    $.fn.dhx_gantt = function (config) {\r\n      config = config || {};\r\n      if (typeof(config) === 'string') {\r\n        if (methods[config]) {\r\n          return methods[config].apply(this, []);\r\n        } else {\r\n          $.error('Method ' + config + ' does not exist on jQuery.dhx_gantt');\r\n        }\r\n      } else {\r\n        var views = [];\r\n        this.each(function () {\r\n          if (this && this.getAttribute) {\r\n            if (!this.getAttribute(\"dhxgantt\")) {\r\n              for (var key in config)\r\n                if (key != \"data\")\r\n                  gantt.config[key] = config[key];\r\n\r\n              gantt.init(this);\r\n              if (config.data)\r\n                gantt.parse(config.data);\r\n\r\n              views.push(gantt);\r\n            }\r\n          }\r\n        });\r\n\r\n\r\n        if (views.length === 1) return views[0];\r\n        return views;\r\n      }\r\n    };\r\n\r\n  })(jQuery);\r\n\r\n}\r\n\r\ngantt.locale = {\r\n  date: {\r\n    month_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n    // month_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n    month_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n    day_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n    // day_short: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\r\n    day_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n  },\r\n  labels: {\r\n    new_task: \"New task\",\r\n    icon_save: \"Save\",\r\n    icon_cancel: \"Cancel\",\r\n    icon_details: \"Details\",\r\n    icon_edit: \"Edit\",\r\n    icon_delete: \"Delete\",\r\n    confirm_closing: \"\",//Your changes will be lost, are you sure?\r\n    confirm_deleting: \"Task will be deleted permanently, are you sure?\",\r\n    section_description: \"Description\",\r\n    section_time: \"Time period\",\r\n    section_type: \"Type\",\r\n\r\n    /* grid columns */\r\n\r\n    column_text: \"Task name\",\r\n    column_start_date: \"Start time\",\r\n    column_duration: \"Duration\",\r\n    column_add: \"\",\r\n\r\n    /* link confirmation */\r\n    link: \"Link\",\r\n    confirm_link_deleting: \"will be deleted\",\r\n    link_start: \" (start)\",\r\n    link_end: \" (end)\",\r\n\r\n    type_task: \"Task\",\r\n    type_project: \"Project\",\r\n    type_milestone: \"Milestone\",\r\n\r\n    minutes: \"Minutes\",\r\n    hours: \"Hours\",\r\n    days: \"Days\",\r\n    weeks: \"Week\",\r\n    months: \"Months\",\r\n    years: \"Years\",\r\n\r\n    /* message popup */\r\n    message_ok: \"OK\",\r\n    message_cancel: \"Cancel\"\r\n\r\n  }\r\n};\r\n\r\n\r\ngantt.skins.skyblue = {\r\n  config: {\r\n    grid_width: 350,\r\n    row_height: 27,\r\n    scale_height: 27,\r\n    link_line_width: 1,\r\n    link_arrow_size: 8,\r\n    lightbox_additional_height: 75\r\n  },\r\n  _second_column_width: 95,\r\n  _third_column_width: 80\r\n};\r\ngantt.skins.meadow = {\r\n  config: {\r\n    grid_width: 350,\r\n    row_height: 27,\r\n    scale_height: 30,\r\n    link_line_width: 2,\r\n    link_arrow_size: 6,\r\n    lightbox_additional_height: 72\r\n  },\r\n  _second_column_width: 95,\r\n  _third_column_width: 80\r\n};\r\n\r\ngantt.skins.terrace = {\r\n  config: {\r\n    grid_width: 360,\r\n    row_height: 35,\r\n    scale_height: 35,\r\n    link_line_width: 2,\r\n    link_arrow_size: 6,\r\n    lightbox_additional_height: 75\r\n  },\r\n  _second_column_width: 90,\r\n  _third_column_width: 70\r\n};\r\ngantt.skins.broadway = {\r\n  config: {\r\n    grid_width: 360,\r\n    row_height: 35,\r\n    scale_height: 35,\r\n    link_line_width: 1,\r\n    link_arrow_size: 7,\r\n    lightbox_additional_height: 86\r\n  },\r\n  _second_column_width: 90,\r\n  _third_column_width: 80,\r\n\r\n  _lightbox_template: \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>\",\r\n  _config_buttons_left: {},\r\n  _config_buttons_right: {\r\n    \"gantt_delete_btn\": \"icon_delete\",\r\n    \"gantt_save_btn\": \"icon_save\"\r\n  }\r\n};\r\n\r\n\r\ngantt.skins[\"contrast_black\"] = {\r\n  config: {\r\n    grid_width: 360,\r\n    row_height: 35,\r\n    scale_height: 35,\r\n    link_line_width: 2,\r\n    link_arrow_size: 6,\r\n    lightbox_additional_height: 75\r\n  },\r\n  _second_column_width: 100,\r\n  _third_column_width: 80\r\n};\r\ngantt.skins[\"contrast_white\"] = {\r\n  config: {\r\n    grid_width: 360,\r\n    row_height: 35,\r\n    scale_height: 35,\r\n    link_line_width: 2,\r\n    link_arrow_size: 6,\r\n    lightbox_additional_height: 75\r\n  },\r\n  _second_column_width: 100,\r\n  _third_column_width: 80\r\n};\r\n\r\ngantt.config.touch_drag = 500; //nearly immediate dnd\r\ngantt.config.touch = true;\r\ngantt.config.touch_feedback = true;\r\ngantt.config.touch_feedback_duration = 1;\r\ngantt._prevent_touch_scroll = false;\r\n\r\n\r\ngantt._touch_feedback = function () {\r\n  if (gantt.config.touch_feedback) {\r\n    if (navigator.vibrate)\r\n      navigator.vibrate(gantt.config.touch_feedback_duration);\r\n  }\r\n};\r\n\r\ngantt._init_touch_events = function () {\r\n  if (this.config.touch != \"force\")\r\n    this.config.touch = this.config.touch &&\r\n        ((navigator.userAgent.indexOf(\"Mobile\") != -1) ||\r\n        (navigator.userAgent.indexOf(\"iPad\") != -1) ||\r\n        (navigator.userAgent.indexOf(\"Android\") != -1) ||\r\n        (navigator.userAgent.indexOf(\"Touch\") != -1));\r\n\r\n  if (this.config.touch) {\r\n\r\n    var touchEventsSupported = true;\r\n    try {\r\n      document.createEvent(\"TouchEvent\");\r\n    } catch (e) {\r\n      touchEventsSupported = false;\r\n    }\r\n\r\n    if (touchEventsSupported) {\r\n      this._touch_events([\"touchmove\", \"touchstart\", \"touchend\"], function (ev) {\r\n        if (ev.touches && ev.touches.length > 1) return null;\r\n        if (ev.touches[0])\r\n          return {\r\n            target: ev.target,\r\n            pageX: ev.touches[0].pageX,\r\n            pageY: ev.touches[0].pageY,\r\n            clientX: ev.touches[0].clientX,\r\n            clientY: ev.touches[0].clientY\r\n          };\r\n        else\r\n          return ev;\r\n      }, function () {\r\n        return false;\r\n      });\r\n    } else if (window.navigator.pointerEnabled) {\r\n      this._touch_events([\"pointermove\", \"pointerdown\", \"pointerup\"], function (ev) {\r\n        if (ev.pointerType == \"mouse\") return null;\r\n        return ev;\r\n      }, function (ev) {\r\n        return (!ev || (ev.pointerType == \"mouse\" ));\r\n      });\r\n    } else if (window.navigator.msPointerEnabled) {\r\n      this._touch_events([\"MSPointerMove\", \"MSPointerDown\", \"MSPointerUp\"], function (ev) {\r\n        if (ev.pointerType == ev.MSPOINTER_TYPE_MOUSE) return null;\r\n        return ev;\r\n      }, function (ev) {\r\n        return (!ev || ev.pointerType == ev.MSPOINTER_TYPE_MOUSE);\r\n      });\r\n    }\r\n\r\n  }\r\n};\r\n\r\n\r\n//we can't use native scrolling, as we need to sync momentum between different parts\r\n//so we will block native scroll and use the custom one\r\n//in future we can add custom momentum\r\ngantt._touch_events = function (names, accessor, ignore) {\r\n  //webkit on android need to be handled separately\r\n  var dblclicktime = 0;\r\n  var action_mode = false;\r\n  var scroll_mode = false;\r\n  var dblclick_timer = 0;\r\n  var action_start = null;\r\n  var scroll_state;\r\n  var long_tap_timer = null;\r\n  var current_target = null;\r\n\r\n  //touch move\r\n  if (!this._gantt_touch_event_ready) {\r\n    this._gantt_touch_event_ready = 1;\r\n    gantt.event(gantt.$container, names[0], function (e) {\r\n      if (ignore(e)) return;\r\n\r\n      //ignore common and scrolling moves\r\n      if (!action_mode) return;\r\n\r\n      if (long_tap_timer) clearTimeout(long_tap_timer);\r\n\r\n      var source = accessor(e);\r\n      if (gantt._tasks_dnd.drag.id || gantt._tasks_dnd.drag.start_drag) {\r\n        gantt._tasks_dnd.on_mouse_move(source);\r\n        if (e.preventDefault)\r\n          e.preventDefault();\r\n        e.cancelBubble = true;\r\n        return false;\r\n      }\r\n      if (!gantt._prevent_touch_scroll) {\r\n        if (source && action_start) {\r\n          var dx = action_start.pageX - source.pageX;\r\n          var dy = action_start.pageY - source.pageY;\r\n          if (!scroll_mode && (Math.abs(dx) > 5 || Math.abs(dy) > 5)) {\r\n            gantt._touch_scroll_active = scroll_mode = true;\r\n            dblclicktime = 0;\r\n            scroll_state = gantt.getScrollState();\r\n          }\r\n\r\n          if (scroll_mode) {\r\n            gantt.scrollTo(scroll_state.x + dx, scroll_state.y + dy);\r\n            var new_scroll_state = gantt.getScrollState();\r\n\r\n            if ((scroll_state.x != new_scroll_state.x && dy > 2 * dx) ||\r\n                (scroll_state.y != new_scroll_state.y && dx > 2 * dy )) {\r\n              return block_action(e);\r\n            }\r\n          }\r\n        }\r\n        return block_action(e);\r\n      }\r\n      return true;\r\n    });\r\n  }\r\n\r\n  //block touch context menu in IE10\r\n  gantt.event(this.$container, \"contextmenu\", function (e) {\r\n    if (action_mode)\r\n      return block_action(e);\r\n  });\r\n\r\n  //touch start\r\n  gantt.event(this.$container, names[1], function (e) {\r\n    if (ignore(e)) return;\r\n    if (e.touches && e.touches.length > 1) {\r\n      action_mode = false;\r\n      return;\r\n    }\r\n\r\n    action_start = accessor(e);\r\n    if (!gantt._locate_css(action_start, \"gantt_hor_scroll\") && !gantt._locate_css(action_start, \"gantt_ver_scroll\")) {\r\n      action_mode = true;\r\n    }\r\n\r\n\r\n    //long tap\r\n    long_tap_timer = setTimeout(function () {\r\n      var taskId = gantt.locate(action_start);\r\n      if (taskId && !gantt._locate_css(action_start, \"gantt_link_control\") && !gantt._locate_css(action_start, \"gantt_grid_data\")) {\r\n        gantt._tasks_dnd.on_mouse_down(action_start);\r\n\r\n        if (gantt._tasks_dnd.drag && gantt._tasks_dnd.drag.start_drag) {\r\n          cloneTaskRendered(taskId);\r\n          gantt._tasks_dnd._start_dnd(action_start);\r\n          gantt._touch_drag = true;\r\n\r\n          gantt.refreshTask(taskId);\r\n\r\n          gantt._touch_feedback();\r\n        }\r\n\r\n      }\r\n\r\n      long_tap_timer = null;\r\n    }, gantt.config.touch_drag);\r\n  });\r\n\r\n  //touch end\r\n  gantt.event(this.$container, names[2], function (e) {\r\n    if (ignore(e)) return;\r\n    if (long_tap_timer) clearTimeout(long_tap_timer);\r\n    gantt._touch_drag = false;\r\n    action_mode = false;\r\n    var source = accessor(e);\r\n    gantt._tasks_dnd.on_mouse_up(source);\r\n\r\n    if (current_target) {\r\n      gantt.refreshTask(gantt.locate(current_target));\r\n      if (current_target.parentNode) {\r\n        current_target.parentNode.removeChild(current_target);\r\n        gantt._touch_feedback();\r\n      }\r\n    }\r\n\r\n    gantt._touch_scroll_active = action_mode = scroll_mode = false;\r\n    current_target = null;\r\n\r\n    //dbl-tap handling\r\n    if (action_start && dblclicktime) {\r\n      var now = new Date();\r\n      if ((now - dblclicktime) < 500) {\r\n        gantt._on_dblclick(action_start);\r\n        block_action(e);\r\n      } else\r\n        dblclicktime = now;\r\n    } else {\r\n      dblclicktime = new Date();\r\n    }\r\n  });\r\n\r\n\r\n  //common helper, prevents event\r\n  function block_action(e) {\r\n    if (e && e.preventDefault)\r\n      e.preventDefault();\r\n    (e || event).cancelBubble = true;\r\n    return false;\r\n  }\r\n\r\n  function cloneTaskRendered(taskId) {\r\n    var renders = gantt._task_area_pulls;\r\n    var task = gantt.getTask(taskId);\r\n    if (task && gantt.isTaskVisible(taskId)) {\r\n      for (var i in renders) {\r\n        task = renders[i][taskId];\r\n        if (task && task.getAttribute(\"task_id\") && task.getAttribute(\"task_id\") == taskId) {\r\n          var copy = task.cloneNode(true);\r\n          current_target = task;\r\n          renders[i][taskId] = copy;\r\n          task.style.display = \"none\";\r\n          copy.className += \" gantt_drag_move \";\r\n          task.parentNode.appendChild(copy);\r\n          return copy;\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n(function () {\r\n\r\n  function deprecated(badCode, goodCode) {\r\n\r\n    var formatting = gantt.env.isIE ? \"\" : \"%c\";\r\n\r\n\r\n    var message = [\r\n      formatting, \"\\\"\", badCode, \"\\\"\", formatting,\r\n      \" has been deprecated in dhtmlxGantt v4.0 and will stop working in v5.0. Use \",\r\n      formatting, \"\\\"\", goodCode, \"\\\"\", formatting,\r\n      \" instead. \\nSee more details at http://docs.dhtmlx.com/gantt/migrating.html \"\r\n    ].join(\"\");\r\n\r\n    var log = window.console.warn || window.console.log;\r\n\r\n    var args = [message];\r\n    if (!gantt.env.isIE) {\r\n      args = args.concat([\"font-weight:bold\", \"font-weight:normal\", \"font-weight:bold\", \"font-weight:normal\"]);\r\n    }\r\n\r\n    log.apply(window.console, args);\r\n  }\r\n\r\n  function wrapDeprecated(method) {\r\n    return function () {\r\n      deprecated(\"dhtmlx.\" + method, \"gantt.\" + method);\r\n      return gantt[method].apply(gantt, arguments);\r\n    };\r\n  }\r\n\r\n  /* dhtmlx */\r\n\r\n\r\n  if (!window.dhtmlx)\r\n    window.dhtmlx = {};\r\n\r\n  var dhtmlxMethods = [\r\n    \"message\",\r\n    \"alert\",\r\n    \"confirm\",\r\n    \"modalbox\",\r\n    \"uid\",\r\n    \"copy\",\r\n    \"mixin\",\r\n    \"defined\",\r\n    \"bind\",\r\n    \"assert\"\r\n  ];\r\n\r\n  for (var i = 0; i < dhtmlxMethods.length; i++) {\r\n    // wrap dhtmlx methods with 'deprecated' warnings\r\n    // do not wrap if methods are defined by dhtmlxSuite\r\n    if (!window.dhtmlx[dhtmlxMethods[i]]) {\r\n      dhtmlx[dhtmlxMethods[i]] = wrapDeprecated(dhtmlxMethods[i]);\r\n    }\r\n  }\r\n  /* global functions */\r\n\r\n\r\n  if (!window.dataProcessor) {\r\n    window.dataProcessor = function (url) {\r\n      deprecated(\"new dataProcessor(url)\", \"new gantt.dataProcessor(url)\");\r\n      return new gantt.dataProcessor(url);\r\n    };\r\n  }\r\n\r\n})();"]}